!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-dsv"),require("d3-time-format"),require("d3-array"),require("d3-shape"),require("d3-path"),require("d3-scale"),require("d3-scale-chromatic"),require("d3-interpolate"),require("d3-time"),require("d3-format"),require("d3-geo"),require("d3-force"),require("d3-collection"),require("d3-hierarchy"),require("d3-voronoi"),require("d3-color"),require("d3-timer")):"function"==typeof define&&define.amd?define(["exports","d3-dsv","d3-time-format","d3-array","d3-shape","d3-path","d3-scale","d3-scale-chromatic","d3-interpolate","d3-time","d3-format","d3-geo","d3-force","d3-collection","d3-hierarchy","d3-voronoi","d3-color","d3-timer"],t):t(e.vega={},e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3)}(this,function(y,n,f,v,e,b,x,r,l,t,u,a,p,o,s,c,i,d){"use strict";function g(e,t,n){return e.fields=t||[],e.fname=n,e}function k(e){return null==e?null:e.fname}function _(e){return null==e?null:e.fields}function Ue(e){throw Error(e)}function w(e){var t,n,r,i=[],a=null,o=0,u=e.length,s="";function l(){i.push(s+e.substring(t,n)),s="",t=n+1}for(e+="",t=n=0;n<u;++n)if("\\"===(r=e[n]))s+=e.substring(t,n),t=++n;else if(r===a)l(),a=null,o=-1;else{if(a)continue;t===o&&'"'===r?(t=n+1,a=r):t===o&&"'"===r?(t=n+1,a=r):"."!==r||o?"["===r?(t<n&&l(),o=t=n+1):"]"===r&&(o||Ue("Access path missing open bracket: "+e),0<o&&l(),o=0,t=n+1):t<n?l():t=n+1}return o&&Ue("Access path missing closing bracket: "+e),a&&Ue("Access path missing closing quote: "+e),t<n&&(n++,l()),i}var h=Array.isArray;function J(e){return e===Object(e)}function m(e){return"string"==typeof e}function Q(e){return h(e)?"["+e.map(Q)+"]":J(e)||m(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function M(e,t){var n=w(e),r="return _["+n.map(Q).join("][")+"];";return g(Function("_",r),[e=1===n.length?n[0]:e],t||e)}var O=[],E=M("id"),R=g(function(e){return e},O,"identity"),S=g(function(){return 0},O,"zero"),z=g(function(){return 1},O,"one"),D=g(function(){return!0},O,"true"),A=g(function(){return!1},O,"false");function C(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var P=0,q=1,L=2,T=3,F=4;function N(e){var t=e||P;return{level:function(e){return arguments.length?(t=+e,this):t},error:function(){return q<=t&&C("error","ERROR",arguments),this},warn:function(){return L<=t&&C("warn","WARN",arguments),this},info:function(){return T<=t&&C("log","INFO",arguments),this},debug:function(){return F<=t&&C("log","DEBUG",arguments),this}}}function I(e){return e[e.length-1]}function j(e){return null==e||""===e?null:+e}function U(t){return function(e){return t*Math.exp(e)}}function B(t){return function(e){return Math.log(t*e)}}function $(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function G(e,t,n,r){var i=n(e[0]),a=n(I(e)),o=(a-i)*t;return[r(i-o),r(a-o)]}function W(e,t){return G(e,t,j,R)}function Y(e,t){var n=Math.sign(e[0]);return G(e,t,B(n),U(n))}function H(e,t,n){return G(e,t,$(n),$(1/n))}function V(e,t,n,r,i){var a=r(e[0]),o=r(I(e)),u=null!=t?r(t):(a+o)/2;return[i(u+(a-u)*n),i(u+(o-u)*n)]}function X(e,t,n){return V(e,t,n,j,R)}function K(e,t,n){var r=Math.sign(e[0]);return V(e,t,n,B(r),U(r))}function Z(e,t,n,r){return V(e,t,n,$(r),$(1/r))}function ee(e){return null!=e?h(e)?e:[e]:[]}function te(e){return"function"==typeof e}function ne(e,t){var n,r,i,a,o,u,s,l,c,f=[],d=(e=ee(e)).map(function(e,t){return null==e?null:(f.push(t),te(e)?e:w(e).map(Q).join("]["))}),h=f.length-1,p=ee(t),m="var u,v;return ";if(h<0)return null;for(r=0;r<=h;++r)te(i=d[n=f[r]])?(a="(u=this."+(u="f"+n)+"(a))",o="(v=this."+u+"(b))",(s=s||{})[u]=i):(a="(u=a["+i+"])",o="(v=b["+i+"])"),u="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))","descending"!==p[n]?l=-(c=1):(c=-1,l=1),m+="("+a+"<"+o+"||u==null)&&v!=null?"+l+":(u>v||v==null)&&u!=null?"+c+":"+u+"!==u&&v===v?"+l+":v!==v&&u===u?"+c+(n<h?":":":0");return i=Function("a","b",m+";"),s&&(i=i.bind(s)),e=e.reduce(function(t,e){return te(e)?(_(e)||[]).forEach(function(e){t[e]=1}):null!=e&&(t[e+""]=1),t},{}),g(i,Object.keys(e))}function re(e){return te(e)?e:function(){return e}}function ie(t,e){var n,r;function i(){e(r),n=r=null}return function(e){r=e,n&&clearTimeout(n),n=setTimeout(i,t)}}function Be(e){for(var t,n,r=1,i=arguments.length;r<i;++r)for(n in t=arguments[r])e[n]=t[n];return e}function ae(e,t){var n,r,i,a,o,u=-1,s=e.length;if(null==t){for(;++u<s;)if(null!=(r=e[u])&&r<=r){n=i=r;break}for(a=o=u;++u<s;)null!=(r=e[u])&&(r<n&&(n=r,a=u),i<r&&(i=r,o=u))}else{for(;++u<s;)if(null!=(r=t(e[u],u,e))&&r<=r){n=i=r;break}for(a=o=u;++u<s;)null!=(r=t(e[u],u,e))&&(r<n&&(n=r,a=u),i<r&&(i=r,o=u))}return[a,o]}var oe={};function ue(t){var i,a,o={};function n(e){return o.hasOwnProperty(e)&&o[e]!==oe}return i={size:0,empty:0,object:o,has:n,get:function(e){return n(e)?o[e]:void 0},set:function(e,t){return n(e)||(++i.size,o[e]===oe&&--i.empty),o[e]=t,this},delete:function(e){return n(e)&&(--i.size,++i.empty,o[e]=oe),this},clear:function(){i.size=i.empty=0,i.object=o={}},test:function(e){return arguments.length?(a=e,i):a},clean:function(){var e,t,n={},r=0;for(e in o)(t=o[e])===oe||a&&a(t)||(n[e]=t,++r);i.size=r,i.empty=0,i.object=o=n}},t&&Object.keys(t).forEach(function(e){i.set(e,t[e])}),i}function se(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n}function le(e){return"boolean"==typeof e}function ce(e){return"[object Date]"===Object.prototype.toString.call(e)}function fe(e){return"number"==typeof e}function de(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function he(e,t){return e&&(e=t?ee(e).map(function(e){return e.replace(/\\(.)/g,"$1")}):ee(e)),g(e&&e.length?Function("_","return ''+"+e.map(function(e){return"_["+(t?Q(e):w(e).map(Q).join("]["))+"]"}).join("+'|'+")+";"):function(){return""},e,"key")}function pe(e,t,n,r){var i=t.length,a=n.length;if(!a)return t;if(!i)return n;for(var o=r||new t.constructor(i+a),u=0,s=0,l=0;u<i&&s<a;++l)o[l]=0<e(t[u],n[s])?n[s++]:t[u++];for(;u<i;++u,++l)o[l]=t[u];for(;s<a;++s,++l)o[l]=n[s];return o}function me(e,t){for(var n="";0<=--t;)n+=e;return n}function ge(e,t,n,r){var i=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===r?me(i,o)+a:"center"===r?me(i,~~(o/2))+a+me(i,Math.ceil(o/2)):a+me(i,o)}function ve(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e)&&!!e}function ye(e){return fe(e)?e:ce(e)?e:Date.parse(e)}function be(e,t){return t=t||ye,null==e||""===e?null:t(e)}function xe(e){return null==e||""===e?null:e+""}function _e(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}function we(e,t,n,r){var i=null!=r?r:"…",a=e+"",o=a.length,u=Math.max(0,t-i.length);return o<=t?a:"left"===n?i+a.slice(o-u):"center"===n?a.slice(0,Math.ceil(u/2))+i+a.slice(o-~~(u/2)):a.slice(0,u)+i}function ke(e,t,n){if(e){var r,i=0,a=e.length;if(t)for(;i<a;++i)(r=t(e[i]))&&n(r,i,e);else e.forEach(n)}}function Me(e){var r=e||R,i=[],a={};return i.add=function(e){var t=r(e);return a[t]||(a[t]=1,i.push(e)),i},i.remove=function(e){var t,n=r(e);return a[n]&&(a[n]=0)<=(t=i.indexOf(e))&&i.splice(t,1),i},i}var Oe=Symbol("vega_id"),Ee=1;function Re(e){return!(!e||!Se(e))}function Se(e){return e[Oe]}function ze(e,t){return e[Oe]=t,e}function De(e){var t=e===Object(e)?e:{data:e};return Se(t)?t:ze(t,Ee++)}function Ae(e){return Ce(e,De({}))}function Ce(e,t){for(var n in e)t[n]=e[n];return t}function Pe(e,t){return ze(t,Se(e))}function qe(e){return e&&e.constructor===Le}function Le(){var c=[],f=[],d=[],h=[],p=[],m=!1;return{constructor:Le,insert:function(e){for(var t=ee(e),n=0,r=t.length;n<r;++n)c.push(t[n]);return this},remove:function(e){for(var t=te(e)?h:f,n=ee(e),r=0,i=n.length;r<i;++r)t.push(n[r]);return this},modify:function(e,t,n){var r={field:t,value:re(n)};return te(e)?(r.filter=e,p.push(r)):(r.tuple=e,d.push(r)),this},encode:function(e,t){return te(e)?p.push({filter:e,field:t}):d.push({tuple:e,field:t}),this},reflow:function(){return m=!0,this},pulse:function(r,e){var i,t,n,a,o,u,s;for(t=0,n=c.length;t<n;++t)r.add.push(De(c[t]));for(i={},t=0,n=f.length;t<n;++t)i[Se(u=f[t])]=u;for(t=0,n=h.length;t<n;++t)o=h[t],e.forEach(function(e){o(e)&&(i[Se(e)]=e)});for(s in i)r.rem.push(i[s]);function l(e,t,n){n?e[t]=n(e):r.encode=t,m||(i[Se(e)]=e)}for(i={},t=0,n=d.length;t<n;++t)l((a=d[t]).tuple,a.field,a.value),r.modifies(a.field);for(t=0,n=p.length;t<n;++t)a=p[t],o=a.filter,e.forEach(function(e){o(e)&&l(e,a.field,a.value)}),r.modifies(a.field);if(m)r.mod=f.length||h.length?e.filter(function(e){return i.hasOwnProperty(Se(e))}):e.slice();else for(s in i)r.mod.push(i[s]);return r}}}var Te="_:mod:_";function Fe(){Object.defineProperty(this,Te,{writable:!0,value:{}})}(ol=Fe.prototype).set=function(e,t,n,r){var i=this[e],a=this[Te];return null!=t&&0<=t?(i[t]!==n||r)&&(i[t]=n,a[t+":"+e]=-1,a[e]=-1):(i!==n||r)&&(this[e]=n,a[e]=h(n)?1+n.length:-1),this},ol.modified=function(e,t){var n,r=this[Te];if(!arguments.length){for(n in r)if(r[n])return!0;return!1}if(h(e)){for(n=0;n<e.length;++n)if(r[e[n]])return!0;return!1}return null!=t&&0<=t?t+1<r[e]||!!r[t+":"+e]:!!r[e]},ol.clear=function(){return this[Te]={},this};var Ne=0,Ie=new Fe;function je(e,t,n,r){this.id=++Ne,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}var $e=je.prototype;function Ge(n){return function(e){var t=this.flags;return 0===arguments.length?!!(t&n):(this.flags=e?t|n:t&~n,this)}}$e.targets=function(){return this._targets||(this._targets=Me(E))},$e.set=function(e){return this.value!==e?(this.value=e,1):0},$e.skip=Ge(1),$e.modified=Ge(2),$e.parameters=function(e,r){r=!1!==r;var t,n,i,a,o=this,u=o._argval=o._argval||new Fe,s=o._argops=o._argops||[],l=[];function c(e,t,n){n instanceof je?(n!==o&&(r&&n.targets().add(o),l.push(n)),s.push({op:n,name:e,index:t})):u.set(e,t,n)}for(t in e)if(n=e[t],"pulse"===t)ee(n).forEach(function(e){e instanceof je?e!==o&&(e.targets().add(o),l.push(e)):Ue("Pulse parameters must be operator instances.")}),o.source=n;else if(h(n))for(u.set(t,-1,Array(i=n.length)),a=0;a<i;++a)c(t,a,n[a]);else c(t,-1,n);return this.marshall().clear(),l},$e.marshall=function(e){var t,n,r,i,a,o=this._argval||Ie,u=this._argops;if(u&&(r=u.length))for(n=0;n<r;++n)a=(i=(t=u[n]).op).modified()&&i.stamp===e,o.set(t.name,t.index,i.value,a);return o},$e.evaluate=function(e){if(this._update){var t=this.marshall(e.stamp),n=this._update(t,e);if(t.clear(),n!==this.value)this.value=n;else if(!this.modified())return e.StopPropagation}},$e.run=function(e){return e.stamp<=this.stamp?e.StopPropagation:(this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.stamp=e.stamp,(this.pulse=t)||e);var t};var We=0;function Ye(e,t,n){this.id=++We,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function He(e,t,n){return new Ye(e,t,n)}var Ve=Ye.prototype;Ve._filter=D,Ve._apply=R,Ve.targets=function(){return this._targets||(this._targets=Me(E))},Ve.consume=function(e){return arguments.length?(this._consume=!!e,this):!!this._consume},Ve.receive=function(e){if(this._filter(e)){for(var t=this.value=this._apply(e),n=this._targets,r=n?n.length:0,i=0;i<r;++i)n[i].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},Ve.filter=function(e){var t=He(e);return this.targets().add(t),t},Ve.apply=function(e){var t=He(null,e);return this.targets().add(t),t},Ve.merge=function(){var e=He();this.targets().add(e);for(var t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},Ve.throttle=function(t){var n=-1;return this.filter(function(){var e=Date.now();return t<e-n?(n=e,1):0})},Ve.debounce=function(e){var n=He();return this.targets().add(He(null,null,ie(e,function(e){var t=e.dataflow;n.receive(e),t&&t.run&&t.run()}))),n},Ve.between=function(e,t){var n=!1;return e.targets().add(He(null,null,function(){n=!0})),t.targets().add(He(null,null,function(){n=!1})),this.filter(function(){return n})};var Xe=/^([A-Za-z]+:)?\/\//,Je="file://";function Qe(e){return{options:e||{},sanitize:Ze,load:Ke,file:tt,http:et}}function Ke(e,n){var r=this;return r.sanitize(e,n).then(function(e){var t=e.href;return e.localFile?r.file(t):r.http(t,n)})}function Ze(u,s){return s=Be({},this.options,s),new Promise(function(e,t){var n,r,i,a,o={href:null};null!=u&&"string"==typeof u?(r=Xe.test(u),(a=s.baseURL)&&!r&&(rt(u,"/")||"/"===a[a.length-1]||(u="/"+u),u=a+u),i=(n=rt(u,Je))||"file"===s.mode||"http"!==s.mode&&!r&&nt(),n?u=u.slice(Je.length):rt(u,"//")&&("file"===s.defaultProtocol?(u=u.slice(2),i=!0):u=(s.defaultProtocol||"http")+":"+u),Object.defineProperty(o,"localFile",{value:!!i}),o.href=u,s.target&&(o.target=s.target+""),e(o)):t("Sanitize failure, invalid URI: "+Q(u))})}function et(e,t){return(n=e,r=Be({},this.options.http,t),i="function"==typeof fetch?fetch:require("node-fetch"),i?i(n,r):Promise.reject("No fetch method available.")).then(function(e){if(!e.ok)throw e.status+""+e.statusText;return e.text()});var n,r,i}function tt(t){return new Promise(function(n,r){var e=nt();e?e.readFile(t,function(e,t){e?r(e):n(t)}):r("No file system access for "+t)})}function nt(){var e="function"==typeof require&&require("fs");return e&&te(e.readFile)?e:null}function rt(e,t){return null!=e&&0===e.lastIndexOf(t,0)}var it={boolean:ve,integer:j,number:j,date:be,string:xe,unknown:R},at=[function(e){return"true"===e||"false"===e||!0===e||!1===e},function(e){return lt(e)&&(e=+e)==~~e},lt,function(e){return!isNaN(Date.parse(e))}],ot=["boolean","integer","number","date"];function ut(e,t){if(!e||!e.length)return"unknown";var n,r,i,a,o,u=at.slice();for(r=0,i=e.length;r<i;++r){for(n=t?e[r][t]:e[r],a=0;a<u.length;++a)null==(o=n)||o!=o||u[a](n)||(u.splice(a,1),--a);if(0===u.length)return"string"}return ot[at.indexOf(u[0])]}function st(n,e){return e.reduce(function(e,t){return e[t]=ut(n,t),e},{})}function lt(e){return!(isNaN(+e)||e instanceof Date)}function ct(r){return function(e,t){var n={delimiter:r};return ft(e,t?Be(t,n):n)}}function ft(e,t){return t.header&&(e=t.header.map(Q).join(t.delimiter)+"\n"+e),n.dsvFormat(t.delimiter).parse(e+"")}function dt(e,t){var n,r,i,a=t&&t.property?M(t.property):R;return!J(e)||(i=e,"function"==typeof Buffer&&te(Buffer.isBuffer)&&Buffer.isBuffer(i))?a(JSON.parse(e)):(n=a(e),r&&r.copy?JSON.parse(JSON.stringify(n)):n)}function ht(e){return e}function pt(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map(function(e){return mt(t,e)})}:mt(t,e)}function mt(e,t){var n=t.id,r=t.bbox,i=null==t.properties?{}:t.properties,a=gt(e,t);return null==n&&null==r?{type:"Feature",properties:i,geometry:a}:null==r?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function gt(e,t){var a=function(e){if(null==e)return ht;var a,o,u=e.scale[0],s=e.scale[1],l=e.translate[0],c=e.translate[1];return function(e,t){t||(a=o=0);var n=2,r=e.length,i=new Array(r);for(i[0]=(a+=e[0])*u+l,i[1]=(o+=e[1])*s+c;n<r;)i[n]=e[n],++n;return i}}(e.transform),o=e.arcs;function i(e,t){t.length&&t.pop();for(var n=o[e<0?~e:e],r=0,i=n.length;r<i;++r)t.push(a(n[r],r));e<0&&function(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n}(t,i)}function u(e){return a(e)}function s(e){for(var t=[],n=0,r=e.length;n<r;++n)i(e[n],t);return t.length<2&&t.push(t[0]),t}function n(e){for(var t=s(e);t.length<4;)t.push(t[0]);return t}function l(e){return e.map(n)}return function e(t){var n,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(e)};case"Point":n=u(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(u);break;case"LineString":n=s(t.arcs);break;case"MultiLineString":n=t.arcs.map(s);break;case"Polygon":n=l(t.arcs);break;case"MultiPolygon":n=t.arcs.map(l);break;default:return null}return{type:r,coordinates:n}}(t)}function vt(s,i){var a={},l={},c={},o=[],u=-1;function e(e,t){for(var n in e){var r=e[n];delete t[r.start],delete r.start,delete r.end,r.forEach(function(e){a[e<0?~e:e]=1}),o.push(r)}}return i.forEach(function(e,t){var n,r=s.arcs[e<0?~e:e];r.length<3&&!r[1][0]&&!r[1][1]&&(n=i[++u],i[u]=e,i[t]=n)}),i.forEach(function(e){var t,n,r=function(e){var t,n=s.arcs[e<0?~e:e],r=n[0];s.transform?(t=[0,0],n.forEach(function(e){t[0]+=e[0],t[1]+=e[1]})):t=n[n.length-1];return e<0?[t,r]:[r,t]}(e),i=r[0],a=r[1];if(t=c[i])if(delete c[t.end],t.push(e),t.end=a,n=l[a]){delete l[n.start];var o=n===t?t:t.concat(n);l[o.start=t.start]=c[o.end=n.end]=o}else l[t.start]=c[t.end]=t;else if(t=l[a])if(delete l[t.start],t.unshift(e),t.start=i,n=c[i]){delete c[n.end];var u=n===t?t:n.concat(t);l[u.start=n.start]=c[u.end=t.end]=u}else l[t.start]=c[t.end]=t;else l[(t=[e]).start=i]=c[t.end=a]=t}),e(c,l),e(l,c),i.forEach(function(e){a[e<0?~e:e]||o.push([e])}),o}function yt(e){return gt(e,function(e,t,n){var r,i,a;if(1<arguments.length)r=function(e,t,n){var r,i=[],a=[];function o(e){var t=e<0?~e:e;(a[t]||(a[t]=[])).push({i:e,g:r})}function u(e){e.forEach(o)}function s(e){e.forEach(u)}return function e(t){switch((r=t).type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":u(t.arcs);break;case"MultiLineString":case"Polygon":s(t.arcs);break;case"MultiPolygon":t.arcs.forEach(s)}}(t),a.forEach(null==n?function(e){i.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&i.push(e[0].i)}),i}(0,t,n);else for(i=0,r=new Array(a=e.arcs.length);i<a;++i)r[i]=i;return{type:"MultiLineString",arcs:vt(e,r)}}.apply(this,arguments))}var bt={dsv:ft,csv:ct(","),tsv:ct("\t"),json:dt,topojson:function(e,t){var n,r,i;return e=dt(e,t),n=t&&(i=t.feature)?pt:t&&(i=t.mesh)?yt:Ue("Missing TopoJSON feature or mesh parameter."),(r=(r=e.objects[i])?n(e,r):Ue("Invalid TopoJSON object: "+i))&&r.features||[r]}};function xt(e,t){return 1<arguments.length?(bt[e]=t,this):bt.hasOwnProperty(e)?bt[e]:null}function _t(e,t,n){var r=xt((t=t||{}).type||"json");return r||Ue("Unknown data format type: "+t.type),e=r(e,t),t.parse&&function(e,i,a){if(!e.length)return;a=a||f.timeParse;var t,n,r,o,u,s,l,c=e.columns||Object.keys(e[0]);"auto"===i&&(i=st(e,c));for(c=Object.keys(i),t=c.map(function(e){var t,n,r=i[e];if(r&&(0===r.indexOf("date:")||0===r.indexOf("utc:")))return("'"===(n=(t=r.split(/:(.+)?/,2))[1])[0]&&"'"===n[n.length-1]||'"'===n[0]&&'"'===n[n.length-1])&&(n=n.slice(1,-1)),"utc"===t[0]?f.utcParse(n):a(n);if(!it[r])throw Error("Illegal format pattern: "+e+":"+r);return it[r]}),o=0,s=e.length,l=c.length;o<s;++o)for(n=e[o],u=0;u<l;++u)r=c[u],n[r]=t[u](n[r])}(e,t.parse,n),e.hasOwnProperty("columns")&&delete e.columns,e}var wt={skip:!0};function kt(r,e,i,t,n,a){var o,u,s=Be({},a,wt);te(i)||(i=re(i)),void 0===t?o=function(e){r.touch(i(e))}:te(t)?(u=new je(null,t,n,!1),o=function(e){var t,n=i(e);u.evaluate(e),qe(t=u.value)?r.pulse(n,t,a):r.update(n,t,s)}):o=function(e){r.update(i(e),t,s)},e.apply(o)}function Mt(e,t,r,n,i,a){var o,u;void 0===n?u=r:(o=te(n)?n:re(n),(u=new je(null,n=r?function(e,t){var n=o(e,t);return r.skip()||(r.skip(n!==this.value).value=n),n}:o,i,!1)).modified(a&&a.force),u.rank=0,r&&(u.skip(!0),u.value=r.value,u.targets().add(r))),t.targets().add(u)}var Ot={};function Et(e,t,n){this.dataflow=e,this.stamp=null==t?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}var Rt=Et.prototype;function St(n,r){return n?function(e,t){return n(e,t)&&r(e,t)}:r}function zt(e,t){var n=[];return ke(e,t,function(e){n.push(e)}),n}function Dt(e,t){var n={};return e.visit(t,function(e){n[Se(e)]=1}),function(e){return n[Se(e)]?null:e}}function At(e,t,n,r){var i,a,o,u,s,l=this,c=0;for(this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,o=0,u=(this.pulses=n).length;o<u;++o)if((i=n[o]).stamp===t){if(i.fields)for(s in a=l.fields||(l.fields={}),i.fields)a[s]=1;i.changed(l.ADD)&&(c|=l.ADD),i.changed(l.REM)&&(c|=l.REM),i.changed(l.MOD)&&(c|=l.MOD)}this.changes=c}Rt.StopPropagation=Ot,Rt.ADD=1,Rt.REM=2,Rt.MOD=4,Rt.ADD_REM=3,Rt.ADD_MOD=5,Rt.ALL=7,Rt.REFLOW=8,Rt.SOURCE=16,Rt.NO_SOURCE=32,Rt.NO_FIELDS=64,Rt.fork=function(e){return new Et(this.dataflow).init(this,e)},Rt.clone=function(){var e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},Rt.addAll=function(){var e=this;return this.source&&this.source.length!==this.add.length&&((e=new Et(this.dataflow).init(this)).add=e.source),e},Rt.init=function(e,t){var n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source),n},Rt.runAfter=function(e){this.dataflow.runAfter(e)},Rt.changed=function(e){var t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},Rt.reflow=function(e){if(e)return this.fork(7).reflow();var t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,Dt(this,1))),this},Rt.modifies=function(e){var t=ee(e),n=this.fields||(this.fields={});return t.forEach(function(e){n[e]=!0}),this},Rt.modified=function(e){var t=this.fields;return!(!this.mod.length||!t)&&(arguments.length?h(e)?e.some(function(e){return t[e]}):t[e]:!!t)},Rt.filter=function(e,t){var n=this;return 1&e&&(n.addF=St(n.addF,t)),2&e&&(n.remF=St(n.remF,t)),4&e&&(n.modF=St(n.modF,t)),16&e&&(n.srcF=St(n.srcF,t)),n},Rt.materialize=function(e){var t=this;return 1&(e=e||7)&&t.addF&&(t.add=zt(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=zt(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=zt(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},Rt.visit=function(e,t){var n,r,i=this,a=t;return 16&e?ke(i.source,i.srcF,a):(1&e&&ke(i.add,i.addF,a),2&e&&ke(i.rem,i.remF,a),4&e&&ke(i.mod,i.modF,a),8&e&&(n=i.source)&&((r=i.add.length+i.mod.length)===n.length||ke(n,r?Dt(i,5):i.srcF,a))),i};var Ct=se(At,Et);function Pt(t,e){try{e(t)}catch(e){t.error(e)}}Ct.fork=function(e){var t=new Et(this.dataflow).init(this,e&this.NO_FIELDS);return void 0!==e&&(e&t.ADD&&this.visit(t.ADD,function(e){return t.add.push(e)}),e&t.REM&&this.visit(t.REM,function(e){return t.rem.push(e)}),e&t.MOD&&this.visit(t.MOD,function(e){return t.mod.push(e)})),t},Ct.changed=function(e){return this.changes&e},Ct.modified=function(e){var t=this.fields;return t&&this.changes&this.MOD?h(e)?e.some(function(e){return t[e]}):t[e]:0},Ct.filter=function(){Ue("MultiPulse does not support filtering.")},Ct.materialize=function(){Ue("MultiPulse does not support materialization.")};var qt={skip:!(Ct.visit=function(e,t){var n=this.pulses,r=n.length,i=0;if(e&this.SOURCE)for(;i<r;++i)n[i].visit(e,t);else for(;i<r;++i)n[i].stamp===this.stamp&&n[i].visit(e,t);return this}),force:!1};function Lt(e){this.cmp=e,this.nodes=[]}var Tt=Lt.prototype;function Ft(e,t,n,r){var i,a,o;for(i=e[n];t<n&&r(i,a=e[o=n-1>>1])<0;)e[n]=a,n=o;return e[n]=i}function Nt(e,t,n){for(var r,i=t,a=e.length,o=e[t],u=2*t+1;u<a;)(r=u+1)<a&&0<=n(e[u],e[r])&&(u=r),e[t]=e[u],u=2*(t=u)+1;return e[t]=o,Ft(e,i,t,n)}function It(){this._log=N(),this.logLevel(q),this._clock=0,this._rank=0;try{this._loader=Qe()}catch(e){}this._touched=Me(E),this._pulses={},this._pulse=null,this._heap=new Lt(function(e,t){return e.qrank-t.qrank}),this._postrun=[]}Tt.size=function(){return this.nodes.length},Tt.clear=function(){return this.nodes=[],this},Tt.peek=function(){return this.nodes[0]},Tt.push=function(e){var t=this.nodes;return t.push(e),Ft(t,0,t.length-1,this.cmp)},Tt.pop=function(){var e,t=this.nodes,n=t.pop();return t.length?(e=t[0],t[0]=n,Nt(t,0,this.cmp)):e=n,e},Tt.replace=function(e){var t=this.nodes,n=t[0];return t[0]=e,Nt(t,0,this.cmp),n},Tt.pushpop=function(e){var t=this.nodes,n=t[0];return t.length&&this.cmp(n,e)<0&&(t[0]=e,e=n,Nt(t,0,this.cmp)),e};var jt=It.prototype;function Ut(e){return function(){return this._log[e].apply(this,arguments)}}function Bt(e,t){je.call(this,e,null,t)}jt.stamp=function(){return this._clock},jt.loader=function(e){return arguments.length?(this._loader=e,this):this._loader},jt.cleanThreshold=1e4,jt.add=function(e,t,n,r){var i,a=1;return e instanceof je?i=e:e&&e.prototype instanceof je?i=new e:te(e)?i=new je(null,e):(a=0,i=new je(e,t)),this.rank(i),a&&(r=n,n=t),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},jt.connect=function(e,t){var n,r,i=e.rank;for(n=0,r=t.length;n<r;++n)if(i<t[n].rank)return void this.rerank(e)},jt.rank=function(e){e.rank=++this._rank},jt.rerank=function(e){for(var t,n,r,i=[e];i.length;)if(this.rank(t=i.pop()),n=t._targets)for(r=n.length;0<=--r;)i.push(t=n[r]),t===e&&Ue("Cycle detected in dataflow graph.")},jt.pulse=function(e,t,n){this.touch(e,n||qt);var r=new Et(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._pulses[e.id]=t.pulse(r,i),this},jt.touch=function(e,t){var n=t||qt;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},jt.update=function(e,t,n){var r=n||qt;return(e.set(t)||r.force)&&this.touch(e,r),this},jt.changeset=Le,jt.ingest=function(e,t,n){return this.pulse(e,this.changeset().insert(_t(t,n)))},jt.request=function(t,n,r){var e,i,a,o,u=this,s=u._pending||(e=u,(o=new Promise(function(e,t){i=e,a=t})).requests=0,o.done=function(){0==--o.requests&&e.runAfter(function(){e._pending=null;try{e.run(),i(e)}catch(e){a(e)}})},e._pending=o);s.requests+=1,u.loader().load(n,{context:"dataflow"}).then(function(e){u.ingest(t,e,r)},function(e){u.error("Loading failed",n,e)}).catch(function(e){u.error("Data ingestion failed",n,e)}).then(s.done,s.done)},jt.events=function(e,t,n,r){for(var i,a=this,o=He(n,r),u=function(e){e.dataflow=a;try{o.receive(e)}catch(e){a.error(e)}finally{a.run()}},s=0,l=(i="string"==typeof e&&"undefined"!=typeof document?document.querySelectorAll(e):ee(e)).length;s<l;++s)i[s].addEventListener(t,u);return o},jt.on=function(e,t,n,r,i){return(e instanceof je?Mt:kt)(this,e,t,n,r,i),this},jt.run=function(e){var t,n,r,i,a=this,o=0,u=a.logLevel();if(a._pending)return a.info("Awaiting requests, delaying dataflow run."),0;if(a._pulse)return a.error("Dataflow invoked recursively. Use the runAfter method to queue invocation."),0;if(!a._touched.length)return a.info("Dataflow invoked, but nothing to do."),0;a._pulse=new Et(a,++a._clock,e),T<=u&&(r=Date.now(),a.debug("-- START PROPAGATION ("+a._clock+") -----")),a._touched.forEach(function(e){a._enqueue(e,!0)}),a._touched=Me(E);try{for(;0<a._heap.size();)(t=a._heap.pop()).rank===t.qrank?(n=t.run(a._getPulse(t,e)),F<=u&&a.debug(t.id,n===Ot?"STOP":n,t),n!==Ot&&(a._pulse=n,t._targets&&t._targets.forEach(function(e){a._enqueue(e)})),++o):a._enqueue(t,!0)}catch(e){i=e}if(a._pulses={},a._pulse=null,T<=u&&(r=Date.now()-r,a.info("> Pulse "+a._clock+": "+o+" operators; "+r+"ms")),i&&(a._postrun=[],a.error(i)),a._onrun)try{a._onrun(a,o,i)}catch(e){a.error(e)}if(a._postrun.length){var s=a._postrun;a._postrun=[],s.sort(function(e,t){return t.priority-e.priority}).forEach(function(e){Pt(a,e.callback)})}return o},jt.runAsync=function(){return this._pending||Promise.resolve(this.run())},jt.runAfter=function(e,t,n){this._pulse||t?this._postrun.push({priority:n||0,callback:e}):Pt(this,e)},jt._enqueue=function(e,t){var n=!this._pulses[e.id];n&&(this._pulses[e.id]=this._pulse),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},jt._getPulse=function(e,t){var n,r=e.source,i=this._clock;return r&&h(r)?new At(this,i,n=r.map(function(e){return e.pulse}),t):(n=this._pulses[e.id],r&&((r=r.pulse)&&r!==Ot?r.stamp===i&&n.target!==e?n=r:n.source=r.source:n.source=[]),n)},jt.error=Ut("error"),jt.warn=Ut("warn"),jt.info=Ut("info"),jt.debug=Ut("debug"),jt.logLevel=Ut("level");var $t=se(Bt,je);$t.run=function(e){return e.stamp<=this.stamp?e.StopPropagation:(this.skip()?this.skip(!1):t=this.evaluate(e),(t=t||e)!==e.StopPropagation&&(this.pulse=t),this.stamp=e.stamp,t);var t},$t.evaluate=function(e){var t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},$t.transform=function(){};var Gt={};function Wt(e){var t=Yt(e);return t&&t.Definition||null}function Yt(e){return e=e&&e.toLowerCase(),Gt.hasOwnProperty(e)?Gt[e]:null}function Ht(e){return e&&e.length?1===e.length?e[0]:(i=e,function(e){for(var t=i.length,n=1,r=String(i[0](e));n<t;++n)r+="|"+i[n](e);return r}):function(){return""};var i}function Vt(e,t,n){return n||e+(t?"_"+t:"")}var Xt={values:Kt({name:"values",init:"cell.store = true;",set:"cell.data.values()",idx:-1}),count:Kt({name:"count",set:"cell.num"}),__count__:Kt({name:"count",set:"this.missing + this.valid"}),missing:Kt({name:"missing",set:"this.missing"}),valid:Kt({name:"valid",set:"this.valid"}),sum:Kt({name:"sum",init:"this.sum = 0;",add:"this.sum += v;",rem:"this.sum -= v;",set:"this.sum"}),mean:Kt({name:"mean",init:"this.mean = 0;",add:"var d = v - this.mean; this.mean += d / this.valid;",rem:"var d = v - this.mean; this.mean -= this.valid ? d / this.valid : this.mean;",set:"this.mean"}),average:Kt({name:"average",set:"this.mean",req:["mean"],idx:1}),variance:Kt({name:"variance",init:"this.dev = 0;",add:"this.dev += d * (v - this.mean);",rem:"this.dev -= d * (v - this.mean);",set:"this.valid > 1 ? this.dev / (this.valid-1) : 0",req:["mean"],idx:1}),variancep:Kt({name:"variancep",set:"this.valid > 1 ? this.dev / this.valid : 0",req:["variance"],idx:2}),stdev:Kt({name:"stdev",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid-1)) : 0",req:["variance"],idx:2}),stdevp:Kt({name:"stdevp",set:"this.valid > 1 ? Math.sqrt(this.dev / this.valid) : 0",req:["variance"],idx:2}),stderr:Kt({name:"stderr",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid * (this.valid-1))) : 0",req:["variance"],idx:2}),distinct:Kt({name:"distinct",set:"cell.data.distinct(this.get)",req:["values"],idx:3}),ci0:Kt({name:"ci0",set:"cell.data.ci0(this.get)",req:["values"],idx:3}),ci1:Kt({name:"ci1",set:"cell.data.ci1(this.get)",req:["values"],idx:3}),median:Kt({name:"median",set:"cell.data.q2(this.get)",req:["values"],idx:3}),q1:Kt({name:"q1",set:"cell.data.q1(this.get)",req:["values"],idx:3}),q3:Kt({name:"q3",set:"cell.data.q3(this.get)",req:["values"],idx:3}),argmin:Kt({name:"argmin",init:"this.argmin = null;",add:"if (v < this.min) this.argmin = t;",rem:"if (v <= this.min) this.argmin = null;",set:"this.argmin || cell.data.argmin(this.get)",req:["min"],str:["values"],idx:3}),argmax:Kt({name:"argmax",init:"this.argmax = null;",add:"if (v > this.max) this.argmax = t;",rem:"if (v >= this.max) this.argmax = null;",set:"this.argmax || cell.data.argmax(this.get)",req:["max"],str:["values"],idx:3}),min:Kt({name:"min",init:"this.min = null;",add:"if (v < this.min || this.min === null) this.min = v;",rem:"if (v <= this.min) this.min = NaN;",set:"this.min = (isNaN(this.min) ? cell.data.min(this.get) : this.min)",str:["values"],idx:4}),max:Kt({name:"max",init:"this.max = null;",add:"if (v > this.max || this.max === null) this.max = v;",rem:"if (v >= this.max) this.max = NaN;",set:"this.max = (isNaN(this.max) ? cell.data.max(this.get) : this.max)",str:["values"],idx:4})},Jt=Object.keys(Xt);function Qt(e,t){return Xt[e](t)}function Kt(n){return function(e){var t=Be({init:"",add:"",rem:"",idx:0},n);return t.out=e||n.name,t}}function Zt(e,t){return e.idx-t.idx}function en(e,t){var n=t||R,r=function(e,i){var t,n=e.reduce(function t(n,e){function r(e){n[e]||t(n,n[e]=Xt[e]())}return e.req&&e.req.forEach(r),i&&e.str&&e.str.forEach(r),n},e.reduce(function(e,t){return e[t.name]=t,e},{})),r=[];for(t in n)r.push(n[t]);return r.sort(Zt)}(e,!0),i="var cell = this.cell; this.valid = 0; this.missing = 0;",a="this.cell = cell; this.init();",o="if(v==null){++this.missing; return;} if(v!==v) return; ++this.valid;",u="if(v==null){--this.missing; return;} if(v!==v) return; --this.valid;",s="var cell = this.cell;";return r.forEach(function(e){i+=e.init,o+=e.add,u+=e.rem}),e.slice().sort(Zt).forEach(function(e){s+="t['"+e.out+"']="+e.set+";"}),s+="return t;",(a=Function("cell",a)).prototype.init=Function(i),a.prototype.add=Function("v","t",o),a.prototype.rem=Function("v","t",u),a.prototype.set=Function("t",s),a.prototype.get=n,a.fields=e.map(function(e){return e.out}),a}function tn(e){var t,n,r,i,a,o,u,s,l=e.maxbins||20,c=e.base||10,f=Math.log(c),d=e.divide||[5,2],h=e.extent[0],p=e.extent[1],m=p-h;if(e.step)t=e.step;else if(e.steps){for(a=m/l,o=0,u=e.steps.length;o<u&&e.steps[o]<a;++o);t=e.steps[Math.max(0,o-1)]}else{for(n=Math.ceil(Math.log(l)/f),r=e.minstep||0,t=Math.max(r,Math.pow(c,Math.round(Math.log(m)/f)-n));Math.ceil(m/t)>l;)t*=c;for(o=0,u=d.length;o<u;++o)r<=(a=t/d[o])&&m/a<=l&&(t=a)}return i=0<=(a=Math.log(t))?0:1+~~(-a/f),s=Math.pow(c,-i-1),(e.nice||void 0===e.nice)&&(h=h<(a=Math.floor(h/t+s)*t)?a-t:a,p=Math.ceil(p/t)*t),{start:h,stop:p,step:t}}function nn(e,t){var n,r=[],i=e.length,a=-1;if(null==t)for(;++a<i;)isNaN(n=rn(e[a]))||r.push(n);else for(;++a<i;)isNaN(n=rn(t(e[a],a,e)))||r.push(n);return r}function rn(e){return null===e?NaN:+e}function an(e,t,n,r){var i,a,o,u,s=nn(e,r),l=s.length,c=t;for(o=0,u=Array(c);o<c;++o){for(a=i=0;a<l;++a)i+=s[~~(y.random()*l)];u[o]=i/l}return[v.quantile(u.sort(v.ascending),n/2),v.quantile(u,1-n/2)]}function on(e,t){var n=nn(e,t);return[v.quantile(n.sort(v.ascending),.25),v.quantile(n,.5),v.quantile(n,.75)]}function un(e,t){var o,u,i=NaN,n={mean:function(e){return arguments.length?(o=e||0,i=NaN,n):o},stdev:function(e){return arguments.length?(u=null==e?1:e,i=NaN,n):u},sample:function(){var e,t,n=0,r=0;if(i==i)return n=i,i=NaN,n;for(;0===(e=(n=2*y.random()-1)*n+(r=2*y.random()-1)*r)||1<e;);return t=Math.sqrt(-2*Math.log(e)/e),i=o+r*t*u,o+n*t*u},pdf:function(e){var t=Math.exp(Math.pow(e-o,2)/(-2*Math.pow(u,2)));return 1/(u*Math.sqrt(2*Math.PI))*t},cdf:function(e){var t,n=(e-o)/u,r=Math.abs(n);if(37<r)t=0;else{var i=Math.exp(-r*r/2);r<7.07106781186547?(t=i*((((((.0352624965998911*r+.700383064443688)*r+6.37396220353165)*r+33.912866078383)*r+112.079291497871)*r+221.213596169931)*r+220.206867912376),t/=((((((.0883883476483184*r+1.75566716318264)*r+16.064177579207)*r+86.7807322029461)*r+296.564248779674)*r+637.333633378831)*r+793.826512519948)*r+440.413735824752):t=i/(r+1/(r+2/(r+3/(r+4/(r+.65)))))/2.506628274631}return 0<n?1-t:t},icdf:function(e){if(e<=0||1<=e)return NaN;var t=2*e-1,n=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),r=2/(Math.PI*n)+Math.log(1-Math.pow(t,2))/2,i=Math.log(1-t*t)/n,a=(0<t?1:-1)*Math.sqrt(Math.sqrt(r*r-i)-r);return o+u*Math.SQRT2*a}};return n.mean(e).stdev(t)}function sn(a,o){var r=un(),u={},i=0;return u.data=function(e){return arguments.length?(i=(a=e)?e.length:0,u.bandwidth(o)):a},u.bandwidth=function(e){return arguments.length?(!(o=e)&&a&&(n=(t=a).length,r=on(t),i=(r[2]-r[0])/1.34,o=1.06*Math.min(Math.sqrt(v.variance(t)),i)*Math.pow(n,-.2)),u):o;var t,n,r,i},u.sample=function(){return a[~~(y.random()*i)]+o*r.sample()},u.pdf=function(e){for(var t=0,n=0;n<i;++n)t+=r.pdf((e-a[n])/o);return t/o/i},u.cdf=function(e){for(var t=0,n=0;n<i;++n)t+=r.cdf((e-a[n])/o);return t/i},u.icdf=function(){throw Error("KDE icdf not supported.")},u.data(a)}function ln(i,t){var a,n={},o=0;return n.weights=function(e){return arguments.length?(a=function(e){var t,n=[],r=0;for(t=0;t<o;++t)r+=n[t]=null==e[t]?1:+e[t];for(t=0;t<o;++t)n[t]/=r;return n}(t=e||[]),n):t},n.distributions=function(e){return arguments.length?(e?(o=e.length,i=e):(o=0,i=[]),n.weights(t)):i},n.sample=function(){for(var e=y.random(),t=i[o-1],n=a[0],r=0;r<o-1;n+=a[++r])if(e<n){t=i[r];break}return t.sample()},n.pdf=function(e){for(var t=0,n=0;n<o;++n)t+=a[n]*i[n].pdf(e);return t},n.cdf=function(e){for(var t=0,n=0;n<o;++n)t+=a[n]*i[n].cdf(e);return t},n.icdf=function(){throw Error("Mixture icdf not supported.")},n.distributions(i).weights(t)}function cn(e,t){null==t&&(t=null==e?1:e,e=0);var n,r,i,a={};return a.min=function(e){return arguments.length?(i=r-(n=e||0),a):n},a.max=function(e){return arguments.length?(i=(r=e||0)-n,a):r},a.sample=function(){return n+i*y.random()},a.pdf=function(e){return n<=e&&e<=r?1/i:0},a.cdf=function(e){return e<n?0:r<e?1:(e-n)/i},a.icdf=function(e){return 0<=e&&e<=1?n+e*i:NaN},a.min(e).max(t)}function fn(e){this._key=e?M(e):Se,this.reset()}y.random=Math.random;var dn=fn.prototype;function hn(e){Bt.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}dn.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},dn.add=function(e){this._add.push(e)},dn.rem=function(e){this._rem.push(e)},dn.values=function(){if(this._get=null,0===this._rem.length)return this._add;var e,t,n,r=this._add,i=this._rem,a=this._key,o=r.length,u=i.length,s=Array(o-u),l={};for(e=0;e<u;++e)l[a(i[e])]=1;for(t=e=0;e<o;++e)l[a(n=r[e])]?l[a(n)]=0:s[t++]=n;return this._rem=[],this._add=s},dn.distinct=function(e){for(var t,n=this.values(),r=n.length,i={},a=0;0<=--r;)t=e(n[r])+"",i.hasOwnProperty(t)||(i[t]=1,++a);return a},dn.extent=function(e){if(this._get!==e||!this._ext){var t=this.values(),n=ae(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},dn.argmin=function(e){return this.extent(e)[0]||{}},dn.argmax=function(e){return this.extent(e)[1]||{}},dn.min=function(e){var t=this.extent(e)[0];return null!=t?e(t):1/0},dn.max=function(e){var t=this.extent(e)[1];return null!=t?e(t):-1/0},dn.quartile=function(e){return this._get===e&&this._q||(this._q=on(this.values(),e),this._get=e),this._q},dn.q1=function(e){return this.quartile(e)[0]},dn.q2=function(e){return this.quartile(e)[1]},dn.q3=function(e){return this.quartile(e)[2]},dn.ci=function(e){return this._get===e&&this._ci||(this._ci=an(this.values(),1e3,.05,e),this._get=e),this._ci},dn.ci0=function(e){return this.ci(e)[0]},dn.ci1=function(e){return this.ci(e)[1]},hn.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Jt},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};var pn=se(hn,Bt);function mn(e){Bt.call(this,null,e)}pn.transform=function(e,t){var n,r=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS);return this.stamp=i.stamp,this.value&&((n=e.modified())||t.modified(this._inputs))?(this._prev=this.value,this.value=n?this.init(e):{},t.visit(t.SOURCE,function(e){r.add(e)})):(this.value=this.value||this.init(e),t.visit(t.REM,function(e){r.rem(e)}),t.visit(t.ADD,function(e){r.add(e)})),i.modifies(this._outputs),r._drop=!1!==e.drop,e.cross&&1<r._dims.length&&(r._drop=!1,this.cross()),r.changes(i)},pn.cross=function(){var s=this,l=s.value,c=s._dnames,f=c.map(function(){return{}}),d=c.length;function e(e){var t,n,r,i;for(t in e)for(r=e[t].tuple,n=0;n<d;++n)f[n][i=r[c[n]]]=i}e(s._prev),e(l),function e(t,n,r){var i,a,o=c[r],u=f[r++];for(i in u)n[o]=u[i],a=t?t+"|"+i:i,r<d?e(a,n,r):l[a]||s.cell(a,n)}("",{},0)},pn.init=function(e){var a=this._inputs=[],n=this._outputs=[],o={};function r(e){for(var t,n=ee(_(e)),r=0,i=n.length;r<i;++r)o[t=n[r]]||(o[t]=1,a.push(t))}this._dims=ee(e.groupby),this._dnames=this._dims.map(function(e){var t=k(e);return r(e),n.push(t),t}),this.cellkey=e.key?e.key:Ht(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];var t,i,u,s,l,c,f=e.fields||[null],d=e.ops||["count"],h=e.as||[],p=f.length,m={};for(p!==d.length&&Ue("Unmatched number of fields and aggregate ops."),c=0;c<p;++c)t=f[c],i=d[c],null==t&&"count"!==i&&Ue("Null aggregate field specified."),l=Vt(i,s=k(t),h[c]),n.push(l),"count"!==i?((u=m[s])||(r(t),(u=m[s]=[]).field=t,this._measures.push(u)),"count"!==i&&(this._countOnly=!1),u.push(Qt(i,l))):this._counts.push(l);return this._measures=this._measures.map(function(e){return en(e,e.field)}),{}},pn.cellkey=Ht(),pn.cell=function(e,t){var n=this.value[e];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},pn.newcell=function(e,t){var n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){var r,i=this._measures,a=i.length;for(n.agg=Array(a),r=0;r<a;++r)n.agg[r]=new i[r](n)}return n.store&&(n.data=new fn),n},pn.newtuple=function(e,t){var n,r,i=this._dnames,a=this._dims,o={};for(n=0,r=a.length;n<r;++n)o[i[n]]=a[n](e);return t?Pe(t.tuple,o):De(o)},pn.add=function(e){var t,n,r,i=this.cellkey(e),a=this.cell(i,e);if(a.num+=1,!this._countOnly)for(a.store&&a.data.add(e),n=0,r=(t=a.agg).length;n<r;++n)t[n].add(t[n].get(e),e)},pn.rem=function(e){var t,n,r,i=this.cellkey(e),a=this.cell(i,e);if(a.num-=1,!this._countOnly)for(a.store&&a.data.rem(e),n=0,r=(t=a.agg).length;n<r;++n)t[n].rem(t[n].get(e),e)},pn.celltuple=function(e){var t,n,r,i=e.tuple,a=this._counts;for(e.store&&e.data.values(),n=0,r=a.length;n<r;++n)i[a[n]]=e.num;if(!this._countOnly)for(n=0,r=(t=e.agg).length;n<r;++n)t[n].set(i);return i},pn.changes=function(e){var t,n,r,i,a=this._adds,o=this._mods,u=this._prev,s=this._drop,l=e.add,c=e.rem,f=e.mod;if(u)for(n in u)t=u[n],s&&!t.num||c.push(t.tuple);for(r=0,i=this._alen;r<i;++r)l.push(this.celltuple(a[r])),a[r]=null;for(r=0,i=this._mlen;r<i;++r)(0===(t=o[r]).num&&s?c:f).push(this.celltuple(t)),o[r]=null;return this._alen=this._mlen=0,this._prev=null,e},mn.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};var gn=se(mn,Bt);function vn(e,t,n){var r=e,i=t||[],a=n||[],o={},u=0;return{add:function(e){a.push(e)},remove:function(e){o[r(e)]=++u},size:function(){return i.length},data:function(e,t){return u&&(i=i.filter(function(e){return!o[r(e)]}),o={},u=0),t&&e&&i.sort(e),a.length&&(i=e?pe(e,i,a.sort(e)):i.concat(a),a=[]),i}}}function yn(e){Bt.call(this,[],e)}function bn(e){je.call(this,null,xn,e)}function xn(e){return this.value&&!e.modified()?this.value:ne(e.fields,e.orders)}function _n(e){Bt.call(this,null,e)}gn.transform=function(e,t){var n,r=this._bins(e),i=r.start,a=r.step,o=e.as||["bin0","bin1"],u=o[0],s=o[1];return n=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(_(e.field))?t.ADD_MOD:t.ADD,t.visit(n,function(e){var t=r(e);e[u]=t,e[s]=null==t?null:i+a*(1+(t-i)/a)}),t.modifies(o)},gn._bins=function(e){if(this.value&&!e.modified())return this.value;var t,n,r=e.field,i=tn(e),a=i.start,o=i.stop,u=i.step;null!=(t=e.anchor)&&(n=t-(a+u*Math.floor((t-a)/u)),a+=n,o+=n);var s=function(e){var t=r(e);return null==t?null:(t=Math.max(a,Math.min(+t,o-u)),a+u*Math.floor((t-a)/u))};return s.start=a,s.stop=o,s.step=u,this.value=g(s,_(r),e.name||"bin_"+k(r))},yn.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},se(yn,Bt).transform=function(e,t){var n=t.fork(t.ALL),r=vn(Se,this.value,n.materialize(n.ADD).add),i=e.sort,a=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(a),this.value=n.source=r.data(i,a),t.source&&t.source.root&&(this.value.root=t.source.root),n},se(bn,je),_n.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};var wn=se(_n,Bt);function kn(e){Bt.call(this,null,e)}wn.transform=function(o,e){function t(a){return function(e){for(var t,n=function(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase()}return e.match(n)}(l(e),o.case,u)||[],r=0,i=n.length;r<i;++r)s.test(t=n[r])||a(t)}}var n=this._parameterCheck(o,e),r=this._counts,u=this._match,s=this._stop,l=o.field,i=o.as||["text","count"],a=t(function(e){r[e]=1+(r[e]||0)}),c=t(function(e){r[e]-=1});return n?e.visit(e.SOURCE,a):(e.visit(e.ADD,a),e.visit(e.REM,c)),this._finish(e,i)},wn._parameterCheck=function(e,t){var n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},wn._finish=function(e,t){var n,r,i,a=this._counts,o=this._tuples||(this._tuples={}),u=t[0],s=t[1],l=e.fork(e.NO_SOURCE|e.NO_FIELDS);for(n in a)r=o[n],i=a[n]||0,!r&&i?(o[n]=r=De({}),r[u]=n,r[s]=i,l.add.push(r)):0===i?(r&&l.rem.push(r),a[n]=null,o[n]=null):r[s]!==i&&(r[s]=i,l.mod.push(r));return l.modifies(t)},kn.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},se(kn,Bt).transform=function(e,t){var n=t.fork(t.NO_SOURCE),r=this.value,i=e.as||["a","b"],a=i[0],o=i[1];return!r||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter")?(r&&(n.rem=r),r=t.materialize(t.SOURCE).source,n.add=this.value=function(e,t,n,r){for(var i,a,o=[],u={},s=e.length,l=0;l<s;++l)for(u[t]=a=e[l],i=0;i<s;++i)u[n]=e[i],r(u)&&(o.push(De(u)),(u={})[t]=a);return o}(r,a,o,e.filter||D)):n.mod=r,n.source=this.value,n.modifies(i)};var Mn={kde:sn,mixture:ln,normal:un,uniform:cn},On="distributions",En="function",Rn="field";function Sn(e){Bt.call(this,null,e)}var zn=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],Dn={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:zn},{name:"weights",type:"number",array:!0}]};function An(e){Bt.call(this,[1/0,-1/0],e)}function Cn(e,t){je.call(this,e),this.parent=t}Sn.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number",default:100},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:zn.concat(Dn)},{name:"as",type:"string",array:!0,default:["value","density"]}]},se(Sn,Bt).transform=function(e,t){var n,r=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var i=function t(e,n){var r=e[En];Mn.hasOwnProperty(r)||Ue("Unknown distribution function: "+r);var i=Mn[r]();for(var a in e)a===Rn?i.data((e.from||n()).map(e[a])):a===On?i[a](e[a].map(function(e){return t(e,n)})):typeof i[a]===En&&i[a](e[a]);return i}(e.distribution,(n=t,function(){return n.materialize(n.SOURCE).source})),a=e.method||"pdf";"pdf"!==a&&"cdf"!==a&&Ue("Invalid density method: "+a),e.extent||i.data||Ue("Missing density extent parameter."),a=i[a];var o=e.as||["value","density"],u=e.extent||v.extent(i.data()),s=(u[1]-u[0])/(e.steps||100),l=v.range(u[0],u[1]+s/2,s).map(function(e){var t={};return t[o[0]]=e,t[o[1]]=a(e),De(t)});this.value&&(r.rem=this.value),this.value=r.add=r.source=l}return r},An.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},se(An,Bt).transform=function(e,t){var n=this.value,r=e.field,i=n[0],a=n[1],o=t.ADD;(t.changed()||t.modified(r.fields)||e.modified("field"))&&(o=t.SOURCE,i=1/0,a=-1/0),t.visit(o,function(e){var t=r(e);null!=t&&((t=+t)<i&&(i=t),a<t&&(a=t))}),this.value=[i,a]};var Pn=se(Cn,je);function qn(e){Bt.call(this,{},e),this._keys=ue();var r=this._targets=[];r.active=0,r.forEach=function(e){for(var t=0,n=r.active;t<n;++t)e(r[t],t,r)}}Pn.connect=function(e){return this.targets().add(e),e.source=this},Pn.add=function(e){this.value.add.push(e)},Pn.rem=function(e){this.value.rem.push(e)},Pn.mod=function(e){this.value.mod.push(e)},Pn.init=function(e){this.value.init(e,e.NO_SOURCE)},Pn.evaluate=function(){return this.value};var Ln=se(qn,Bt);function Tn(e){je.call(this,null,Fn,e)}function Fn(e){return this.value&&!e.modified()?this.value:h(e.name)?ee(e.name).map(function(e){return M(e)}):M(e.name,e.as)}function Nn(e){Bt.call(this,ue(),e)}function In(e,n){return e?e.map(function(e,t){return n[t]||k(e)}):null}function jn(e){Bt.call(this,[],e)}function Un(e){Bt.call(this,[],e)}function Bn(e){Bt.call(this,null,e)}function $n(e){Bt.call(this,[],e)}Ln.activate=function(e){this._targets[this._targets.active++]=e},Ln.subflow=function(e,t,n,r){var i,a,o=this.value,u=o.hasOwnProperty(e)&&o[e];return u?u.value.stamp<n.stamp&&(u.init(n),this.activate(u)):(a=r||(a=this._group[e])&&a.tuple,u=(i=n.dataflow).add(new Cn(n.fork(n.NO_SOURCE),this)).connect(t(i,e,a)),o[e]=u,this.activate(u)),u},Ln.transform=function(e,t){var n=t.dataflow,r=this,i=e.key,a=e.subflow,o=this._keys,u=e.modified("key");function s(e){return r.subflow(e,a,t)}return this._group=e.group||{},this._targets.active=0,t.visit(t.REM,function(e){var t=Se(e),n=o.get(t);void 0!==n&&(o.delete(t),s(n).rem(e))}),t.visit(t.ADD,function(e){var t=i(e);o.set(Se(e),t),s(t).add(e)}),u||t.modified(i.fields)?t.visit(t.MOD,function(e){var t=Se(e),n=o.get(t),r=i(e);n===r?s(r).mod(e):(o.set(t,r),s(n).rem(e),s(r).add(e))}):t.changed(t.MOD)&&t.visit(t.MOD,function(e){s(o.get(Se(e))).mod(e)}),u&&t.visit(t.REFLOW,function(e){var t=Se(e),n=o.get(t),r=i(e);n!==r&&(o.set(t,r),s(n).rem(e),s(r).add(e))}),o.empty>n.cleanThreshold&&n.runAfter(o.clean),t},se(Tn,je),Nn.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},se(Nn,Bt).transform=function(i,e){var t=e.dataflow,a=this.value,n=e.fork(),o=n.add,u=n.rem,s=n.mod,l=i.expr,c=!0;function r(e){var t=Se(e),n=l(e,i),r=a.get(t);n&&r?(a.delete(t),o.push(e)):n||r?c&&n&&!r&&s.push(e):(a.set(t,1),u.push(e))}return e.visit(e.REM,function(e){var t=Se(e);a.has(t)?a.delete(t):u.push(e)}),e.visit(e.ADD,function(e){l(e,i)?o.push(e):a.set(Se(e),1)}),e.visit(e.MOD,r),i.modified()&&(c=!1,e.visit(e.REFLOW,r)),a.empty>t.cleanThreshold&&t.runAfter(a.clean),n},jn.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0}]},se(jn,Bt).transform=function(e,t){var u=t.fork(t.NO_SOURCE),s=e.fields,l=In(s,e.as||[]),c=l.length;return u.rem=this.value,t.visit(t.SOURCE,function(t){for(var e,n,r,i=s.map(function(e){return e(t)}),a=i.reduce(function(e,t){return Math.max(e,t.length)},0),o=0;o<a;++o){for(n=Ae(t),e=0;e<c;++e)n[l[e]]=null==(r=i[e][o])?null:r;u.add.push(n)}}),this.value=u.source=u.add,u.modifies(l)},Un.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},se(Un,Bt).transform=function(e,t){var r=t.fork(t.NO_SOURCE),i=e.fields,a=i.map(k),n=e.as||["key","value"],o=n[0],u=n[1],s=i.length;return r.rem=this.value,t.visit(t.SOURCE,function(e){for(var t,n=0;n<s;++n)(t=Ae(e))[o]=a[n],t[u]=i[n](e),r.add.push(t)}),this.value=r.source=r.add,r.modifies(n)},Bn.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},se(Bn,Bt).transform=function(t,e){var n=t.expr,r=t.as,i=t.modified(),a=t.initonly?e.ADD:i?e.SOURCE:e.modified(n.fields)?e.ADD_MOD:e.ADD;return i&&(e=e.materialize().reflow(!0)),t.initonly||e.modifies(r),e.visit(a,function(e){e[r]=n(e,t)})},se($n,Bt).transform=function(e,t){var n,r,i,a=this.value,o=t.fork(t.ALL),u=e.size-a.length,s=e.generator;if(0<u){for(n=[];0<=--u;)n.push(i=De(s(e))),a.push(i);o.add=o.add.length?o.materialize(o.ADD).add.concat(n):n}else r=a.slice(0,-u),o.rem=o.rem.length?o.materialize(o.REM).rem.concat(r):r,a=a.slice(-u);return o.source=this.value=a,o};var Gn={value:"value",median:v.median,mean:v.mean,min:v.min,max:v.max},Wn=[];function Yn(e){Bt.call(this,[],e)}function Hn(e){hn.call(this,e)}Yn.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},se(Yn,Bt).transform=function(e,t){var n,r,i,a,o,u,s,l,c,f,d,h=t.fork(t.ALL),p=function(e){var t,n=e.method||Gn.value;if(null!=Gn[n])return n===Gn.value?(t=void 0!==e.value?e.value:0,function(){return t}):Gn[n];Ue("Unrecognized imputation method: "+n)}(e),m=(d=e.field,function(e){return e?d(e):NaN}),g=k(e.field),v=k(e.key),y=(e.groupby||[]).map(k),b=function(e,t,n,r){var i,a,o,u,s,l,c,f,d=function(e){return e(f)},h=[],p=r?r.slice():[],m={},g={};for(p.forEach(function(e,t){m[e]=t+1}),u=0,c=e.length;u<c;++u)f=e[u],l=n(f),s=m[l]||(m[l]=p.push(l)),a=(i=t?t.map(d):Wn)+"",(o=g[a])||(o=g[a]=[],h.push(o),o.values=i),o[s-1]=f;return h.domain=p,h}(t.source,e.groupby,e.key,e.keyvals),x=[],_=this.value,w=b.domain.length;for(o=0,l=b.length;o<l;++o)for(i=(n=b[o]).values,r=NaN,s=0;s<w;++s)if(null==n[s]){for(a=b.domain[s],f={_impute:!0},u=0,c=i.length;u<c;++u)f[y[u]]=i[u];f[v]=a,f[g]=isNaN(r)?r=p(n,m):r,x.push(De(f))}return x.length&&(h.add=h.materialize(h.ADD).add.concat(x)),_.length&&(h.rem=h.materialize(h.REM).rem.concat(_)),this.value=x,h},Hn.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Jt},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};var Vn=se(Hn,hn);function Xn(e){je.call(this,null,Jn,e)}function Jn(e){return this.value&&!e.modified()?this.value:he(e.fields,e.flat)}function Qn(e){Bt.call(this,{},e)}function Kn(e){je.call(this,null,Zn,e)}function Zn(e){if(this.value&&!e.modified())return this.value;var t,n,r,i=1/0,a=-1/0,o=e.extents;for(t=0,n=o.length;t<n;++t)(r=o[t])[0]<i&&(i=r[0]),r[1]>a&&(a=r[1]);return[i,a]}function er(e){je.call(this,null,tr,e)}function tr(e){return this.value&&!e.modified()?this.value:e.values.reduce(function(e,t){return e.concat(t)},[])}function nr(e){Bt.call(this,null,e)}function rr(e){hn.call(this,e)}Vn.transform=function(e,t){var n,r=this,i=e.modified();return r.value&&(i||t.modified(r._inputs))?(n=r.value=i?r.init(e):{},t.visit(t.SOURCE,function(e){r.add(e)})):(n=r.value=r.value||this.init(e),t.visit(t.REM,function(e){r.rem(e)}),t.visit(t.ADD,function(e){r.add(e)})),r.changes(),t.visit(t.SOURCE,function(e){Be(e,n[r.cellkey(e)].tuple)}),t.reflow(i).modifies(this._outputs)},Vn.changes=function(){var e,t,n=this._adds,r=this._mods;for(e=0,t=this._alen;e<t;++e)this.celltuple(n[e]),n[e]=null;for(e=0,t=this._mlen;e<t;++e)this.celltuple(r[e]),r[e]=null;this._alen=this._mlen=0},se(Xn,je),Qn.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},se(Qn,Bt).transform=function(e,t){var n,a,r=t,o=e.as,u=e.fields,s=e.index,l=e.values,c=null==e.default?null:e.default,i=e.modified(),f=i?t.SOURCE:t.ADD,d=u.length;return l?(a=l.length,1<d&&!o&&Ue('Multi-field lookup requires explicit "as" parameter.'),o&&o.length!==d*a&&Ue('The "as" parameter has too few output field names.'),o=o||l.map(k),n=function(e){for(var t,n,r=0,i=0;r<d;++r)if(null==(n=s.get(u[r](e))))for(t=0;t<a;++t,++i)e[o[i]]=c;else for(t=0;t<a;++t,++i)e[o[i]]=l[t](n)}):(o||Ue("Missing output field names."),n=function(e){for(var t,n=0;n<d;++n)t=s.get(u[n](e)),e[o[n]]=null==t?c:t}),i?r=t.reflow(!0):f|=u.some(function(e){return t.modified(e.fields)})?t.MOD:0,t.visit(f,n),r.modifies(o)},se(Kn,je),se(er,je),se(nr,Bt),nr.prototype.transform=function(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)},rr.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Jt,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};var ir=se(rr,hn);function ar(e){qn.call(this,e)}function or(e){Bt.call(this,null,e)}function ur(e){Bt.call(this,null,e)}function sr(e){Bt.call(this,null,e)}function lr(e){Bt.call(this,[],e),this.count=0}function cr(e){Bt.call(this,null,e)}function fr(e){Bt.call(this,null,e),this.modified(!0)}function dr(e){Bt.call(this,ue(),e)}function hr(e){Bt.call(this,null,e)}ir._transform=ir.transform,ir.transform=function(e,t){return this._transform((r=t,i=(n=e).field,a=n.value,o=("count"===n.op?"__count__":n.op)||"sum",u=_(i).concat(_(a)),l=i,c=n.limit||0,d={},h=[],(f=r).visit(f.SOURCE,function(e){var t=l(e);d[t]||(d[t]=1,h.push(t))}),h.sort(function(e,t){return(e<t||null==e)&&null!=t?-1:(t<e||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0)}),s=c?h.slice(0,c):h,{key:n.key,groupby:n.groupby,ops:s.map(function(){return o}),fields:s.map(function(e){return n=i,r=a,g(function(e){return n(e)===t?r(e):NaN},u,(t=e)+"");var t,n,r}),as:s.map(function(e){return e+""}),modified:n.modified.bind(n)}),t);var n,r,i,a,o,u,s,l,c,f,d,h},se(ar,qn).transform=function(e,n){var r=this,i=e.subflow,a=e.field;return(e.modified("field")||a&&n.modified(_(a)))&&Ue("PreFacet does not support field modification."),this._targets.active=0,n.visit(n.MOD,function(e){var t=r.subflow(Se(e),i,n,e);a?a(e).forEach(function(e){t.mod(e)}):t.mod(e)}),n.visit(n.ADD,function(e){var t=r.subflow(Se(e),i,n,e);a?a(e).forEach(function(e){t.add(De(e))}):t.add(e)}),n.visit(n.REM,function(e){var t=r.subflow(Se(e),i,n,e);a?a(e).forEach(function(e){t.rem(e)}):t.rem(e)}),n},or.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},se(or,Bt).transform=function(e,t){var n,r,i=e.fields,a=In(e.fields,e.as||[]),o=i?function(e,t){return function(e,t,n,r){for(var i=0,a=n.length;i<a;++i)t[r[i]]=n[i](e);return t}(e,t,i,a)}:Ce;return this.value?r=this.value:(t=t.addAll(),r=this.value={}),n=t.fork(t.NO_SOURCE),t.visit(t.REM,function(e){var t=Se(e);n.rem.push(r[t]),r[t]=null}),t.visit(t.ADD,function(e){var t=o(e,De({}));r[Se(e)]=t,n.add.push(t)}),t.visit(t.MOD,function(e){n.mod.push(o(e,r[Se(e)]))}),n},se(ur,Bt).transform=function(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation},se(sr,Bt).transform=function(e,t){var n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,function(e){var t=Se(e);n.rem.push(r[t]),r[t]=null}),t.visit(t.ADD,function(e){var t=Ae(e);r[Se(e)]=t,n.add.push(t)}),t.visit(t.MOD,function(e){n.mod.push(Ce(e,r[Se(e)]))})),n},lr.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},se(lr,Bt).transform=function(e,t){var r=t.fork(t.NO_SOURCE),n=e.modified("size"),i=e.size,a=this.value,o=this.count,u=0,s=a.reduce(function(e,t){return e[Se(t)]=1,e},{});function l(e){var t,n;a.length<i?a.push(e):(n=~~((o+1)*y.random()))<a.length&&u<=n&&(t=a[n],s[Se(t)]&&r.rem.push(t),a[n]=e),++o}if(t.rem.length&&(t.visit(t.REM,function(e){var t=Se(e);s[t]&&(s[t]=-1,r.rem.push(e)),--o}),a=a.filter(function(e){return-1!==s[Se(e)]})),(t.rem.length||n)&&a.length<i&&t.source&&(u=o=a.length,t.visit(t.SOURCE,function(e){s[Se(e)]||l(e)}),u=-1),n&&a.length>i){for(var c=0,f=a.length-i;c<f;++c)s[Se(a[c])]=-1,r.rem.push(a[c]);a=a.slice(f)}return t.mod.length&&t.visit(t.MOD,function(e){s[Se(e)]&&r.mod.push(e)}),t.add.length&&t.visit(t.ADD,l),(t.add.length||u<0)&&(r.add=a.filter(function(e){return!s[Se(e)]})),this.count=o,this.value=r.source=a,r},cr.Definition={type:"Sequence",metadata:{changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1}],output:["value"]},se(cr,Bt).transform=function(e,t){if(!this.value||e.modified()){var n=t.materialize().fork(t.MOD);return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=v.range(e.start,e.stop,e.step||1).map(De),n.add=t.add.concat(this.value),n}},se(fr,Bt).transform=function(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation},se(dr,Bt).transform=function(e,t){var n=t.dataflow,r=e.field,i=this.value,a=!0;function o(e){i.set(r(e),e)}return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,o)):t.changed()?(t.visit(t.REM,function(e){i.delete(r(e))}),t.visit(t.ADD,o)):a=!1,this.modified(a),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()},se(hr,Bt).transform=function(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(e.sort):t.source).map(e.field))};var pr={row_number:function(){return{next:function(e){return e.index+1}}},rank:function(){var r;return{init:function(){r=1},next:function(e){var t=e.index,n=e.data;return t&&e.compare(n[t-1],n[t])?r=t+1:r}}},dense_rank:function(){var r;return{init:function(){r=1},next:function(e){var t=e.index,n=e.data;return t&&e.compare(n[t-1],n[t])?++r:r}}},percent_rank:function(){var e=pr.rank(),t=e.next;return{init:e.init,next:function(e){return(t(e)-1)/(e.data.length-1)}}},cume_dist:function(){var i;return{init:function(){i=0},next:function(e){var t=e.index,n=e.data,r=e.compare;if(i<t){for(;t+1<n.length&&!r(n[t],n[t+1]);)++t;i=t}return(1+i)/n.length}}},ntile:function(e,t){0<(t=+t)||Ue("ntile num must be greater than zero.");var n=pr.cume_dist(),r=n.next;return{init:n.init,next:function(e){return Math.ceil(t*r(e))}}},lag:function(n,r){return r=+r||1,{next:function(e){var t=e.index-r;return 0<=t?n(e.data[t]):null}}},lead:function(r,i){return i=+i||1,{next:function(e){var t=e.index+i,n=e.data;return t<n.length?r(n[t]):null}}},first_value:function(t){return{next:function(e){return t(e.data[e.i0])}}},last_value:function(t){return{next:function(e){return t(e.data[e.i1-1])}}},nth_value:function(n,r){return 0<(r=+r)||Ue("nth_value nth must be greater than zero."),{next:function(e){var t=e.i0+(r-1);return t<e.i1?n(e.data[t]):null}}}},mr=Object.keys(pr);function gr(e){var t=ee(e.ops),f=ee(e.fields),d=ee(e.params),h=ee(e.as),p=this.outputs=[],m=this.windows=[],n={},g={},v=!0,y=[],b=[];function x(e){ee(_(e)).forEach(function(e){n[e]=1})}x(e.sort),t.forEach(function(e,t){var n,r,i,a,o,u=f[t],s=k(u),l=Vt(e,s,h[t]);if(x(u),p.push(l),pr.hasOwnProperty(e))m.push((n=e,r=f[t],i=d[t],a=l,{init:(o=pr[n](r,i)).init||S,update:function(e,t){t[a]=o.next(e)}}));else{if(null==u&&"count"!==e&&Ue("Null aggregate field specified."),"count"===e)return void y.push(l);v=!1;var c=g[s];c||((c=g[s]=[]).field=u,b.push(c)),c.push(Qt(e,l))}}),(y.length||b.length)&&(this.cell=function(e,r,i){e=e.map(function(e){return en(e,e.field)});var a={num:0,agg:null,store:!1,count:r};if(!i)for(var n=e.length,o=a.agg=Array(n),t=0;t<n;++t)o[t]=new e[t](a);if(a.store)var u=a.data=new fn;return a.add=function(e){if(a.num+=1,!i){u&&u.add(e);for(var t=0;t<n;++t)o[t].add(o[t].get(e),e)}},a.rem=function(e){if(a.num-=1,!i){u&&u.rem(e);for(var t=0;t<n;++t)o[t].rem(o[t].get(e),e)}},a.set=function(e){var t,n;for(u&&u.values(),t=0,n=r.length;t<n;++t)e[r[t]]=a.num;if(!i)for(t=0,n=o.length;t<n;++t)o[t].set(e)},a.init=function(){a.num=0,u&&u.reset();for(var e=0;e<n;++e)o[e].init()},a}(b,y,v)),this.inputs=Object.keys(n)}var vr=gr.prototype;function yr(e){Bt.call(this,{},e),this._mlen=0,this._mods=[]}vr.init=function(){this.windows.forEach(function(e){e.init()}),this.cell&&this.cell.init()},vr.update=function(e,t){var n,r=this.cell,i=this.windows,a=e.data,o=i&&i.length;if(r){for(n=e.p0;n<e.i0;++n)r.rem(a[n]);for(n=e.p1;n<e.i1;++n)r.add(a[n]);r.set(t)}for(n=0;n<o;++n)i[n].update(e,t)},yr.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:mr.concat(Jt)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};var br=se(yr,Bt);function xr(e,t,n){var r=n.sort,i=r&&!n.ignorePeers,a=n.frame||[null,0],o=e.data(r),u=o.length,s=0,l=i?v.bisector(r):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:o,compare:r||re(-1)};for(t.init();s<u;++s)_r(c,a,s,u),i&&wr(c,l),t.update(c,o[s])}function _r(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=null==t[0]?0:Math.max(0,n-Math.abs(t[0])),e.i1=null==t[1]?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function wr(e,t){var n=e.i0,r=e.i1-1,i=e.compare,a=e.data,o=a.length-1;0<n&&!i(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),r<o&&!i(a[r],a[r+1])&&(e.i1=t.right(a,a[r]))}br.transform=function(e,t){var n,r,i=this,a=i.state,o=e.modified();this.stamp=t.stamp,a&&!o||(a=i.state=new gr(e));var u=Ht(e.groupby);function s(e){return i.group(u(e))}for(o||t.modified(a.inputs)?(i.value={},t.visit(t.SOURCE,function(e){s(e).add(e)})):(t.visit(t.REM,function(e){s(e).remove(e)}),t.visit(t.ADD,function(e){s(e).add(e)})),n=0,r=i._mlen;n<r;++n)xr(i._mods[n],a,e);return i._mlen=0,i._mods=[],t.reflow(o).modifies(a.outputs)},br.group=function(e){var t=this,n=t.value[e];return n||((n=t.value[e]=vn(Se)).stamp=-1),n.stamp<t.stamp&&(n.stamp=t.stamp,t._mods[t._mlen++]=n),n};var kr=Object.freeze({aggregate:hn,bin:mn,collect:yn,compare:bn,countpattern:_n,cross:kn,density:Sn,extent:An,facet:qn,field:Tn,filter:Nn,flatten:jn,fold:Un,formula:Bn,generate:$n,impute:Yn,joinaggregate:Hn,key:Xn,lookup:Qn,multiextent:Kn,multivalues:er,params:nr,pivot:rr,prefacet:ar,project:or,proxy:ur,relay:sr,sample:lr,sequence:cr,sieve:fr,subflow:Cn,tupleindex:dr,values:hr,window:yr}),Mr="top",Or="left",Er="right",Rr="bottom",Sr="top-left",zr="top-right",Dr="bottom-left",Ar="bottom-right",Cr="start",Pr="end",qr="group",Lr="axis",Tr="legend",Fr="row-header",Nr="row-footer",Ir="row-title",jr="column-header",Ur="column-footer",Br="column-title",$r="padding",Gr="symbol",Wr="fit",Yr="fit-x",Hr="fit-y",Vr="pad",Xr="none",Jr="all",Qr="column",Kr="row";function Zr(e){this.clear(),e&&this.union(e)}var ei=Zr.prototype;ei.clone=function(){return new Zr(this)},ei.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},ei.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},ei.set=function(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},ei.add=function(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},ei.expand=function(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},ei.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},ei.translate=function(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},ei.rotate=function(e,t,n){var r=Math.cos(e),i=Math.sin(e),a=t-t*r+n*i,o=n-t*i-n*r,u=this.x1,s=this.x2,l=this.y1,c=this.y2;return this.clear().add(r*u-i*l+a,i*u+r*l+o).add(r*u-i*c+a,i*u+r*c+o).add(r*s-i*l+a,i*s+r*l+o).add(r*s-i*c+a,i*s+r*c+o)},ei.union=function(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},ei.intersect=function(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},ei.encloses=function(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},ei.alignsWith=function(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},ei.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},ei.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},ei.width=function(){return this.x2-this.x1},ei.height=function(){return this.y2-this.y1};var ti,ni=0;function ri(e,t){var n,r=[];return n={id:"gradient_"+ni++,x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:r,stop:function(e,t){return r.push({offset:e,color:t}),n}}}function ii(e){this.mark=e,this.bounds=this.bounds||new Zr}function ai(e){ii.call(this,e),this.items=this.items||[]}function oi(e,t){return function(e,t){if("undefined"!=typeof document&&document.createElement){var n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}(e,t)||function(e,t){if(ti)try{return new ti(e,t)}catch(e){}return null}(e,t)||null}function ui(){return("undefined"!=typeof Image?Image:null)||ti&&ti.Image||null||null}function si(e){this._pending=0,this._loader=e||Qe()}se(ai,ii),["canvas","canvas-prebuilt"].some(function(e){try{"function"!=typeof(ti=require(e))&&(ti=null)}catch(e){ti=null}return ti});var li=si.prototype;function ci(e){e._pending+=1}function fi(e){e._pending-=1}li.pending=function(){return this._pending},li.sanitizeURL=function(e){var t=this;return ci(t),t._loader.sanitize(e,{context:"href"}).then(function(e){return fi(t),e}).catch(function(){return fi(t),null})},li.loadImage=function(e){var r=this,i=ui();return ci(r),r._loader.sanitize(e,{context:"image"}).then(function(e){var t=e.href;if(!t||!i)throw{url:t};var n=new i;return n.onload=function(){fi(r),n.loaded=!0},n.onerror=function(){fi(r),n.loaded=!1},n.src=t,n}).catch(function(e){return fi(r),{loaded:!1,width:0,height:0,src:e&&e.url||""}})},li.ready=function(){var r=this;return new Promise(function(n){!function e(t){r.pending()?setTimeout(function(){e(!0)},10):n(t)}(!1)})};var di={basis:{curve:e.curveBasis},"basis-closed":{curve:e.curveBasisClosed},"basis-open":{curve:e.curveBasisOpen},bundle:{curve:e.curveBundle,tension:"beta",value:.85},cardinal:{curve:e.curveCardinal,tension:"tension",value:0},"cardinal-open":{curve:e.curveCardinalOpen,tension:"tension",value:0},"cardinal-closed":{curve:e.curveCardinalClosed,tension:"tension",value:0},"catmull-rom":{curve:e.curveCatmullRom,tension:"alpha",value:.5},"catmull-rom-closed":{curve:e.curveCatmullRomClosed,tension:"alpha",value:.5},"catmull-rom-open":{curve:e.curveCatmullRomOpen,tension:"alpha",value:.5},linear:{curve:e.curveLinear},"linear-closed":{curve:e.curveLinearClosed},monotone:{horizontal:e.curveMonotoneY,vertical:e.curveMonotoneX},natural:{curve:e.curveNatural},step:{curve:e.curveStep},"step-after":{curve:e.curveStepAfter},"step-before":{curve:e.curveStepBefore}};function hi(e,t,n){var r=di.hasOwnProperty(e)&&di[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&null!=n&&(i=i[r.tension](n))),i}var pi={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},mi=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/];function gi(e){var t,n,r,i,a,o,u,s,l,c,f,d=[];for(s=0,c=(t=e.slice().replace(mi[0],"###$1").split(mi[1]).slice(1)).length;s<c;++s){for(r=(n=t[s]).slice(1).trim().replace(mi[2],"$1###$2").split(mi[3]),i=[o=n.charAt(0)],l=0,f=r.length;l<f;++l)(a=+r[l])===a&&i.push(a);if(u=pi[o.toLowerCase()],i.length-1>u)for(l=1,f=i.length;l<f;l+=u)d.push([o].concat(i.slice(l,l+u)));else d.push(i)}return d}var vi={},yi={},bi=[].join;function xi(e){var t=bi.call(e);if(yi[t])return yi[t];var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],u=e[5],s=e[6],l=e[7],c=l*o,f=-s*u,d=s*o,h=l*u,p=Math.cos(i),m=Math.sin(i),g=Math.cos(a),v=Math.sin(a),y=.5*(a-i),b=Math.sin(.5*y),x=8/3*b*b/Math.sin(y),_=n+p-x*m,w=r+m+x*p,k=n+g,M=r+v,O=k+x*v,E=M-x*g;return yi[t]=[c*_+f*w,d*_+h*w,c*O+f*E,d*O+h*E,c*k+f*M,d*k+h*M]}var _i=["l",0,0,0,0,0,0,0];function wi(e,t){var n=_i[0]=e[0];if("a"===n||"A"===n)_i[1]=t*e[1],_i[2]=t*e[2],_i[6]=t*e[6],_i[7]=t*e[7];else for(var r=1,i=e.length;r<i;++r)_i[r]=t*e[r];return _i}function ki(e,t,n,r,i){var a,o,u,s,l,c=null,f=0,d=0,h=0,p=0;null==n&&(n=0),null==r&&(r=0),null==i&&(i=1),e.beginPath&&e.beginPath();for(var m=0,g=t.length;m<g;++m){switch(a=t[m],1!==i&&(a=wi(a,i)),a[0]){case"l":f+=a[1],d+=a[2],e.lineTo(f+n,d+r);break;case"L":f=a[1],d=a[2],e.lineTo(f+n,d+r);break;case"h":f+=a[1],e.lineTo(f+n,d+r);break;case"H":f=a[1],e.lineTo(f+n,d+r);break;case"v":d+=a[1],e.lineTo(f+n,d+r);break;case"V":d=a[1],e.lineTo(f+n,d+r);break;case"m":f+=a[1],d+=a[2],e.moveTo(f+n,d+r);break;case"M":f=a[1],d=a[2],e.moveTo(f+n,d+r);break;case"c":o=f+a[5],u=d+a[6],h=f+a[3],p=d+a[4],e.bezierCurveTo(f+a[1]+n,d+a[2]+r,h+n,p+r,o+n,u+r),f=o,d=u;break;case"C":f=a[5],d=a[6],h=a[3],p=a[4],e.bezierCurveTo(a[1]+n,a[2]+r,h+n,p+r,f+n,d+r);break;case"s":o=f+a[3],u=d+a[4],h=2*f-h,p=2*d-p,e.bezierCurveTo(h+n,p+r,f+a[1]+n,d+a[2]+r,o+n,u+r),h=f+a[1],p=d+a[2],f=o,d=u;break;case"S":o=a[3],u=a[4],h=2*f-h,p=2*d-p,e.bezierCurveTo(h+n,p+r,a[1]+n,a[2]+r,o+n,u+r),f=o,d=u,h=a[1],p=a[2];break;case"q":o=f+a[3],u=d+a[4],h=f+a[1],p=d+a[2],e.quadraticCurveTo(h+n,p+r,o+n,u+r),f=o,d=u;break;case"Q":o=a[3],u=a[4],e.quadraticCurveTo(a[1]+n,a[2]+r,o+n,u+r),f=o,d=u,h=a[1],p=a[2];break;case"t":o=f+a[1],u=d+a[2],null===c[0].match(/[QqTt]/)?(h=f,p=d):"t"===c[0]?(h=2*f-s,p=2*d-l):"q"===c[0]&&(h=2*f-h,p=2*d-p),s=h,l=p,e.quadraticCurveTo(h+n,p+r,o+n,u+r),d=u,h=(f=o)+a[1],p=d+a[2];break;case"T":o=a[1],u=a[2],h=2*f-h,p=2*d-p,e.quadraticCurveTo(h+n,p+r,o+n,u+r),f=o,d=u;break;case"a":Mi(e,f+n,d+r,[a[1],a[2],a[3],a[4],a[5],a[6]+f+n,a[7]+d+r]),f+=a[6],d+=a[7];break;case"A":Mi(e,f+n,d+r,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+r]),f=a[6],d=a[7];break;case"z":case"Z":e.closePath()}c=a}}function Mi(e,t,n,r){for(var i=function(e,t,n,r,i,a,o,u,s){var l=bi.call(arguments);if(vi[l])return vi[l];var c=o*(Math.PI/180),f=Math.sin(c),d=Math.cos(c),h=d*(u-e)*.5+f*(s-t)*.5,p=d*(s-t)*.5-f*(u-e)*.5,m=h*h/((n=Math.abs(n))*n)+p*p/((r=Math.abs(r))*r);1<m&&(n*=m=Math.sqrt(m),r*=m);var g=d/n,v=f/n,y=-f/r,b=d/r,x=g*u+v*s,_=y*u+b*s,w=g*e+v*t,k=y*e+b*t,M=1/((w-x)*(w-x)+(k-_)*(k-_))-.25;M<0&&(M=0);var O=Math.sqrt(M);a==i&&(O=-O);var E=.5*(x+w)-O*(k-_),R=.5*(_+k)+O*(w-x),S=Math.atan2(_-R,x-E),z=Math.atan2(k-R,w-E)-S;z<0&&1===a?z+=2*Math.PI:0<z&&0===a&&(z-=2*Math.PI);for(var D=Math.ceil(Math.abs(z/(.5*Math.PI+.001))),A=[],C=0;C<D;++C){var P=S+C*z/D,q=S+(C+1)*z/D;A[C]=[E,R,P,q,n,r,f,d]}return vi[l]=A}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n),a=0;a<i.length;++a){var o=xi(i[a]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var Oi=2*Math.PI,Ei=Math.sqrt(3)/2,Ri={circle:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,Oi)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Ei*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Ei*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Ei*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Ei*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}}};function Si(e){return Ri.hasOwnProperty(e)?Ri[e]:function(e){if(!zi.hasOwnProperty(e)){var n=gi(e);zi[e]={draw:function(e,t){ki(e,n,0,0,Math.sqrt(t)/2)}}}return zi[e]}(e)}var zi={};function Di(e){return e.x}function Ai(e){return e.y}function Ci(e){return e.width}function Pi(e){return e.height}function qi(e){return function(){return e}}function Li(){var f=Di,d=Ai,h=Ci,p=Pi,m=qi(0),g=null;function t(e,t,n){var r,i=null!=t?t:+f.call(this,e),a=null!=n?n:+d.call(this,e),o=+h.call(this,e),u=+p.call(this,e),s=+m.call(this,e);if(g||(g=r=b.path()),s<=0)g.rect(i,a,o,u);else{var l=i+o,c=a+u;g.moveTo(i+s,a),g.lineTo(l-s,a),g.quadraticCurveTo(l,a,l,a+s),g.lineTo(l,c-s),g.quadraticCurveTo(l,c,l-s,c),g.lineTo(i+s,c),g.quadraticCurveTo(i,c,i,c-s),g.lineTo(i,a+s),g.quadraticCurveTo(i,a,i+s,a),g.closePath()}if(r)return g=null,r+""||null}return t.x=function(e){return arguments.length?(f="function"==typeof e?e:qi(+e),t):f},t.y=function(e){return arguments.length?(d="function"==typeof e?e:qi(+e),t):d},t.width=function(e){return arguments.length?(h="function"==typeof e?e:qi(+e),t):h},t.height=function(e){return arguments.length?(p="function"==typeof e?e:qi(+e),t):p},t.cornerRadius=function(e){return arguments.length?(m="function"==typeof e?e:qi(+e),t):m},t.context=function(e){return arguments.length?(g=null==e?null:e,t):g},t}var Ti=Math.PI;function Fi(){var o,u,s,l,c,f,d,h,p=null;function m(e,t,n){var r=n/2;if(c){var i=d-t,a=e-f;if(i||a){var o=Math.sqrt(i*i+a*a),u=(i/=o)*h,s=(a/=o)*h,l=Math.atan2(a,i);p.moveTo(f-u,d-s),p.lineTo(e-i*r,t-a*r),p.arc(e,t,r,l-Ti,l),p.lineTo(f+u,d+s),p.arc(f,d,h,l,l+Ti)}else p.arc(e,t,r,0,2*Ti);p.closePath()}else c=1;f=e,d=t,h=r}function t(e){var t,n,r,i=e.length,a=!1;for(null==p&&(p=r=b.path()),t=0;t<=i;++t)!(t<i&&l(n=e[t],t,e))===a&&(a=!a)&&(c=0),a&&m(+o(n,t,e),+u(n,t,e),+s(n,t,e));if(r)return p=null,r+""||null}return t.x=function(e){return arguments.length?(o=e,t):o},t.y=function(e){return arguments.length?(u=e,t):u},t.size=function(e){return arguments.length?(s=e,t):s},t.defined=function(e){return arguments.length?(l=e,t):l},t.context=function(e){return arguments.length?(p=null==e?null:e,t):p},t}function Ni(e){return e.x||0}function Ii(e){return e.y||0}function ji(e){return e.cornerRadius||0}function Ui(e){return!(!1===e.defined)}var Bi=e.arc().startAngle(function(e){return e.startAngle||0}).endAngle(function(e){return e.endAngle||0}).padAngle(function(e){return e.padAngle||0}).innerRadius(function(e){return e.innerRadius||0}).outerRadius(function(e){return e.outerRadius||0}).cornerRadius(ji),$i=e.area().x(Ni).y1(Ii).y0(function(e){return(e.y||0)+(e.height||0)}).defined(Ui),Gi=e.area().y(Ii).x1(Ni).x0(function(e){return(e.x||0)+(e.width||0)}).defined(Ui),Wi=e.line().x(Ni).y(Ii).defined(Ui),Yi=Li().x(Ni).y(Ii).width(function(e){return e.width||0}).height(function(e){return e.height||0}).cornerRadius(ji),Hi=e.symbol().type(function(e){return Si(e.shape||"circle")}).size(function(e){return null==e.size?64:e.size}),Vi=Fi().x(Ni).y(Ii).defined(Ui).size(function(e){return e.size||1});function Xi(e,t,n,r){return Yi.context(e)(t,n,r)}function Ji(e,t){return t.stroke&&0!==t.opacity&&0!==t.strokeOpacity&&e.expand(null!=t.strokeWidth?+t.strokeWidth:1),e}var Qi,Ki=2*Math.PI,Zi=Ki/4,ea=Ki-1e-8;function ta(e){return Qi=e,ta}function na(){}function ra(e,t){Qi.add(e,t)}function ia(e,t,n){return n.id?function(e,t,n){for(var r=n.width(),i=n.height(),a=n.x1+t.x1*r,o=n.y1+t.y1*i,u=n.x1+t.x2*r,s=n.y1+t.y2*i,l=t.stops,c=0,f=l.length,d=e.createLinearGradient(a,o,u,s);c<f;++c)d.addColorStop(l[c].offset,l[c].color);return d}(e,n,t.bounds):n}function aa(e,t,n){return 0<(n*=null==t.fillOpacity?1:t.fillOpacity)&&(e.globalAlpha=n,e.fillStyle=ia(e,t,t.fill),!0)}ta.beginPath=na,ta.closePath=na,ta.moveTo=ra,ta.lineTo=ra,ta.rect=function(e,t,n,r){ra(e,t),ra(e+n,t+r)},ta.quadraticCurveTo=function(e,t,n,r){ra(e,t),ra(n,r)},ta.bezierCurveTo=function(e,t,n,r,i,a){ra(e,t),ra(n,r),ra(i,a)},ta.arc=function(e,t,n,r,i,a){if(Math.abs(i-r)>ea)return ra(e-n,t-n),void ra(e+n,t+n);var o,u,s,l,c=1/0,f=-1/0,d=1/0,h=-1/0;function p(e){s=n*Math.cos(e),l=n*Math.sin(e),s<c&&(c=s),f<s&&(f=s),l<d&&(d=l),h<l&&(h=l)}if(p(r),p(i),i!==r)if((r%=Ki)<0&&(r+=Ki),(i%=Ki)<0&&(i+=Ki),i<r&&(a=!a,o=r,r=i,i=o),a)for(i-=Ki,o=r-r%Zi,u=0;u<4&&i<o;++u,o-=Zi)p(o);else for(o=r-r%Zi+Zi,u=0;u<4&&o<i;++u,o+=Zi)p(o);ra(e+c,t+d),ra(e+f,t+h)};var oa=[];function ua(e,t,n){var r=null!=(r=t.strokeWidth)?r:1;return!(r<=0)&&(0<(n*=null==t.strokeOpacity?1:t.strokeOpacity)&&(e.globalAlpha=n,e.strokeStyle=ia(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||oa),e.lineDashOffset=t.strokeDashOffset||0),!0))}function sa(e,t){return e.zindex-t.zindex||e.index-t.index}function la(e){if(!e.zdirty)return e.zitems;var t,n,r,i=e.items,a=[];for(n=0,r=i.length;n<r;++n)(t=i[n]).index=n,t.zindex&&a.push(t);return e.zdirty=!1,e.zitems=a.sort(sa)}function ca(e,t){var n,r,i=e.items;if(i&&i.length){var a=la(e);if(a&&a.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||t(i[n]);i=a}for(n=0,r=i.length;n<r;++n)t(i[n])}}function fa(e,t){var n,r,i=e.items;if(!i||!i.length)return null;var a=la(e);for(a&&a.length&&(i=a),r=i.length;0<=--r;)if(n=t(i[r]))return n;if(i===a)for(r=(i=e.items).length;0<=--r;)if(!i[r].zindex&&(n=t(i[r])))return n;return null}function da(r){return function(t,e,n){ca(e,function(e){n&&!n.intersects(e.bounds)||ha(r,t,e,e)})}}function ha(e,t,n,r){var i=null==n.opacity?1:n.opacity;0!==i&&(e(t,r)||(n.fill&&aa(t,n,i)&&t.fill(),n.stroke&&ua(t,n,i)&&t.stroke()))}var pa=function(){return!0};function ma(u){return u||(u=pa),function(n,e,r,i,a,o){return r*=n.pixelRatio,i*=n.pixelRatio,fa(e,function(e){var t=e.bounds;if((!t||t.contains(a,o))&&t)return u(n,e,r,i,a,o)?e:void 0})}}function ga(l,c){return function(e,t,n,r){var i,a,o=Array.isArray(t)?t[0]:t,u=null==c?o.fill:c,s=o.stroke&&e.isPointInStroke;return s&&(i=o.strokeWidth,a=o.strokeCap,e.lineWidth=null!=i?i:1,e.lineCap=null!=a?a:"butt"),!l(e,t)&&(u&&e.isPointInPath(n,r)||s&&e.isPointInStroke(n,r))}}function va(e){return ma(ga(e))}function ya(e,t){return"translate("+e+","+t+")"}function ba(e){return ya(e.x||0,e.y||0)}function xa(e,i){function t(e,t){var n=t.x||0,r=t.y||0;e.translate(n,r),e.beginPath(),i(e,t),e.translate(-n,-r)}return{type:e,tag:"path",nested:!1,attr:function(e,t){e("transform",ba(t)),e("d",i(null,t))},bound:function(e,t){return i(ta(e),t),Ji(e,t).translate(t.x||0,t.y||0)},draw:da(t),pick:va(t)}}var _a=xa("arc",function(e,t){return Bi.context(e)(t)});function wa(e,r,t){function n(e,t){e.beginPath(),r(e,t)}var i,s=ga(n);return{type:e,tag:"path",nested:!0,attr:function(e,t){var n=t.mark.items;n.length&&e("d",r(null,n))},bound:function(e,t){var n=t.items;return 0===n.length?e:(r(ta(e),n),Ji(e,n[0]))},draw:(i=n,function(e,t,n){!t.items.length||n&&!n.intersects(t.bounds)||ha(i,e,t.items[0],t.items)}),pick:function(e,t,n,r,i,a){var o=t.items,u=t.bounds;return!o||!o.length||u&&!u.contains(i,a)?null:(n*=e.pixelRatio,r*=e.pixelRatio,s(e,o,n,r)?o[0]:null)},tip:t}}var ka=wa("area",function(e,t){var n=t[0],r=n.interpolate||"linear";return("horizontal"===n.orient?Gi:$i).curve(hi(r,n.orient,n.tension)).context(e)(t)},function(e,t){var n="horizontal"===e[0].orient?t[1]:t[0],r="horizontal"===e[0].orient?"y":"x",i=0,a=e.length;if(1===a)return e[0];for(;i<a;){var o=i+a>>>1;e[o][r]<n?i=o+1:a=o}return i=Math.max(0,i-1),a=Math.min(e.length-1,a),n-e[i][r]<e[a][r]-n?e[i]:e[a]}),Ma=1;function Oa(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+Ma++),o=i.clipping[a]||(i.clipping[a]={id:a});return te(r)?o.path=r(null):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}var Ea=.5;function Ra(e,t){var n=t.stroke?Ea:0;e.beginPath(),Xi(e,t,n,n)}var Sa=ga(Ra);var za={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",ba(t))},bound:function(e,t){if(!t.clip&&t.items)for(var n=t.items,r=0,i=n.length;r<i;++r)e.union(n[r].bounds);return(t.clip||t.width||t.height)&&Ji(e.add(0,0).add(t.width||0,t.height||0),t),e.translate(t.x||0,t.y||0)},draw:function(o,e,u){var s=this;ca(e,function(e){var t,n=e.x||0,r=e.y||0,i=e.width||0,a=e.height||0;o.save(),o.translate(n,r),(e.stroke||e.fill)&&0<(t=null==e.opacity?1:e.opacity)&&(Ra(o,e),e.fill&&aa(o,e,t)&&o.fill(),e.stroke&&ua(o,e,t)&&o.stroke()),e.clip&&(o.beginPath(),o.rect(0,0,i,a),o.clip()),u&&u.translate(-n,-r),ca(e,function(e){s.draw(o,e,u)}),u&&u.translate(n,r),o.restore()})},pick:function(r,o,u,s,l,c){if(o.bounds&&!o.bounds.contains(l,c)||!o.items)return null;var f=this,d=u*r.pixelRatio,h=s*r.pixelRatio;return fa(o,function(e){var t,i,a,n;if(!(n=e.bounds)||n.contains(l,c))return i=e.x||0,a=e.y||0,r.save(),r.translate(i,a),i=l-i,a=c-a,!(t=fa(e,function(e){return n=i,r=a,(!1!==(t=e).interactive||"group"===t.marktype)&&t.bounds&&t.bounds.contains(n,r)?f.pick(e,u,s,i,a):null;var t,n,r}))&&!1!==o.interactive&&(e.fill||e.stroke)&&Sa(r,e,d,h)&&(t=e),r.restore(),t||null})},background:function(e,t){var n=t.stroke?Ea:0;e("class","background"),e("d",Xi(null,t,n,n))},foreground:function(e,t,n){e("clip-path",t.clip?Oa(n,t,t):null)}};function Da(t,e){var n=t.image;return n&&n.url===t.url||(n={loaded:!1,width:0,height:0},e.loadImage(t.url).then(function(e){t.image=e,t.image.url=t.url})),n}function Aa(e,t){return"center"===e?t/2:"right"===e?t:0}function Ca(e,t){return"middle"===e?t/2:"bottom"===e?t:0}var Pa={type:"image",tag:"image",nested:!1,attr:function(e,t,n){var r=Da(t,n),i=t.x||0,a=t.y||0,o=(null!=t.width?t.width:r.width)||0,u=(null!=t.height?t.height:r.height)||0,s=!1===t.aspect?"none":"xMidYMid";i-=Aa(t.align,o),a-=Ca(t.baseline,u),e("href",r.src||"","http://www.w3.org/1999/xlink","xlink:href"),e("transform",ya(i,a)),e("width",o),e("height",u),e("preserveAspectRatio",s)},bound:function(e,t){var n=t.image,r=t.x||0,i=t.y||0,a=(null!=t.width?t.width:n&&n.width)||0,o=(null!=t.height?t.height:n&&n.height)||0;return r-=Aa(t.align,a),i-=Ca(t.baseline,o),e.set(r,i,r+a,i+o)},draw:function(c,e,f){var d=this;ca(e,function(e){if(!f||f.intersects(e.bounds)){var t,n,r,i,a=Da(e,d),o=e.x||0,u=e.y||0,s=(null!=e.width?e.width:a.width)||0,l=(null!=e.height?e.height:a.height)||0;o-=Aa(e.align,s),u-=Ca(e.baseline,l),!1!==e.aspect&&(n=a.width/a.height,r=e.width/e.height,n==n&&r==r&&n!==r&&(r<n?(u+=(l-(i=s/n))/2,l=i):(o+=(s-(i=l*n))/2,s=i))),a.loaded&&(c.globalAlpha=null!=(t=e.opacity)?t:1,c.drawImage(a,o,u,s,l))}})},pick:ma(),get:Da,xOffset:Aa,yOffset:Ca},qa=wa("line",function(e,t){var n=t[0],r=n.interpolate||"linear";return Wi.curve(hi(r,n.orient,n.tension)).context(e)(t)},function(e,t){for(var n,r,i=Math.pow(e[0].strokeWidth||1,2),a=e.length;0<=--a;)if(!1!==e[a].defined&&(n=e[a].x-t[0])*n+(r=e[a].y-t[1])*r<i)return e[a];return null});function La(e,t){var n=t.path;if(null==n)return!0;var r=t.pathCache;r&&r.path===n||((t.pathCache=r=gi(n)).path=n),ki(e,r,t.x,t.y)}var Ta={type:"path",tag:"path",nested:!1,attr:function(e,t){e("transform",ba(t)),e("d",t.path)},bound:function(e,t){return La(ta(e),t)?e.set(0,0,0,0):Ji(e,t)},draw:da(La),pick:va(La)};function Fa(e,t){e.beginPath(),Xi(e,t)}var Na={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",Xi(null,t))},bound:function(e,t){var n,r;return Ji(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)},draw:da(Fa),pick:va(Fa)};function Ia(e,t,n){var r,i,a,o;return!(!t.stroke||!ua(e,t,n))&&(r=t.x||0,i=t.y||0,a=null!=t.x2?t.x2:r,o=null!=t.y2?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(a,o),!0)}var ja,Ua,Ba={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",ba(t)),e("x2",null!=t.x2?t.x2-(t.x||0):0),e("y2",null!=t.y2?t.y2-(t.y||0):0)},bound:function(e,t){var n,r;return Ji(e.set(n=t.x||0,r=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r),t)},draw:function(n,e,r){ca(e,function(e){if(!r||r.intersects(e.bounds)){var t=null==e.opacity?1:e.opacity;t&&Ia(n,e,t)&&n.stroke()}})},pick:ma(function(e,t,n,r){return!!e.isPointInStroke&&Ia(e,t,1)&&e.isPointInStroke(n,r)})},$a=xa("shape",function(e,t){return(t.mark.shape||t.shape).context(e)(t)}),Ga=xa("symbol",function(e,t){return Hi.context(e)(t)}),Wa={height:Ja,measureWidth:Va,estimateWidth:Ya,width:Ya,canvas:Qa};function Ya(e){return Ua=Ja(e),Ha(Ka(e))}function Ha(e){return~~(.8*e.length*Ua)}function Va(e){return ja.font=Za(e),Xa(Ka(e))}function Xa(e){return ja.measureText(e).width}function Ja(e){return null!=e.fontSize?e.fontSize:11}function Qa(e){ja=e&&(ja=oi(1,1))?ja.getContext("2d"):null,Wa.width=ja?Va:Ya}function Ka(e){var t=e.text;return null==t?"":0<e.limit?function(e){var t,n=+e.limit,r=e.text+"";ja?(ja.font=Za(e),t=Xa):(Ua=Ja(e),t=Ha);if(t(r)<n)return r;var i,a=e.ellipsis||"…",o="rtl"===e.dir,u=0,s=r.length;{if(n-=t(a),o){for(;u<s;)i=u+s>>>1,t(r.slice(i))>n?u=i+1:s=i;return a+r.slice(u)}for(;u<s;)i=1+(u+s>>>1),t(r.slice(0,i))<n?u=i:s=i-1;return r.slice(0,u)+a}}(e):t+""}function Za(e,t){var n=e.font;return t&&n&&(n=String(n).replace(/"/g,"'")),(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+Ja(e)+"px "+(n||"sans-serif")}function eo(e){var t=e.baseline,n=Ja(e);return Math.round("top"===t?.79*n:"middle"===t?.3*n:"bottom"===t?-.21*n:0)}Qa(!0);var to={left:"start",center:"middle",right:"end"},no=new Zr;function ro(e,t,n){var r,i,a=Wa.height(t),o=t.align,u=t.radius||0,s=t.x||0,l=t.y||0,c=t.dx||0,f=(t.dy||0)+eo(t)-Math.round(.8*a);return u&&(i=(t.theta||0)-Math.PI/2,s+=u*Math.cos(i),l+=u*Math.sin(i)),r=Wa.width(t),"center"===o?c-=r/2:"right"===o&&(c-=r),e.set(c+=s,f+=l,c+r,f+a),t.angle&&!n&&e.rotate(t.angle*Math.PI/180,s,l),e.expand(n||!r?0:1)}var io={arc:_a,area:ka,group:za,image:Pa,line:qa,path:Ta,rect:Na,rule:Ba,shape:$a,symbol:Ga,text:{type:"text",tag:"text",nested:!1,attr:function(e,t){var n,r=t.dx||0,i=(t.dy||0)+eo(t),a=t.x||0,o=t.y||0,u=t.angle||0,s=t.radius||0;s&&(n=(t.theta||0)-Math.PI/2,a+=s*Math.cos(n),o+=s*Math.sin(n)),e("text-anchor",to[t.align]||"start"),u?(n=ya(a,o)+" rotate("+u+")",(r||i)&&(n+=" "+ya(r,i))):n=ya(a+r,o+i),e("transform",n)},bound:ro,draw:function(u,e,s){ca(e,function(e){var t,n,r,i,a,o;s&&!s.intersects(e.bounds)||(o=Ka(e))&&0!==(t=null==e.opacity?1:e.opacity)&&(u.font=Za(e),u.textAlign=e.align||"left",n=e.x||0,r=e.y||0,(i=e.radius)&&(a=(e.theta||0)-Math.PI/2,n+=i*Math.cos(a),r+=i*Math.sin(a)),e.angle&&(u.save(),u.translate(n,r),u.rotate(e.angle*Math.PI/180),n=r=0),n+=e.dx||0,r+=(e.dy||0)+eo(e),e.fill&&aa(u,e,t)&&u.fillText(o,n,r),e.stroke&&ua(u,e,t)&&u.strokeText(o,n,r),e.angle&&u.restore())})},pick:ma(function(e,t,n,r,i,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=ro(no,t,!0),u=-t.angle*Math.PI/180,s=Math.cos(u),l=Math.sin(u),c=t.x,f=t.y,d=s*i-l*a+(c-c*s+f*l),h=l*i+s*a+(f-c*l-f*s);return o.contains(d,h)})},trail:wa("trail",function(e,t){return Vi.context(e)(t)},function(e,t){for(var n,r,i=e.length;0<=--i;)if(!1!==e[i].defined&&(n=e[i].x-t[0])*n+(r=e[i].y-t[1])*r<(n=e[i].size||1)*n)return e[i];return null})};function ao(e,t,n){var r=io[e.mark.marktype],i=t||r.bound;return r.nested&&(e=e.mark),i(e.bounds||(e.bounds=new Zr),e,n)}var oo={mark:null};function uo(e,t,n){var r,i,a,o,u=io[e.marktype],s=u.bound,l=e.items,c=l&&l.length;if(u.nested)return c?a=l[0]:(oo.mark=e,a=oo),o=ao(a,s,n),t=t&&t.union(o)||o;if(t=t||e.bounds&&e.bounds.clear()||new Zr,c)for(r=0,i=l.length;r<i;++r)t.union(ao(l[r],s,n));return e.bounds=t}var so=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","interpolate","tension","orient","defined","url","path","x2","y2","size","shape","text","angle","theta","radius","dx","dy","font","fontSize","fontWeight","fontStyle","fontVariant"];function lo(e,t){return JSON.stringify(e,so,t)}function co(e){return function e(t){var n,r,i,a=t.marktype,o=t.items;if(o)for(r=0,i=o.length;r<i;++r)n=a?"mark":"group",o[r][n]=t,o[r].zindex&&(o[r][n].zdirty=!0),"group"===(a||n)&&e(o[r]);a&&uo(t);return t}("string"==typeof e?JSON.parse(e):e)}function fo(e){arguments.length?this.root=co(e):(this.root=po({marktype:"group",name:"root",role:"frame"}),this.root.items=[new ai(this.root)])}var ho=fo.prototype;function po(e,t){return{bounds:new Zr,clip:!!e.clip,group:t,interactive:!1!==e.interactive,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0}}function mo(e,t,n){return!e&&"undefined"!=typeof document&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function go(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function vo(e,t,n,r){var i,a=e.childNodes[t];return a&&a.tagName.toLowerCase()===n.toLowerCase()||(i=a||null,a=mo(e.ownerDocument,n,r),e.insertBefore(a,i)),a}function yo(e,t){for(var n=e.childNodes,r=n.length;t<r;)e.removeChild(n[--r]);return e}function bo(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function xo(e,t){var n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function _o(e,t){this._active=null,this._handlers={},this._loader=e||Qe(),this._tooltip=t||wo}function wo(e,t,n,r){e.element().setAttribute("title",r||"")}ho.toJSON=function(e){return lo(this.root,e||0)},ho.mark=function(e,t,n){var r=po(e,t=t||this.root.items[0]);return(t.items[n]=r).zindex&&(r.group.zdirty=!0),r};var ko=_o.prototype;function Mo(e){this._el=null,this._bgcolor=null,this._loader=new si(e)}ko.initialize=function(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},ko.element=function(){return this._el},ko.canvas=function(){return this._el&&this._el.firstChild},ko.origin=function(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},ko.scene=function(e){return arguments.length?(this._scene=e,this):this._scene},ko.on=function(){},ko.off=function(){},ko._handlerIndex=function(e,t,n){for(var r=e?e.length:0;0<=--r;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},ko.handlers=function(e){var t,n=this._handlers,r=[];if(e)r.push.apply(r,n[this.eventName(e)]);else for(t in n)r.push.apply(r,n[t]);return r},ko.eventName=function(e){var t=e.indexOf(".");return t<0?e:e.slice(0,t)},ko.handleHref=function(i,e,t){this._loader.sanitize(t,{context:"href"}).then(function(e){var t=new MouseEvent(i.type,i),n=mo(null,"a");for(var r in e)n.setAttribute(r,e[r]);n.dispatchEvent(t)}).catch(function(){})},ko.handleTooltip=function(e,t,n){if(t&&null!=t.tooltip){t=function(e,t,n,r){var i,a,o=e&&e.mark;if(o&&(i=io[o.marktype]).tip){for((a=xo(t,n))[0]-=r[0],a[1]-=r[1];e=e.mark.group;)a[0]-=e.x||0,a[1]-=e.y||0;e=i.tip(o.items,a)}return e}(t,e,this.canvas(),this._origin);var r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},ko.getItemBoundingClientRect=function(e){if(t=this.canvas()){for(var t,n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.x1+r[0]+n.left,o=i.y1+r[1]+n.top,u=i.width(),s=i.height();e.mark&&(e=e.mark.group);)a+=e.x||0,o+=e.y||0;return{x:a,y:o,width:u,height:s,left:a,top:o,right:a+u,bottom:o+s}}};var Oo=Mo.prototype;Oo.initialize=function(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},Oo.element=function(){return this._el},Oo.canvas=function(){return this._el&&this._el.firstChild},Oo.background=function(e){return 0===arguments.length?this._bgcolor:(this._bgcolor=e,this)},Oo.resize=function(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},Oo.dirty=function(){},Oo.render=function(e){var t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},Oo._render=function(){},Oo.renderAsync=function(e){var t=this.render(e);return this._ready?this._ready.then(function(){return t}):Promise.resolve(t)},Oo._load=function(e,t){var n=this,r=n._loader[e](t);if(!n._ready){var i=n._call;n._ready=n._loader.ready().then(function(e){e&&i(),n._ready=null})}return r},Oo.sanitizeURL=function(e){return this._load("sanitizeURL",e)},Oo.loadImage=function(e){return this._load("loadImage",e)};var Eo="mousemove",Ro="mouseout",So="click";function zo(e,t){_o.call(this,e,t),this._down=null,this._touch=null,this._first=!0}var Do=se(zo,_o);function Ao(r,i,a){return function(e){var t=this._active,n=this.pickEvent(e);n===t||(t&&t.exit||this.fire(a,e),this._active=n,this.fire(i,e)),this.fire(r,e)}}function Co(t){return function(e){this.fire(t,e),this._active=null}}Do.initialize=function(e,t,n){var r=this._canvas=e&&go(e,"canvas");if(r){var i=this;this.events.forEach(function(t){r.addEventListener(t,function(e){Do[t]?Do[t].call(i,e):i.fire(t,e)})})}return _o.prototype.initialize.call(this,e,t,n)},Do.canvas=function(){return this._canvas},Do.context=function(){return this._canvas.getContext("2d")},Do.events=["keydown","keypress","keyup","dragenter","dragleave","dragover","mousedown","mouseup","mousemove","mouseout","mouseover","click","dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],Do.DOMMouseScroll=function(e){this.fire("mousewheel",e)},Do.mousemove=Ao("mousemove","mouseover","mouseout"),Do.dragover=Ao("dragover","dragenter","dragleave"),Do.mouseout=Co("mouseout"),Do.dragleave=Co("dragleave"),Do.mousedown=function(e){this._down=this._active,this.fire("mousedown",e)},Do.click=function(e){this._down===this._active&&(this.fire("click",e),this._down=null)},Do.touchstart=function(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",e,!0)},Do.touchmove=function(e){this.fire("touchmove",e,!0)},Do.touchend=function(e){this.fire("touchend",e,!0),this._touch=null},Do.fire=function(e,t,n){var r,i,a=n?this._touch:this._active,o=this._handlers[e];if((t.vegaType=e)===So&&a&&a.href?this.handleHref(t,a,a.href):e!==Eo&&e!==Ro||this.handleTooltip(t,a,e!==Ro),o)for(r=0,i=o.length;r<i;++r)o[r].handler.call(this._obj,t,a)},Do.on=function(e,t){var n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(r[n]||(r[n]=[])).push({type:e,handler:t}),this},Do.off=function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return 0<=i&&r.splice(i,1),this},Do.pickEvent=function(e){var t=xo(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},Do.pick=function(e,t,n,r,i){var a=this.context();return io[e.marktype].pick.call(this,a,e,t,n,r,i)};var Po="undefined"!=typeof window&&window.devicePixelRatio||1;function qo(e){Mo.call(this,e),this._redraw=!1,this._dirty=new Zr}var Lo=se(qo,Mo),To=Mo.prototype,Fo=new Zr;function No(e,t){_o.call(this,e,t);var n=this;n._hrefHandler=jo(n,function(e,t){t&&t.href&&n.handleHref(e,t,t.href)}),n._tooltipHandler=jo(n,function(e,t){n.handleTooltip(e,t,e.type!==Ro)})}Lo.initialize=function(e,t,n,r,i){return this._canvas=oi(1,1),e&&(yo(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),To.initialize.call(this,e,t,n,r,i)},Lo.resize=function(e,t,n,r){var i,a,o,u,s,l,c,f;return To.resize.call(this,e,t,n,r),i=this._canvas,a=this._width,o=this._height,u=this._origin,s=this._scale,l="undefined"!=typeof HTMLElement&&i instanceof HTMLElement&&null!=i.parentNode,c=i.getContext("2d"),f=l?Po:s,i.width=a*f,i.height=o*f,l&&1!==f&&(i.style.width=a+"px",i.style.height=o+"px"),c.pixelRatio=f,c.setTransform(f,0,0,f,f*u[0],f*u[1]),this._redraw=!0,this},Lo.canvas=function(){return this._canvas},Lo.context=function(){return this._canvas?this._canvas.getContext("2d"):null},Lo.dirty=function(e){var t=function(e,t){if(null==t)return e;for(var n=Fo.clear().union(e);null!=t;t=t.mark.group)n.translate(t.x||0,t.y||0);return n}(e.bounds,e.mark.group);this._dirty.union(t)},Lo._render=function(e){var t,n,r,i=this.context(),a=this._origin,o=this._width,u=this._height,s=this._dirty;return i.save(),this._redraw||s.empty()?(this._redraw=!1,s=null):(t=i,r=a,(n=s).expand(1).round(),n.translate(-r[0]%1,-r[1]%1),t.beginPath(),t.rect(n.x1,n.y1,n.width(),n.height()),t.clip(),s=n),this.clear(-a[0],-a[1],o,u),this.draw(i,e,s),i.restore(),this._dirty.clear(),this},Lo.draw=function(e,t,n){var r=io[t.marktype];t.clip&&function(e,t){var n=t.clip;if(e.save(),e.beginPath(),te(n))n(e);else{var r=t.group;e.rect(0,0,r.width||0,r.height||0)}e.clip()}(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},Lo.clear=function(e,t,n,r){var i=this.context();i.clearRect(e,t,n,r),null!=this._bgcolor&&(i.fillStyle=this._bgcolor,i.fillRect(e,t,n,r))};var Io=se(No,_o);function jo(n,r){return function(e){var t=e.target.__data__;e.vegaType=e.type,t=Array.isArray(t)?t[0]:t,r.call(n._obj,e,t)}}function Uo(e,t,n){var r,i,a="<"+e;if(t)for(r in t)null!=(i=t[r])&&(a+=" "+r+'="'+i+'"');return n&&(a+=" "+n),a+">"}function Bo(e){return"</"+e+">"}Io.initialize=function(e,t,n){var r=this._svg;return r&&(r.removeEventListener(So,this._hrefHandler),r.removeEventListener(Eo,this._tooltipHandler),r.removeEventListener(Ro,this._tooltipHandler)),this._svg=r=e&&go(e,"svg"),r&&(r.addEventListener(So,this._hrefHandler),r.addEventListener(Eo,this._tooltipHandler),r.addEventListener(Ro,this._tooltipHandler)),_o.prototype.initialize.call(this,e,t,n)},Io.canvas=function(){return this._svg},Io.on=function(e,t){var n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){var i={type:e,handler:t,listener:jo(this,t)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},Io.off=function(e,t){var n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return 0<=i&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this};var $o={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},Go={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},Wo=Object.keys(Go),Yo=$o.xmlns;function Ho(e){Mo.call(this,e),this._dirtyID=1,this._dirty=[],this._svg=null,this._root=null,this._defs=null}var Vo=se(Ho,Mo),Xo=Mo.prototype;function Jo(e,t,n){var r,i,a;for((e=vo(e,n,"linearGradient",Yo)).setAttribute("id",t.id),e.setAttribute("x1",t.x1),e.setAttribute("x2",t.x2),e.setAttribute("y1",t.y1),e.setAttribute("y2",t.y2),r=0,i=t.stops.length;r<i;++r)(a=vo(e,r,"stop",Yo)).setAttribute("offset",t.stops[r].offset),a.setAttribute("stop-color",t.stops[r].color);yo(e,r)}function Qo(e,t,n){var r;(e=vo(e,n,"clipPath",Yo)).setAttribute("id",t.id),t.path?(r=vo(e,0,"path",Yo)).setAttribute("d",t.path):((r=vo(e,0,"rect",Yo)).setAttribute("x",0),r.setAttribute("y",0),r.setAttribute("width",t.width),r.setAttribute("height",t.height))}function Ko(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function Zo(e,t,n,r,i){var a,o,u,s=e._svg;if(!s&&(s=mo(a=t.ownerDocument,r,Yo),e._svg=s,e.mark&&(s.__data__=e,s.__values__={fill:"default"},"g"===r))){var l=mo(a,"path",Yo);l.setAttribute("class","background"),s.appendChild(l),l.__data__=e;var c=mo(a,"g",Yo);s.appendChild(c),c.__data__=e}return(s.ownerSVGElement!==i||(u=(o=e).mark||o.group)&&1<u.items.length&&s.previousSibling!==n)&&t.insertBefore(s,n?n.nextSibling:t.firstChild),s}Vo.initialize=function(e,t,n,r){return e&&(this._svg=vo(e,0,"svg",Yo),this._svg.setAttribute("class","marks"),yo(e,1),this._root=vo(this._svg,0,"g",Yo),yo(this._svg,1)),this._defs={gradient:{},clipping:{}},this.background(this._bgcolor),Xo.initialize.call(this,e,t,n,r)},Vo.background=function(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Xo.background.apply(this,arguments)},Vo.resize=function(e,t,n,r){return Xo.resize.call(this,e,t,n,r),this._svg&&(this._svg.setAttribute("width",this._width*this._scale),this._svg.setAttribute("height",this._height*this._scale),this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height),this._root.setAttribute("transform","translate("+this._origin+")")),this._dirty=[],this},Vo.canvas=function(){return this._svg},Vo.svg=function(){if(!this._svg)return null;var e={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var t in $o)e[t]=$o[t];var n=this._bgcolor?Uo("rect",{width:this._width,height:this._height,style:"fill: "+this._bgcolor+";"})+Bo("rect"):"";return Uo("svg",e)+n+this._svg.innerHTML+Bo("svg")},Vo._render=function(e){return this._dirtyCheck()&&(this._dirtyAll&&this._resetDefs(),this.draw(this._root,e),yo(this._root,1)),this.updateDefs(),this._dirty=[],++this._dirtyID,this},Vo.updateDefs=function(){var e,t=this._svg,n=this._defs,r=n.el,i=0;for(e in n.gradient)r||(n.el=r=vo(t,0,"defs",Yo)),Jo(r,n.gradient[e],i++);for(e in n.clipping)r||(n.el=r=vo(t,0,"defs",Yo)),Qo(r,n.clipping[e],i++);r&&(0===i?(t.removeChild(r),n.el=null):yo(r,i))},Vo._resetDefs=function(){var e=this._defs;e.gradient={},e.clipping={}},Vo.dirty=function(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},Vo.isDirty=function(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},Vo._dirtyCheck=function(){this._dirtyAll=!0;var e=this._dirty;if(!e.length)return!0;var t,n,r,i,a,o,u,s=++this._dirtyID;for(a=0,o=e.length;a<o;++a)(n=(t=e[a]).mark).marktype!==r&&(r=n.marktype,i=io[r]),n.zdirty&&n.dirty!==s&&(this._dirtyAll=!1,Ko(t,s),n.items.forEach(function(e){e.dirty=s})),n.zdirty||(t.exit?(i.nested&&n.items.length?(u=n.items[0])._svg&&this._update(i,u._svg,u):t._svg&&(u=t._svg.parentNode)&&u.removeChild(t._svg),t._svg=null):(t=i.nested?n.items[0]:t)._update!==s&&(t._svg&&t._svg.ownerSVGElement?this._update(i,t._svg,t):(this._dirtyAll=!1,Ko(t,s)),t._update=s));return!this._dirtyAll},Vo.draw=function(e,t,n){if(!this.isDirty(t))return t._svg;var r,i=this,a=this._svg,o=io[t.marktype],u=!1===t.interactive?"none":null,s="g"===o.tag,l=null,c=0;function f(e){var t=i.isDirty(e),n=Zo(e,r,l,o.tag,a);t&&(i._update(o,n,e),s&&function(t,n,e){n=n.lastChild;var r,i=0;ca(e,function(e){r=t.draw(n,e,r),++i}),yo(n,1+i)}(i,n,e)),l=n,++c}return(r=Zo(t,e,n,"g",a)).setAttribute("class",bo(t)),s||r.style.setProperty("pointer-events",u),t.clip?r.setAttribute("clip-path",Oa(i,t,t.group)):r.removeAttribute("clip-path"),o.nested?t.items.length&&f(t.items[0]):ca(t,f),yo(r,c),r};var eu=null,tu=null,nu={group:function(e,t,n){tu=t.__values__,eu=t.childNodes[1],e.foreground(ru,n,this),eu=t.childNodes[0],e.background(ru,n,this);var r=!1===n.mark.interactive?"none":null;r!==tu.events&&(eu.style.setProperty("pointer-events",r),tu.events=r)},text:function(e,t,n){var r=Ka(n);r!==tu.text&&(t.textContent=r,tu.text=r),(r=Za(n))!==tu.font&&(t.style.setProperty("font",r),tu.font=r)}};function ru(e,t,n){t!==tu[e]&&(null!=t?n?eu.setAttributeNS(n,e,t):eu.setAttribute(e,t):n?eu.removeAttributeNS(n,e):eu.removeAttribute(e),tu[e]=t)}function iu(e){Mo.call(this,e),this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""},this._defs={gradient:{},clipping:{}}}Vo._update=function(e,t,n){tu=(eu=t).__values__,e.attr(ru,n,this);var r=nu[e.type];r&&r.call(this,e,t,n),this.style(eu,n)},Vo.style=function(e,t){var n,r,i,a,o,u;if(null!=t)for(n=0,r=Wo.length;n<r;++n)(o=t[i=Wo[n]])!==tu[i]&&(a=Go[i],null==o?"fill"===a?e.style.setProperty(a,"none"):e.style.removeProperty(a):(o.id&&(this._defs.gradient[o.id]=o,o="url("+(u=void 0,"undefined"==typeof window?"":(u=window.location).hash?u.href.slice(0,-u.hash.length):u.href)+"#"+o.id+")"),e.style.setProperty(a,o+"")),tu[i]=o)};var au,ou=se(iu,Mo),uu=Mo.prototype;function su(e,t,n,r){au[r||e]=t}function lu(e,t,n,r){if(null==e)return"";var i,a,o,u,s,l="";for("bgrect"===n&&!1===t.interactive&&(l+="pointer-events: none; "),"text"===n&&(l+="font: "+Za(e)+"; "),i=0,a=Wo.length;i<a;++i)o=Wo[i],u=Go[o],null==(s=e[o])?"fill"===u&&(l+="fill: none; "):"transparent"!==s||"fill"!==u&&"stroke"!==u?(s.id&&(s="url(#"+(r.gradient[s.id]=s).id+")"),l+=u+": "+s+"; "):l+=u+": none; ";return l?'style="'+l.trim()+'"':null}ou.resize=function(e,t,n,r){uu.resize.call(this,e,t,n,r);var i=this._origin,a=this._text,o={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var u in $o)o[u]=$o[u];a.head=Uo("svg",o);var s=this._bgcolor;return"transparent"!==s&&"none"!==s||(s=null),a.bg=s?Uo("rect",{width:this._width,height:this._height,style:"fill: "+s+";"})+Bo("rect"):"",a.root=Uo("g",{transform:"translate("+i+")"}),a.foot=Bo("g")+Bo("svg"),this},ou.background=function(){var e=uu.background.apply(this,arguments);return arguments.length&&this._text.head&&this.resize(this._width,this._height,this._origin,this._scale),e},ou.svg=function(){var e=this._text;return e.head+e.bg+e.defs+e.root+e.body+e.foot},ou._render=function(e){return this._text.body=this.mark(e),this._text.defs=this.buildDefs(),this},ou.buildDefs=function(){var e,t,n,r,i=this._defs,a="";for(t in i.gradient){for(r=(n=i.gradient[t]).stops,a+=Uo("linearGradient",{id:t,x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2}),e=0;e<r.length;++e)a+=Uo("stop",{offset:r[e].offset,"stop-color":r[e].color})+Bo("stop");a+=Bo("linearGradient")}for(t in i.clipping)n=i.clipping[t],a+=Uo("clipPath",{id:t}),n.path?a+=Uo("path",{d:n.path})+Bo("path"):a+=Uo("rect",{x:0,y:0,width:n.width,height:n.height})+Bo("rect"),a+=Bo("clipPath");return 0<a.length?Uo("defs")+a+Bo("defs"):""},ou.attributes=function(e,t){return au={},e(su,t,this),au},ou.href=function(e){var t,n=this,r=e.href;if(r){if(t=n._hrefs&&n._hrefs[r])return t;n.sanitizeURL(r).then(function(e){e["xlink:href"]=e.href,e.href=null,(n._hrefs||(n._hrefs={}))[r]=e})}return null},ou.mark=function(n){var r,i=this,a=io[n.marktype],o=a.tag,u=this._defs,s="";function e(e){var t=i.href(e);t&&(s+=Uo("a",t)),r="g"!==o?lu(e,n,o,u):null,s+=Uo(o,i.attributes(a.attr,e),r),"text"===o?s+=Ka(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):"g"===o&&(s+=Uo("path",i.attributes(a.background,e),lu(e,n,"bgrect",u))+Bo("path"),s+=Uo("g",i.attributes(a.foreground,e))+i.markGroup(e)+Bo("g")),s+=Bo(o),t&&(s+=Bo("a"))}return"g"!==o&&!1===n.interactive&&(r='style="pointer-events: none;"'),s+=Uo("g",{class:bo(n),"clip-path":n.clip?Oa(i,n,n.group):null},r),a.nested?n.items&&n.items.length&&e(n.items[0]):ca(n,e),s+Bo("g")},ou.markGroup=function(e){var t=this,n="";return ca(e,function(e){n+=t.mark(e)}),n};var cu={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},fu={};function du(e,t){return e=String(e||"").toLowerCase(),1<arguments.length?(fu[e]=t,this):fu[e]}fu.canvas=fu.png={renderer:qo,headless:qo,handler:zo},fu.svg={renderer:Ho,headless:iu,handler:No},fu.none={};var hu=new Zr;function pu(e){var t=e.clip;if(te(t))t(ta(hu.clear()));else{if(!t)return;hu.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(hu)}var mu=1e-9;function gu(e,t,n){return e===t||("path"===n?vu(e,t):e instanceof Date&&t instanceof Date?+e==+t:fe(e)&&fe(t)?Math.abs(e-t)<=mu:e&&t&&(J(e)||J(t))?null!=e&&null!=t&&function(e,t){var n,r,i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(i.sort(),a.sort(),r=i.length-1;0<=r;r--)if(i[r]!=a[r])return!1;for(r=i.length-1;0<=r;r--)if(n=i[r],!gu(e[n],t[n],n))return!1;return typeof e==typeof t}(e,t):e==t)}function vu(e,t){return gu(gi(e),gi(t))}function yu(e){Bt.call(this,null,e)}function bu(e,t,n){return t(e.bounds.clear(),e,n)}se(yu,Bt).transform=function(e,t){var n,r=t.dataflow,i=e.mark,a=i.marktype,o=io[a],u=o.bound,s=i.bounds;return o.nested?(i.items.length&&r.dirty(i.items[0]),s=bu(i,u),i.items.forEach(function(e){e.bounds.clear().union(s)})):a===qr||e.modified()?(t.visit(t.MOD,function(e){r.dirty(e)}),s.clear(),i.items.forEach(function(e){s.union(bu(e,u))}),i.role===Tr&&t.reflow()):(n=t.changed(t.REM),t.visit(t.ADD,function(e){s.union(bu(e,u))}),t.visit(t.MOD,function(e){n=n||s.alignsWith(e.bounds),r.dirty(e),s.union(bu(e,u))}),n&&(s.clear(),i.items.forEach(function(e){s.union(e.bounds)}))),pu(i),t.modifies("bounds")};var xu=":vega_identifier:";function _u(e){Bt.call(this,0,e)}function wu(e){Bt.call(this,null,e)}function ku(e){Bt.call(this,null,e)}_u.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},se(_u,Bt).transform=function(e,t){var n=function(e){var t=e._signals[xu];t||(e._signals[xu]=t=e.add(0));return t}(t.dataflow),r=n.value,i=e.as;return t.visit(t.ADD,function(e){e[i]||(e[i]=++r)}),n.set(this.value=r),t},se(wu,Bt).transform=function(e,t){var n,r,i,a=this.value;a||((a=t.dataflow.scenegraph().mark(e.markdef,(r=(n=e).groups,i=n.parent,r&&1===r.size?r.get(Object.keys(r.object)[0]):r&&i?r.lookup(i):null),e.index)).group.context=e.context,e.context.group||(e.context.group=a.group),a.source=this,a.clip=e.clip,a.interactive=e.interactive,this.value=a);var o=a.marktype===qr?ai:ii;return t.visit(t.ADD,function(e){o.call(e,a)}),(e.modified("clip")||e.modified("interactive"))&&(a.clip=e.clip,a.interactive=!!e.interactive,a.zdirty=!0,t.reflow()),a.items=t.source,t};var Mu=se(ku,Bt),Ou={parity:function(e){return e.filter(function(e,t){return t%2?e.opacity=0:1})},greedy:function(e){var n;return e.filter(function(e,t){return t&&Eu(n.bounds,e.bounds)?e.opacity=0:(n=e,1)})}};function Eu(e,t){return!(e.x2-1<t.x1||e.x1+1>t.x2||e.y2-1<t.y1||e.y1+1>t.y2)}function Ru(e){for(var t,n=1,r=e.length,i=e[0].bounds;n<r;i=t,++n)if(Eu(i,t=e[n].bounds))return!0}function Su(e){var t=e.bounds;return 1<t.width()&&1<t.height()}function zu(e){Bt.call(this,null,e)}function Du(e,t){for(var n=0,r=e.length;n<r;++n)t.push(e[n])}function Au(e){return{x1:0,y1:0,x2:e.width||0,y2:e.height||0}}function Cu(e){var t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Pu(e,t){return"x1"===t?e.x||0:"y1"===t?e.y||0:"x2"===t?(e.x||0)+(e.width||0):"y2"===t?(e.y||0)+(e.height||0):void 0}function qu(e,t){return e.bounds[t]}function Lu(e,t,n){var r=J(e)?e[t]:e;return null!=r?r:void 0!==n?n:0}function Tu(e){return e<0?Math.ceil(-e):0}function Fu(e,t,n){var r,i,a,o,u,s,l,c,f,d,h,p,m=function(e){for(var t,n,r=e.items,i=r.length,a=0,o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};a<i;++a)if(n=(t=r[a]).items,t.marktype===qr)switch(t.role){case Lr:case Tr:break;case Fr:Du(n,o.rowheaders);break;case Nr:Du(n,o.rowfooters);break;case jr:Du(n,o.colheaders);break;case Ur:Du(n,o.colfooters);break;case Ir:o.rowtitle=n[0];break;case Br:o.coltitle=n[0];break;default:Du(n,o.marks)}return o}(t),g=m.marks,v="flush"===n.bounds,y=v?Au:Cu,b=new Zr(0,0,0,0),x=Lu(n.align,Qr),_=Lu(n.align,Kr),w=Lu(n.padding,Qr),k=Lu(n.padding,Kr),M=n.offset,O=t.columns||n.columns||g.length,E=O<0?1:Math.ceil(g.length/O),R=E*O,S=[],z=[],D=0,A=[],C=[],P=0,q=g.length;for(i=0;i<O;++i)z[i]=0;for(i=0;i<E;++i)C[i]=0;for(i=0;i<q;++i)u=y(g[i]),a=i%O,o=~~(i/O),l=Math.ceil(y(g[i]).x2),c=Math.ceil(y(g[i]).y2),D=Math.max(D,l),P=Math.max(P,c),z[a]=Math.max(z[a],l),C[o]=Math.max(C[o],c),S.push(w+Tu(u.x1)),A.push(k+Tu(u.y1)),e.dirty(g[i]);for(i=0;i<q;++i)i%O==0&&(S[i]=0),i<O&&(A[i]=0);if("each"===x)for(a=1;a<O;++a){for(p=0,i=a;i<q;i+=O)p<S[i]&&(p=S[i]);for(i=a;i<q;i+=O)S[i]=p+z[a-1]}else if(x===Jr){for(i=p=0;i<q;++i)i%O&&p<S[i]&&(p=S[i]);for(i=0;i<q;++i)i%O&&(S[i]=p+D)}else for(x=!1,a=1;a<O;++a)for(i=a;i<q;i+=O)S[i]+=z[a-1];if("each"===_)for(o=1;o<E;++o){for(p=0,r=(i=o*O)+O;i<r;++i)p<A[i]&&(p=A[i]);for(i=o*O;i<r;++i)A[i]=p+C[o-1]}else if(_===Jr){for(p=0,i=O;i<q;++i)p<A[i]&&(p=A[i]);for(i=O;i<q;++i)A[i]=p+P}else for(_=!1,o=1;o<E;++o)for(r=(i=o*O)+O;i<r;++i)A[i]+=C[o-1];for(i=f=0;i<q;++i)l=(s=g[i]).x||0,s.x=f=S[i]+(i%O?f:0),s.bounds.translate(f-l,0);for(a=0;a<O;++a)for(d=0,i=a;i<q;i+=O)c=(s=g[i]).y||0,s.y=d+=A[i],s.bounds.translate(0,d-c);if(Lu(n.center,Qr)&&1<E&&x)for(i=0;i<q;++i)s=g[i],0<(f=(u=x===Jr?D:z[i%O])-y(s).x2)&&(s.x+=l=f/2,s.bounds.translate(l,0));if(Lu(n.center,Kr)&&1!==O&&_)for(i=0;i<q;++i)s=g[i],0<(d=(u=_===Jr?P:C[~~(i/O)])-y(s).y2)&&(s.y+=c=d/2,s.bounds.translate(0,c));for(i=0;i<q;++i)g[i].mark.bounds.clear();for(i=0;i<q;++i)s=g[i],e.dirty(s),b.union(s.mark.bounds.union(s.bounds));function L(e,t){return Math.floor(Math.min(e,t))}function T(e,t){return Math.ceil(Math.max(e,t))}y=v?Pu:qu,h=Lu(n.headerBand,Kr,null),f=Nu(e,m.rowheaders,g,O,E,-Lu(M,"rowHeader"),L,0,y,"x1",0,O,1,h),h=Lu(n.headerBand,Qr,null),d=Nu(e,m.colheaders,g,O,O,-Lu(M,"columnHeader"),L,1,y,"y1",0,1,O,h),h=Lu(n.footerBand,Kr,null),Nu(e,m.rowfooters,g,O,E,Lu(M,"rowFooter"),T,0,y,"x2",O-1,O,1,h),h=Lu(n.footerBand,Qr,null),Nu(e,m.colfooters,g,O,O,Lu(M,"columnFooter"),T,1,y,"y2",R-O,1,O,h),m.rowtitle&&(p=f-Lu(M,"rowTitle"),h=Lu(n.titleBand,Kr,.5),Iu(e,m.rowtitle,p,0,b,h)),m.coltitle&&(p=d-Lu(M,"columnTitle"),h=Lu(n.titleBand,Qr,.5),Iu(e,m.coltitle,p,1,b,h))}function Nu(e,t,n,r,i,a,o,u,s,l,c,f,d,h){var p,m,g,v,y,b,x,_,w,k=n.length,M=0,O=0;if(!k)return M;for(p=c;p<k;p+=f)n[p]&&(M=o(M,s(n[p],l)));if(!t.length)return M;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),M+=a,m=0,v=t.length;m<v;++m)e.dirty(t[m]),t[m].mark.bounds.clear();for(p=c,m=0,v=t.length;m<v;++m,p+=f){for(y=(b=t[m]).mark.bounds,g=p;0<=g&&null==(x=n[g]);g-=d);u?(_=null==h?x.x:Math.round(x.bounds.x1+h*x.bounds.width()),w=M):(_=M,w=null==h?x.y:Math.round(x.bounds.y1+h*x.bounds.height())),y.union(b.bounds.translate(_-(b.x||0),w-(b.y||0))),b.x=_,b.y=w,e.dirty(b),O=o(O,y[l])}return O}function Iu(e,t,n,r,i,a){if(t){e.dirty(t);var o=n,u=n;r?o=Math.round(i.x1+a*i.width()):u=Math.round(i.y1+a*i.height()),t.bounds.translate(o-(t.x||0),u-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=u,e.dirty(t)}}Mu.transform=function(e,t){var n=Ou[e.method]||Ou.parity,r=t.materialize(t.SOURCE).source;if(r){e.sort&&(r=r.slice().sort(e.sort)),"greedy"===e.method&&(r=r.filter(Su)),r.forEach(function(e){e.opacity=1});var i,a,o,u,s,l=r;if(3<=l.length&&Ru(l)){for(t=t.reflow(e.modified()).modifies("opacity");3<=(l=n(l)).length&&Ru(l););l.length<3&&!I(r).opacity&&(1<l.length&&(I(l).opacity=0),I(r).opacity=1)}if(e.boundScale){var c=(i=e.boundScale,a=e.boundOrient,o=e.boundTolerance,u=i.range(),s=new Zr,a===Mr||a===Rr?s.set(u[0],-1/0,u[1],1/0):s.set(-1/0,u[0],1/0,u[1]),s.expand(o||1),function(e){return s.encloses(e.bounds)});r.forEach(function(e){c(e)||(e.opacity=0)})}return t}},se(zu,Bt).transform=function(e,t){var n=t.dataflow;if(t.visit(t.ALL,function(e){n.dirty(e)}),t.fields&&t.fields.zindex){var r=t.source&&t.source[0];r&&(r.mark.zdirty=!0)}};var ju=.5,Uu=new Zr;function Bu(e){Bt.call(this,null,e)}function $u(e,t,n){return e[t]===n?0:(e[t]=n,1)}function Gu(e,t,n,r){var i,a,o,u,s=t.items[0],l=s.datum,c=l.orient,f=(u=+(o=l).grid,[o.ticks?u++:-1,o.labels?u++:-1,u+ +o.domain]),d=s.range,h=s.offset,p=s.position,m=s.minExtent,g=s.maxExtent,v=l.title&&s.items[f[2]].items[0],y=s.titlePadding,b=s.bounds,x=0,_=0;switch(Uu.clear().union(b),b.clear(),-1<(i=f[0])&&b.union(s.items[i].bounds),-1<(i=f[1])&&b.union(s.items[i].bounds),c){case Mr:x=p||0,_=-h,a=Math.max(m,Math.min(g,-b.y1)),v&&(a=Wu(v,a,y,0,-1,b)),b.add(0,-a).add(d,0);break;case Or:x=-h,_=p||0,a=Math.max(m,Math.min(g,-b.x1)),v&&(a=Wu(v,a,y,1,-1,b)),b.add(-a,0).add(0,d);break;case Er:x=n+h,_=p||0,a=Math.max(m,Math.min(g,b.x2)),v&&(a=Wu(v,a,y,1,1,b)),b.add(0,0).add(a,d);break;case Rr:x=p||0,_=r+h,a=Math.max(m,Math.min(g,b.y2)),v&&(a=Wu(v,a,y,0,1,b)),b.add(0,0).add(d,a);break;default:x=s.x,_=s.y}return Ji(b.translate(x,_),s),$u(s,"x",x+ju)|$u(s,"y",_+ju)&&(s.bounds=Uu,e.dirty(s),s.bounds=b,e.dirty(s)),s.mark.bounds.clear().union(b)}function Wu(e,t,n,r,i,a){var o=e.bounds,u=0,s=0;return e.auto?(t+=n,r?u=(e.x||0)-(e.x=i*t):s=(e.y||0)-(e.y=i*t),o.translate(-u,-s),e.mark.bounds.set(o.x1,o.y1,o.x2,o.y2),r?(a.add(0,o.y1).add(0,o.y2),t+=o.width()):(a.add(o.x1,0).add(o.x2,0),t+=o.height())):a.union(o),t}function Yu(e,t,n,r,i,a,o){var u,s,l,c,f,d=t.items[0],h=d.datum,p=h.orient,m=d.offset,g=d.bounds,v=0,y=0;switch(p===Mr||p===Rr?(l=i,v=n[p]):p!==Or&&p!==Er||(l=r,y=n[p]),Uu.clear().union(g),g.clear(),d.items.forEach(function(e){g.union(e.bounds)}),u=Math.round(g.width())+2*d.padding-1,s=Math.round(g.height())+2*d.padding-1,h.type===Gr&&(c=d.items[0].items[0].items[0].items,f=c.reduce(function(e,t){return e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0),e},{}),c.forEach(function(e){e.width=f[e.column],e.height=e.bounds.y2-e.y})),p){case Or:v-=n.leftWidth+m-Math.floor(l.x1),n.left+=s+n.margin;break;case Er:v+=m+Math.ceil(l.x2),n.right+=s+n.margin;break;case Mr:y-=s+m-Math.floor(l.y1),n.top+=u+n.margin;break;case Rr:y+=m+Math.ceil(l.y2),n.bottom+=u+n.margin;break;case Sr:v+=m,y+=m;break;case zr:v+=a-u-m,y+=m;break;case Dr:v+=m,y+=o-s-m;break;case Ar:v+=a-u-m,y+=o-s-m;break;default:v=d.x,y=d.y}return Ji(g.set(v,y,v+u,y+s),d),$u(d,"x",v)|$u(d,"width",u)|$u(d,"y",y)|$u(d,"height",s)&&(d.bounds=Uu,e.dirty(d),d.bounds=g,e.dirty(d)),d.mark.bounds.clear().union(g)}se(Bu,Bt).transform=function(t,e){var n=e.dataflow;return t.mark.items.forEach(function(e){t.layout&&Fu(n,e,t.layout),function(e,t,n){var r,i,a,o,u,s,l=t.items,c=Math.max(0,t.width||0),f=Math.max(0,t.height||0),d=(new Zr).set(0,0,c,f),h=d.clone(),p=d.clone(),m=[];for(u=0,s=l.length;u<s;++u)switch((i=l[u]).role){case Lr:void 0,g=i.items[0].datum.orient,(o=g===Or||g===Er?h:p).union(Gu(e,i,c,f));break;case"title":r=i;break;case Tr:m.push(i);break;case"frame":case"scope":case Fr:case Nr:case Ir:case jr:case Ur:case Br:h.union(i.bounds),p.union(i.bounds);break;default:d.union(i.bounds)}var g;if(m.length)for(a={leftWidth:(y=e,b=m,b.reduce(function(e,t){var n=t.items[0];if(function(e,t,n){var r=t.padding-n.x,i=t.padding-n.y;if(t.datum.title){var a=t.items[1].items[0];i+=t.titlePadding+a.fontSize}(r||i)&&(n.x+=r,n.y+=i,n.bounds.translate(r,i),n.mark.bounds.translate(r,i),e.dirty(n))}(y,n,n.items[0].items[0]),n.datum.orient===Or){var r=Uu.clear();n.items.forEach(function(e){r.union(e.bounds)}),e=Math.max(e,Math.round(r.width())+2*n.padding-1)}return e},0)),margin:n.legendMargin||8,left:0,right:0,top:0,bottom:0},u=0,s=m.length;u<s;++u)if(o=Yu(e,m[u],a,h,p,c,f),n.autosize&&n.autosize.type===Wr){var v=m[u].items[0].datum.orient;v===Or||v===Er?d.add(o.x1,0).add(o.x2,0):v!==Mr&&v!==Rr||d.add(0,o.y1).add(0,o.y2)}else d.union(o);var y,b;d.union(h).union(p),r&&d.union(function(e,t,n,r,i){var a,o=t.items[0],u=o.orient,s=o.frame,l=o.anchor,c=o.offset,f=o.bounds,d=0,h=u===Or||u===Er?r:n,p=0,m=0;s!==qr?u===Or?(d=i.y2,h=i.y1):u===Er?(d=i.y1,h=i.y2):(d=i.x1,h=i.x2):u===Or&&(d=r,h=0);switch(a=l===Cr?d:l===Pr?h:(d+h)/2,Uu.clear().union(f),u){case Mr:p=a,m=i.y1-c;break;case Or:p=i.x1-c,m=a;break;case Er:p=i.x2+c,m=a;break;case Rr:p=a,m=i.y2+c;break;default:p=o.x,m=o.y}f.translate(p-o.x,m-o.y),$u(o,"x",p)|$u(o,"y",m)&&(o.bounds=Uu,e.dirty(o),o.bounds=f,e.dirty(o));return t.bounds.clear().union(f)}(e,r,c,f,d));!function(e,t,n,r){var i=r.autosize||{},a=i.type,o=e._width,u=e._height,s=e.padding();if(e._autosize<1||!a)return;var l=Math.max(0,t.width||0),c=Math.max(0,Math.ceil(-n.x1)),f=Math.max(0,Math.ceil(n.x2-l)),d=Math.max(0,t.height||0),h=Math.max(0,Math.ceil(-n.y1)),p=Math.max(0,Math.ceil(n.y2-d));i.contains===$r&&(o-=s.left+s.right,u-=s.top+s.bottom);a===Xr?(h=c=0,l=o,d=u):a===Wr?(l=Math.max(0,o-c-f),d=Math.max(0,u-h-p)):a===Yr?(l=Math.max(0,o-c-f),u=d+h+p):a===Hr?(o=l+c+f,d=Math.max(0,u-h-p)):a===Vr&&(o=l+c+f,u=d+h+p);e._resizeView(o,u,l,d,[c,h],i.resize)}(e,t,d,n)}(n,e,t)}),t.modified()&&e.reflow(),e};var Hu=Object.freeze({bound:yu,identifier:_u,mark:wu,overlap:ku,render:zu,viewlayout:Bu}),Vu="log",Xu="pow",Ju="sqrt",Qu="band",Ku="point",Zu="linear",es="ordinal",ts="quantile",ns="quantize",rs="threshold",is="bin-ordinal",as="sequential";function os(e,t,n){var r=e-t+2*n;return e?0<r?r:1:0}function us(){var o,l,n=x.scaleOrdinal().unknown(void 0),c=n.domain,f=n.range,d=[0,1],u=!1,s=0,h=0,p=.5;function t(){var e=c().length,t=d[1]<d[0],n=d[t-0],r=d[1-t],i=os(e,s,h);o=(r-n)/(i||1),u&&(o=Math.floor(o)),n+=(r-n-o*(e-s))*p,l=o*(1-s),u&&(n=Math.round(n),l=Math.round(l));var a=v.range(e).map(function(e){return n+o*e});return f(t?a.reverse():a)}return delete n.unknown,n.domain=function(e){return arguments.length?(c(e),t()):c()},n.range=function(e){return arguments.length?(d=[+e[0],+e[1]],t()):d.slice()},n.rangeRound=function(e){return d=[+e[0],+e[1]],u=!0,t()},n.bandwidth=function(){return l},n.step=function(){return o},n.round=function(e){return arguments.length?(u=!!e,t()):u},n.padding=function(e){return arguments.length?(h=Math.max(0,Math.min(1,e)),s=h,t()):s},n.paddingInner=function(e){return arguments.length?(s=Math.max(0,Math.min(1,e)),t()):s},n.paddingOuter=function(e){return arguments.length?(h=Math.max(0,Math.min(1,e)),t()):h},n.align=function(e){return arguments.length?(p=Math.max(0,Math.min(1,e)),t()):p},n.invertRange=function(e){if(null!=e[0]&&null!=e[1]){var t,n,r,i=+e[0],a=+e[1],o=d[1]<d[0],u=o?f().reverse():f(),s=u.length-1;if(i==i&&a==a&&(a<i&&(r=i,i=a,a=r),!(a<u[0]||i>d[1-o])))return t=Math.max(0,v.bisectRight(u,i)-1),n=i===a?t:v.bisectRight(u,a)-1,i-u[t]>l+1e-10&&++t,o&&(r=t,t=s-n,n=s-r),n<t?void 0:c().slice(t,n+1)}},n.invert=function(e){var t=n.invertRange([e,e]);return t?t[0]:t},n.copy=function(){return us().domain(c()).range(d).round(u).paddingInner(s).paddingOuter(h).align(p)},t()}var ss=Array.prototype.map,ls=Array.prototype.slice;function cs(e){return ss.call(e,function(e){return+e})}function fs(e,t){return 1<arguments.length?(ds[e]=(n=e,r=t,function(){var l,i,e=r();return e.invertRange||(e.invertRange=e.invert?(i=e,function(e){var t,n=e[0],r=e[1];return r<n&&(t=n,n=r,r=t),[i.invert(n),i.invert(r)]}):e.invertExtent?(l=e,function(e){var t,n,r,i,a=l.range(),o=e[0],u=e[1],s=-1;for(u<o&&(n=o,o=u,u=n),r=0,i=a.length;r<i;++r)a[r]>=o&&a[r]<=u&&(s<0&&(s=r),t=r);if(!(s<0))return o=l.invertExtent(a[s]),u=l.invertExtent(a[t]),[void 0===o[0]?o[1]:o[0],void 0===u[1]?u[0]:u[1]]}):void 0),e.type=n,e}),this):ds.hasOwnProperty(e)?ds[e]:void 0;var n,r}var ds={identity:x.scaleIdentity,linear:x.scaleLinear,log:x.scaleLog,ordinal:x.scaleOrdinal,pow:x.scalePow,sqrt:x.scaleSqrt,quantile:x.scaleQuantile,quantize:x.scaleQuantize,threshold:x.scaleThreshold,time:x.scaleTime,utc:x.scaleUtc,band:us,point:function(){return function e(t){var n=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return e(n())},t}(us().paddingInner(1))},sequential:function e(n){var r=x.scaleLinear(),i=0,a=1,o=!1;function t(){var e=r.domain();i=e[0],a=I(e)-i}function u(e){var t=(e-i)/a;return n(o?Math.max(0,Math.min(1,t)):t)}return u.clamp=function(e){return arguments.length?(o=!!e,u):o},u.domain=function(e){return arguments.length?(r.domain(e),t(),u):r.domain()},u.interpolator=function(e){return arguments.length?(n=e,u):n},u.copy=function(){return e().domain(r.domain()).clamp(o).interpolator(n)},u.ticks=function(e){return r.ticks(e)},u.tickFormat=function(e,t){return r.tickFormat(e,t)},u.nice=function(e){return r.nice(e),t(),u},u},"bin-linear":function e(){var t=x.scaleLinear(),r=[];function i(e){return t(e)}return i.domain=function(e){return arguments.length?(r=cs(e),t.domain([r[0],I(r)]),i):r.slice()},i.range=function(e){return arguments.length?(t.range(e),i):t.range()},i.rangeRound=function(e){return arguments.length?(t.rangeRound(e),i):t.rangeRound()},i.interpolate=function(e){return arguments.length?(t.interpolate(e),i):t.interpolate()},i.invert=function(e){return t.invert(e)},i.ticks=function(e){var t=r.length,n=~~(t/(e||t));return n<2?i.domain():r.filter(function(e,t){return!(t%n)})},i.tickFormat=function(){return t.tickFormat.apply(t,arguments)},i.copy=function(){return e().domain(i.domain()).range(i.range())},i},"bin-ordinal":function e(){var t=[],n=[];function r(e){return null==e||e!=e?void 0:n[(v.bisect(t,e)-1)%n.length]}return r.domain=function(e){return arguments.length?(t=cs(e),r):t.slice()},r.range=function(e){return arguments.length?(n=ls.call(e),r):n.slice()},r.copy=function(){return e().domain(r.domain()).range(r.range())},r}};for(var hs in ds)fs(hs,ds[hs]);function ps(e){for(var t=e.length/6|0,n=new Array(t),r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}var ms=ps("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5"),gs=ps("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6"),vs=ps("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9"),ys=ps("4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac"),bs=ps("4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5"),xs=new Array(3).concat("67a9cff7f7f7f1a340","0571b092c5defdb863e66101","0571b092c5def7f7f7fdb863e66101","2166ac67a9cfd1e5f0fee0b6f1a340b35806","2166ac67a9cfd1e5f0f7f7f7fee0b6f1a340b35806","2166ac4393c392c5ded1e5f0fee0b6fdb863e08214b35806","2166ac4393c392c5ded1e5f0f7f7f7fee0b6fdb863e08214b35806","0530612166ac4393c392c5ded1e5f0fee0b6fdb863e08214b358067f3b08","0530612166ac4393c392c5ded1e5f0f7f7f7fee0b6fdb863e08214b358067f3b08").map(ps),_s={blueorange:xs},ws={category10:r.schemeCategory10,accent:r.schemeAccent,dark2:r.schemeDark2,paired:r.schemePaired,pastel1:r.schemePastel1,pastel2:r.schemePastel2,set1:r.schemeSet1,set2:r.schemeSet2,set3:r.schemeSet3,category20:ms,category20b:gs,category20c:vs,tableau10:ys,tableau20:bs,viridis:r.interpolateViridis,magma:r.interpolateMagma,inferno:r.interpolateInferno,plasma:r.interpolatePlasma,blueorange:l.interpolateRgbBasis(I(xs))};function ks(e,t){ws[e]=r["interpolate"+t],_s[e]=r["scheme"+t]}function Ms(e,t){if(1<arguments.length)return ws[e]=t,this;var n=e.split("-");return e=n[0],(n=+n[1]+1)&&_s.hasOwnProperty(e)?_s[e][n-1]:!n&&ws.hasOwnProperty(e)?ws[e]:void 0}function Os(t,e){var n=e-t;return function(e){return t+e*n}}ks("blues","Blues"),ks("greens","Greens"),ks("greys","Greys"),ks("purples","Purples"),ks("reds","Reds"),ks("oranges","Oranges"),ks("brownbluegreen","BrBG"),ks("purplegreen","PRGn"),ks("pinkyellowgreen","PiYG"),ks("purpleorange","PuOr"),ks("redblue","RdBu"),ks("redgrey","RdGy"),ks("redyellowblue","RdYlBu"),ks("redyellowgreen","RdYlGn"),ks("spectral","Spectral"),ks("bluegreen","BuGn"),ks("bluepurple","BuPu"),ks("greenblue","GnBu"),ks("orangered","OrRd"),ks("purplebluegreen","PuBuGn"),ks("purpleblue","PuBu"),ks("purplered","PuRd"),ks("redpurple","RdPu"),ks("yellowgreenblue","YlGnBu"),ks("yellowgreen","YlGn"),ks("yelloworangebrown","YlOrBr"),ks("yelloworangered","YlOrRd");var Es={millisecond:t.timeMillisecond,second:t.timeSecond,minute:t.timeMinute,hour:t.timeHour,day:t.timeDay,week:t.timeWeek,month:t.timeMonth,year:t.timeYear},Rs={millisecond:t.utcMillisecond,second:t.utcSecond,minute:t.utcMinute,hour:t.utcHour,day:t.utcDay,week:t.utcWeek,month:t.utcMonth,year:t.utcYear};function Ss(e,t){var n,r,i;return J(t)&&(n=t.step,t=t.interval),m(t)&&(t="time"===e.type?(i=t,Es.hasOwnProperty(i)&&Es[i]):"utc"===e.type?(r=t,Rs.hasOwnProperty(r)&&Rs[r]):Ue("Only time and utc scales accept interval strings."),n&&(t=t.every(n))),t}function zs(t,e,n){var r=t.range(),i=r[0],a=I(r);if(a<i&&(r=a,a=i,i=r),e=e.filter(function(e){return!((e=t(e))<i||a<e)}),0<n&&1<e.length){for(var o=[e[0],I(e)];e.length>n&&3<=e.length;)e=e.filter(function(e,t){return!(t%2)});e.length<3&&(e=o)}return e}function Ds(e,t){return e.ticks?e.ticks(t):e.domain()}function As(e,t,n){var r,i,a=e.tickFormat?e.tickFormat(t,n):n?u.format(n):String;return e.type===Vu?(r=a,i=function(e){var t=u.formatSpecifier(e||",");{if(null==t.precision){switch(t.precision=12,t.type){case"%":t.precision-=2;break;case"e":t.precision-=1}return a=u.format(t),o=u.format(".1f")(1)[1],function(e){var t,n,r=a(e),i=r.indexOf(o);if(i<0)return r;for(t=function(e,t){var n,r=e.lastIndexOf("e");if(0<r)return r;for(r=e.length;--r>t;)if(48<=(n=e.charCodeAt(r))&&n<=57)return r+1}(r,i),n=t<r.length?r.slice(t):"";--t>i;)if("0"!==r[t]){++t;break}return r.slice(0,t)+n}}return u.format(t)}var a,o}(n),function(e){return r(e)?i(e):""}):a}function Cs(e){Bt.call(this,null,e)}function Ps(e){Bt.call(this,null,e)}function qs(){return De({})}function Ls(e){return e.exit}function Ts(e){Bt.call(this,null,e)}se(Cs,Bt).transform=function(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,i=e.scale,a=null==e.count?e.values?e.values.length:10:Ss(i,e.count),o=e.format||As(i,a,e.formatSpecifier),u=e.values?zs(i,e.values,a):Ds(i,a);return r&&(n.rem=r),r=u.map(function(e,t){return De({index:t/(u.length-1),value:e,label:o(e)})}),e.extra&&r.push(De({index:-1,extra:{value:r[0].value},label:""})),n.source=r,n.add=r,this.value=r,n},se(Ps,Bt).transform=function(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||qs,a=e.key||Se,o=this.value;return h(r.encode)&&(r.encode=null),o&&(e.modified("key")||t.modified(a))&&Ue("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=ue().test(Ls),o.lookup=function(e){return o.get(a(e))}),t.visit(t.ADD,function(e){var t=a(e),n=o.get(t);n?n.exit?(o.empty--,r.add.push(n)):r.mod.push(n):(o.set(t,n=i(e)),r.add.push(n)),n.datum=e,n.exit=!1}),t.visit(t.MOD,function(e){var t=a(e),n=o.get(t);n&&(n.datum=e,r.mod.push(n))}),t.visit(t.REM,function(e){var t=a(e),n=o.get(t);e!==n.datum||n.exit||(r.rem.push(n),n.exit=!0,++o.empty)}),t.changed(t.ADD_MOD)&&r.modifies("datum"),e.clean&&o.empty>n.cleanThreshold&&n.runAfter(o.clean),r},se(Ts,Bt).transform=function(n,e){var r=e.fork(e.ADD_REM),t=n.encoders,i=e.encode;if(h(i)){if(!r.changed()&&!i.every(function(e){return t[e]}))return e.StopPropagation;i=i[0],r.encode=null}var a="enter"===i,o=t.update||A,u=t.enter||A,s=t.exit||A,l=(i&&!a?t[i]:o)||A;if(e.changed(e.ADD)&&(e.visit(e.ADD,function(e){u(e,n),o(e,n),l!==A&&l!==o&&l(e,n)}),r.modifies(u.output),r.modifies(o.output),l!==A&&l!==o&&r.modifies(l.output)),e.changed(e.REM)&&s!==A&&(e.visit(e.REM,function(e){s(e,n)}),r.modifies(s.output)),a||l!==A){var c=e.MOD|(n.modified()?e.REFLOW:0);a?(e.visit(c,function(e){var t=u(e,n);(l(e,n)||t)&&r.mod.push(e)}),r.mod.length&&r.modifies(u.output)):e.visit(c,function(e){l(e,n)&&r.mod.push(e)}),r.mod.length&&r.modifies(l.output)}return r.changed()?r:e.StopPropagation};var Fs="symbol",Ns={};function Is(e,t,n){return n===Fs&&Ns[e.type]?(o=t,function(e,t,n){var r=n[t+1]||n.max||1/0,i=js(e,o),a=js(r,o);return i&&a?i+"–"+a:a?"< "+a:"≥ "+i}):"discrete"===n?(i=t,function(e,t){return t?i(e):null}):(r=t,function(e){return r(e)});var r,i,o}function js(e,t){return isFinite(e)?t(e):null}function Us(e){Bt.call(this,[],e)}Ns[ts]=function(e){var t=[-1/0].concat(e.quantiles());return t.max=1/0,t},Ns[ns]=function(e){var t=e.domain(),n=t[0],r=I(t),i=e.range().length,a=new Array(i),o=0;a[0]=-1/0;for(;++o<i;)a[o]=(o*r-(o-i)*n)/i;return a.max=1/0,a},Ns[rs]=function(e){var t=[-1/0].concat(e.domain());return t.max=1/0,t},Ns["bin-linear"]=Ns[is]=function(e){var t=e.domain();return t.max=t.pop(),t},se(Us,Bt).transform=function(n,e){if(null!=this.value&&!n.modified())return e.StopPropagation;var t,r,i,a,o,u,s,l,c,f,d,h=e.fork(e.NO_SOURCE|e.NO_FIELDS),p=this.value,m=n.type||Fs,g=n.scale,v=null==n.count?5:Ss(g,n.count),y=n.format||As(g,v,n.formatSpecifier),b=n.values||(u=v,(s=Ns[(o=g).type])?s(o):Ds(o,u));return y=Is(g,y,m),p&&(h.rem=p),m===Fs?(te(i=n.size)?(n.values||0!==g(b[0])||(b=b.slice(1)),a=b.reduce(function(e,t){return Math.max(e,i(t,n))},0)):i=re(a=i||8),p=b.map(function(e,t){return De({index:t,label:y(e,t,b),value:e,offset:a,size:i(e,n)})})):"gradient"===m?(t=n.values?g.domain():b,l=g,c=t[0],f=I(t),r=(d=f-c)?"linear"===l.type||"sequential"===l.type?function(e){return(e-c)/d}:l.copy().domain([c,f]).range([0,1]).interpolate(Os):re(0),p=b.map(function(e,t){return De({index:t,label:y(e,t,b),value:e,perc:r(e)})})):(i=b.length-1,r=function(e){var t=e.domain(),n=t.length-1,r=+t[0],i=+I(t),a=i-r;if(e.type===rs){var o=n?a/n:.1;a=(i+=o)-(r-=o)}return function(e){return(e-r)/a}}(g),p=b.map(function(e,t){return De({index:t,label:y(e,t,b),value:e,perc:t?r(e):0,perc2:t===i?1:r(b[t+1])})})),h.source=p,h.add=p,this.value=p,h};var Bs=ue({line:Vs,"line-radial":function(e,t,n,r){return Vs(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n))},arc:Xs,"arc-radial":function(e,t,n,r){return Xs(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n))},curve:Js,"curve-radial":function(e,t,n,r){return Js(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n))},"orthogonal-horizontal":function(e,t,n,r){return"M"+e+","+t+"V"+r+"H"+n},"orthogonal-vertical":function(e,t,n,r){return"M"+e+","+t+"H"+n+"V"+r},"orthogonal-radial":function(e,t,n,r){var i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),u=Math.sin(n),s=Math.abs(n-e)>Math.PI?n<=e:e<n;return"M"+t*i+","+t*a+"A"+t+","+t+" 0 0,"+(s?1:0)+" "+t*o+","+t*u+"L"+r*o+","+r*u},"diagonal-horizontal":function(e,t,n,r){var i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},"diagonal-vertical":function(e,t,n,r){var i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":function(e,t,n,r){var i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),u=Math.sin(n),s=(t+r)/2;return"M"+t*i+","+t*a+"C"+s*i+","+s*a+" "+s*o+","+s*u+" "+r*o+","+r*u}});function $s(e){return e.source.x}function Gs(e){return e.source.y}function Ws(e){return e.target.x}function Ys(e){return e.target.y}function Hs(e){Bt.call(this,{},e)}function Vs(e,t,n,r){return"M"+e+","+t+"L"+n+","+r}function Xs(e,t,n,r){var i=n-e,a=r-t,o=Math.sqrt(i*i+a*a)/2;return"M"+e+","+t+"A"+o+","+o+" "+180*Math.atan2(a,i)/Math.PI+" 0 1 "+n+","+r}function Js(e,t,n,r){var i=n-e,a=r-t,o=.2*(i+a),u=.2*(a-i);return"M"+e+","+t+"C"+(e+o)+","+(t+u)+" "+(n+u)+","+(r-o)+" "+n+","+r}function Qs(e){Bt.call(this,null,e)}Hs.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"as",type:"string",default:"path"}]},se(Hs,Bt).transform=function(e,t){var n=e.sourceX||$s,r=e.sourceY||Gs,i=e.targetX||Ws,a=e.targetY||Ys,o=e.as||"path",u=e.orient||"vertical",s=e.shape||"line",l=Bs.get(s+"-"+u)||Bs.get(s);return l||Ue("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,function(e){e[o]=l(n(e),r(e),i(e),a(e))}),t.reflow(e.modified()).modifies(o)},Qs.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},se(Qs,Bt).transform=function(e,t){var n,r,i,a=e.as||["startAngle","endAngle"],o=a[0],u=a[1],s=e.field||z,l=e.startAngle||0,c=null!=e.endAngle?e.endAngle:2*Math.PI,f=t.source,d=f.map(s),h=d.length,p=l,m=(c-l)/v.sum(d),g=v.range(h);for(e.sort&&g.sort(function(e,t){return d[e]-d[t]}),n=0;n<h;++n)i=d[g[n]],(r=f[g[n]])[o]=p,r[u]=p+=i*m;return this.value=d,t.reflow(e.modified()).modifies(a)};var Ks=5,Zs=_e([Zu,Xu,Ju]),el=_e([Zu,Vu,Xu,Ju,"time","utc"]),tl=_e(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","nice","zero","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function nl(e){Bt.call(this,null,e),this.modified(!0)}function rl(e,t,n){return te(e)&&(t||n)?(r=e,i=il(t||[0,1],n),a=i[0],o=I(i)-a,function(e){return r(a+e*o)}):e;var r,i,a,o}function il(e,t){return t?e.slice().reverse():e}function al(e){Bt.call(this,null,e)}se(nl,Bt).transform=function(e,t){var n,r=t.dataflow,i=this.value;for(n in i&&!e.modified("type")||(this.value=i=fs((e.type||Zu).toLowerCase())()),e)if(!tl[n]){if("padding"===n&&el[i.type])continue;te(i[n])?i[n](e[n]):r.warn("Unsupported scale property: "+n)}return function(e,t,n){var r=t.round||!1,i=t.range;if(null!=t.rangeStep)i=function(e,t,n){e!==Qu&&e!==Ku&&Ue("Only band and point scales support rangeStep.");var r=(null!=t.paddingOuter?t.paddingOuter:t.padding)||0,i=e===Ku?1:(null!=t.paddingInner?t.paddingInner:t.padding)||0;return[0,t.rangeStep*os(n,i,r)]}(e.type,t,n);else if(t.scheme){if(te(i=function(e,t,n){var r,i=t.scheme.toLowerCase(),a=Ms(i),o=t.schemeExtent;a||Ue("Unrecognized scheme name: "+t.scheme);return n=e===rs?n+1:e===is?n-1:e===ts||e===ns?+t.schemeCount||Ks:n,e===as?rl(a,o,t.reverse):!o&&(r=Ms(i+"-"+n))?r:te(a)?function(e,t){for(var n=new Array(t),r=t+2,i=0;i<t;)n[i]=e(++i/r);return n}(rl(a,o),n):e===es?a:a.slice(0,n)}(e.type,t,n)))return e.interpolator(i)}else if(i&&e.type===as)return e.interpolator(l.interpolateRgbBasis(il(i,t.reverse)));i&&t.interpolate&&e.interpolate?e.interpolate((a=t.interpolate,o=t.interpolateGamma,s=l[(u=a,"interpolate"+u.toLowerCase().split("-").map(function(e){return e[0].toUpperCase()+e.slice(1)}).join(""))],null!=o&&s&&s.gamma?s.gamma(o):s)):te(e.round)?e.round(r):te(e.rangeRound)&&e.interpolate(r?l.interpolateRound:l.interpolate);var a,o,u,s;i&&e.range(il(i,t.reverse))}(i,e,function(e,t,n){var r=(i=e,a=t.domainRaw,a?(i.domain(a),a.length):-1);var i,a;if(-1<r)return r;var o,u,s=t.domain,l=e.type,c=t.zero||void 0===t.zero&&Zs[l];if(!s)return 0;el[l]&&t.padding&&s[0]!==I(s)&&(f=l,d=s,h=t.range,p=t.padding,m=t.exponent,g=Math.abs(I(h)-h[0]),v=g/(g-2*p),y=f===Vu?K(d,null,v):f===Ju?Z(d,null,v,.5):f===Xu?Z(d,null,v,m):X(d,null,v),(d=d.slice())[0]=y[0],d[d.length-1]=y[1],s=d);var f,d,h,p,m,g,v,y;(c||null!=t.domainMin||null!=t.domainMax||null!=t.domainMid)&&(o=(s=s.slice()).length-1||1,c&&(0<s[0]&&(s[0]=0),s[o]<0&&(s[o]=0)),null!=t.domainMin&&(s[0]=t.domainMin),null!=t.domainMax&&(s[o]=t.domainMax),null!=t.domainMid&&(((u=t.domainMid)<s[0]||u>s[o])&&n.warn("Scale domainMid exceeds domain min or max.",u),s.splice(o,0,u)));e.domain(s),l===es&&e.unknown(void 0);t.nice&&e.nice&&e.nice(!0!==t.nice&&Ss(e,t.nice)||null);return s.length}(i,e,r)),t.fork(t.NO_SOURCE|t.NO_FIELDS)},se(al,Bt).transform=function(e,t){var n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(e.sort),this.modified(n),t};var ol;function ul(e){Bt.call(this,null,e)}function sl(e,t,n,r,i){for(var a,o=(t-e.sum)/2,u=e.length,s=0;s<u;++s)(a=e[s])[r]=o,a[i]=o+=Math.abs(n(a))}function ll(e,t,n,r,i){for(var a,o=1/e.sum,u=0,s=e.length,l=0,c=0;l<s;++l)(a=e[l])[r]=u,a[i]=u=o*(c+=Math.abs(n(a)))}function cl(e,t,n,r,i){for(var a,o,u=0,s=0,l=e.length,c=0;c<l;++c)(a=n(o=e[c]))<0?(o[r]=s,o[i]=s+=a):(o[r]=u,o[i]=u+=a)}ul.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:"zero",values:["zero","center","normalize"]},{name:"as",type:"string",array:!0,length:2,default:["y0","y1"]}]},(ol=se(ul,Bt)).transform=function(e,t){var n,r,i,a,o=e.as||["y0","y1"],u=o[0],s=o[1],l=e.field||z,c="center"===e.offset?sl:"normalize"===e.offset?ll:cl;for(r=0,i=(n=function(e,t,n,r){var i,a,o,u,s,l,c,f,d,h=[],p=function(e){return e(s)};if(null==t)h.push(e.slice());else for(i={},a=0,o=e.length;a<o;++a)s=e[a],l=t.map(p),(c=i[l])||(i[l]=c=[],h.push(c)),c.push(s);for(d=l=0,u=h.length;l<u;++l){for(c=h[l],f=a=0,o=c.length;a<o;++a)f+=Math.abs(r(c[a]));c.sum=f,d<f&&(d=f),n&&c.sort(n)}return h.max=d,h}(t.source,e.groupby,e.sort,l)).length,a=n.max;r<i;++r)c(n[r],a,l,u,s);return t.reflow(e.modified()).modifies(o)};var fl=Object.freeze({axisticks:Cs,datajoin:Ps,encode:Ts,legendentries:Us,linkpath:Hs,pie:Qs,scale:nl,sortitems:al,stack:ul,validTicks:zs}),dl=Array.prototype.slice;function hl(e,t){return e-t}function pl(e){return function(){return e}}function ml(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=gl(e,t[r]))return n;return 0}function gl(e,t){for(var n,r,i,a,o,u,s,l,c,f,d=t[0],h=t[1],p=-1,m=0,g=e.length,v=g-1;m<g;v=m++){var y=e[m],b=y[0],x=y[1],_=e[v],w=_[0],k=_[1];if(f=void 0,a=s=y,u=c=t,((o=l=_)[0]-a[0])*(u[1]-a[1])==(u[0]-a[0])*(o[1]-a[1])&&(n=s[f=+(s[0]===l[0])],r=c[f],i=l[f],n<=r&&r<=i||i<=r&&r<=n))return 0;h<x!=h<k&&d<(w-b)*(h-x)/(k-x)+b&&(p=-p)}return p}function vl(){}var yl=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function bl(){var d=1,h=1,a=v.thresholdSturges,o=t;function r(t){var e=a(t);if(Array.isArray(e))e=e.slice().sort(hl);else{var n=v.extent(t),r=n[0],i=n[1];e=v.tickStep(r,i,e),e=v.range(Math.floor(r/e)*e,Math.floor(i/e)*e,e)}return e.map(function(e){return u(t,e)})}function u(t,n){var i=[],r=[];return function(e,t,u){var s,l,n,r,i,a,c=new Array,f=new Array;s=l=-1,r=e[0]>=t,yl[r<<1].forEach(o);for(;++s<d-1;)n=r,r=e[s+1]>=t,yl[n|r<<1].forEach(o);yl[r<<0].forEach(o);for(;++l<h-1;){for(s=-1,r=e[l*d+d]>=t,i=e[l*d]>=t,yl[r<<1|i<<2].forEach(o);++s<d-1;)n=r,r=e[l*d+d+s+1]>=t,a=i,i=e[l*d+s+1]>=t,yl[n|r<<1|i<<2|a<<3].forEach(o);yl[r|i<<3].forEach(o)}s=-1,i=e[l*d]>=t,yl[i<<2].forEach(o);for(;++s<d-1;)a=i,i=e[l*d+s+1]>=t,yl[i<<2|a<<3].forEach(o);function o(e){var t,n,r=[e[0][0]+s,e[0][1]+l],i=[e[1][0]+s,e[1][1]+l],a=p(r),o=p(i);(t=f[a])?(n=c[o])?(delete f[t.end],delete c[n.start],t===n?(t.ring.push(i),u(t.ring)):c[t.start]=f[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete f[t.end],t.ring.push(i),f[t.end=o]=t):(t=c[o])?(n=f[a])?(delete c[t.start],delete f[n.end],t===n?(t.ring.push(i),u(t.ring)):c[n.start]=f[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete c[t.start],t.ring.unshift(r),c[t.start=a]=t):c[a]=f[o]={start:a,end:o,ring:[r,i]}}yl[i<<3].forEach(o)}(t,n,function(e){o(e,t,n),0<function(e){for(var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}(e)?i.push([e]):r.push(e)}),r.forEach(function(e){for(var t,n=0,r=i.length;n<r;++n)if(-1!==ml((t=i[n])[0],e))return void t.push(e)}),{type:"MultiPolygon",value:n,coordinates:i}}function p(e){return 2*e[0]+e[1]*(d+1)*4}function t(e,u,s){e.forEach(function(e){var t,n=e[0],r=e[1],i=0|n,a=0|r,o=u[a*d+i];0<n&&n<d&&i===n&&(t=u[a*d+i-1],e[0]=n+(s-t)/(o-t)-.5),0<r&&r<h&&a===r&&(t=u[(a-1)*d+i],e[1]=r+(s-t)/(o-t)-.5)})}return r.contour=u,r.size=function(e){if(!arguments.length)return[d,h];var t=Math.ceil(e[0]),n=Math.ceil(e[1]);if(!(0<t&&0<n))throw new Error("invalid size");return d=t,h=n,r},r.thresholds=function(e){return arguments.length?(a="function"==typeof e?e:Array.isArray(e)?pl(dl.call(e)):pl(e),r):a},r.smooth=function(e){return arguments.length?(o=e?t:vl,r):o===t},r}function xl(e,t,n){for(var r=e.width,i=e.height,a=1+(n<<1),o=0;o<i;++o)for(var u=0,s=0;u<r+n;++u)u<r&&(s+=e.data[u+o*r]),n<=u&&(a<=u&&(s-=e.data[u-a+o*r]),t.data[u-n+o*r]=s/Math.min(u+1,r-1+a-u,a))}function _l(e,t,n){for(var r=e.width,i=e.height,a=1+(n<<1),o=0;o<r;++o)for(var u=0,s=0;u<i+n;++u)u<i&&(s+=e.data[o+u*r]),n<=u&&(a<=u&&(s-=e.data[o+(u-a)*r]),t.data[o+(u-n)*r]=s/Math.min(u+1,i-1+a-u,a))}function wl(e){return e[0]}function kl(e){return e[1]}var Ml=["size","smooth"],Ol=["x","y","size","cellSize","bandwidth"];function El(e){Bt.call(this,null,e)}El.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"smooth",type:"boolean"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0}]},se(El,Bt).transform=function(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n,r,i,o,a=e.fork(e.NO_SOURCE|e.NO_FIELDS),u=t.count||10;return t.values?(n=bl(),r=Ml,i=t.values):(n=function(){var o=wl,u=kl,r=960,i=500,s=20,l=2,c=3*s,f=r+2*c>>l,d=i+2*c>>l,h=pl(20);function t(e){var a=new Float32Array(f*d),t=new Float32Array(f*d);e.forEach(function(e,t,n){var r=o(e,t,n)+c>>l,i=u(e,t,n)+c>>l;0<=r&&r<f&&0<=i&&i<d&&++a[r+i*f]}),xl({width:f,height:d,data:a},{width:f,height:d,data:t},s>>l),_l({width:f,height:d,data:t},{width:f,height:d,data:a},s>>l),xl({width:f,height:d,data:a},{width:f,height:d,data:t},s>>l),_l({width:f,height:d,data:t},{width:f,height:d,data:a},s>>l),xl({width:f,height:d,data:a},{width:f,height:d,data:t},s>>l),_l({width:f,height:d,data:t},{width:f,height:d,data:a},s>>l);var n=h(a);if(!Array.isArray(n)){var r=v.max(a);n=v.tickStep(0,r,n),(n=v.range(0,Math.floor(r/n)*n,n)).shift()}return bl().thresholds(n).size([f,d])(a).map(p)}function p(e){return e.value*=Math.pow(2,-2*l),e.coordinates.forEach(n),e}function n(e){e.forEach(a)}function a(e){e.forEach(m)}function m(e){e[0]=e[0]*Math.pow(2,l)-c,e[1]=e[1]*Math.pow(2,l)-c}function g(){return f=r+2*(c=3*s)>>l,d=i+2*c>>l,t}return t.x=function(e){return arguments.length?(o="function"==typeof e?e:pl(+e),t):o},t.y=function(e){return arguments.length?(u="function"==typeof e?e:pl(+e),t):u},t.size=function(e){if(!arguments.length)return[r,i];var t=Math.ceil(e[0]),n=Math.ceil(e[1]);if(!(0<=t||0<=t))throw new Error("invalid size");return r=t,i=n,g()},t.cellSize=function(e){if(!arguments.length)return 1<<l;if(!(1<=(e=+e)))throw new Error("invalid cell size");return l=Math.floor(Math.log(e)/Math.LN2),g()},t.thresholds=function(e){return arguments.length?(h="function"==typeof e?e:Array.isArray(e)?pl(dl.call(e)):pl(e),t):h},t.bandwidth=function(e){if(!arguments.length)return Math.sqrt(s*(s+1));if(!(0<=(e=+e)))throw new Error("invalid bandwidth");return s=Math.round((Math.sqrt(4*e*e+1)-1)/2),g()},t}(),r=Ol,i=e.materialize(e.SOURCE).source),n.thresholds(t.thresholds||(t.nice?u:(o=u,function(e){for(var t=v.extent(e),n=t[0],r=t[1]-n,i=[],a=1;a<=o;++a)i.push(n+r*a/(o+1));return i}))),r.forEach(function(e){null!=t[e]&&n[e](t[e])}),this.value&&(a.rem=this.value),i=i&&i.length?n(i).map(De):[],this.value=a.source=a.add=i,a};var Rl="FeatureCollection";function Sl(e){Bt.call(this,null,e)}Sl.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},se(Sl,Bt).transform=function(e,t){var n,r=this._features,i=this._points,a=e.fields,o=a&&a[0],u=a&&a[1],s=e.geojson,l=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(_(s))||o&&t.modified(_(o))||u&&t.modified(_(u)),this.value&&!n||(l=t.SOURCE,this._features=r=[],this._points=i=[]),s&&t.visit(l,function(e){r.push(s(e))}),o&&u&&(t.visit(l,function(e){var t=o(e),n=u(e);null!=t&&null!=n&&(t=+t)===t&&(n=+n)===n&&i.push([t,n])}),r=r.concat({type:"Feature",geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:Rl,features:r}};var zl=a.geoPath(),Dl=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function Al(e,t){if(!e||"string"!=typeof e)throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),1<arguments.length?(Pl[e]=(r=e,i=t,function e(){var n=i();return n.type=r,n.path=a.geoPath().projection(n),n.copy=n.copy||function(){var t=e();return Dl.forEach(function(e){n.hasOwnProperty(e)&&t[e](n[e]())}),t.path.pointRadius(n.path.pointRadius()),t},n}),this):Pl.hasOwnProperty(e)?Pl[e]:null;var r,i}function Cl(e){return e&&e.path||zl}var Pl={albers:a.geoAlbers,albersusa:a.geoAlbersUsa,azimuthalequalarea:a.geoAzimuthalEqualArea,azimuthalequidistant:a.geoAzimuthalEquidistant,conicconformal:a.geoConicConformal,conicequalarea:a.geoConicEqualArea,conicequidistant:a.geoConicEquidistant,equirectangular:a.geoEquirectangular,gnomonic:a.geoGnomonic,identity:a.geoIdentity,mercator:a.geoMercator,orthographic:a.geoOrthographic,stereographic:a.geoStereographic,transversemercator:a.geoTransverseMercator};for(var ql in Pl)Al(ql,Pl[ql]);function Ll(e){Bt.call(this,null,e)}function Tl(e){Bt.call(this,null,e)}function Fl(e){Bt.call(this,null,e)}function Nl(e){Bt.call(this,[],e),this.generator=a.geoGraticule()}function Il(e){Bt.call(this,null,e),this.modified(!0)}function jl(e,t,n){te(e[t])&&e[t](n)}Ll.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},se(Ll,Bt).transform=function(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||R,a=e.as||"path",o=n.SOURCE;!r||e.modified()?(this.value=r=Cl(e.projection),n.materialize().reflow()):o=i===R||t.modified(i.fields)?n.ADD_MOD:n.ADD;var u=function(e,t){var n=e.pointRadius();e.context(null),null!=t&&e.pointRadius(t);return n}(r,e.pointRadius);return n.visit(o,function(e){e[a]=r(i(e))}),r.pointRadius(u),n.modifies(a)},Tl.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},se(Tl,Bt).transform=function(e,t){var n,r=e.projection,i=e.fields[0],a=e.fields[1],o=e.as||["x","y"],u=o[0],s=o[1];function l(e){var t=r([i(e),a(e)]);t?(e[u]=t[0],e[s]=t[1]):(e[u]=void 0,e[s]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,l):(n=t.modified(i.fields)||t.modified(a.fields),t.visit(n?t.ADD_MOD:t.ADD,l)),t.modifies(o)},Fl.Definition={type:"GeoShape",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},se(Fl,Bt).transform=function(e,t){var r,i,a,n,o=t.fork(t.ALL),u=this.value,s=e.field||M("datum"),l=e.as||"shape",c=o.ADD_MOD;return u&&!e.modified()||(this.value=(r=Cl(e.projection),i=s,a=e.pointRadius,(n=null==a?function(e){return r(i(e))}:function(e){var t=r.pointRadius(),n=r.pointRadius(a)(i(e));return r.pointRadius(t),n}).context=function(e){return r.context(e),n},u=n),o.materialize().reflow(),c=o.SOURCE),o.visit(c,function(e){e[l]=u}),o.modifies(l)},Nl.Definition={type:"Graticule",metadata:{changes:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},se(Nl,Bt).transform=function(e,t){var n,r=this.value,i=this.generator;if(!r.length||e.modified())for(var a in e)te(i[a])&&i[a](e[a]);return n=i(),r.length?t.mod.push(Pe(r[0],n)):t.add.push(De(n)),r[0]=n,t},se(Il,Bt).transform=function(t,e){var n,r,i,a,o=this.value;return!o||t.modified("type")?(this.value=o=function(e){var t=Al((e||"mercator").toLowerCase());t||Ue("Unrecognized projection type: "+e);return t()}(t.type),Dl.forEach(function(e){null!=t[e]&&jl(o,e,t[e])})):Dl.forEach(function(e){t.modified(e)&&jl(o,e,t[e])}),null!=t.pointRadius&&o.path.pointRadius(t.pointRadius),t.fit&&(n=o,a=(r=t).fit,i=1===(a=ee(a)).length?a[0]:{type:Rl,features:a.reduce(function(e,t){return t&&t.type===Rl?e.push.apply(e,t.features):h(t)?e.push.apply(e,t):e.push(t),e},[])},r.extent?n.fitExtent(r.extent,i):r.size&&n.fitSize(r.size,i)),e.fork(e.NO_SOURCE|e.NO_FIELDS)};var Ul=Object.freeze({contour:El,geojson:Sl,geopath:Ll,geopoint:Tl,geoshape:Fl,graticule:Nl,projection:Il}),Bl={center:p.forceCenter,collide:p.forceCollide,nbody:p.forceManyBody,link:p.forceLink,x:p.forceX,y:p.forceY},$l="forces",Gl=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],Wl=["static","iterations"],Yl=["x","y","vx","vy"];function Hl(e){Bt.call(this,null,e)}Hl.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:Yl}]};var Vl=se(Hl,Bt);function Xl(e,t,n,r){var i,a,o,u,s=ee(t.forces);for(i=0,a=Gl.length;i<a;++i)(o=Gl[i])!==$l&&t.modified(o)&&e[o](t[o]);for(i=0,a=s.length;i<a;++i)u=$l+i,(o=n||t.modified($l,i)?Ql(s[i]):r&&Jl(s[i],r)?e.force(u):null)&&e.force(u,o);for(a=e.numForces||0;i<a;++i)e.force($l+i,null);return e.numForces=s.length,e}function Jl(e,t){var n,r;for(n in e)if(te(r=e[n])&&t.modified(_(r)))return 1;return 0}function Ql(e){var t,n;for(n in Bl.hasOwnProperty(e.force)||Ue("Unrecognized force: "+e.force),t=Bl[e.force](),e)te(t[n])&&Kl(t[n],e[n],e);return t}function Kl(e,t,n){e(te(t)?function(e){return t(e,n)}:t)}Vl.transform=function(e,t){var n,r,i,a,o,u,s,l,c=this.value,f=t.changed(t.ADD_REM),d=e.modified(Gl),h=e.iterations||300;if(c?(f&&(t.modifies("index"),c.nodes(t.source)),(d||t.changed(t.MOD))&&Xl(c,e,0,t)):(this.value=(i=t.source,a=e,o=p.forceSimulation(i),u=!1,s=o.stop,l=o.restart,o.stopped=function(){return u},o.restart=function(){return u=!1,l()},o.stop=function(){return u=!0,s()},c=Xl(o,a,!0).on("end",function(){u=!0})),c.on("tick",(n=t.dataflow,r=this,function(){n.touch(r).run()})),e.static||(f=!0,c.tick()),t.modifies("index")),d||f||e.modified(Wl)||t.changed()&&e.restart)if(c.alpha(Math.max(c.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(c.alphaMin(),1/h)),e.static)for(c.stop();0<=--h;)c.tick();else if(c.stopped()&&c.restart(),!f)return t.StopPropagation;return this.finish(e,t)},Vl.finish=function(e,t){for(var n,r=t.dataflow,i=this._argops,a=0,o=i.length;a<o;++a)if((n=i[a]).name===$l&&"link"===n.op._argval.force)for(var u,s=n.op._argops,l=0,c=s.length;l<c;++l)if("links"===s[l].name&&(u=s[l].op.source)){r.pulse(u,r.changeset().reflow());break}return t.reflow(e.modified()).modifies(Yl)};var Zl=Object.freeze({force:Hl});function ec(e,n,r){var i={};return e.each(function(e){var t=e.data;r(t)&&(i[n(t)]=e)}),e.lookup=i,e}function tc(e){Bt.call(this,null,e)}function nc(e){return e.values}function rc(e){Bt.call(this,null,e)}tc.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]},se(tc,Bt).transform=function(e,t){t.source||Ue("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),a=this.value;return(!a||r||t.changed())&&(a&&a.each(function(e){e.children&&Re(e.data)&&i.rem.push(e.data)}),this.value=a=s.hierarchy({values:ee(e.keys).reduce(function(e,t){return e.key(t),e},o.nest()).entries(i.source)},nc),n&&a.each(function(e){e.children&&(e=De(e.data),i.add.push(e),i.source.push(e))}),ec(a,Se,Se)),i.source.root=a,i},se(rc,Bt).transform=function(e,t){t.source&&t.source.root||Ue(this.constructor.name+" transform requires a backing tree data source.");var n=this.layout(e.method),r=this.fields,i=t.source.root,a=e.as||r;e.field&&i.sum(e.field),e.sort&&i.sort(e.sort),function(e,t,n){for(var r,i=0,a=t.length;i<a;++i)(r=t[i])in n&&e[r](n[r])}(n,this.params,e);try{this.value=n(i)}catch(e){Ue(e)}return i.each(function(e){!function(e,t,n){for(var r=e.data,i=0,a=t.length-1;i<a;++i)r[n[i]]=e[t[i]];r[n[a]]=e.children?e.children.length:0}(e,r,a)}),t.reflow(e.modified()).modifies(a).modifies("leaf")};var ic=["x","y","r","depth","children"];function ac(e){rc.call(this,e)}ac.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:3,default:ic}]};var oc=se(ac,rc);oc.layout=s.pack,oc.params=["size","padding"],oc.fields=ic;var uc=["x0","y0","x1","y1","depth","children"];function sc(e){rc.call(this,e)}sc.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:4,default:uc}]};var lc=se(sc,rc);function cc(e){Bt.call(this,null,e)}lc.layout=s.partition,lc.params=["size","round","padding"],lc.fields=uc,cc.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},se(cc,Bt).transform=function(e,t){t.source||Ue("Stratify transform requires an upstream data source.");var n=e.modified(),r=t.fork(t.ALL).materialize(t.SOURCE),i=!this.value||n||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return r.source=r.source.slice(),i&&(this.value=ec(s.stratify().id(e.key).parentId(e.parentKey)(r.source),e.key,D)),r.source.root=this.value,r};var fc={tidy:s.tree,cluster:s.cluster},dc=["x","y","depth","children"];function hc(e){rc.call(this,e)}hc.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:4,default:dc}]};var pc=se(hc,rc);function mc(e){Bt.call(this,[],e)}pc.layout=function(e){var t=e||"tidy";if(fc.hasOwnProperty(t))return fc[t]();Ue("Unrecognized Tree layout method: "+t)},pc.params=["size","nodeSize","separation"],pc.fields=dc,mc.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},se(mc,Bt).transform=function(e,t){var n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),a={};return r||Ue("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,function(e){a[Se(e)]=1}),r.each(function(e){var t=e.data,n=e.parent&&e.parent.data;n&&a[Se(t)]&&a[Se(n)]&&i.add.push(De({source:n,target:t}))}),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,function(e){a[Se(e)]=1}),n.forEach(function(e){(a[Se(e.source)]||a[Se(e.target)])&&i.mod.push(e)})),i};var gc={binary:s.treemapBinary,dice:s.treemapDice,slice:s.treemapSlice,slicedice:s.treemapSliceDice,squarify:s.treemapSquarify,resquarify:s.treemapResquarify},vc=["x0","y0","x1","y1","depth","children"];function yc(e){rc.call(this,e)}yc.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:4,default:vc}]};var bc=se(yc,rc);bc.layout=function(){var n=s.treemap();return n.ratio=function(e){var t=n.tile();t.ratio&&n.tile(t.ratio(e))},n.method=function(e){gc.hasOwnProperty(e)?n.tile(gc[e]):Ue("Unrecognized Treemap layout method: "+e)},n},bc.params=["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],bc.fields=vc;var xc=Object.freeze({nest:tc,pack:ac,partition:sc,stratify:cc,tree:hc,treelinks:mc,treemap:yc});function _c(e){Bt.call(this,null,e)}_c.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};var wc=se(_c,Bt),kc=[[-1e5,-1e5],[1e5,1e5]];wc.transform=function(e,t){var n,r,i,a,o=e.as||"path",u=t.source;for(n=c.voronoi().x(e.x).y(e.y),e.size?n.size(e.size):n.extent(e.extent||kc),this.value=n=n(u),r=n.polygons(),i=0,a=u.length;i<a;++i)u[i][o]=r[i]?"M"+r[i].join("L")+"Z":null;return t.reflow(e.modified()).modifies(o)};var Mc=Object.freeze({voronoi:_c}),Oc=Math.PI/180,Ec=64,Rc=2048;function Sc(){var s,l,c,f,d,h,p,O=[256,256],E=Cc,m=[],R=Math.random,t={};function g(e,t,n){for(var r,i,a,o,u,s=t.x,l=t.y,c=Math.sqrt(O[0]*O[0]+O[1]*O[1]),f=E(O),d=R()<.5?1:-1,h=-d;(r=f(h+=d))&&(i=~~r[0],a=~~r[1],!(Math.min(Math.abs(i),Math.abs(a))>=c));)if(t.x=s+i,t.y=l+a,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>O[0]||t.y+t.y1>O[1]||n&&Dc(t,e,O[0])||n&&(u=n,!((o=t).x+o.x1>u[0].x&&o.x+o.x0<u[1].x&&o.y+o.y1>u[0].y&&o.y+o.y0<u[1].y)))){for(var p,m=t.sprite,g=t.width>>5,v=O[0]>>5,y=t.x-(g<<4),b=127&y,x=32-b,_=t.y1-t.y0,w=(t.y+t.y0)*v+(y>>5),k=0;k<_;k++){for(var M=p=0;M<=g;M++)e[w+M]|=p<<x|(M<g?(p=m[k*g+M])>>>b:0);w+=v}return!(t.sprite=null)}return!1}return t.layout=function(){for(var e=function(e){e.width=e.height=1;var t=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2);e.width=(Ec<<5)/t,e.height=Rc/t;var n=e.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:t}}(oi()),t=function(e){var t=[],n=-1;for(;++n<e;)t[n]=0;return t}((O[0]>>5)*O[1]),n=null,r=m.length,i=-1,a=[],o=m.map(function(e){return{text:s(e),font:l(e),style:f(e),weight:d(e),rotate:h(e),size:~~c(e),padding:p(e),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:e}}).sort(function(e,t){return t.size-e.size});++i<r;){var u=o[i];u.x=O[0]*(R()+.5)>>1,u.y=O[1]*(R()+.5)>>1,zc(e,u,o,i),u.hasText&&g(t,u,n)&&(a.push(u),n?Ac(n,u):n=[{x:u.x+u.x0,y:u.y+u.y0},{x:u.x+u.x1,y:u.y+u.y1}],u.x-=O[0]>>1,u.y-=O[1]>>1)}return a},t.words=function(e){return arguments.length?(m=e,t):m},t.size=function(e){return arguments.length?(O=[+e[0],+e[1]],t):O},t.font=function(e){return arguments.length?(l=Pc(e),t):l},t.fontStyle=function(e){return arguments.length?(f=Pc(e),t):f},t.fontWeight=function(e){return arguments.length?(d=Pc(e),t):d},t.rotate=function(e){return arguments.length?(h=Pc(e),t):h},t.text=function(e){return arguments.length?(s=Pc(e),t):s},t.spiral=function(e){return arguments.length?(E=qc[e]||e,t):E},t.fontSize=function(e){return arguments.length?(c=Pc(e),t):c},t.padding=function(e){return arguments.length?(p=Pc(e),t):p},t.random=function(e){return arguments.length?(R=e,t):R},t}function zc(e,t,n,r){if(!t.sprite){var i=e.context,a=e.ratio;i.clearRect(0,0,(Ec<<5)/a,Rc/a);var o,u,s,l,c,f=0,d=0,h=0,p=n.length;for(--r;++r<p;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,o=i.measureText(t.text+"m").width*a,s=t.size<<1,t.rotate){var m=Math.sin(t.rotate*Oc),g=Math.cos(t.rotate*Oc),v=o*g,y=o*m,b=s*g,x=s*m;o=Math.max(Math.abs(v+x),Math.abs(v-x))+31>>5<<5,s=~~Math.max(Math.abs(y+b),Math.abs(y-b))}else o=o+31>>5<<5;if(h<s&&(h=s),Ec<<5<=f+o&&(d+=h,h=f=0),Rc<=d+s)break;i.translate((f+(o>>1))/a,(d+(s>>1))/a),t.rotate&&i.rotate(t.rotate*Oc),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=o,t.height=s,t.xoff=f,t.yoff=d,t.x1=o>>1,t.y1=s>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,f+=o}for(var _=i.getImageData(0,0,(Ec<<5)/a,Rc/a).data,w=[];0<=--r;)if((t=n[r]).hasText){for(u=(o=t.width)>>5,s=t.y1-t.y0,l=0;l<s*u;l++)w[l]=0;if(null==(f=t.xoff))return;d=t.yoff;var k=0,M=-1;for(c=0;c<s;c++){for(l=0;l<o;l++){var O=u*c+(l>>5),E=_[(d+c)*(Ec<<5)+(f+l)<<2]?1<<31-l%32:0;w[O]|=E,k|=E}k?M=c:(t.y0++,s--,c--,d++)}t.y1=t.y0+M,t.sprite=w.slice(0,(t.y1-t.y0)*u)}}}function Dc(e,t,n){n>>=5;for(var r,i=e.sprite,a=e.width>>5,o=e.x-(a<<4),u=127&o,s=32-u,l=e.y1-e.y0,c=(e.y+e.y0)*n+(o>>5),f=0;f<l;f++){for(var d=r=0;d<=a;d++)if((r<<s|(d<a?(r=i[f*a+d])>>>u:0))&t[c+d])return!0;c+=n}return!1}function Ac(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function Cc(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function Pc(e){return"function"==typeof e?e:function(){return e}}var qc={archimedean:Cc,rectangular:function(e){var n=4*e[0]/e[1],r=0,i=0;return function(e){var t=e<0?-1:1;switch(Math.sqrt(1+4*t*e)-t&3){case 0:r+=n;break;case 1:i+=4;break;case 2:r-=n;break;default:i-=4}return[r,i]}}};function Lc(){var s,l,n=x.scaleOrdinal().unknown(void 0),c=n.domain,f=n.range,d=[0,1],h=!1,p=0,m=0,g=.5;function t(){var e,t,n=c().length,r=d[1]<d[0],i=d[r-0],a=d[1-r],o=(t=(e=n)-p+2*m,e?0<t?t:1:0);s=(a-i)/(o||1),h&&(s=Math.floor(s)),i+=(a-i-s*(n-p))*g,l=s*(1-p),h&&(i=Math.round(i),l=Math.round(l));var u=v.range(n).map(function(e){return i+s*e});return f(r?u.reverse():u)}return delete n.unknown,n.domain=function(e){return arguments.length?(c(e),t()):c()},n.range=function(e){return arguments.length?(d=[+e[0],+e[1]],t()):d.slice()},n.rangeRound=function(e){return d=[+e[0],+e[1]],h=!0,t()},n.bandwidth=function(){return l},n.step=function(){return s},n.round=function(e){return arguments.length?(h=!!e,t()):h},n.padding=function(e){return arguments.length?(m=Math.max(0,Math.min(1,e)),p=m,t()):p},n.paddingInner=function(e){return arguments.length?(p=Math.max(0,Math.min(1,e)),t()):p},n.paddingOuter=function(e){return arguments.length?(m=Math.max(0,Math.min(1,e)),t()):m},n.align=function(e){return arguments.length?(g=Math.max(0,Math.min(1,e)),t()):g},n.invertRange=function(e){if(null!=e[0]&&null!=e[1]){var t,n,r,i=+e[0],a=+e[1],o=d[1]<d[0],u=o?f().reverse():f(),s=u.length-1;if(i==i&&a==a&&(a<i&&(r=i,i=a,a=r),!(a<u[0]||i>d[1-o])))return t=Math.max(0,v.bisectRight(u,i)-1),n=i===a?t:v.bisectRight(u,a)-1,i-u[t]>l+1e-10&&++t,o&&(r=t,t=s-n,n=s-r),n<t?void 0:c().slice(t,n+1)}},n.invert=function(e){var t=n.invertRange([e,e]);return t?t[0]:t},n.copy=function(){return Lc().domain(c()).range(d).round(h).paddingInner(p).paddingOuter(m).align(g)},t()}var Tc=Array.prototype.map,Fc=Array.prototype.slice;function Nc(e){return Tc.call(e,function(e){return+e})}function Ic(e,t){return 1<arguments.length?(jc[e]=(n=e,r=t,function(){var l,i,e=r();return e.invertRange||(e.invertRange=e.invert?(i=e,function(e){var t,n=e[0],r=e[1];return r<n&&(t=n,n=r,r=t),[i.invert(n),i.invert(r)]}):e.invertExtent?(l=e,function(e){var t,n,r,i,a=l.range(),o=e[0],u=e[1],s=-1;for(u<o&&(n=o,o=u,u=n),r=0,i=a.length;r<i;++r)a[r]>=o&&a[r]<=u&&(s<0&&(s=r),t=r);if(!(s<0))return o=l.invertExtent(a[s]),u=l.invertExtent(a[t]),[void 0===o[0]?o[1]:o[0],void 0===u[1]?u[0]:u[1]]}):void 0),e.type=n,e}),this):jc.hasOwnProperty(e)?jc[e]:void 0;var n,r}var jc={identity:x.scaleIdentity,linear:x.scaleLinear,log:x.scaleLog,ordinal:x.scaleOrdinal,pow:x.scalePow,sqrt:x.scaleSqrt,quantile:x.scaleQuantile,quantize:x.scaleQuantize,threshold:x.scaleThreshold,time:x.scaleTime,utc:x.scaleUtc,band:Lc,point:function(){return function e(t){var n=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return e(n())},t}(Lc().paddingInner(1))},sequential:function e(n){var r=x.scaleLinear(),i=0,a=1,o=!1;function t(){var e=r.domain();i=e[0],a=I(e)-i}function u(e){var t=(e-i)/a;return n(o?Math.max(0,Math.min(1,t)):t)}return u.clamp=function(e){return arguments.length?(o=!!e,u):o},u.domain=function(e){return arguments.length?(r.domain(e),t(),u):r.domain()},u.interpolator=function(e){return arguments.length?(n=e,u):n},u.copy=function(){return e().domain(r.domain()).clamp(o).interpolator(n)},u.ticks=function(e){return r.ticks(e)},u.tickFormat=function(e,t){return r.tickFormat(e,t)},u.nice=function(e){return r.nice(e),t(),u},u},"bin-linear":function e(){var t=x.scaleLinear(),r=[];function i(e){return t(e)}return i.domain=function(e){return arguments.length?(r=Nc(e),t.domain([r[0],I(r)]),i):r.slice()},i.range=function(e){return arguments.length?(t.range(e),i):t.range()},i.rangeRound=function(e){return arguments.length?(t.rangeRound(e),i):t.rangeRound()},i.interpolate=function(e){return arguments.length?(t.interpolate(e),i):t.interpolate()},i.invert=function(e){return t.invert(e)},i.ticks=function(e){var t=r.length,n=~~(t/(e||t));return n<2?i.domain():r.filter(function(e,t){return!(t%n)})},i.tickFormat=function(){return t.tickFormat.apply(t,arguments)},i.copy=function(){return e().domain(i.domain()).range(i.range())},i},"bin-ordinal":function e(){var t=[],n=[];function r(e){return null==e||e!=e?void 0:n[(v.bisect(t,e)-1)%n.length]}return r.domain=function(e){return arguments.length?(t=Nc(e),r):t.slice()},r.range=function(e){return arguments.length?(n=Fc.call(e),r):n.slice()},r.copy=function(){return e().domain(r.domain()).range(r.range())},r}};for(var Uc in jc)Ic(Uc,jc[Uc]);function Bc(e){for(var t=e.length/6|0,n=new Array(t),r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}var $c=Bc("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5"),Gc=Bc("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6"),Wc=Bc("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9"),Yc=Bc("4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac"),Hc=Bc("4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5"),Vc=new Array(3).concat("67a9cff7f7f7f1a340","0571b092c5defdb863e66101","0571b092c5def7f7f7fdb863e66101","2166ac67a9cfd1e5f0fee0b6f1a340b35806","2166ac67a9cfd1e5f0f7f7f7fee0b6f1a340b35806","2166ac4393c392c5ded1e5f0fee0b6fdb863e08214b35806","2166ac4393c392c5ded1e5f0f7f7f7fee0b6fdb863e08214b35806","0530612166ac4393c392c5ded1e5f0fee0b6fdb863e08214b358067f3b08","0530612166ac4393c392c5ded1e5f0f7f7f7fee0b6fdb863e08214b358067f3b08").map(Bc),Xc={blueorange:Vc},Jc={category10:r.schemeCategory10,accent:r.schemeAccent,dark2:r.schemeDark2,paired:r.schemePaired,pastel1:r.schemePastel1,pastel2:r.schemePastel2,set1:r.schemeSet1,set2:r.schemeSet2,set3:r.schemeSet3,category20:$c,category20b:Gc,category20c:Wc,tableau10:Yc,tableau20:Hc,viridis:r.interpolateViridis,magma:r.interpolateMagma,inferno:r.interpolateInferno,plasma:r.interpolatePlasma,blueorange:l.interpolateRgbBasis(I(Vc))};function Qc(e,t){Jc[e]=r["interpolate"+t],Xc[e]=r["scheme"+t]}Qc("blues","Blues"),Qc("greens","Greens"),Qc("greys","Greys"),Qc("purples","Purples"),Qc("reds","Reds"),Qc("oranges","Oranges"),Qc("brownbluegreen","BrBG"),Qc("purplegreen","PRGn"),Qc("pinkyellowgreen","PiYG"),Qc("purpleorange","PuOr"),Qc("redblue","RdBu"),Qc("redgrey","RdGy"),Qc("redyellowblue","RdYlBu"),Qc("redyellowgreen","RdYlGn"),Qc("spectral","Spectral"),Qc("bluegreen","BuGn"),Qc("bluepurple","BuPu"),Qc("greenblue","GnBu"),Qc("orangered","OrRd"),Qc("purplebluegreen","PuBuGn"),Qc("purpleblue","PuBu"),Qc("purplered","PuRd"),Qc("redpurple","RdPu"),Qc("yellowgreenblue","YlGnBu"),Qc("yellowgreen","YlGn"),Qc("yelloworangebrown","YlOrBr"),Qc("yelloworangered","YlOrRd");var Kc=["x","y","font","fontSize","fontStyle","fontWeight","angle"],Zc=["text","font","rotate","fontSize","fontStyle","fontWeight"];function ef(e){Bt.call(this,Sc(),e)}ef.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:Kc}]},se(ef,Bt).transform=function(n,r){var e=n.modified();if(e||r.changed(r.ADD_REM)||Zc.some(function(e){var t=n[e];return te(t)&&r.modified(t.fields)})){var t,i=r.materialize(r.SOURCE).source,a=this.value,o=n.as||Kc,u=n.fontSize||14;if(te(u)?t=n.fontSizeRange:u=re(u),t){var s=u,l=Ic("sqrt")().domain(function(e,t){for(var n,r=1/0,i=-1/0,a=0,o=t.length;a<o;++a)(n=e(t[a]))<r&&(r=n),i<n&&(i=n);return[r,i]}(s,i)).range(t);u=function(e){return l(s(e))}}i.forEach(function(e){e[o[0]]=NaN,e[o[1]]=NaN,e[o[3]]=0});for(var c,f,d=a.words(i).text(n.text).size(n.size||[500,500]).padding(n.padding||1).spiral(n.spiral||"archimedean").rotate(n.rotate||0).font(n.font||"sans-serif").fontStyle(n.fontStyle||"normal").fontWeight(n.fontWeight||"normal").fontSize(u).random(y.random).layout(),h=a.size(),p=h[0]>>1,m=h[1]>>1,g=0,v=d.length;g<v;++g)(f=(c=d[g]).datum)[o[0]]=c.x+p,f[o[1]]=c.y+m,f[o[2]]=c.font,f[o[3]]=c.size,f[o[4]]=c.style,f[o[5]]=c.weight,f[o[6]]=c.rotate;return r.reflow(e).modifies(o)}};var tf=Object.freeze({wordcloud:ef});function nf(e){return new Uint32Array(e)}function rf(e,t,n){var r=(t<257?function(e){return new Uint8Array(e)}:t<65537?function(e){return new Uint16Array(e)}:nf)(e);return n&&r.set(n),r}function af(e,t,n){var s=1<<t;return{one:s,zero:~s,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd:function(e,t){var n,r=this.bisect(this.range,e.value),i=e.index,a=r[0],o=r[1],u=i.length;for(n=0;n<a;++n)t[i[n]]|=s;for(n=o;n<u;++n)t[i[n]]|=s;return this}}}function of(){var d=nf(0),h=[],p=0;return{insert:function(e,t,n){if(!t.length)return[];var r,i,a,o,u,s=p,l=t.length,c=Array(l),f=nf(l);for(a=0;a<l;++a)c[a]=e(t[a]),f[a]=a;if(u=f,(o=c).sort.call(u,function(e,t){var n=o[e],r=o[t];return n<r?-1:r<n?1:0}),c=v.permute(o,u),s)r=h,i=d,h=Array(s+l),d=nf(s+l),function(e,t,n,r,i,a,o,u,s){var l,c=0,f=0;for(l=0;c<r&&f<o;++l)t[c]<i[f]?(u[l]=t[c],s[l]=n[c++]):(u[l]=i[f],s[l]=a[f++]+e);for(;c<r;++c,++l)u[l]=t[c],s[l]=n[c];for(;f<o;++f,++l)u[l]=i[f],s[l]=a[f]+e}(n,r,i,s,c,f,l,h,d);else{if(0<n)for(a=0;a<l;++a)f[a]+=n;h=c,d=f}return p=s+l,{index:f,value:c}},remove:function(e,t){var n,r,i,a=p;for(r=0;!t[d[r]]&&r<a;++r);for(i=r;r<a;++r)t[n=d[r]]||(d[i]=n,h[i]=h[r],++i);p=a-e},bisect:function(e,t){var n;return t?n=t.length:(t=h,n=p),[v.bisectLeft(t,e[0],0,n),v.bisectRight(t,e[1],0,n)]},reindex:function(e){for(var t=0,n=p;t<n;++t)d[t]=e[d[t]]},index:function(){return d},size:function(){return p}}}function uf(e){var n,s,r,l,c;Bt.call(this,(n=8,s=[],r=nf(0),l=rf(0,n),c=rf(0,n),{data:function(){return s},seen:function(){return e=r,t=s.length,r=e.length>=t?e:((n=n||new e.constructor(t)).set(e),n);var e,t,n},add:function(e){for(var t,n=0,r=s.length,i=e.length;n<i;++n)(t=e[n])._index=r++,s.push(t)},remove:function(e,t){var n,r,i,a=s.length,o=Array(a-e),u=s;for(r=0;!t[r]&&r<a;++r)o[r]=s[r],u[r]=r;for(i=r;r<a;++r)n=s[r],t[r]?u[r]=-1:(u[r]=i,l[i]=l[r],c[i]=c[r],(o[i]=n)._index=i++),l[r]=0;return s=o,u},size:function(){return s.length},curr:function(){return l},prev:function(){return c},reset:function(e){c[e]=l[e]},all:function(){return n<257?255:n<65537?65535:4294967295},set:function(e,t){l[e]|=t},clear:function(e,t){l[e]&=~t},resize:function(e,t){(l.length<e||n<t)&&(n=Math.max(t,n),l=rf(e,n,l),c=rf(e,n))}}),e),this._indices=null,this._dims=null}uf.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};var sf=se(uf,Bt);function lf(e){Bt.call(this,null,e)}sf.transform=function(e,t){return this._dims?e.modified("fields")||e.fields.some(function(e){return t.modified(e.fields)})?this.reinit(e,t):this.eval(e,t):this.init(e,t)},sf.init=function(e,t){for(var n,r,i=e.fields,a=e.query,o=this._indices={},u=this._dims=[],s=a.length,l=0;l<s;++l)r=o[n=i[l].fname]||(o[n]=of()),u.push(af(r,l,a[l]));return this.eval(e,t)},sf.reinit=function(e,t){var n,r,i,a,o,u,s,l,c,f=t.materialize().fork(),d=e.fields,h=e.query,p=this._indices,m=this._dims,g=this.value,v=g.curr(),y=g.prev(),b=g.all(),x=f.rem=f.add,_=f.mod,w=h.length,k={};if(y.set(v),t.rem.length&&(o=this.remove(e,t,f)),t.add.length&&g.add(t.add),t.mod.length)for(u={},s=0,l=(a=t.mod).length;s<l;++s)u[a[s]._index]=1;for(s=0;s<w;++s)c=d[s],(!m[s]||e.modified("fields",s)||t.modified(c.fields))&&((n=k[i=c.fname])||(p[i]=r=of(),k[i]=n=r.insert(c,t.source,0)),m[s]=af(r,s,h[s]).onAdd(n,v));for(s=0,l=g.data().length;s<l;++s)o[s]||(y[s]!==v[s]?x.push(s):u[s]&&v[s]!==b&&_.push(s));return g.mask=(1<<w)-1,f},sf.eval=function(e,t){var n=t.materialize().fork(),r=this._dims.length,i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},sf.insert=function(e,t,n){var r,i,a,o=t.add,u=this.value,s=this._dims,l=this._indices,c=e.fields,f={},d=n.add,h=u.size(),p=h+o.length,m=s.length;u.resize(p,m),u.add(o);var g=u.curr(),v=u.prev(),y=u.all();for(r=0;r<m;++r)a=f[i=c[r].fname]||(f[i]=l[i].insert(c[r],o,h)),s[r].onAdd(a,g);for(;h<p;++h)v[h]=y,g[h]!==y&&d.push(h)},sf.modify=function(e,t){var n,r,i,a=t.mod,o=this.value,u=o.curr(),s=o.all(),l=e.mod;for(n=0,r=l.length;n<r;++n)u[i=l[n]._index]!==s&&a.push(i)},sf.remove=function(e,t,n){var r,i,a,o,u=this._indices,s=this.value,l=s.curr(),c=s.prev(),f=s.all(),d={},h=n.rem,p=t.rem;for(r=0,i=p.length;r<i;++r)d[a=p[r]._index]=1,c[a]=o=l[a],o!==(l[a]=f)&&h.push(a);for(a in u)u[a].remove(i,d);return this.reindex(t,i,d),d},sf.reindex=function(e,n,r){var i=this._indices,a=this.value;e.runAfter(function(){var e=a.remove(n,r);for(var t in i)i[t].reindex(e)})},sf.update=function(e,t,n){var r,i,a=this._dims,o=e.query,u=t.stamp,s=a.length,l=0;for(i=n.filters=0;i<s;++i)e.modified("query",i)&&(r=i,++l);if(1===l)l=a[r].one,this.incrementOne(a[r],o[r],n.add,n.rem);else for(l=i=0;i<s;++i)e.modified("query",i)&&(l|=a[i].one,this.incrementAll(a[i],o[i],u,n.add),n.rem=n.add);return l},sf.incrementAll=function(e,t,n,r){var i,a,o,u=this.value,s=u.seen(),l=u.curr(),c=u.prev(),f=e.index(),d=e.bisect(e.range),h=e.bisect(t),p=h[0],m=h[1],g=d[0],v=d[1],y=e.one;if(p<g)for(i=p,a=Math.min(g,m);i<a;++i)s[o=f[i]]!==n&&(c[o]=l[o],s[o]=n,r.push(o)),l[o]^=y;else if(g<p)for(i=g,a=Math.min(p,v);i<a;++i)s[o=f[i]]!==n&&(c[o]=l[o],s[o]=n,r.push(o)),l[o]^=y;if(v<m)for(i=Math.max(p,v),a=m;i<a;++i)s[o=f[i]]!==n&&(c[o]=l[o],s[o]=n,r.push(o)),l[o]^=y;else if(m<v)for(i=Math.max(g,m),a=v;i<a;++i)s[o=f[i]]!==n&&(c[o]=l[o],s[o]=n,r.push(o)),l[o]^=y;e.range=t.slice()},sf.incrementOne=function(e,t,n,r){var i,a,o,u=this.value.curr(),s=e.index(),l=e.bisect(e.range),c=e.bisect(t),f=c[0],d=c[1],h=l[0],p=l[1],m=e.one;if(f<h)for(i=f,a=Math.min(h,d);i<a;++i)u[o=s[i]]^=m,n.push(o);else if(h<f)for(i=h,a=Math.min(f,p);i<a;++i)u[o=s[i]]^=m,r.push(o);if(p<d)for(i=Math.max(f,p),a=d;i<a;++i)u[o=s[i]]^=m,n.push(o);else if(d<p)for(i=Math.max(h,d),a=p;i<a;++i)u[o=s[i]]^=m,r.push(o);e.range=t.slice()},lf.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},se(lf,Bt).transform=function(e,t){var n=~(e.ignore||0),r=e.filter,i=r.mask;if(0==(i&n))return t.StopPropagation;var a=t.fork(t.ALL),o=r.data(),u=r.curr(),s=r.prev(),l=function(e){return u[e]&n?null:o[e]};return a.filter(a.MOD,l),i&i-1?(a.filter(a.ADD,function(e){var t=u[e]&n;return!t&&t^s[e]&n?o[e]:null}),a.filter(a.REM,function(e){var t=u[e]&n;return t&&!(t^t^s[e]&n)?o[e]:null})):(a.filter(a.ADD,l),a.filter(a.REM,function(e){return(u[e]&n)===i?o[e]:null})),a.filter(a.SOURCE,function(e){return l(e._index)})};var cf=Object.freeze({crossfilter:uf,resolvefilter:lf});function ff(){var s,l,n=x.scaleOrdinal().unknown(void 0),c=n.domain,f=n.range,d=[0,1],h=!1,p=0,m=0,g=.5;function t(){var e,t,n=c().length,r=d[1]<d[0],i=d[r-0],a=d[1-r],o=(t=(e=n)-p+2*m,e?0<t?t:1:0);s=(a-i)/(o||1),h&&(s=Math.floor(s)),i+=(a-i-s*(n-p))*g,l=s*(1-p),h&&(i=Math.round(i),l=Math.round(l));var u=v.range(n).map(function(e){return i+s*e});return f(r?u.reverse():u)}return delete n.unknown,n.domain=function(e){return arguments.length?(c(e),t()):c()},n.range=function(e){return arguments.length?(d=[+e[0],+e[1]],t()):d.slice()},n.rangeRound=function(e){return d=[+e[0],+e[1]],h=!0,t()},n.bandwidth=function(){return l},n.step=function(){return s},n.round=function(e){return arguments.length?(h=!!e,t()):h},n.padding=function(e){return arguments.length?(m=Math.max(0,Math.min(1,e)),p=m,t()):p},n.paddingInner=function(e){return arguments.length?(p=Math.max(0,Math.min(1,e)),t()):p},n.paddingOuter=function(e){return arguments.length?(m=Math.max(0,Math.min(1,e)),t()):m},n.align=function(e){return arguments.length?(g=Math.max(0,Math.min(1,e)),t()):g},n.invertRange=function(e){if(null!=e[0]&&null!=e[1]){var t,n,r,i=+e[0],a=+e[1],o=d[1]<d[0],u=o?f().reverse():f(),s=u.length-1;if(i==i&&a==a&&(a<i&&(r=i,i=a,a=r),!(a<u[0]||i>d[1-o])))return t=Math.max(0,v.bisectRight(u,i)-1),n=i===a?t:v.bisectRight(u,a)-1,i-u[t]>l+1e-10&&++t,o&&(r=t,t=s-n,n=s-r),n<t?void 0:c().slice(t,n+1)}},n.invert=function(e){var t=n.invertRange([e,e]);return t?t[0]:t},n.copy=function(){return ff().domain(c()).range(d).round(h).paddingInner(p).paddingOuter(m).align(g)},t()}var df=Array.prototype.map,hf=Array.prototype.slice;function pf(e){return df.call(e,function(e){return+e})}function mf(e,t){return 1<arguments.length?(gf[e]=(n=e,r=t,function(){var l,i,e=r();return e.invertRange||(e.invertRange=e.invert?(i=e,function(e){var t,n=e[0],r=e[1];return r<n&&(t=n,n=r,r=t),[i.invert(n),i.invert(r)]}):e.invertExtent?(l=e,function(e){var t,n,r,i,a=l.range(),o=e[0],u=e[1],s=-1;for(u<o&&(n=o,o=u,u=n),r=0,i=a.length;r<i;++r)a[r]>=o&&a[r]<=u&&(s<0&&(s=r),t=r);if(!(s<0))return o=l.invertExtent(a[s]),u=l.invertExtent(a[t]),[void 0===o[0]?o[1]:o[0],void 0===u[1]?u[0]:u[1]]}):void 0),e.type=n,e}),this):gf.hasOwnProperty(e)?gf[e]:void 0;var n,r}var gf={identity:x.scaleIdentity,linear:x.scaleLinear,log:x.scaleLog,ordinal:x.scaleOrdinal,pow:x.scalePow,sqrt:x.scaleSqrt,quantile:x.scaleQuantile,quantize:x.scaleQuantize,threshold:x.scaleThreshold,time:x.scaleTime,utc:x.scaleUtc,band:ff,point:function(){return function e(t){var n=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return e(n())},t}(ff().paddingInner(1))},sequential:function e(n){var r=x.scaleLinear(),i=0,a=1,o=!1;function t(){var e=r.domain();i=e[0],a=I(e)-i}function u(e){var t=(e-i)/a;return n(o?Math.max(0,Math.min(1,t)):t)}return u.clamp=function(e){return arguments.length?(o=!!e,u):o},u.domain=function(e){return arguments.length?(r.domain(e),t(),u):r.domain()},u.interpolator=function(e){return arguments.length?(n=e,u):n},u.copy=function(){return e().domain(r.domain()).clamp(o).interpolator(n)},u.ticks=function(e){return r.ticks(e)},u.tickFormat=function(e,t){return r.tickFormat(e,t)},u.nice=function(e){return r.nice(e),t(),u},u},"bin-linear":function e(){var t=x.scaleLinear(),r=[];function i(e){return t(e)}return i.domain=function(e){return arguments.length?(r=pf(e),t.domain([r[0],I(r)]),i):r.slice()},i.range=function(e){return arguments.length?(t.range(e),i):t.range()},i.rangeRound=function(e){return arguments.length?(t.rangeRound(e),i):t.rangeRound()},i.interpolate=function(e){return arguments.length?(t.interpolate(e),i):t.interpolate()},i.invert=function(e){return t.invert(e)},i.ticks=function(e){var t=r.length,n=~~(t/(e||t));return n<2?i.domain():r.filter(function(e,t){return!(t%n)})},i.tickFormat=function(){return t.tickFormat.apply(t,arguments)},i.copy=function(){return e().domain(i.domain()).range(i.range())},i},"bin-ordinal":function e(){var t=[],n=[];function r(e){return null==e||e!=e?void 0:n[(v.bisect(t,e)-1)%n.length]}return r.domain=function(e){return arguments.length?(t=pf(e),r):t.slice()},r.range=function(e){return arguments.length?(n=hf.call(e),r):n.slice()},r.copy=function(){return e().domain(r.domain()).range(r.range())},r}};for(var vf in gf)mf(vf,gf[vf]);function yf(e){for(var t=e.length/6|0,n=new Array(t),r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}var bf=yf("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5"),xf=yf("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6"),_f=yf("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9"),wf=yf("4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac"),kf=yf("4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5"),Mf=new Array(3).concat("67a9cff7f7f7f1a340","0571b092c5defdb863e66101","0571b092c5def7f7f7fdb863e66101","2166ac67a9cfd1e5f0fee0b6f1a340b35806","2166ac67a9cfd1e5f0f7f7f7fee0b6f1a340b35806","2166ac4393c392c5ded1e5f0fee0b6fdb863e08214b35806","2166ac4393c392c5ded1e5f0f7f7f7fee0b6fdb863e08214b35806","0530612166ac4393c392c5ded1e5f0fee0b6fdb863e08214b358067f3b08","0530612166ac4393c392c5ded1e5f0f7f7f7fee0b6fdb863e08214b358067f3b08").map(yf),Of={blueorange:Mf},Ef={category10:r.schemeCategory10,accent:r.schemeAccent,dark2:r.schemeDark2,paired:r.schemePaired,pastel1:r.schemePastel1,pastel2:r.schemePastel2,set1:r.schemeSet1,set2:r.schemeSet2,set3:r.schemeSet3,category20:bf,category20b:xf,category20c:_f,tableau10:wf,tableau20:kf,viridis:r.interpolateViridis,magma:r.interpolateMagma,inferno:r.interpolateInferno,plasma:r.interpolatePlasma,rainbow:r.interpolateRainbow,sinebow:r.interpolateSinebow,blueorange:l.interpolateRgbBasis(I(Mf))};function Rf(e,t){Ef[e]=r["interpolate"+t],Of[e]=r["scheme"+t]}Rf("blues","Blues"),Rf("greens","Greens"),Rf("greys","Greys"),Rf("purples","Purples"),Rf("reds","Reds"),Rf("oranges","Oranges"),Rf("brownbluegreen","BrBG"),Rf("purplegreen","PRGn"),Rf("pinkyellowgreen","PiYG"),Rf("purpleorange","PuOr"),Rf("redblue","RdBu"),Rf("redgrey","RdGy"),Rf("redyellowblue","RdYlBu"),Rf("redyellowgreen","RdYlGn"),Rf("spectral","Spectral"),Rf("bluegreen","BuGn"),Rf("bluepurple","BuPu"),Rf("greenblue","GnBu"),Rf("orangered","OrRd"),Rf("purplebluegreen","PuBuGn"),Rf("purpleblue","PuBu"),Rf("purplered","PuRd"),Rf("redpurple","RdPu"),Rf("yellowgreenblue","YlGnBu"),Rf("yellowgreen","YlGn"),Rf("yelloworangebrown","YlOrBr"),Rf("yelloworangered","YlOrRd");var Sf={millisecond:t.timeMillisecond,second:t.timeSecond,minute:t.timeMinute,hour:t.timeHour,day:t.timeDay,week:t.timeWeek,month:t.timeMonth,year:t.timeYear},zf={millisecond:t.utcMillisecond,second:t.utcSecond,minute:t.utcMinute,hour:t.utcHour,day:t.utcDay,week:t.utcWeek,month:t.utcMonth,year:t.utcYear};var Df="default";function Af(e){var a=e._signals.cursor;a||(e._signals.cursor=a=e.add({user:Df,item:null})),e.on(e.events("view","mousemove"),a,function(e,t){var n=a.value,r=n?m(n)?n:n.user:Df,i=t.item&&t.item.cursor||null;return n&&r===n.user&&i==n.item?n:{user:r,item:i}}),e.add(null,function(e){var t,n=e.cursor,r=this.value;return m(n)||(r=n.item,n=n.user),t=n&&n!==Df?n:r||n,"undefined"!=typeof document&&document.body&&(document.body.style.cursor=t),r},{cursor:a})}function Cf(e,t){var n=e._runtime.data;return n.hasOwnProperty(t)||Ue("Unrecognized data set: "+t),n[t]}function Pf(e,t){qe(t)||Ue("Second argument to changes must be a changeset.");var n=Cf(this,e);return n.modified=!0,this.pulse(n.input,t)}function qf(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function Lf(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function Tf(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function Ff(e,t,n){var r,i,a=e._renderer.canvas();return a&&(i=Tf(e),(r=xo(t.changedTouches?t.changedTouches[0]:t,a))[0]-=i[0],r[1]-=i[1]),t.dataflow=e,t.vega=function(e,r,n){var i=r?"group"===r.mark.marktype?r:r.mark.group:null;function a(e){var t,n=i;if(e)for(t=r;t;t=t.mark.group)if(t.mark.name===e){n=t;break}return n&&n.mark&&n.mark.interactive?n:{}}function t(e){if(!e)return n;m(e)&&(e=a(e));for(var t=n.slice();e;)t[0]-=e.x||0,t[1]-=e.y||0,e=e.mark&&e.mark.group;return t}return{view:re(e),item:re(r||{}),group:a,xy:t,x:function(e){return t(e)[0]},y:function(e){return t(e)[1]}}}(e,n,r),t.item=n,t}var Nf={trap:!1};function If(e){return e.item}function jf(e){var t=e.item.mark.source;return t.source||t}function Uf(n){return function(e,t){return t.vega.view().changeset().encode(t.item,n)}}function Bf(e,t,n){var r=document.createElement(e);for(var i in t)r.setAttribute(i,t[i]);return null!=n&&(r.textContent=n),r}var $f="vega-bind",Gf="vega-bind-name",Wf="vega-bind-radio",Yf="vega-option-";function Hf(t,e,n){if(e){var r=n.param,i=n.state;return i||(i=n.state={elements:null,active:!1,set:null,update:function(e){e!==t.signal(r.signal)&&(i.source=!0,t.signal(r.signal,e).run())}},r.debounce&&(i.update=ie(r.debounce,i.update))),function(e,t,n,r){var i=Bf("div",{class:$f});i.appendChild(Bf("span",{class:Gf},n.name||n.signal)),t.appendChild(i);var a=Vf;switch(n.input){case"checkbox":a=Xf;break;case"select":a=Jf;break;case"radio":a=Qf;break;case"range":a=Kf}a(e,i,n,r)}(i,e,r,t.signal(r.signal)),i.active||(t.on(t._signals[r.signal],null,function(){i.source?i.source=!1:i.set(t.signal(r.signal))}),i.active=!0),i}}function Vf(e,t,n,r){var i=Bf("input");for(var a in n)"signal"!==a&&"element"!==a&&i.setAttribute("input"===a?"type":a,n[a]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",function(){e.update(i.value)}),e.elements=[i],e.set=function(e){i.value=e}}function Xf(e,t,n,r){var i={type:"checkbox",name:n.signal};r&&(i.checked=!0);var a=Bf("input",i);t.appendChild(a),a.addEventListener("change",function(){e.update(a.checked)}),e.elements=[a],e.set=function(e){a.checked=!!e||null}}function Jf(e,t,r,n){var i=Bf("select",{name:r.signal});r.options.forEach(function(e){var t={value:e};Zf(e,n)&&(t.selected=!0),i.appendChild(Bf("option",t,e+""))}),t.appendChild(i),i.addEventListener("change",function(){e.update(r.options[i.selectedIndex])}),e.elements=[i],e.set=function(e){for(var t=0,n=r.options.length;t<n;++t)if(Zf(r.options[t],e))return void(i.selectedIndex=t)}}function Qf(i,e,a,o){var u=Bf("span",{class:Wf});e.appendChild(u),i.elements=a.options.map(function(e){var t=Yf+a.signal+"-"+e,n={id:t,type:"radio",name:a.signal,value:e};Zf(e,o)&&(n.checked=!0);var r=Bf("input",n);return r.addEventListener("change",function(){i.update(e)}),u.appendChild(r),u.appendChild(Bf("label",{for:t},e+"")),r}),i.set=function(e){for(var t=i.elements,n=0,r=t.length;n<r;++n)Zf(t[n].value,e)&&(t[n].checked=!0)}}function Kf(e,t,n,r){r=void 0!==r?r:(+n.max+ +n.min)/2;var i=n.min||Math.min(0,+r)||0,a=n.max||Math.max(100,+r)||100,o=n.step||v.tickStep(i,a,100),u=Bf("input",{type:"range",name:n.signal,min:i,max:a,step:o}),s=Bf("label",{},+(u.value=r));function l(){s.textContent=u.value,e.update(+u.value)}t.appendChild(u),t.appendChild(s),u.addEventListener("input",l),u.addEventListener("change",l),e.elements=[u],e.set=function(e){u.value=e,s.textContent=e}}function Zf(e,t){return e===t||e+""==t+""}function ed(e,t,n,r,i){return(t=t||new r(e.loader())).initialize(n,qf(e),Lf(e),Tf(e),i).background(e._background)}function td(t,e){return e?function(){try{e.apply(this,arguments)}catch(e){t.error(e)}}:null}function nd(t,n){if("string"==typeof n){if("undefined"==typeof document)return t.error("DOM document instance not found."),null;if(!(n=document.querySelector(n)))return t.error("Signal bind element not found: "+n),null}if(n)try{n.innerHTML=""}catch(e){n=null,t.error(e)}return n}function rd(e,t,n){var r=du(t),i=r&&r.headless;return i?e.runAsync().then(function(){return ed(e,null,null,i,n).renderAsync(e._scenegraph.root)}):Promise.reject("Unrecognized renderer type: "+t)}function id(e){return+e||0}var ad,od,ud,sd,ld,cd="outer",fd=["value","update","react","bind"];function dd(e,t){Ue(e+' for "outer" push: '+Q(t))}function hd(t,e){var n=t.name;if(t.push===cd)e.signals[n]||dd("No prior signal definition",n),fd.forEach(function(e){void 0!==t[e]&&dd("Invalid property ",e)});else{var r=e.addSignal(n,t.value);!1===t.react&&(r.react=!1),t.bind&&e.addBinding(n,t.bind)}}function pd(e){this.type=e}pd.prototype.visit=function(e){var t,n,r;if(e(this))return 1;for(n=0,r=(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case"CallExpression":var t=e.arguments.slice();return t.unshift(e.callee),t;case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this)).length;n<r;++n)if(t[n].visit(e))return 1};var md=1,gd=2,vd=3,yd=4,bd=5,xd=6,_d=7,wd=8;(ad={})[md]="Boolean",ad[gd]="<end>",ad[vd]="Identifier",ad[yd]="Keyword",ad[bd]="Null",ad[xd]="Numeric",ad[_d]="Punctuator",ad[wd]="String",ad[9]="RegularExpression";var kd="ArrayExpression",Md="BinaryExpression",Od="CallExpression",Ed="ConditionalExpression",Rd="Identifier",Sd="Literal",zd="LogicalExpression",Dd="MemberExpression",Ad="ObjectExpression",Cd="Property",Pd="UnaryExpression",qd="Unexpected token %0",Ld="Unexpected number",Td="Unexpected string",Fd="Unexpected identifier",Nd="Unexpected reserved word",Id="Unexpected end of input",jd="Invalid regular expression",Ud="Invalid regular expression: missing /",Bd="Octal literals are not allowed in strict mode.",$d="Duplicate data property in object literal not allowed in strict mode",Gd="ILLEGAL",Wd="Disabled.",Yd=new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢲऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]"),Hd=new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԯԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠ-ࢲࣤ-ॣ०-९ॱ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఀ-ఃఅ-ఌఎ-ఐఒ-నప-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಁ-ಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲഁ-ഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟ෦-෯ෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤞᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧ᪰-᪽ᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶ᳸᳹ᴀ-᷵᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚝꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꧠ-ꧾꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︭︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]");function Vd(e,t){if(!e)throw new Error("ASSERT: "+t)}function Xd(e){return 48<=e&&e<=57}function Jd(e){return 0<="0123456789abcdefABCDEF".indexOf(e)}function Qd(e){return 0<="01234567".indexOf(e)}function Kd(e){return 10===e||13===e||8232===e||8233===e}function Zd(e){return 36===e||95===e||65<=e&&e<=90||97<=e&&e<=122||92===e||128<=e&&Yd.test(String.fromCharCode(e))}function eh(e){return 36===e||95===e||65<=e&&e<=90||97<=e&&e<=122||48<=e&&e<=57||92===e||128<=e&&Hd.test(String.fromCharCode(e))}var th={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function nh(){for(var e,t;ud<sd&&(e=od.charCodeAt(ud),32===(t=e)||9===t||11===t||12===t||160===t||5760<=t&&0<=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)||Kd(e));)++ud}function rh(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)ud<sd&&Jd(od[ud])?(r=od[ud++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):yh({},qd,Gd);return String.fromCharCode(i)}function ih(){var e,t,n,r;for(t=0,"}"===(e=od[ud])&&yh({},qd,Gd);ud<sd&&Jd(e=od[ud++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(1114111<t||"}"!==e)&&yh({},qd,Gd),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function ah(){var e,t;for(e=od.charCodeAt(ud++),t=String.fromCharCode(e),92===e&&(117!==od.charCodeAt(ud)&&yh({},qd,Gd),++ud,(e=rh("u"))&&"\\"!==e&&Zd(e.charCodeAt(0))||yh({},qd,Gd),t=e);ud<sd&&eh(e=od.charCodeAt(ud));)++ud,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==od.charCodeAt(ud)&&yh({},qd,Gd),++ud,(e=rh("u"))&&"\\"!==e&&eh(e.charCodeAt(0))||yh({},qd,Gd),t+=e);return t}function oh(){var e,t;return e=ud,{type:1===(t=92===od.charCodeAt(ud)?ah():function(){var e,t;for(e=ud++;ud<sd;){if(92===(t=od.charCodeAt(ud)))return ud=e,ah();if(!eh(t))break;++ud}return od.slice(e,ud)}()).length?vd:th.hasOwnProperty(t)?yd:"null"===t?bd:"true"===t||"false"===t?md:vd,value:t,start:e,end:ud}}function uh(){var e,t,n,r,i=ud,a=od.charCodeAt(ud),o=od[ud];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++ud,{type:_d,value:String.fromCharCode(a),start:i,end:ud};default:if(61===(e=od.charCodeAt(ud+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return ud+=2,{type:_d,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:ud};case 33:case 61:return ud+=2,61===od.charCodeAt(ud)&&++ud,{type:_d,value:od.slice(i,ud),start:i,end:ud}}}return">>>="===(r=od.substr(ud,4))?{type:_d,value:r,start:i,end:ud+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:_d,value:n,start:i,end:ud+=3}:o===(t=n.substr(0,2))[1]&&0<="+-<>&|".indexOf(o)||"=>"===t?{type:_d,value:t,start:i,end:ud+=2}:0<="<>=!+-*%&|^/".indexOf(o)?{type:_d,value:o,start:i,end:++ud}:void yh({},qd,Gd)}function sh(){var e,t,n;if(Vd(Xd((n=od[ud]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=ud,e="","."!==n){if(e=od[ud++],n=od[ud],"0"===e){if("x"===n||"X"===n)return++ud,function(e){for(var t="";ud<sd&&Jd(od[ud]);)t+=od[ud++];return 0===t.length&&yh({},qd,Gd),Zd(od.charCodeAt(ud))&&yh({},qd,Gd),{type:xd,value:parseInt("0x"+t,16),start:e,end:ud}}(t);if(Qd(n))return function(e){for(var t="0"+od[ud++];ud<sd&&Qd(od[ud]);)t+=od[ud++];return(Zd(od.charCodeAt(ud))||Xd(od.charCodeAt(ud)))&&yh({},qd,Gd),{type:xd,value:parseInt(t,8),octal:!0,start:e,end:ud}}(t);n&&Xd(n.charCodeAt(0))&&yh({},qd,Gd)}for(;Xd(od.charCodeAt(ud));)e+=od[ud++];n=od[ud]}if("."===n){for(e+=od[ud++];Xd(od.charCodeAt(ud));)e+=od[ud++];n=od[ud]}if("e"===n||"E"===n)if(e+=od[ud++],"+"!==(n=od[ud])&&"-"!==n||(e+=od[ud++]),Xd(od.charCodeAt(ud)))for(;Xd(od.charCodeAt(ud));)e+=od[ud++];else yh({},qd,Gd);return Zd(od.charCodeAt(ud))&&yh({},qd,Gd),{type:xd,value:parseFloat(e),start:t,end:ud}}function lh(){var e,t,n,r;return ld=null,nh(),e=ud,t=function(){var e,t,n,r;for(Vd("/"===(e=od[ud]),"Regular expression literal must start with a slash"),t=od[ud++],r=n=!1;ud<sd;)if(t+=e=od[ud++],"\\"===e)Kd((e=od[ud++]).charCodeAt(0))&&yh({},Ud),t+=e;else if(Kd(e.charCodeAt(0)))yh({},Ud);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||yh({},Ud),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(n=t="";ud<sd&&eh((e=od[ud]).charCodeAt(0));)++ud,"\\"===e&&ud<sd?yh({},qd,Gd):(n+=e,t+=e);return 0<=n.search(/[^gimuy]/g)&&yh({},jd,n),{value:n,literal:t}}(),r=function(e,t){var n=e;0<=t.indexOf("u")&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(e,t){if(parseInt(t,16)<=1114111)return"x";yh({},jd)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:ud}}function ch(){var e;return nh(),sd<=ud?{type:gd,start:ud,end:ud}:Zd(e=od.charCodeAt(ud))?oh():40===e||41===e||59===e?uh():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(Vd("'"===(e=od[ud])||'"'===e,"String literal must starts with a quote"),t=ud,++ud;ud<sd;){if((n=od[ud++])===e){e="";break}if("\\"===n)if((n=od[ud++])&&Kd(n.charCodeAt(0)))"\r"===n&&"\n"===od[ud]&&++ud;else switch(n){case"u":case"x":"{"===od[ud]?(++ud,i+=ih()):i+=rh(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:Qd(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),ud<sd&&Qd(od[ud])&&(a=!0,r=8*r+"01234567".indexOf(od[ud++]),0<="0123".indexOf(n)&&ud<sd&&Qd(od[ud])&&(r=8*r+"01234567".indexOf(od[ud++]))),i+=String.fromCharCode(r)):i+=n}else{if(Kd(n.charCodeAt(0)))break;i+=n}}return""!==e&&yh({},qd,Gd),{type:wd,value:i,octal:a,start:t,end:ud}}():46===e?Xd(od.charCodeAt(ud+1))?sh():uh():Xd(e)?sh():uh()}function fh(){var e;return ud=(e=ld).end,ld=ch(),ud=e.end,e}function dh(){var e;e=ud,ld=ch(),ud=e}function hh(e,t,n){var r=new pd("||"===e||"&&"===e?zd:Md);return r.operator=e,r.left=t,r.right=n,r}function ph(e){var t=new pd(Rd);return t.name=e,t}function mh(e){var t=new pd(Sd);return t.value=e.value,t.raw=od.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function gh(e,t,n){var r=new pd(Dd);return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function vh(e,t,n){var r=new pd(Cd);return r.key=t,r.value=n,r.kind=e,r}function yh(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,function(e,t){return Vd(t<r.length,"Message reference must be in range"),r[t]});throw(n=new Error(i)).index=ud,n.description=i,n}function bh(e){e.type===gd&&yh(e,Id),e.type===xd&&yh(e,Ld),e.type===wd&&yh(e,Td),e.type===vd&&yh(e,Fd),e.type===yd&&yh(e,Nd),yh(e,qd,e.value)}function xh(e){var t=fh();t.type===_d&&t.value===e||bh(t)}function _h(e){return ld.type===_d&&ld.value===e}function wh(e){return ld.type===yd&&ld.value===e}function kh(){var e,t,n=[];for(ud=ld.start,xh("[");!_h("]");)_h(",")?(fh(),n.push(null)):(n.push(Ph()),_h("]")||xh(","));return fh(),e=n,(t=new pd(kd)).elements=e,t}function Mh(){var e;return ud=ld.start,(e=fh()).type===wd||e.type===xd?(e.octal&&yh(e,Bd),mh(e)):ph(e.value)}function Oh(){var e,t,n,r,i,a,o,u=[],s={},l=String;for(ud=ld.start,xh("{");!_h("}");)i=r=n=void 0,ud=ld.start,t="$"+((e=(n=ld).type===vd?(i=Mh(),xh(":"),vh("init",i,Ph())):n.type!==gd&&n.type!==_d?(r=Mh(),xh(":"),vh("init",r,Ph())):void bh(n)).key.type===Rd?e.key.name:l(e.key.value)),Object.prototype.hasOwnProperty.call(s,t)?yh({},$d):s[t]=!0,u.push(e),_h("}")||xh(",");return xh("}"),a=u,(o=new pd(Ad)).properties=a,o}var Eh={if:1,this:1};function Rh(){var e,t,n,r;if(_h("("))return xh("("),r=qh(),xh(")"),r;if(_h("["))return kh();if(_h("{"))return Oh();if(e=ld.type,ud=ld.start,e===vd||Eh[ld.value])n=ph(fh().value);else if(e===wd||e===xd)ld.octal&&yh(ld,Bd),n=mh(fh());else{if(e===yd)throw new Error(Wd);e===md?((t=fh()).value="true"===t.value,n=mh(t)):e===bd?((t=fh()).value=null,n=mh(t)):_h("/")||_h("/=")?(n=mh(lh()),dh()):bh(fh())}return n}function Sh(){var e=[];if(xh("("),!_h(")"))for(;ud<sd&&(e.push(Ph()),!_h(")"));)xh(",");return xh(")"),e}function zh(){var e,t;return ud=ld.start,e=fh(),(t=e).type!==vd&&t.type!==yd&&t.type!==md&&t.type!==bd&&bh(e),ph(e.value)}function Dh(){var e=function(){var e,t,n,r,i,a;for(e=Rh();;)if(_h("."))xh("."),e=gh(".",e,zh());else if(_h("("))t=Sh(),r=e,i=t,a=void 0,(a=new pd(Od)).callee=r,a.arguments=i,e=a;else{if(!_h("["))break;n=void 0,xh("["),n=qh(),xh("]"),e=gh("[",e,n)}return e}();if(ld.type===_d&&(_h("++")||_h("--")))throw new Error(Wd);return e}function Ah(){var e,t,n,r,i;if(ld.type!==_d&&ld.type!==yd)t=Dh();else{if(_h("++")||_h("--"))throw new Error(Wd);if(_h("+")||_h("-")||_h("~")||_h("!"))e=fh(),t=Ah(),n=e.value,r=t,(i=new pd(Pd)).operator=n,i.argument=r,i.prefix=!0,t=i;else{if(wh("delete")||wh("void")||wh("typeof"))throw new Error(Wd);t=Dh()}}return t}function Ch(e){var t=0;if(e.type!==_d&&e.type!==yd)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function Ph(){var e,t,n,r,i,a,o;return e=function(){var e,t,n,r,i,a,o,u,s,l;if(e=ld,s=Ah(),0===(i=Ch(r=ld)))return s;for(r.prec=i,fh(),t=[e,ld],a=[s,r,o=Ah()];0<(i=Ch(ld));){for(;2<a.length&&i<=a[a.length-2].prec;)o=a.pop(),u=a.pop().value,s=a.pop(),t.pop(),n=hh(u,s,o),a.push(n);(r=fh()).prec=i,a.push(r),t.push(ld),n=Ah(),a.push(n)}for(n=a[l=a.length-1],t.pop();1<l;)t.pop(),n=hh(a[l-1].value,a[l-2],n),l-=2;return n}(),_h("?")&&(fh(),t=Ph(),xh(":"),n=Ph(),r=e,i=t,a=n,(o=new pd(Ed)).test=r,o.consequent=i,o.alternate=a,e=o),e}function qh(){var e=Ph();if(_h(","))throw new Error(Wd);return e}var Lh={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function Th(l){function e(o,u,s){return function(e){return t=o,r=u,i=s,a=l((n=e)[0]),r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+t+(i<0?"":0===i?"()":"("+n.slice(1).map(l).join(",")+")");var t,n,r,i,a}}var t="new Date",n="String";return{isNaN:"isNaN",isFinite:"isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(e){e.length<3&&Ue("Missing arguments to clamp function."),3<e.length&&Ue("Too many arguments to clamp function.");var t=e.map(l);return"Math.max("+t[1]+", Math.min("+t[2]+","+t[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:t,date:e("getDate",t,0),day:e("getDay",t,0),year:e("getFullYear",t,0),month:e("getMonth",t,0),hours:e("getHours",t,0),minutes:e("getMinutes",t,0),seconds:e("getSeconds",t,0),milliseconds:e("getMilliseconds",t,0),time:e("getTime",t,0),timezoneoffset:e("getTimezoneOffset",t,0),utcdate:e("getUTCDate",t,0),utcday:e("getUTCDay",t,0),utcyear:e("getUTCFullYear",t,0),utcmonth:e("getUTCMonth",t,0),utchours:e("getUTCHours",t,0),utcminutes:e("getUTCMinutes",t,0),utcseconds:e("getUTCSeconds",t,0),utcmilliseconds:e("getUTCMilliseconds",t,0),length:e("length",null,-1),indexof:e("indexOf",null),lastindexof:e("lastIndexOf",null),slice:e("slice",null),parseFloat:"parseFloat",parseInt:"parseInt",upper:e("toUpperCase",n,0),lower:e("toLowerCase",n,0),substring:e("substring",n),replace:e("replace",n),regexp:"RegExp",test:e("test","RegExp"),if:function(e){e.length<3&&Ue("Missing arguments to if function."),3<e.length&&Ue("Too many arguments to if function.");var t=e.map(l);return"("+t[0]+"?"+t[1]+":"+t[2]+")"}}}var Fh={};function Nh(e,t,n){var r=e+":"+n,i=Fh[r];return i&&i[0]===t||(Fh[r]=i=[t,t(n)]),i[1]}function Ih(e,t){return Nh("timeFormat",f.timeFormat,t)(e)}var jh=new Date(2e3,0,1);function Uh(e,t,n){return jh.setMonth(e),jh.setDate(t),Ih(jh,n)}function Bh(t,e,n){try{t[e].apply(t,["EXPRESSION"].concat([].slice.call(n)))}catch(e){t.warn(e)}return n[n.length-1]}var $h="undefined"!=typeof window&&window||null;var Gh="Literal",Wh="%",Yh=":";function Hh(e,t,n){var r=e-t+2*n;return e?0<r?r:1:0}function Vh(){var o,l,n=x.scaleOrdinal().unknown(void 0),c=n.domain,f=n.range,d=[0,1],u=!1,s=0,h=0,p=.5;function t(){var e=c().length,t=d[1]<d[0],n=d[t-0],r=d[1-t],i=Hh(e,s,h);o=(r-n)/(i||1),u&&(o=Math.floor(o)),n+=(r-n-o*(e-s))*p,l=o*(1-s),u&&(n=Math.round(n),l=Math.round(l));var a=v.range(e).map(function(e){return n+o*e});return f(t?a.reverse():a)}return delete n.unknown,n.domain=function(e){return arguments.length?(c(e),t()):c()},n.range=function(e){return arguments.length?(d=[+e[0],+e[1]],t()):d.slice()},n.rangeRound=function(e){return d=[+e[0],+e[1]],u=!0,t()},n.bandwidth=function(){return l},n.step=function(){return o},n.round=function(e){return arguments.length?(u=!!e,t()):u},n.padding=function(e){return arguments.length?(h=Math.max(0,Math.min(1,e)),s=h,t()):s},n.paddingInner=function(e){return arguments.length?(s=Math.max(0,Math.min(1,e)),t()):s},n.paddingOuter=function(e){return arguments.length?(h=Math.max(0,Math.min(1,e)),t()):h},n.align=function(e){return arguments.length?(p=Math.max(0,Math.min(1,e)),t()):p},n.invertRange=function(e){if(null!=e[0]&&null!=e[1]){var t,n,r,i=+e[0],a=+e[1],o=d[1]<d[0],u=o?f().reverse():f(),s=u.length-1;if(i==i&&a==a&&(a<i&&(r=i,i=a,a=r),!(a<u[0]||i>d[1-o])))return t=Math.max(0,v.bisectRight(u,i)-1),n=i===a?t:v.bisectRight(u,a)-1,i-u[t]>l+1e-10&&++t,o&&(r=t,t=s-n,n=s-r),n<t?void 0:c().slice(t,n+1)}},n.invert=function(e){var t=n.invertRange([e,e]);return t?t[0]:t},n.copy=function(){return Vh().domain(c()).range(d).round(u).paddingInner(s).paddingOuter(h).align(p)},t()}var Xh=Array.prototype.map,Jh=Array.prototype.slice;function Qh(e){return Xh.call(e,function(e){return+e})}function Kh(e,t){return 1<arguments.length?(Zh[e]=(n=e,r=t,function(){var l,i,e=r();return e.invertRange||(e.invertRange=e.invert?(i=e,function(e){var t,n=e[0],r=e[1];return r<n&&(t=n,n=r,r=t),[i.invert(n),i.invert(r)]}):e.invertExtent?(l=e,function(e){var t,n,r,i,a=l.range(),o=e[0],u=e[1],s=-1;for(u<o&&(n=o,o=u,u=n),r=0,i=a.length;r<i;++r)a[r]>=o&&a[r]<=u&&(s<0&&(s=r),t=r);if(!(s<0))return o=l.invertExtent(a[s]),u=l.invertExtent(a[t]),[void 0===o[0]?o[1]:o[0],void 0===u[1]?u[0]:u[1]]}):void 0),e.type=n,e}),this):Zh.hasOwnProperty(e)?Zh[e]:void 0;var n,r}var Zh={identity:x.scaleIdentity,linear:x.scaleLinear,log:x.scaleLog,ordinal:x.scaleOrdinal,pow:x.scalePow,sqrt:x.scaleSqrt,quantile:x.scaleQuantile,quantize:x.scaleQuantize,threshold:x.scaleThreshold,time:x.scaleTime,utc:x.scaleUtc,band:Vh,point:function(){return function e(t){var n=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return e(n())},t}(Vh().paddingInner(1))},sequential:function e(n){var r=x.scaleLinear(),i=0,a=1,o=!1;function t(){var e=r.domain();i=e[0],a=I(e)-i}function u(e){var t=(e-i)/a;return n(o?Math.max(0,Math.min(1,t)):t)}return u.clamp=function(e){return arguments.length?(o=!!e,u):o},u.domain=function(e){return arguments.length?(r.domain(e),t(),u):r.domain()},u.interpolator=function(e){return arguments.length?(n=e,u):n},u.copy=function(){return e().domain(r.domain()).clamp(o).interpolator(n)},u.ticks=function(e){return r.ticks(e)},u.tickFormat=function(e,t){return r.tickFormat(e,t)},u.nice=function(e){return r.nice(e),t(),u},u},"bin-linear":function e(){var t=x.scaleLinear(),r=[];function i(e){return t(e)}return i.domain=function(e){return arguments.length?(r=Qh(e),t.domain([r[0],I(r)]),i):r.slice()},i.range=function(e){return arguments.length?(t.range(e),i):t.range()},i.rangeRound=function(e){return arguments.length?(t.rangeRound(e),i):t.rangeRound()},i.interpolate=function(e){return arguments.length?(t.interpolate(e),i):t.interpolate()},i.invert=function(e){return t.invert(e)},i.ticks=function(e){var t=r.length,n=~~(t/(e||t));return n<2?i.domain():r.filter(function(e,t){return!(t%n)})},i.tickFormat=function(){return t.tickFormat.apply(t,arguments)},i.copy=function(){return e().domain(i.domain()).range(i.range())},i},"bin-ordinal":function e(){var t=[],n=[];function r(e){return null==e||e!=e?void 0:n[(v.bisect(t,e)-1)%n.length]}return r.domain=function(e){return arguments.length?(t=Qh(e),r):t.slice()},r.range=function(e){return arguments.length?(n=Jh.call(e),r):n.slice()},r.copy=function(){return e().domain(r.domain()).range(r.range())},r}};for(var ep in Zh)Kh(ep,Zh[ep]);function tp(e){for(var t=e.length/6|0,n=new Array(t),r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}var np=tp("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5"),rp=tp("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6"),ip=tp("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9"),ap=tp("4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac"),op=tp("4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5"),up=new Array(3).concat("67a9cff7f7f7f1a340","0571b092c5defdb863e66101","0571b092c5def7f7f7fdb863e66101","2166ac67a9cfd1e5f0fee0b6f1a340b35806","2166ac67a9cfd1e5f0f7f7f7fee0b6f1a340b35806","2166ac4393c392c5ded1e5f0fee0b6fdb863e08214b35806","2166ac4393c392c5ded1e5f0f7f7f7fee0b6fdb863e08214b35806","0530612166ac4393c392c5ded1e5f0fee0b6fdb863e08214b358067f3b08","0530612166ac4393c392c5ded1e5f0f7f7f7fee0b6fdb863e08214b358067f3b08").map(tp),sp={blueorange:up},lp={category10:r.schemeCategory10,accent:r.schemeAccent,dark2:r.schemeDark2,paired:r.schemePaired,pastel1:r.schemePastel1,pastel2:r.schemePastel2,set1:r.schemeSet1,set2:r.schemeSet2,set3:r.schemeSet3,category20:np,category20b:rp,category20c:ip,tableau10:ap,tableau20:op,viridis:r.interpolateViridis,magma:r.interpolateMagma,inferno:r.interpolateInferno,plasma:r.interpolatePlasma,blueorange:l.interpolateRgbBasis(I(up))};function cp(e,t){lp[e]=r["interpolate"+t],sp[e]=r["scheme"+t]}function fp(t,e){var n=e-t;return function(e){return t+e*n}}function dp(e,t){var n;return te(e)?e:m(e)?(n=t.scales[e])&&n.value:void 0}function hp(e,t,n){var r=Wh+n;if(!t.hasOwnProperty(r))try{t[r]=e.scaleRef(n)}catch(e){}}function pp(e,t,n,r){if(t[0].type===Gh)hp(n,r,t[0].value);else if("Identifier"===t[0].type)for(e in n.scales)hp(n,r,e)}function mp(i,a){return function(e,t,n){if(e){var r=dp(e,(n||this).context);return r&&r.path[i](t)}return a(t)}}cp("blues","Blues"),cp("greens","Greens"),cp("greys","Greys"),cp("purples","Purples"),cp("reds","Reds"),cp("oranges","Oranges"),cp("brownbluegreen","BrBG"),cp("purplegreen","PRGn"),cp("pinkyellowgreen","PiYG"),cp("purpleorange","PuOr"),cp("redblue","RdBu"),cp("redgrey","RdGy"),cp("redyellowblue","RdYlBu"),cp("redyellowgreen","RdYlGn"),cp("spectral","Spectral"),cp("bluegreen","BuGn"),cp("bluepurple","BuPu"),cp("greenblue","GnBu"),cp("orangered","OrRd"),cp("purplebluegreen","PuBuGn"),cp("purpleblue","PuBu"),cp("purplered","PuRd"),cp("redpurple","RdPu"),cp("yellowgreenblue","YlGnBu"),cp("yellowgreen","YlGn"),cp("yelloworangebrown","YlOrBr"),cp("yelloworangered","YlOrRd");var gp=mp("area",a.geoArea),vp=mp("bounds",a.geoBounds),yp=mp("centroid",a.geoCentroid);function bp(e){var t=this.context.data[e];return t?t.values.value:[]}function xp(e,t,n,r){t[0].type!==Gh&&Ue("First argument to data functions must be a string literal.");var i=t[0].value,a=Yh+i;r.hasOwnProperty(a)||(r[a]=n.getData(i).tuplesRef())}var _p={};function wp(e){return e.data}function kp(e,t){var n=bp.call(t,e);return n.root&&n.root.lookup||_p}function Mp(e,t,n,r){var i,a=t[0],o=t[t.length-1];return o<a&&(i=a,a=o,o=i),r=void 0===r||r,((n=void 0===n||n)?a<=e:a<e)&&(r?e<=o:e<o)}function Op(e,t){return e===t||e!=e&&t!=t||!(!h(e)||!h(t)||e.length!==t.length)&&function(e,t){for(var n=0,r=e.length;n<r;++n)if(!Op(e[n],t[n]))return!1;return!0}(e,t)}function Ep(n){return function(e){for(var t in n)if(!Op(e[t],n[t]))return!1;return!0}}var Rp="bin_",Sp="intersect",zp="union",Dp="index:unit";function Ap(e,t){for(var n,r=t.fields,i=t.values,a=t.getter||(t.getter=[]),o=r.length,u=0;u<o;++u)if(a[u]=a[u]||M(r[u]),ce(n=a[u](e))&&(n=j(n)),ce(i[u])&&(i[u]=j(i[u])),t[Rp+r[u]]){if(ce(i[u][0])&&(i[u]=i[u].map(j)),!Mp(n,i[u],!0,!1))return!1}else if(n!==i[u])return!1;return!0}function Cp(e,t){for(var n,r,i=t.intervals,a=i.length,o=0;o<a;++o){if(n=i[o].extent,r=(i[o].getter||(i[o].getter=M(i[o].field)))(e),!n||n[0]===n[1])return!1;if(ce(r)&&(r=j(r)),ce(n[0])&&(n=i[o].extent=n.map(j)),fe(n[0])&&!Mp(r,n))return!1;if(m(n[0])&&n.indexOf(r)<0)return!1}return!0}function Pp(e,t,n,r){for(var i,a,o,u,s,l=this.context.data[e],c=l?l.values.value:[],f=l?l[Dp]&&l[Dp].value:void 0,d=n===Sp,h=c.length,p=0;p<h;++p)if(i=c[p],f&&d){if(-1===(o=(a=a||{})[u=i.unit]||0))continue;if(s=r(t,i),a[u]=s?-1:++o,s&&1===f.size)return!0;if(!s&&o===f.get(u).count)return!1}else if(d^(s=r(t,i)))return s;return h&&d}function qp(e,t,n){return Pp.call(this,e,t,n,Ap)}function Lp(e,t,n,r){t[0].type!==Gh&&Ue("First argument to indata must be a string literal.");var i=t[0].value;(2<=t.length&&t[t.length-1].value)!==Sp||r.hasOwnProperty("@unit")||(r["@unit"]=n.getData(i).indataRef(n,"unit")),xp(0,t,n,r)}function Tp(e,t,n,r){var i,a,o,u,s,l=this.context.data[e],c=l?l.values.value:[],f=l?l[Dp]&&l[Dp].value:void 0,d=c[0],h=0;if(d){for(i=t?d.encodings.length:d.fields.length;h<i;++h)if(t&&d.encodings[h]===t||n&&d.fields[h]===n){a=h,u=d[Rp+d.fields[h]];break}return f&&1===f.size&&(r=zp),f&&r===Sp?(s=c.reduce(function(e,t){return(e[t.unit]||(e[t.unit]=[])).push({unit:t.unit,value:t.values[a]}),e},{}),o=Object.keys(s).map(function(e){return{unit:e,value:u?Np(s[e],zp):Fp(s[e],zp)}})):o=c.map(function(e){return{unit:e.unit,value:e.values[a]}}),u?Np(o,r):Fp(o,r)}}function Fp(e,t){for(var n,r,i,a,o={},u=0,s={},l=[],c=0,f=e.length;c<f;++c)r=(n=e[c]).unit,a=n.value,o[r]||(o[r]=++u),(i=s[a])||(s[a]=i={value:a,units:{},count:0}),i.units[r]||(i.units[r]=++i.count);for(a in s)i=s[a],t===Sp&&i.count!==u||l.push(i.value);return l.length?l:void 0}function Np(e,t){for(var n,r,i,a,o=t===Sp?jp:Ip,u=0,s=e.length;u<s;++u)ce((n=e[u].value)[0])&&(n=n.map(j)),i=n[0],(a=n[1])<i&&(a=n[0],i=n[1]),r=r?o(r,i,a):[i,a];return r&&r.length&&+r[0]!=+r[1]?r:void 0}function Ip(e,t,n){return e[0]>t&&(e[0]=t),e[1]<n&&(e[1]=n),e}function jp(e,t,n){return n<e[0]||e[1]<t?[]:(e[0]<t&&(e[0]=t),e[1]>n&&(e[1]=n),e)}var Up={random:function(){return y.random()},isArray:h,isBoolean:le,isDate:ce,isNumber:fe,isObject:J,isRegExp:de,isString:m,isTuple:Re,toBoolean:ve,toDate:be,toNumber:j,toString:xe,pad:ge,peek:I,truncate:we,rgb:i.rgb,lab:i.lab,hcl:i.hcl,hsl:i.hsl,sequence:v.range,format:function(e,t){return Nh("format",u.format,t)(e)},utcFormat:function(e,t){return Nh("utcFormat",f.utcFormat,t)(e)},utcParse:function(e,t){return Nh("utcParse",f.utcParse,t)(e)},timeFormat:Ih,timeParse:function(e,t){return Nh("timeParse",f.timeParse,t)(e)},monthFormat:function(e){return Uh(e,1,"%B")},monthAbbrevFormat:function(e){return Uh(e,1,"%b")},dayFormat:function(e){return Uh(0,2+e,"%A")},dayAbbrevFormat:function(e){return Uh(0,2+e,"%a")},quarter:function(e){return 1+~~(new Date(e).getMonth()/3)},utcquarter:function(e){return 1+~~(new Date(e).getUTCMonth()/3)},warn:function(){return Bh(this.context.dataflow,"warn",arguments)},info:function(){return Bh(this.context.dataflow,"info",arguments)},debug:function(){return Bh(this.context.dataflow,"debug",arguments)},inScope:function(e){var t=this.context.group,n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},clampRange:function(e,t,n){var r,i=e[0],a=e[1];return a<i&&(r=a,a=i,i=r),n-t<=(r=a-i)?[t,n]:[Math.min(Math.max(i,t),n-r),Math.min(Math.max(a,r),n)]},pinchDistance:function(e){var t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){var t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){return $h?$h.screen:{}},containerSize:function(){var e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){return $h?[$h.innerWidth,$h.innerHeight]:[void 0,void 0]},span:function(e){return e[e.length-1]-e[0]||0},merge:function(){var e=[].slice.call(arguments);return e.unshift({}),Be.apply(null,e)},flush:function(e,t,n,r,i,a){var o,u,s=e[0],l=I(e);return l<s&&(o=s,s=l,l=o),(o=Math.abs(t-s))<(u=Math.abs(l-t))&&o<=n?r:u<=n?i:a},bandspace:function(e,t,n){return Hh(e||0,t||0,n||0)},inrange:Mp,setdata:function(e,t){var n=this.context.dataflow,r=this.context.data[e].input;return n.pulse(r,n.changeset().remove(D).insert(t)),1},pathShape:function(t){var n=null;return function(e){return e?ki(e,n=n||gi(t)):t}},panLinear:W,panLog:Y,panPow:H,zoomLinear:X,zoomLog:K,zoomPow:Z,encode:function(e,t,n){if(e){var r=this.context.dataflow,i=e.mark.source;r.pulse(i,r.changeset().encode(e,t))}return void 0!==n?n:e},modify:function(e,t,n,r,i,a){var o,u,s=this.context.dataflow,l=this.context.data[e],c=l.input,f=l.changes,d=s.stamp();if(!1===s._trigger||!(c.value.length||t||r))return 0;if((!f||f.stamp<d)&&(l.changes=f=s.changeset(),f.stamp=d,s.runAfter(function(){l.modified=!0,s.pulse(c,f).run()},!0,1)),n&&(o=!0===n?D:h(n)||Re(n)?n:Ep(n),f.remove(o)),t&&f.insert(t),r&&(o=Ep(r),c.value.some(o)?f.remove(o):f.insert(r)),i)for(u in a)f.modify(i,u,a[u]);return 1}},Bp=["view","item","group","xy","x","y"],$p={};function Gp(e,t,n){return 1===arguments.length?Up[e]:(Up[e]=t,n&&($p[e]=n),Yp&&(Yp.functions[e]="this."+e),this)}Gp("bandwidth",function(e,t){var n=dp(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0},pp),Gp("copy",function(e,t){var n=dp(e,(t||this).context);return n?n.copy():void 0},pp),Gp("domain",function(e,t){var n=dp(e,(t||this).context);return n?n.domain():[]},pp),Gp("range",function(e,t){var n=dp(e,(t||this).context);return n&&n.range?n.range():[]},pp),Gp("invert",function(e,t,n){var r=dp(e,(n||this).context);return r?h(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0},pp),Gp("scale",function(e,t,n){var r=dp(e,(n||this).context);return r?r(t):void 0},pp),Gp("gradient",function(e,t,n,r,i){e=dp(e,(i||this).context);var a,o,u,s,l=ri(t,n),c=e.domain(),f=c[0],d=c[c.length-1],h=(a=e,(s=(u=d)-(o=f))?"linear"===a.type||"sequential"===a.type?function(e){return(e-o)/s}:a.copy().domain([o,u]).range([0,1]).interpolate(fp):re(0));e.ticks&&(f!==(c=e.ticks(+r||15))[0]&&c.unshift(f),d!==c[c.length-1]&&c.push(d));for(var p=0,m=c.length;p<m;++p)l.stop(h(c[p]),e(c[p]));return l},pp),Gp("geoArea",gp,pp),Gp("geoBounds",vp,pp),Gp("geoCentroid",yp,pp),Gp("geoShape",function(e,t,n){var r=dp(e,(n||this).context);return function(e){return r?r.path.context(e)(t):""}},pp),Gp("indata",function(e,t,n){var r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i?i.count:i},function(e,t,n,r){t[0].type!==Gh&&Ue("First argument to indata must be a string literal."),t[1].type!==Gh&&Ue("Second argument to indata must be a string literal.");var i=t[0].value,a=t[1].value,o="@"+a;r.hasOwnProperty(o)||(r[o]=n.getData(i).indataRef(n,a))}),Gp("data",bp,xp),Gp("vlSingle",qp,xp),Gp("vlSingleDomain",Tp,xp),Gp("vlMulti",qp,Lp),Gp("vlMultiDomain",Tp,Lp),Gp("vlInterval",function(e,t,n){return Pp.call(this,e,t,n,Cp)},xp),Gp("vlIntervalDomain",function(e,t,n,r){var i,a,o,u,s,l=this.context.data[e],c=l?l.values.value:[],f=c[0],d=0;if(f){for(i=f.intervals.length;d<i;++d)if(a=f.intervals[d],t&&a.encoding===t||n&&a.field===n){if(!a.extent)return;o=d,s=2<a.extent.length;break}return u=c.reduce(function(e,t){var n=t.intervals[o].extent,r=s?n.map(function(e){return{unit:t.unit,value:e}}):{unit:t.unit,value:n};return s?e.push.apply(e,r):e.push(r),e},[]),s?Fp(u,r):Np(u,r)}},xp),Gp("treePath",function(e,t,n){var r=kp(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(wp):void 0},xp),Gp("treeAncestors",function(e,t){var n=kp(e,this)[t];return n?n.ancestors().map(wp):void 0},xp);var Wp={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:function(e){return"_["+Q("$"+e)+"]"},functions:function(e){var t=Th(e);for(var n in Bp.forEach(function(e){t[e]="event.vega."+e}),Up)t[n]="this."+n;return t},constants:Lh,visitors:$p},Yp=function(e){var n=(e=e||{}).whitelist?_e(e.whitelist):{},r=e.blacklist?_e(e.blacklist):{},i=e.constants||Lh,a=(e.functions||Th)(f),t=e.globalvar,o=e.fieldvar,u={},s={},l=0,c=te(t)?t:function(e){return t+'["'+e+'"]'};function f(e){if(m(e))return e;var t=d[e.type];return null==t&&Ue("Unsupported type: "+e.type),t(e)}var d={Literal:function(e){return e.raw},Identifier:function(e){var t=e.name;return 0<l?t:r.hasOwnProperty(t)?Ue("Illegal identifier: "+t):i.hasOwnProperty(t)?i[t]:n.hasOwnProperty(t)?t:(u[t]=1,c(t))},MemberExpression:function(e){var t=!e.computed,n=f(e.object);t&&(l+=1);var r=f(e.property);return n===o&&(s[r]=1),t&&(l-=1),n+(t?"."+r:"["+r+"]")},CallExpression:function(e){"Identifier"!==e.callee.type&&Ue("Illegal callee type: "+e.callee.type);var t=e.callee.name,n=e.arguments,r=a.hasOwnProperty(t)&&a[t];return r||Ue("Unrecognized function: "+t),te(r)?r(n):r+"("+n.map(f).join(",")+")"},ArrayExpression:function(e){return"["+e.elements.map(f).join(",")+"]"},BinaryExpression:function(e){return"("+f(e.left)+e.operator+f(e.right)+")"},UnaryExpression:function(e){return"("+e.operator+f(e.argument)+")"},ConditionalExpression:function(e){return"("+f(e.test)+"?"+f(e.consequent)+":"+f(e.alternate)+")"},LogicalExpression:function(e){return"("+f(e.left)+e.operator+f(e.right)+")"},ObjectExpression:function(e){return"{"+e.properties.map(f).join(",")+"}"},Property:function(e){l+=1;var t=f(e.key);return l-=1,t+":"+f(e.value)}};function h(e){var t={code:f(e),globals:Object.keys(u),fields:Object.keys(s)};return u={},s={},t}return h.functions=a,h.constants=i,h}(Wp),Hp="$";function Vp(t,r,e){var n,i,a={};try{n=function(e){ud=0,sd=(od=e).length,ld=null,dh();var t=qh();if(ld.type!==gd)throw new Error("Unexpect token after expression.");return t}(t=m(t)?t:Q(t)+"")}catch(e){Ue("Expression parse error: "+t)}return n.visit(function(e){if("CallExpression"===e.type){var t=e.callee.name,n=Wp.visitors[t];n&&n(t,e.arguments,r,a)}}),(i=Yp(n)).globals.forEach(function(e){var t=Hp+e;!a.hasOwnProperty(t)&&r.getSignal(e)&&(a[t]=r.signalRef(e))}),{$expr:e?e+"return("+i.code+");":i.code,$fields:i.fields,$params:a}}function Xp(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function Jp(e,t,n,r){return new Xp(e,t,n,r)}function Qp(e,t){return Jp("operator",e,t)}function Kp(e){var t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}var Zp={$tupleid:1,toString:function(){return":_tupleid_:"}};function em(e,t){return t?{$field:e,$name:t}:{$field:e}}var tm=em("key");function nm(e,t){return{$compare:e,$order:t}}var rm="descending";function im(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}var am="scope",om="view";function um(e){return e&&e.signal}function sm(e,t){return null!=e?e:t}function lm(e){return e&&e.signal||e}var cm="timer";function fm(e,t){return(e.merge?dm:e.stream?hm:e.type?pm:Ue("Invalid stream specification: "+Q(e)))(e,t)}function dm(e,t){var n=mm({merge:e.merge.map(function(e){return fm(e,t)})},e,t);return t.addStream(n).id}function hm(e,t){var n=mm({stream:fm(e.stream,t)},e,t);return t.addStream(n).id}function pm(e,t){var n,r,i;return e.type===cm?(n=t.event(cm,e.throttle),e={between:e.between,filter:e.filter}):n=t.event((i=e.source)===am?om:i||om,e.type),r=mm({stream:n},e,t),1===Object.keys(r).length?n:t.addStream(r).id}function mm(e,t,n){var r,i,a,o,u=t.between;return u&&(2!==u.length&&Ue('Stream "between" parameter must have 2 entries: '+Q(t)),e.between=[fm(u[0],n),fm(u[1],n)]),u=t.filter?ee(t.filter):[],(t.marktype||t.markname||t.markrole)&&u.push((r=t.marktype,i=t.markname,a=t.markrole,(o="event.item")+(r&&"*"!==r?"&&"+o+".mark.marktype==='"+r+"'":"")+(a?"&&"+o+".mark.role==='"+a+"'":"")+(i?"&&"+o+".mark.name==='"+i+"'":""))),t.source===am&&u.push("inScope(event.item)"),u.length&&(e.filter=Vp("("+u.join(")&&(")+")").$expr),null!=(u=t.throttle)&&(e.throttle=+u),null!=(u=t.debounce)&&(e.debounce=+u),t.consume&&(e.consume=!0),e}var gm,vm,ym="view",bm="[",xm="]",_m="{",wm="}",km=":",Mm=",",Om="@",Em=">",Rm=/[[\]{}]/,Sm={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function zm(e,t,n,r,i){for(var a,o=0,u=e.length;t<u;++t){if(a=e[t],!o&&a===n)return t;i&&0<=i.indexOf(a)?--o:r&&0<=r.indexOf(a)&&++o}return t}function Dm(e){for(var t=[],n=0,r=e.length,i=0;i<r;)i=zm(e,i,Mm,bm+_m,xm+wm),t.push(e.substring(n,i).trim()),n=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function Am(e){return"["===e[0]?function(e){var t,n,r=e.length,i=1;if((i=zm(e,i,xm,bm,xm))===r)throw"Empty between selector: "+e;if(2!==(t=Dm(e.substring(1,i))).length)throw"Between selector must have two elements: "+e;if((e=e.slice(i+1).trim())[0]!==Em)throw"Expected '>' after between selector: "+e;{if(t=t.map(Am),(n=Am(e.slice(1).trim())).between)return{between:t,stream:n};n.between=t}return n}(e):function(t){var e,n,r={source:gm},i=[],a=[0,0],o=0,u=0,s=t.length,l=0;if(t[s-1]===wm){if(!(0<=(l=t.lastIndexOf(_m))))throw"Unmatched right brace: "+t;try{a=function(n){var e=n.split(Mm);if(!n.length||2<e.length)throw n;return e.map(function(e){var t=+e;if(t!=t)throw n;return t})}(t.substring(l+1,s-1))}catch(e){throw"Invalid throttle specification: "+t}t=t.slice(0,l).trim(),s=t.length,l=0}if(!s)throw t;t[0]===Om&&(o=++l);(e=zm(t,l,km))<s&&(i.push(t.substring(u,e).trim()),u=l=++e);if((l=zm(t,l,bm))===s)i.push(t.substring(u,s).trim());else if(i.push(t.substring(u,l).trim()),n=[],(u=++l)===s)throw"Unmatched left bracket: "+t;for(;l<s;){if((l=zm(t,l,xm))===s)throw"Unmatched left bracket: "+t;if(n.push(t.substring(u,l).trim()),l<s-1&&t[++l]!==bm)throw"Expected left bracket: "+t;u=++l}if(!(s=i.length)||Rm.test(i[s-1]))throw"Invalid event selector: "+t;1<s?(r.type=i[1],o?r.markname=i[0].slice(1):(c=i[0],vm.hasOwnProperty(c)?r.marktype=i[0]:r.source=i[0])):r.type=i[0];var c;"!"===r.type.slice(-1)&&(r.consume=!0,r.type=r.type.slice(0,-1));null!=n&&(r.filter=n);a[0]&&(r.throttle=a[0]);a[1]&&(r.debounce=a[1]);return r}(e)}var Cm="var datum=event.item&&event.item.datum;";function Pm(e,r,t){var n,i,a,o,u,s=e.events,l=e.update,c=e.encode,f=[];s||Ue("Signal update missing events specification."),m(s)&&(a=s,o=r.isSubscope()?am:om,gm=o||ym,vm=u||Sm,s=Dm(a.trim()).map(Am)),(s=ee(s).filter(function(e){return e.signal||e.scale?(f.push(e),0):1})).length&&f.push(1<s.length?{merge:s}:s[0]),null!=c&&(l&&Ue("Signal encode and update are mutually exclusive."),l="encode(item(),"+Q(c)+")"),n=m(l)?Vp(l,r,Cm):null!=l.expr?Vp(l.expr,r,Cm):null!=l.value?l.value:null!=l.signal?{$expr:"_.value",$params:{value:r.signalRef(l.signal)}}:Ue("Invalid signal update specification."),i={target:t,update:n},e.force&&(i.options={force:!0}),f.forEach(function(e){var t,n;r.addUpdate(Be((n=r,{source:(t=e).signal?n.signalRef(t.signal):t.scale?n.scaleRef(t.scale):fm(t,n)}),i))})}function qm(r){return function(e,t,n){return Jp(r,t,e||void 0,n)}}var Lm=qm("aggregate"),Tm=qm("axisticks"),Fm=qm("bound"),Nm=qm("collect"),Im=qm("compare"),jm=qm("datajoin"),Um=qm("encode"),Bm=qm("facet"),$m=qm("field"),Gm=qm("key"),Wm=qm("legendentries"),Ym=qm("mark"),Hm=qm("multiextent"),Vm=qm("multivalues"),Xm=qm("overlap"),Jm=qm("params"),Qm=qm("prefacet"),Km=qm("projection"),Zm=qm("proxy"),eg=qm("relay"),tg=qm("render"),ng=qm("scale"),rg=qm("sieve"),ig=qm("sortitems"),ag=qm("viewlayout"),og=qm("values"),ug=0,sg=["identity","ordinal","band","point","bin-linear","bin-ordinal","quantize","quantile","threshold","linear","pow","sqrt","log","sequential","time","utc"],lg=_e(sg),cg=_e(sg.slice(4,9)),fg=_e(sg.slice(9)),dg=_e(sg.slice(1,6));function hg(e){return dg.hasOwnProperty(e)}function pg(e){return cg.hasOwnProperty(e)}function mg(e){return"quantile"===e}function gg(e,t){var n,r,i,a,o=t.getScale(e.name).params;for(n in o.domain=bg(e.domain,e,t),null!=e.range&&(o.range=function e(t,n,r){var i=t.range,a=n.config.range;{if(i.signal)return n.signalRef(i.signal);if(m(i)){if(a&&a.hasOwnProperty(i))return t=Be({},t,{range:a[i]}),e(t,n,r);"width"===i?i=[0,{signal:"width"}]:"height"===i?i=hg(t.type)?[0,{signal:"height"}]:[{signal:"height"},0]:Ue("Unrecognized scale range value: "+Q(i))}else{if(i.scheme)return r.scheme=vg(i.scheme,n),i.extent&&(r.schemeExtent=(o=i.extent,u=n,o.signal?u.signalRef(o.signal):o.map(function(e){return vg(e,u)}))),void(i.count&&(r.schemeCount=vg(i.count,n)));if(i.step)return void(r.rangeStep=vg(i.step,n));if(hg(t.type)&&!h(i))return bg(i,t,n);h(i)||Ue("Unsupported range type: "+Q(i))}}var o,u;return i.map(function(e){return vg(e,n)})}(e,t,o)),null!=e.interpolate&&(r=e.interpolate,(i=o).interpolate=vg(r.type||r),null!=r.gamma&&(i.interpolateGamma=vg(r.gamma))),null!=e.nice&&(a=e.nice,o.nice=J(a)?{interval:vg(a.interval),step:vg(a.step)}:vg(a)),e)o.hasOwnProperty(n)||"name"===n||(o[n]=vg(e[n],t))}function vg(e,t){return J(e)?e.signal?t.signalRef(e.signal):Ue("Unsupported object: "+Q(e)):e}function yg(e){Ue("Can not find data set: "+Q(e))}function bg(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(h(e)?function(e,t,n){return e.map(function(e){return vg(e,n)})}:e.fields?function(e,t,n){var r=e.data,i=e.fields.reduce(function(e,t){return t=m(t)?{data:r,field:t}:h(t)||t.signal?function(e,t){var n="_:vega:_"+ug++,r=Nm({});if(h(e))r.value={$ingest:e};else if(e.signal){var i="setdata("+Q(n)+","+e.signal+")";r.params.input=t.signalRef(i)}return t.addDataPipeline(n,[r,rg({})]),{data:n,field:"data"}}(t,n):t,e.push(t),e},[]);return(hg(t.type)?function(e,n,t){var r,i,a;return r=t.map(function(e){var t=n.getData(e.data);return t||yg(e.data),t.countsRef(n,e.field)}),i=n.add(Lm({groupby:tm,ops:["sum"],fields:[n.fieldRef("count")],as:["count"],pulse:r})),a=n.add(Nm({pulse:Kp(i)})),Kp(n.add(og({field:tm,sort:n.sortRef(xg(e.sort,!0)),pulse:Kp(a)})))}:mg(t.type)?function(e,n,t){var r=t.map(function(e){var t=n.getData(e.data);return t||yg(e.data),t.domainRef(n,e.field)});return Kp(n.add(Vm({values:r})))}:function(e,n,t){var r=t.map(function(e){var t=n.getData(e.data);return t||yg(e.data),t.extentRef(n,e.field)});return Kp(n.add(Hm({extents:r})))})(e,n,i)}:function(e,t,n){var r=n.getData(e.data);r||yg(e.data);return hg(t.type)?r.valuesRef(n,e.field,xg(e.sort,!1)):mg(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)})(e,t,n);null==t.domainMin&&null==t.domainMax||Ue("No scale domain defined for domainMin/domainMax to override.")}function xg(e,t){return e&&(e.field||e.op?e.field||"count"===e.op?t&&e.field?Ue("Multiple domain scales can not sort by field."):t&&e.op&&"count"!==e.op&&Ue("Multiple domain scales support op count only."):Ue("No field provided for sort aggregate op: "+e.op):J(e)?e.field="key":e={field:"key"}),e}function _g(e,t,n){return h(e)?e.map(function(e){return _g(e,t,n)}):J(e)?e.signal?n.signalRef(e.signal):"fit"===t?e:Ue("Unsupported parameter object: "+Q(e)):e}var wg="top",kg="left",Mg="right",Og="bottom",Eg="vertical",Rg="index",Sg="label",zg="offset",Dg="perc",Ag="perc2",Cg="size",Pg="value",qg="guide-label",Lg="guide-title",Tg="group-title",Fg="symbol",Ng="gradient",Ig="discrete",jg=["size","shape","fill","stroke","strokeDash","opacity"],Ug={name:1,interactive:1},Bg=_e(["rule"]),$g=_e(["group","image","rect"]);function Gg(e,t,n,r){var i=Vp(e,t);return i.$fields.forEach(function(e){r[e]=1}),Be(n,i.$params),i.$expr}function Wg(e,t,n,r){return function e(t,n,r,i){var a,o,u;if(t.signal)a="datum",u=Gg(t.signal,n,r,i);else if(t.group||t.parent){for(o=Math.max(1,t.level||1),a="item";0<o--;)a+=".mark.group";t.parent?(u=t.parent,a+=".datum"):u=t.group}else t.datum?(a="datum",u=t.datum):Ue("Invalid field reference: "+Q(t));t.signal||(m(u)?(i[u]=1,u=w(u).map(Q).join("][")):u=e(u,n,r,i));return a+"["+u+"]"}(J(e)?e:{datum:e},t,n,r)}function Yg(e,t,n,r,i){var a,o,u,s=Hg(e.scale,n,r,i);return null!=e.range?(o=s+".range()",t=0===(a=+e.range)?o+"[0]":"($="+o+","+(1===a?"$[$.length-1]":"$[0]+"+a+"*($[$.length-1]-$[0])")+")"):(void 0!==t&&(t=s+"("+t+")"),e.band&&(u=function(e,t){if(!m(e))return-1;var n=t.scaleType(e);return"band"===n||"point"===n?1:0}(e.scale,n))&&(a=(o=s+".bandwidth")+"()"+(1===(a=+e.band)?"":"*"+a),u<0&&(a="("+o+"?"+a+":0)"),t=(t?t+"+":"")+a,e.extra&&(t="(datum.extra?"+s+"(datum.extra.value):"+t+")")),null==t&&(t="0")),t}function Hg(e,t,n,r){var i;if(m(e))i=Wh+e,n.hasOwnProperty(i)||(n[i]=t.scaleRef(e)),i=Q(i);else{for(i in t.scales)n[Wh+i]=t.scaleRef(i);i=Q(Wh)+"+"+(e.signal?"("+Gg(e.signal,t,n,r)+")":Wg(e,t,n,r))}return"_["+i+"]"}function Vg(e,t,n,r){return J(e)?"("+Xg(null,e,t,n,r)+")":e}function Xg(e,t,n,r,i){if(null!=t.gradient)return o=n,u=r,s=i,"this.gradient("+Hg((a=t).gradient,o,u,s)+","+Q(a.start)+","+Q(a.stop)+","+Q(a.count)+")";var a,o,u,s,l=t.signal?Gg(t.signal,n,r,i):t.color?function(e,i,a,o){function t(e,t,n,r){return"this."+e+"("+[Xg(null,t,i,a,o),Xg(null,n,i,a,o),Xg(null,r,i,a,o)].join(",")+").toString()"}return e.c?t("hcl",e.h,e.c,e.l):e.h||e.s?t("hsl",e.h,e.s,e.l):e.l||e.a?t("lab",e.l,e.a,e.b):e.r||e.g||e.b?t("rgb",e.r,e.g,e.b):null}(t.color,n,r,i):null!=t.field?Wg(t.field,n,r,i):void 0!==t.value?Q(t.value):void 0;return null!=t.scale&&(l=Yg(t,l,n,r,i)),void 0===l&&(l=null),null!=t.exponent&&(l="Math.pow("+l+","+Vg(t.exponent,n,r,i)+")"),null!=t.mult&&(l+="*"+Vg(t.mult,n,r,i)),null!=t.offset&&(l+="+"+Vg(t.offset,n,r,i)),t.round&&(l="Math.round("+l+")"),l}function Jg(e,t,n){return e+"["+Q(t)+"]="+n+";"}function Qg(e,t,n,r,i){var a="";return t.forEach(function(e){var t=Xg(0,e,n,r,i);a+=e.test?Gg(e.test,n,r,i)+"?"+t+":":t}),Jg("o",e,a)}function Kg(e,t,n,r){var i,a,o,u,s,l={},c="var o=item,datum=o.datum,$;";for(i in e)a=e[i],h(a)?c+=Qg(i,a,r,n,l):c+=Jg("o",i,Xg(0,a,r,n,l));return c+=(o=e,s="",Bg[u=t]||(o.x2&&(o.x?($g[u]&&(s+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),s+="o.width=o.x2-o.x;"):s+="o.x=o.x2-(o.width||0);"),o.xc&&(s+="o.x=o.xc-(o.width||0)/2;"),o.y2&&(o.y?($g[u]&&(s+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),s+="o.height=o.y2-o.y;"):s+="o.y=o.y2-(o.height||0);"),o.yc&&(s+="o.y=o.yc-(o.height||0)/2;")),s),{$expr:c+="return 1;",$fields:Object.keys(l),$output:Object.keys(e)}}var Zg="mark",ev="frame",tv="scope",nv="axis",rv="axis-domain",iv="axis-grid",av="axis-label",ov="axis-tick",uv="axis-title",sv="legend",lv="legend-band",cv="legend-entry",fv="legend-gradient",dv="legend-label",hv="legend-symbol",pv="legend-title",mv="title";function gv(e){return J(e)?Be({},e):{value:e}}function vv(e,t,n){return null!=n?(e[t]=J(n)&&!h(n)?n:{value:n},1):0}function yv(e,t,n){for(var r in t)n&&n.hasOwnProperty(r)||(e[r]=Be(e[r]||{},t[r]));return e}function bv(e,t,n,r,i,a){var o,u;for(u in(a=a||{}).encoders={$encode:o={}},e=function(r,e,t,n,i){var a,o,u={};"legend"!=t&&0!==String(t).indexOf("axis")||(t=null);for(a in o=t===ev?i.group:t===Zg?Be({},i.mark,i[e]):null)_v(a,r)||("fill"===a||"stroke"===a)&&(_v("fill",r)||_v("stroke",r))||(u[a]=xv(o[a]));return ee(n).forEach(function(e){var t=i.style&&i.style[e];for(var n in t)_v(n,r)||(u[n]=xv(t[n]))}),(r=Be({},r)).enter=Be(u,r.enter),r}(e,t,n,r,i.config))o[u]=Kg(e[u],t,a,i);return a}function xv(e){return e&&e.signal?{signal:e.signal}:{value:e}}function _v(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}function wv(e,t,n,r,i,a,o){return{type:e,name:o?o.name:void 0,role:t,style:o&&o.style||n,key:r,from:i,interactive:!(!o||!o.interactive),encode:yv(a,o,Ug)}}function kv(e,t,n){return sm(t[e],n[e])}function Mv(e,t){return sm(e.direction,t)===Eg}function Ov(e,t){return sm(e.gradientLength,t.gradientLength||t.gradientWidth)}function Ev(e,t){return sm(e.gradientThickness,t.gradientThickness||t.gradientHeight)}function Rv(e,t){var n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}var Sv="group",zv="rect",Dv="rule",Av="symbol",Cv="text";var Pv="datum."+Dg+'<=0?"left":datum.'+Dg+'>=1?"right":"center"',qv="datum."+Dg+'<=0?"bottom":datum.'+Dg+'>=1?"top":"middle"';function Lv(e,t,n,r){var i,a,o,u,s={value:0},l=Mv(e,t.gradientDirection),c=gv(Ev(e,t)),f=Ov(e,t),d=kv("labelOverlap",e,t),h={},p="";return h.enter=i={opacity:s},vv(i,"fill",kv("labelColor",e,t)),vv(i,"font",kv("labelFont",e,t)),vv(i,"fontSize",kv("labelFontSize",e,t)),vv(i,"fontWeight",kv("labelFontWeight",e,t)),vv(i,"limit",sm(e.labelLimit,t.gradientLabelLimit)),h.exit={opacity:s},h.update=a={opacity:{value:1},text:{field:Sg}},l?(i.align={value:"left"},i.baseline=a.baseline={signal:qv},o="y",u="x",p="1-"):(i.align=a.align={signal:Pv},i.baseline={value:"top"},o="x",u="y"),i[o]=a[o]={signal:p+"datum."+Dg,mult:f},i[u]=a[u]=c,c.offset=sm(e.labelOffset,t.gradientLabelOffset)||0,e=wv(Cv,dv,qg,Pg,r,h,n),d&&(e.overlap={method:d,order:"datum."+Rg}),e}function Tv(e,t,n,r,i,a,o,u){return{type:Sv,name:n,role:e,style:t,from:r,interactive:i||!1,encode:a,marks:o,layout:u}}var Fv={value:0};function Nv(e,t){return{align:kv("gridAlign",e,t),center:{row:!0,column:!1},columns:(n=e,r=t,sm(n.columns,sm(r.columns,+Mv(n,r.symbolDirection)))),padding:{row:kv("rowPadding",e,t),column:kv("columnPadding",e,t)}};var n,r}function Iv(e){return J(e)&&e.signal?e.signal:Q(e)}function jv(e){var t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")?e.type===Sv?tv:t||Zg:t}function Uv(e,t){var n=Wt(e.type);n||Ue("Unrecognized transform type: "+Q(e.type));var r=Jp(n.type.toLowerCase(),null,Bv(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function Bv(e,t,n){var r,i,a,o={};for(i=0,a=e.params.length;i<a;++i)o[(r=e.params[i]).name]=$v(r,t,n);return o}function $v(t,e,n){var r,i,a,o=t.type,u=e[t.name];if("index"===o)return function(e,t,n){m(t.from)||Ue('Lookup "from" parameter must be a string literal.');return n.getData(t.from).lookupRef(n,t.key)}(0,e,n);{if(void 0!==u)return"param"===o?(i=n,a=e[(r=t).name],r.array?(h(a)||Ue("Expected an array of sub-parameters. Instead: "+Q(a)),a.map(function(e){return Wv(r,e,i)})):Wv(r,a,i)):"projection"===o?n.projectionRef(e[t.name]):t.array&&!um(u)?u.map(function(e){return Gv(t,e,n)}):Gv(t,u,n);t.required&&Ue("Missing required "+Q(e.type)+" parameter: "+Q(t.name))}}function Gv(e,t,n){var r=e.type;if(um(t))return Yv(r)?Ue("Expression references can not be signals."):Hv(r)?n.fieldRef(t):Vv(r)?n.compareRef(t):n.signalRef(t.signal);var i,a,o=e.expr||Hv(r);return o&&((a=t)&&a.expr)?Vp(t.expr,n):o&&((i=t)&&i.field)?em(t.field):Yv(r)?Vp(t,n):"data"===r?Kp(n.getData(t).values):Hv(r)?em(t):Vv(r)?n.compareRef(t):t}function Wv(e,t,n){var r,i,a,o,u;for(o=0,u=e.params.length;o<u;++o){for(a in(i=e.params[o]).key)if(i.key[a]!==t[a]){i=null;break}if(i)break}return i||Ue("Unsupported parameter: "+Q(t)),r=Be(Bv(i,t,n),i.key),Kp(n.add(Jm(r)))}function Yv(e){return"expr"===e}function Hv(e){return"field"===e}function Vv(e){return"compare"===e}function Xv(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:Kp(t.getData(e.data).output)}function Jv(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}Jv.fromEntries=function(e,t){var n=t.length,r=1,i=t[0],a=t[n-1],o=t[n-2],u=null;for(e.add(t[0]);r<n;++r)t[r].params.pulse=Kp(t[r-1]),e.add(t[r]),"aggregate"===t[r].type&&(u=t[r]);return new Jv(e,i,o,a,u)};var Qv=Jv.prototype;function Kv(e){return m(e)?e:null}function Zv(e,t,n){var r,i=im(n.op,n.field);if(t.ops){for(var a=0,o=t.as.length;a<o;++a)if(t.as[a]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function ey(e,t,n,r,i,a,o){var u,s,l,c=t[n]||(t[n]={}),f=J(l=a)?(l.order===rm?"-":"+")+im(l.op,l.field):"",d=Kv(i);if(null!=d&&(e=t.scope,u=c[d+=f?"|"+f:""]),!u){var h=a?{field:tm,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:Kp(t.output)};f&&(h.sort=e.sortRef(a)),s=e.add(Jp(r,void 0,h)),o&&(t.index[i]=s),u=Kp(s),null!=d&&(c[d]=u)}return u}function ty(e,t,n){var r,i=e.remove,a=e.insert,o=e.toggle,u=e.modify,s=e.values,l=t.add(Qp());r=Vp("if("+e.trigger+',modify("'+n+'",'+[a,i,o,u,s].map(function(e){return null==e?"null":e}).join(",")+"),0)",t),l.update=r.$expr,l.params=r.$params}function ny(e,n){var t,r,i,a,o,u,s,l,c,f,d,h,p,m,g,v,y,b,x,_,w,k,M,O,E,R,S,z,D,A,C,P,q,L,T,F,N,I,j,U,B,$,G=jv(e),W=e.type===Sv,Y=e.from&&e.from.facet,H=e.layout||G===tv||G===ev,V=G===Zg||H||Y,X=e.overlap;m=e.from,g=W,v=n,m?(y=m.facet)&&(g||Ue("Only group marks can be faceted."),null!=y.field?_=w=Xv(y,v):(m.data?w=Kp(v.getData(m.data).aggregate):((x=Uv(Be({type:"aggregate",groupby:ee(y.groupby)},y.aggregate),v)).params.key=v.keyRef(y.groupby),x.params.pulse=Xv(y,v),_=w=Kp(v.add(x))),b=v.keyRef(y.groupby,!0))):_=Kp(v.add(Nm(null,[{}]))),_||(_=Xv(m,v)),i={key:b,pulse:_,parent:w},c=Kp(r=n.add(jm({key:i.key||(e.key?em(e.key):void 0),pulse:i.pulse,clean:!W}))),r=a=n.add(Nm({pulse:c})),f=Kp(r=n.add(Ym({markdef:(S=e,{marktype:S.type,name:S.name||void 0,role:S.role||jv(S),zindex:+S.zindex||void 0}),interactive:(E=e.interactive,R=n,E&&E.signal?R.signalRef(E.signal):!1!==E),clip:(k=e.clip,M=n,J(k)&&(k.signal?O=k.signal:k.path?O="pathShape("+Iv(k.path)+")":k.sphere&&(O="geoShape("+Iv(k.sphere)+', {type: "Sphere"})')),O?M.signalRef(O):!!k),context:{$context:!0},groups:n.lookup(),parent:n.signals.parent?n.signalRef("parent"):null,index:n.markpath(),pulse:Kp(r)}))),(r=n.add(Um(bv(e.encode,e.type,G,e.style,n,{pulse:f})))).params.parent=n.encode(),e.transform&&e.transform.forEach(function(e){var t=Uv(e,n);(t.metadata.generates||t.metadata.changes)&&Ue("Mark transforms should not generate new data."),t.params.pulse=Kp(r),n.add(r=t)}),e.sort&&(r=n.add(ig({sort:n.compareRef(e.sort,!0),pulse:Kp(r)}))),d=Kp(r),(Y||H)&&(h=Kp(H=n.add(ag({layout:n.objectProperty(e.layout),legendMargin:n.config.legendMargin,mark:f,pulse:d})))),p=Kp(o=n.add(Fm({mark:f,pulse:h||d}))),W&&(V&&((t=n.operators).pop(),H&&t.pop()),n.pushState(d,h||p,c),Y?(L=n,T=i,U=(q=e).from.facet,B=U.name,$=Xv(U,L),U.name||Ue("Facet must have a name: "+Q(U)),U.data||Ue("Facet must reference a data set: "+Q(U)),U.field?j=L.add(Qm({field:L.fieldRef(U.field),pulse:$})):U.groupby?j=L.add(Bm({key:L.keyRef(U.groupby),group:Kp(L.proxy(T.parent)),pulse:$})):Ue("Facet must specify groupby or field: "+Q(U)),N=(F=L.fork()).add(Nm()),I=F.add(rg({pulse:Kp(N)})),F.addData(B,new Jv(F,N,N,I)),F.addSignal("parent",null),j.params.subflow={$subflow:hy(q,F).toRuntime()}):V?(z=e,A=i,C=(D=n).add(Qm({pulse:A.pulse})),(P=D.fork()).add(rg()),P.addSignal("parent",null),C.params.subflow={$subflow:hy(z,P).toRuntime()}):hy(e,n),n.popState(),V&&(H&&t.push(H),t.push(o))),X&&(r={method:!0===X.method?"parity":X.method,pulse:p},X.order&&(r.sort=n.compareRef({field:X.order})),X.bound&&(r.boundScale=n.scaleRef(X.bound.scale),r.boundOrient=X.bound.orient,r.boundTolerance=X.bound.tolerance),p=Kp(n.add(Xm(r)))),u=n.add(tg({pulse:p})),s=n.add(rg({pulse:Kp(u)},void 0,n.parent())),null!=e.name&&(l=e.name,n.addData(l,new Jv(n,a,u,s)),e.on&&e.on.forEach(function(e){(e.insert||e.remove||e.toggle)&&Ue("Marks only support modify triggers."),ty(e,n,l)}))}function ry(n,e){var t,r,i,a,o,u,s,l,c,f,d,h,p,m,g,v,y,b,x,_,w,k,M,O,E,R,S,z,D,A,C,P,q,L,T,F,N,I,j,U,B,$,G,W,Y,H,V,X,J,Q,K,Z,ee,te,ne,re,ie,ae,oe,ue,se,le,ce,fe,de,he,pe,me,ge,ve,ye,be,xe,_e,we,ke,Me,Oe,Ee,Re,Se,ze,De,Ae,Ce,Pe,qe=e.config.legend,Le=n.encode||{},Te=Le.legend||{},Fe=Te.name||void 0,Ne=Te.interactive,Ie=Te.style,je=jg.reduce(function(e,t){return e||n[t]},0);return je||Ue("Missing valid scale for legend."),o=function(e,t){var n=e.type||Fg;e.type||1!==(i=e,jg.reduce(function(e,t){return e+(i[t]?1:0)},0))||!e.fill&&!e.stroke||(r=t,n=fg.hasOwnProperty(r)?Ng:pg(t)?Ig:Fg);var r;var i;return n!==Ng?n:pg(t)?Ig:Ng}(n,e.scaleType(je)),u={orient:kv("orient",n,qe),title:null!=n.title,type:o},s=Kp(e.add(Nm(null,[u]))),Te=yv({enter:(f=n,d=qe,h={},vv(h,"fill",kv("fillColor",f,d))+vv(h,"stroke",kv("strokeColor",f,d))+vv(h,"strokeWidth",kv("strokeWidth",f,d))+vv(h,"cornerRadius",kv("cornerRadius",f,d))+vv(h,"strokeDash",d.strokeDash)?h:void 0),update:{offset:gv(kv("offset",n,qe)),padding:gv(kv("padding",n,qe)),titlePadding:gv(kv("titlePadding",n,qe))}},Te,Ug),t={enter:{x:{value:0},y:{value:0}}},l=Kp(e.add(Wm(i={type:o,scale:e.scaleRef(je),count:e.objectProperty(n.tickCount),values:e.objectProperty(n.values),formatSpecifier:e.property(n.format)}))),o===Ng?(a=[(de=n,he=je,pe=qe,me=Le.gradient,we={value:0},ke=Mv(de,pe.gradientDirection),Me=Ev(de,pe),Oe=Ov(de,pe),Ee={},ke?(ye=[0,1],be=[0,0],xe=Me,_e=Oe):(ye=[0,0],be=[1,0],xe=Oe,_e=Me),Ee.enter=ge={opacity:we,x:we,y:we},vv(ge,"stroke",kv("gradientStrokeColor",de,pe)),vv(ge,"strokeWidth",kv("gradientStrokeWidth",de,pe)),Ee.exit={opacity:we},Ee.update=ve={x:we,y:we,fill:{gradient:he,start:ye,stop:be},opacity:{value:1}},ge.width=ve.width=gv(xe),ge.height=ve.height=gv(_e),wv(zv,fv,null,void 0,void 0,Ee,me)),Lv(n,qe,Le.labels,l)],i.count=i.count||e.signalRef("max(2,2*floor(("+lm(Ov(n,qe))+")/100))")):o===Ig?a=[(X=n,J=je,Q=qe,K=Le.gradient,Z=l,oe={value:0},ue=Mv(X,Q.gradientDirection),se=Ev(X,Q),le=Ov(X,Q),ce={},fe="",ue?(ne="y",ie="y2",re="x",ae="width",fe="1-"):(ne="x",ie="x2",re="y",ae="height"),ce.enter=ee={opacity:oe},vv(ee,"stroke",kv("gradientStrokeColor",X,Q)),vv(ee,"strokeWidth",kv("gradientStrokeWidth",X,Q)),ce.exit={opacity:oe},ce.update=te={opacity:{value:1}},ee.fill=te.fill={scale:J,field:Pg},ee[ne]=te[ne]={signal:fe+"datum."+Dg,mult:le},ee[re]=te[re]={value:0},ee[ie]=te[ie]={signal:fe+"datum."+Ag,mult:le},ee[ae]=te[ae]=gv(se),wv(zv,lv,null,Pg,Z,ce,K)),Lv(n,qe,Le.labels,l)]:(r=Nv(n,qe),a=[(E=n,R=qe,S=Le,z=l,D=lm(r.columns),N=S.entries,I=!(!N||!N.interactive),j=N?N.name:void 0,U=kv("clipHeight",E,R),B=kv("symbolOffset",E,R),$={data:"value"},G={},W=D+"?datum."+zg+":datum."+Cg,Y=U?gv(U):{field:Cg},H="datum."+Rg,V="max(1,"+D+")",G={enter:A={opacity:Fv},exit:{opacity:Fv},update:C={opacity:{value:1}}},E.fill||(vv(A,"fill",R.symbolBaseFillColor),vv(A,"stroke",R.symbolBaseStrokeColor)),vv(A,"shape",kv("symbolType",E,R)),vv(A,"size",kv("symbolSize",E,R)),vv(A,"strokeWidth",kv("symbolStrokeWidth",E,R)),vv(A,"fill",kv("symbolFillColor",E,R)),vv(A,"stroke",kv("symbolStrokeColor",E,R)),A.x=C.x={signal:W,mult:.5,offset:B},Y.mult=.5,A.y=C.y=Y,jg.forEach(function(e){E[e]&&(C[e]=A[e]={scale:E[e],field:Pg})}),q=wv(Av,hv,null,Pg,$,G,S.symbols),U&&(q.clip=!0),G={enter:A={opacity:Fv},exit:{opacity:Fv},update:C={opacity:{value:1},text:{field:Sg}}},vv(A,"align",kv("labelAlign",E,R)),vv(A,"baseline",kv("labelBaseline",E,R)),vv(A,"fill",kv("labelColor",E,R)),vv(A,"font",kv("labelFont",E,R)),vv(A,"fontSize",kv("labelFontSize",E,R)),vv(A,"fontWeight",kv("labelFontWeight",E,R)),vv(A,"limit",kv("labelLimit",E,R)),(P=gv(B)).offset=kv("labelOffset",E,R),A.x=C.x={signal:W,offset:P},A.y=C.y=Y,L=wv(Cv,dv,qg,Pg,$,G,S.labels),G={enter:{width:Fv,height:U?gv(U):Fv,opacity:Fv},exit:{opacity:Fv},update:C={opacity:{value:1},row:{signal:null},column:{signal:null}}},Mv(E,R.symbolDirection)?(T="ceil(item.mark.items.length/"+V+")",C.row.signal=H+"%"+T,C.column.signal="floor("+H+"/"+T+")",F={field:["row",H]}):(C.row.signal="floor("+H+"/"+V+")",C.column.signal=H+"%"+V,F={field:H}),C.column.signal=D+"?"+C.column.signal+":"+H,(E=Tv(tv,null,j,z={facet:{data:z,name:"value",groupby:Rg}},I,yv(G,N,Ug),[q,L])).sort=F,E)],i.size=(p=n,m=e,g=a[0].marks,b=Rv("strokeWidth",g[0].encode),y=p.size?'scale("'+p.size+'",datum)':Rv("size",g[0].encode),x=g[1].encode,_=m,w=qg,v=Rv("fontSize",x)||(k="fontSize",M=w,(O=_.config.style[M])&&O[k]),Vp("max(ceil(sqrt("+lm(y)+")+"+lm(b)+"),"+lm(v)+")",m))),a=[Tv(cv,null,null,s,Ne,t,a,r)],u.title&&a.push((Re=n,Se=qe,ze=Le.title,De=s,(Pe={}).enter=Ae={x:{field:{group:"padding"}},y:{field:{group:"padding"}},opacity:Ce={value:0}},vv(Ae,"align",kv("titleAlign",Re,Se)),vv(Ae,"baseline",kv("titleBaseline",Re,Se)),vv(Ae,"fill",kv("titleColor",Re,Se)),vv(Ae,"font",kv("titleFont",Re,Se)),vv(Ae,"fontSize",kv("titleFontSize",Re,Se)),vv(Ae,"fontWeight",kv("titleFontWeight",Re,Se)),vv(Ae,"limit",kv("titleLimit",Re,Se)),Pe.exit={opacity:Ce},Pe.update={opacity:{value:1},text:gv(Re.title)},wv(Cv,pv,Lg,null,De,Pe,ze))),c=Tv(sv,Ie,Fe,s,Ne,Te,a),n.zindex&&(c.zindex=n.zindex),ny(c,e)}function iy(e,t,n){return'item.anchor==="start"?'+e+':item.anchor==="end"?'+t+":"+n}Qv.countsRef=function(e,t,n){var r,i,a,o=this.counts||(this.counts={}),u=Kv(t);return null!=u&&(e=this.scope,r=o[u]),r?n&&n.field&&Zv(e,r.agg.params,n):(a={groupby:e.fieldRef(t,"key"),pulse:Kp(this.output)},n&&n.field&&Zv(e,a,n),r={agg:i=e.add(Lm(a)),ref:Kp(r=e.add(Nm({pulse:Kp(i)})))},null!=u&&(o[u]=r)),r.ref},Qv.tuplesRef=function(){return Kp(this.values)},Qv.extentRef=function(e,t){return ey(e,this,"extent","extent",t,!1)},Qv.domainRef=function(e,t){return ey(e,this,"domain","values",t,!1)},Qv.valuesRef=function(e,t,n){return ey(e,this,"vals","values",t,n||!0)},Qv.lookupRef=function(e,t){return ey(e,this,"lookup","tupleindex",t,!1)},Qv.indataRef=function(e,t){return ey(e,this,"indata","tupleindex",t,!0,!0)};var ay=iy(Q(kg),Q(Mg),Q("center")),oy=iy('+(item.orient==="'+Mg+'")','+(item.orient!=="'+kg+'")',"0.5");function uy(e,t){e=m(e)?{text:e}:e;var n,r,i,a=t.config.title,o=Be({},e.encode);return n={orient:kv("orient",e,a)},r=Kp(t.add(Nm(null,[n]))),o.name=e.name,o.interactive=e.interactive,i=function(e,t,n,r){var i,a,o,u,s={value:0},l=e.text,c=kv("orient",e,t),f=kv("anchor",e,t),d=c===kg||c===wg?-1:1,h=c===wg||c===Og,p={group:h?"width":"height"},m={};o={field:p,mult:{signal:oy}},u=d<0?s:h?{field:{group:"height"}}:{field:{group:"width"}},m.enter=i={opacity:s},vv(i,"fill",kv("color",e,t)),vv(i,"font",kv("font",e,t)),vv(i,"fontSize",kv("fontSize",e,t)),vv(i,"fontWeight",kv("fontWeight",e,t)),m.exit={opacity:s},m.update=a={opacity:{value:1},text:gv(l),anchor:gv(f),orient:gv(c),extent:{field:p},align:{signal:ay}},h?(a.x=o,a.y=u,a.angle=s,a.baseline={value:c===wg?Og:wg}):(a.x=u,a.y=o,a.angle={value:90*d},a.baseline={value:Og});return vv(a,"offset",kv("offset",e,t)||0),vv(a,"frame",kv("frame",e,t)),vv(a,"angle",kv("angle",e,t)),vv(a,"baseline",kv("baseline",e,t)),vv(a,"limit",kv("limit",e,t)),wv(Cv,mv,e.style||Tg,null,r,m,n)}(e,a,o,r),e.zindex&&(i.zindex=e.zindex),ny(i,t)}function sy(t,n){var r=[];t.transform&&t.transform.forEach(function(e){r.push(Uv(e,n))}),t.on&&t.on.forEach(function(e){ty(e,n,t.name)}),n.addDataPipeline(t.name,function(e,t,n){var r,i,a,o,u,s=[],l=null,c=!1,f=!1;e.values?s.push(l=ly({$ingest:e.values,$format:e.format})):e.url?s.push(l=ly({$request:e.url,$format:e.format})):e.source&&(l=r=ee(e.source).map(function(e){return Kp(t.getData(e).output)}),s.push(null));for(i=0,a=n.length;i<a;++i)o=n[i],u=o.metadata,l||u.source||s.push(l=ly()),s.push(o),u.generates&&(f=!0),u.modifies&&!f&&(c=!0),u.source?l=o:u.changes&&(l=null);r&&(a=r.length-1,s[0]=eg({derive:c,pulse:a?r:r[0]}),(c||a)&&s.splice(1,0,ly()));l||s.push(ly());return s.push(rg({})),s}(t,n,r))}function ly(e){var t=Nm({},e);return t.metadata={source:!0},t}function cy(e,t){return{scale:e.scale,range:t}}function fy(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function dy(e,t){var n,r,i,a,o,u,s,l,c,f,d,h,p,m,g,v,y,b,x,_,w,k,M,O,E,R,S,z,D,A,C,P,q,L,T,F,N,I,j,U,B,$,G,W,Y,H,V,X,J,Q,K,Z,ee,te,ne,re,ie,ae,oe,ue,se,le,ce,fe,de,he,pe,me,ge,ve,ye,be,xe,_e,we,ke,Me,Oe,Ee,Re,Se,ze,De,Ae,Ce,Pe,qe,Le,Te=(s=e,c=(l=t).config,f=s.orient,d=f===wg||f===Og?c.axisX:c.axisY,h=c["axis"+f[0].toUpperCase()+f.slice(1)],p="band"===l.scaleType(s.scale)&&c.axisBand,d||h||p?Be({},c.axis,d,h,p):c.axis),Fe=e.encode||{},Ne=Fe.axis||{},Ie=Ne.name||void 0,je=Ne.interactive,Ue=Ne.style;return n={orient:e.orient,ticks:!!kv("ticks",e,Te),labels:!!kv("labels",e,Te),grid:!!kv("grid",e,Te),domain:!!kv("domain",e,Te),title:!!sm(e.title,!1)},r=Kp(t.add(Nm({},[n]))),Ne=yv({update:{range:{signal:'abs(span(range("'+e.scale+'")))'},offset:gv(sm(e.offset,0)),position:gv(sm(e.position,0)),titlePadding:gv(kv("titlePadding",e,Te)),minExtent:gv(kv("minExtent",e,Te)),maxExtent:gv(kv("maxExtent",e,Te))}},Fe.axis,Ug),i=Kp(t.add(Tm({scale:t.scaleRef(e.scale),extra:t.property(kv("tickExtra",e,Te)),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),formatSpecifier:t.property(e.format)}))),u=[],n.grid&&u.push((m=e,g=Te,v=Fe.grid,y=i,R=m.orient,S=m.gridScale,D=(z=R===kg||R===wg?1:-1)*m.offset||0,(C={}).enter=b={opacity:A={value:0}},vv(b,"stroke",kv("gridColor",m,g)),vv(b,"strokeWidth",kv("gridWidth",m,g)),vv(b,"strokeDash",kv("gridDash",m,g)),C.exit=x={opacity:A},C.update=_={},vv(_,"opacity",kv("gridOpacity",m,g)),w={scale:m.scale,field:Pg,band:kv("bandPosition",m,g),round:kv("tickRound",m,g),extra:kv("tickExtra",m,g),offset:kv("tickOffset",m,g)},R===wg||R===Og?(k="x",M="y",E="height"):(k="y",M="x",E="width"),O=M+"2",_[k]=b[k]=x[k]=w,S?(b[M]={scale:S,range:0,mult:z,offset:D},_[O]=b[O]={scale:S,range:1,mult:z,offset:D}):(b[M]={value:D},_[O]=b[O]={signal:E,mult:z,offset:D}),wv(Dv,iv,null,Pg,y,C,v))),n.ticks&&(a=kv("tickSize",e,Te),u.push((P=e,q=Te,L=Fe.ticks,T=i,F=a,$=P.orient,G=$===kg||$===wg?-1:1,(Y={}).enter=N={opacity:W={value:0}},vv(N,"stroke",kv("tickColor",P,q)),vv(N,"strokeWidth",kv("tickWidth",P,q)),Y.exit=I={opacity:W},Y.update=j={opacity:{value:1}},(U=gv(F)).mult=G,B={scale:P.scale,field:Pg,band:kv("bandPosition",P,q),round:kv("tickRound",P,q),extra:kv("tickExtra",P,q),offset:kv("tickOffset",P,q)},$===wg||$===Og?(j.y=N.y=W,j.y2=N.y2=U,j.x=N.x=I.x=B):(j.x=N.x=W,j.x2=N.x2=U,j.y=N.y=I.y=B),wv(Dv,ov,null,Pg,T,Y,L)))),n.labels&&(a=n.ticks?a:0,u.push((H=e,V=Te,X=Fe.labels,J=i,Q=a,re=H.orient,ie=re===kg||re===wg?-1:1,ae=H.scale,oe=kv("labelBound",H,V),ue=kv("labelFlush",H,V),se=null!=ue&&!1!==ue&&(ue=+ue)===ue,le=+kv("labelFlushOffset",H,V),ce=kv("labelOverlap",H,V),(de={}).enter=K={opacity:fe={value:0}},vv(K,"angle",kv("labelAngle",H,V)),vv(K,"fill",kv("labelColor",H,V)),vv(K,"font",kv("labelFont",H,V)),vv(K,"fontSize",kv("labelFontSize",H,V)),vv(K,"fontWeight",kv("labelFontWeight",H,V)),vv(K,"limit",kv("labelLimit",H,V)),de.exit=Z={opacity:fe},de.update=ee={opacity:{value:1},text:{field:Sg}},(te=gv(Q)).mult=ie,te.offset=gv(kv("labelPadding",H,V)||0),te.offset.mult=ie,ne={scale:ae,field:Pg,band:.5,offset:kv("tickOffset",H,V)},re===wg||re===Og?(ee.y=K.y=te,ee.x=K.x=Z.x=ne,vv(ee,"align",se?fy(ae,ue,'"left"','"right"','"center"'):"center"),se&&le&&vv(ee,"dx",fy(ae,ue,-le,le,0)),vv(ee,"baseline",re===wg?"bottom":"top")):(ee.x=K.x=te,ee.y=K.y=Z.y=ne,vv(ee,"align",re===Mg?"left":"right"),vv(ee,"baseline",se?fy(ae,ue,'"bottom"','"top"','"middle"'):"middle"),se&&le&&vv(ee,"dy",fy(ae,ue,le,-le,0))),H=wv(Cv,av,qg,Pg,J,de,X),(ce||oe)&&(H.overlap={method:ce,order:"datum.index",bound:oe?{scale:ae,orient:re,tolerance:+oe}:null}),H))),n.domain&&u.push((he=e,pe=Te,me=Fe.domain,ge=r,we=he.orient,(Me={}).enter=ve={opacity:ke={value:0}},vv(ve,"stroke",kv("domainColor",he,pe)),vv(ve,"strokeWidth",kv("domainWidth",he,pe)),Me.exit={opacity:ke},Me.update=ye={opacity:{value:1}},we===wg||we===Og?(be="x",_e="y"):(be="y",_e="x"),xe=be+"2",ve[_e]=ke,ye[be]=ve[be]=cy(he,0),ye[xe]=ve[xe]=cy(he,1),wv(Dv,rv,null,null,ge,Me,me))),n.title&&u.push((Oe=e,Ee=Te,Re=Fe.title,Se=r,Ce=Oe.orient,Pe=Ce===kg||Ce===wg?-1:1,qe=Ce===wg||Ce===Og,(Le={}).enter=ze={opacity:{value:0}},vv(ze,"align",kv("titleAlign",Oe,Ee)),vv(ze,"fill",kv("titleColor",Oe,Ee)),vv(ze,"font",kv("titleFont",Oe,Ee)),vv(ze,"fontSize",kv("titleFontSize",Oe,Ee)),vv(ze,"fontWeight",kv("titleFontWeight",Oe,Ee)),vv(ze,"limit",kv("titleLimit",Oe,Ee)),Le.exit={opacity:{value:0}},Le.update=De={opacity:{value:1},text:gv(Oe.title)},Ae={scale:Oe.scale,range:.5},qe?(De.x=Ae,De.angle={value:0},De.baseline={value:Ce===wg?"bottom":"top"}):(De.y=Ae,De.angle={value:90*Pe},De.baseline={value:"bottom"}),vv(De,"angle",kv("titleAngle",Oe,Ee)),vv(De,"baseline",kv("titleBaseline",Oe,Ee)),!vv(De,"x",kv("titleX",Oe,Ee))&&qe&&!_v("x",Re)&&(Le.enter.auto={value:!0}),!vv(De,"y",kv("titleY",Oe,Ee))&&!qe&&!_v("y",Re)&&(Le.enter.auto={value:!0}),wv(Cv,uv,Lg,null,Se,Le,Re))),o=Tv(nv,Ue,Ie,r,je,Ne,u),e.zindex&&(o.zindex=e.zindex),ny(o,t)}function hy(e,i,t){var n=ee(e.signals),r=ee(e.scales);return t||n.forEach(function(e){hd(e,i)}),ee(e.projections).forEach(function(e){!function(e,t){var n={};for(var r in e)"name"!==r&&(n[r]=_g(e[r],r,t));t.addProjection(e.name,n)}(e,i)}),r.forEach(function(e){var t,n,r;n=i,r=(t=e).type||"linear",lg.hasOwnProperty(r)||Ue("Unrecognized scale type: "+Q(r)),n.addScale(t.name,{type:r,domain:void 0})}),ee(e.data).forEach(function(e){sy(e,i)}),r.forEach(function(e){gg(e,i)}),n.forEach(function(e){!function(e,t){var n=t.getSignal(e.name);if(e.update){var r=Vp(e.update,t);n.update=r.$expr,n.params=r.$params}e.on&&e.on.forEach(function(e){Pm(e,t,n.id)})}(e,i)}),ee(e.axes).forEach(function(e){dy(e,i)}),ee(e.marks).forEach(function(e){ny(e,i)}),ee(e.legends).forEach(function(e){ry(e,i)}),e.title&&uy(e.title,i),i.parseLambdas(),i}var py=_e(["width","height","padding","autosize"]);function my(e,t){var n,r,i,a,o,u,s,l,c,f,d=t.config;return t.background=e.background||d.background,t.eventConfig=d.events,o=Kp(t.root=t.add(Qp())),t.addSignal("width",e.width||0),t.addSignal("height",e.height||0),t.addSignal("padding",(u=e.padding,s=d,J(u=u||s.padding)?{top:id(u.top),bottom:id(u.bottom),left:id(u.left),right:id(u.right)}:{top:l=id(u),bottom:l,left:l,right:l})),t.addSignal("autosize",(c=e.autosize,f=d,J(c=c||f.autosize)?c:{type:c=c||"pad"})),ee(e.signals).forEach(function(e){py[e.name]||hd(e,t)}),r=t.add(Nm()),i=yv({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e.encode),i=t.add(Um(bv(i,Sv,ev,e.style,t,{pulse:Kp(r)}))),a=t.add(ag({layout:t.objectProperty(e.layout),legendMargin:d.legendMargin,autosize:t.signalRef("autosize"),mark:o,pulse:Kp(i)})),t.operators.pop(),t.pushState(Kp(i),Kp(a),null),hy(e,t,!0),t.operators.push(a),n=t.add(Fm({mark:o,pulse:Kp(a)})),n=t.add(tg({pulse:Kp(n)})),n=t.add(rg({pulse:Kp(n)})),t.addData("root",new Jv(t,r,r,n)),t}function gy(e){this.config=e,this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.background=null,this.eventConfig=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function vy(e){this.config=e.config,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}var yy=gy.prototype=vy.prototype;function by(e){return(h(e)?function(e){for(var t,n="[",r=0,i=e.length;r<i;++r)t=e[r],n+=(0<r?",":"")+(J(t)?t.signal||by(t):Q(t));return n+"]"}:function(e){var t,n,r="{",i=0;for(t in e)n=e[t],r+=(1<++i?",":"")+Q(t)+":"+(J(n)?n.signal||by(n):Q(n));return r+"}"})(e)}function xy(e){var i={padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:My},area:{fill:My},image:null,line:{stroke:My,strokeWidth:ky},path:{stroke:My},rect:{fill:My},rule:{stroke:Oy},shape:{stroke:My},symbol:{fill:My,size:64},text:{fill:Oy,font:_y,fontSize:11},style:{"guide-label":{fill:Oy,font:_y,fontSize:10},"guide-title":{fill:Oy,font:_y,fontSize:11,fontWeight:"bold"},"group-title":{fill:Oy,font:_y,fontSize:13,fontWeight:"bold"},point:{size:wy,strokeWidth:ky,shape:"circle"},circle:{size:wy,strokeWidth:ky},square:{size:wy,strokeWidth:ky,shape:"square"},cell:{fill:"transparent",stroke:Ry}},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:Ey,grid:!1,gridWidth:1,gridColor:Ry,gridOpacity:1,labels:!0,labelAngle:0,labelLimit:180,labelPadding:2,ticks:!0,tickColor:Ey,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titleAlign:"center",titlePadding:4},axisBand:{tickOffset:-1},legend:{orient:"right",offset:18,padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:Ry,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:Ey,titleAlign:"left",titleBaseline:"top",titleLimit:180,titlePadding:5},title:{orient:"top",anchor:"middle",offset:4},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues",extent:[.2,1]},heatmap:{scheme:"viridis"},ramp:{scheme:"blues",extent:[.2,1]},diverging:{scheme:"blueorange"},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}};return(e||[]).forEach(function(e){var t,n,r;if(e)for(t in e)if("style"===t)for(t in r=i.style||(i.style={}),e.style)r[t]=Be(r[t]||{},e.style[t]);else n=e[t],i[t]=J(n)&&!h(n)?Be(J(i[t])?i[t]:{},n):n}),i}yy.fork=function(){return new vy(this)},yy.isSubscope=function(){return 0<this._subid},yy.toRuntime=function(){return this.finish(),{background:this.background,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig}},yy.id=function(){return(this._subid?this._subid+":":0)+this._id++},yy.add=function(t){return this.operators.push(t),t.id=this.id(),t.refs&&(t.refs.forEach(function(e){e.$ref=t.id}),t.refs=null),t},yy.proxy=function(e){var t=e instanceof Xp?Kp(e):e;return this.add(Zm({value:t}))},yy.addStream=function(e){return this.streams.push(e),e.id=this.id(),e},yy.addUpdate=function(e){return this.updates.push(e),e},yy.finish=function(){var e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){var r;e&&((r=e.data||(e.data={}))[t]||(r[t]=[])).push(n)}for(e in this.data)for(var r in n((t=this.data[e]).input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values"),t.index)n(t.index[r],e,"index:"+r);return this},yy.pushState=function(e,t,n){this._encode.push(Kp(this.add(rg({pulse:e})))),this._parent.push(t),this._lookup.push(n?Kp(this.proxy(n)):null),this._markpath.push(-1)},yy.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},yy.parent=function(){return I(this._parent)},yy.encode=function(){return I(this._encode)},yy.lookup=function(){return I(this._lookup)},yy.markpath=function(){var e=this._markpath;return++e[e.length-1]},yy.fieldRef=function(e,t){if(m(e))return em(e,t);e.signal||Ue("Unsupported field reference: "+Q(e));var n,r=e.signal,i=this.field[r];return i||(n={name:this.signalRef(r)},t&&(n.as=t),this.field[r]=i=Kp(this.add($m(n)))),i},yy.compareRef=function(e,t){function n(e){return um(e)?(i=!0,Kp(r[e.signal])):e}var r=this.signals,i=!1,a=ee(e.field).map(n),o=ee(e.order).map(n);return t&&a.push(Zp),i?Kp(this.add(Im({fields:a,orders:o}))):nm(a,o)},yy.keyRef=function(e,t){var n,r=this.signals,i=!1;return e=ee(e).map(function(e){return um(e)?(i=!0,Kp(r[e.signal])):e}),i?Kp(this.add(Gm({fields:e,flat:t}))):(n={$key:e},t&&(n.$flat=!0),n)},yy.sortRef=function(e){if(!e)return e;var t=[im(e.op,e.field),Zp],n=e.order||"ascending";return n.signal?Kp(this.add(Im({fields:t,orders:[n=this.signalRef(n.signal),n]}))):nm(t,[n,n])},yy.event=function(e,t){var n=e+":"+t;if(!this.events[n]){var r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},yy.addSignal=function(e,t){this.signals.hasOwnProperty(e)&&Ue("Duplicate signal name: "+Q(e));var n=t instanceof Xp?t:this.add(Qp(t));return this.signals[e]=n},yy.getSignal=function(e){return this.signals[e]||Ue("Unrecognized signal name: "+Q(e)),this.signals[e]},yy.signalRef=function(e){return this.signals[e]?Kp(this.signals[e]):(this.lambdas.hasOwnProperty(e)||(this.lambdas[e]=this.add(Qp(null))),Kp(this.lambdas[e]))},yy.parseLambdas=function(){for(var e=Object.keys(this.lambdas),t=0,n=e.length;t<n;++t){var r=e[t],i=Vp(r,this),a=this.lambdas[r];a.params=i.$params,a.update=i.$expr}},yy.property=function(e){return e&&e.signal?this.signalRef(e.signal):e},yy.objectProperty=function(e){return e&&J(e)?this.signalRef(e.signal||by(e)):e},yy.addBinding=function(e,t){this.bindings||Ue("Nested signals do not support binding: "+Q(e)),this.bindings.push(Be({signal:e},t))},yy.addScaleProj=function(e,t){this.scales.hasOwnProperty(e)&&Ue("Duplicate scale or projection name: "+Q(e)),this.scales[e]=this.add(t)},yy.addScale=function(e,t){this.addScaleProj(e,ng(t))},yy.addProjection=function(e,t){this.addScaleProj(e,Km(t))},yy.getScale=function(e){return this.scales[e]||Ue("Unrecognized scale name: "+Q(e)),this.scales[e]},yy.projectionRef=yy.scaleRef=function(e){return Kp(this.getScale(e))},yy.projectionType=yy.scaleType=function(e){return this.getScale(e).params.type},yy.addData=function(e,t){return this.data.hasOwnProperty(e)&&Ue("Duplicate data set name: "+Q(e)),this.data[e]=t},yy.getData=function(e){return this.data[e]||Ue("Undefined data set name: "+Q(e)),this.data[e]},yy.addDataPipeline=function(e,t){return this.data.hasOwnProperty(e)&&Ue("Duplicate data set name: "+Q(e)),this.addData(e,Jv.fromEntries(this,t))};var _y="sans-serif",wy=30,ky=2,My="#4c78a8",Oy="#000",Ey="#888",Ry="#ddd";function Sy(e,t,n){";"!==t[t.length-1]&&(t="return("+t+");");var r=Function.apply(null,e.concat(t));return n&&n.functions?r.bind(n.functions):r}function zy(e,t){return Sy(["event"],e,t)}function Dy(e,t,n){var r,i;for(r in n=n||{},e)(i=e[r])&&i.$expr&&i.$params&&Dy(i.$params,t,n),n[r]=h(i)?i.map(function(e){return Ay(e,t)}):Ay(i,t);return n}function Ay(e,t){if(!e||!J(e))return e;for(var n,r=0,i=Cy.length;r<i;++r)if(n=Cy[r],e.hasOwnProperty(n.key))return n.parse(e,t);return e}var Cy=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||Ue("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){var n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=he(e.$key,e.$flat))}},{key:"$expr",parse:function(e,t){var n="e:"+e.$expr;return t.fn[n]||(t.fn[n]=g((r=e.$expr,i=t,Sy(["datum","_"],r,i)),e.$fields,e.$name));var r,i}},{key:"$field",parse:function(e,t){if(!e.$field)return null;var n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=M(e.$field,e.$name))}},{key:"$encode",parse:function(e,t){var n,r,i=e.$encode,a={};for(n in i)r=i[n],a[n]=g(Sy(["item","_"],r.$expr,t),r.$fields),a[n].output=r.$output;return a}},{key:"$compare",parse:function(e,t){var n="c:"+e.$compare+"_"+e.$order,r=ee(e.$compare).map(function(e){return e&&e.$tupleid?Se:e});return t.fn[n]||(t.fn[n]=ne(r,e.$order))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,o){var u=e.$subflow;return function(e,t,n){var r=Ty(u,o.fork()),i=r.get(u.operators[0].id),a=r.signals.parent;return a&&a.set(n),i}}},{key:"$tupleid",parse:function(){return Se}}];function Py(e){return(e+"").toLowerCase()}function qy(e,t){"operator"!==Py(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?Sy(["_"],e.update,t):null)}function Ly(e,t){var n=J(n=e.source)?n.$ref:n,r=t.get(n),i=null,a=e.update,o=void 0;r||Ue("Source not defined: "+e.source),i=e.target&&e.target.$expr?zy(e.target.$expr,t):t.get(e.target),a&&a.$expr&&(a.$params&&(o=Dy(a.$params,t)),a=Sy(["_","event"],a.$expr,t)),t.update(e,r,i,a,o)}function Ty(e,o){var t=e.operators||[];return e.background&&(o.background=e.background),e.eventConfig&&(o.eventConfig=e.eventConfig),t.forEach(function(e){qy(e,o)}),t.forEach(function(e){var t,n,r,i;n=o,(t=e).params&&((r=n.get(t.id))||Ue("Invalid operator id: "+t.id),i=Dy(t.params,n),n.dataflow.connect(r,r.parameters(i)))}),(e.streams||[]).forEach(function(e){var t,n,r,i,a;n=o,i=null!=(t=e).filter?zy(t.filter,n):void 0,a=null!=t.stream?n.get(t.stream):void 0,t.source?a=n.events(t.source,t.type,i):t.merge&&(a=(r=t.merge.map(n.get.bind(n)))[0].merge.apply(r[0],r.slice(1))),t.between&&(r=t.between.map(n.get.bind(n)),a=a.between(r[0],r[1])),t.filter&&(a=a.filter(i)),null!=t.throttle&&(a=a.throttle(+t.throttle)),null!=t.debounce&&(a=a.debounce(+t.debounce)),null==a&&Ue("Invalid stream definition: "+JSON.stringify(t)),t.consume&&a.consume(!0),n.stream(t,a)}),(e.updates||[]).forEach(function(e){Ly(e,o)}),o.resolve()}var Fy={skip:!0};function Ny(e,t,n){return new Iy(e,t,n)}function Iy(e,t,n){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function jy(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.functions=e.functions,this.events=e.events,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}Iy.prototype=jy.prototype={fork:function(){var e=new jy(this);return(this.subcontext||(this.subcontext=[])).push(e),e},get:function(e){return this.nodes[e]},set:function(e,t){return this.nodes[e]=t},add:function(e,t){var n,r=this,i=r.dataflow;if(r.set(e.id,t),"collect"===Py(e.type)&&(n=e.value)&&(n.$ingest?i.ingest(t,n.$ingest,n.$format):n.$request?i.request(t,n.$request,n.$format):i.pulse(t,i.changeset().insert(n))),e.root&&(r.root=t),e.parent){var a=r.get(e.parent.$ref);a?(i.connect(a,[t]),t.targets().add(a)):(r.unresolved=r.unresolved||[]).push(function(){a=r.get(e.parent.$ref),i.connect(a,[t]),t.targets().add(a)})}if(e.signal&&(r.signals[e.signal]=t),e.scale&&(r.scales[e.scale]=t),e.data)for(var o in e.data)n=r.data[o]||(r.data[o]={}),e.data[o].forEach(function(e){n[e]=t})},resolve:function(){return(this.unresolved||[]).forEach(function(e){e()}),delete this.unresolved,this},operator:function(e,t,n){this.add(e,this.dataflow.add(e.value,t,n,e.react))},transform:function(e,t,n){this.add(e,this.dataflow.add(this.transforms[Py(t)],n))},stream:function(e,t){this.set(e.id,t)},update:function(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},getState:function(n){var r=this,e={};if(n.signals){var i=e.signals={};Object.keys(r.signals).forEach(function(e){var t=r.signals[e];n.signals(e,t)&&(i[e]=t.value)})}if(n.data){var a=e.data={};Object.keys(r.data).forEach(function(e){var t=r.data[e];n.data(e,t)&&(a[e]=t.input.value)})}return r.subcontext&&!1!==n.recurse&&(e.subcontext=r.subcontext.map(function(e){return e.getState(n)})),e},setState:function(e){var r=this,t=r.dataflow,n=e.data,i=e.signals;Object.keys(i||{}).forEach(function(e){t.update(r.signals[e],i[e],Fy)}),Object.keys(n||{}).forEach(function(e){t.pulse(r.data[e].input,t.changeset().remove(D).insert(n[e]))}),(e.subcontext||[]).forEach(function(e,t){var n=r.subcontext[t];n&&n.setState(e)})}};var Uy="width",By="height",$y="padding",Gy={skip:!0};function Wy(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===$y?r.left+r.right:0)}function Yy(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===$y?r.top+r.bottom:0)}function Hy(e,t){return t.modified&&h(t.input.value)&&e.indexOf("_:vega:_")}function Vy(e,t){return!("parent"===e||t instanceof Gt.proxy)}function Xy(e,t,n,r){var i,a,o=e.element();o&&o.setAttribute("title",null==(i=r)?"":h(i)?Jy(i):J(i)&&!ce(i)?(a=i,Object.keys(a).map(function(e){var t=a[e];return e+": "+(h(t)?Jy(t):Qy(t))}).join("\n")):i+"")}function Jy(e){return"["+e.map(Qy).join(", ")+"]"}function Qy(e){return h(e)?"[…]":J(e)&&!ce(e)?"{…}":e}function Ky(e,t){var n=this;t=t||{},It.call(n),n.loader(t.loader||n._loader),n.logLevel(t.logLevel||0),n._el=null,n._renderType=t.renderer||cu.Canvas,n._scenegraph=new fo;var r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||Xy,n._redraw=!0,n._handler=(new zo).scene(r),n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[];var i,a,o,u,s,l=(i=n,a=e,o=t.functions,Ty(a,Ny(i,Gt,o||Up)));n._runtime=l,n._signals=l.signals,n._bind=(e.bindings||[]).map(function(e){return{state:null,param:Be({},e)}}),l.root&&l.root.set(r),r.source=l.data.root.input,n.pulse(l.data.root.input,n.changeset().insert(r.items)),n._background=l.background||null,n._eventConfig=(u=l.eventConfig,(s=(u=Be({},u)).defaults)&&(h(s.prevent)&&(s.prevent=_e(s.prevent)),h(s.allow)&&(s.allow=_e(s.allow))),u),n._width=n.width(),n._height=n.height(),n._viewWidth=Wy(n,n._width),n._viewHeight=Yy(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(t){var e=t._signals,n=e[Uy],r=e[By],i=e[$y];function a(){t._autosize=t._resize=1}t._resizeWidth=t.add(null,function(e){t._width=e.size,t._viewWidth=Wy(t,e.size),a()},{size:n}),t._resizeHeight=t.add(null,function(e){t._height=e.size,t._viewHeight=Yy(t,e.size),a()},{size:r});var o=t.add(null,a,{pad:i});t._resizeWidth.rank=n.rank+1,t._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}(n),Af(n)}var Zy=se(Ky,It);function eb(e,t){return e._signals.hasOwnProperty(t)?e._signals[t]:Ue("Unrecognized signal name: "+Q(t))}function tb(e,n){var t=(e._targets||[]).filter(function(e){var t=e._update;return t&&t.handler===n});return t.length?t[0]:null}Zy.run=function(e){if(It.prototype.run.call(this,e),this._redraw||this._resize)try{this.render()}catch(e){this.error(e)}return this},Zy.render=function(){var t,e,n,r;return this._renderer&&(this._resize&&(this._resize=0,e=Tf(t=this),n=qf(t),r=Lf(t),t._renderer.background(t._background),t._renderer.resize(n,r,e),t._handler.origin(e),t._resizeListeners.forEach(function(e){try{e(n,r)}catch(e){t.error(e)}})),this._renderer.render(this._scenegraph.root)),this._redraw=!1,this},Zy.dirty=function(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},Zy.container=function(){return this._el},Zy.scenegraph=function(){return this._scenegraph},Zy.origin=function(){return this._origin.slice()},Zy.signal=function(e,t,n){var r=eb(this,e);return 1===arguments.length?r.value:this.update(r,t,n)},Zy.background=function(e){return arguments.length?(this._background=e,this._resize=1,this):this._background},Zy.width=function(e){return arguments.length?this.signal("width",e):this.signal("width")},Zy.height=function(e){return arguments.length?this.signal("height",e):this.signal("height")},Zy.padding=function(e){return arguments.length?this.signal("padding",e):this.signal("padding")},Zy.autosize=function(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},Zy.renderer=function(e){return arguments.length?(du(e)||Ue("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},Zy.tooltip=function(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},Zy.loader=function(e){return arguments.length?(e!==this._loader&&(It.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},Zy.resize=function(){return this._autosize=1,this},Zy._resetRenderer=function(){this._renderer&&(this._renderer=null,this.initialize(this._el))},Zy._resizeView=function(n,r,i,a,o,u){this.runAfter(function(e){var t=0;e._autosize=0,e.width()!==i&&(t=1,e.signal(Uy,i,Gy),e._resizeWidth.skip(!0)),e.height()!==a&&(t=1,e.signal(By,a,Gy),e._resizeHeight.skip(!0)),e._viewWidth!==n&&(e._resize=1,e._viewWidth=n),e._viewHeight!==r&&(e._resize=1,e._viewHeight=r),e._origin[0]===o[0]&&e._origin[1]===o[1]||(e._resize=1,e._origin=o),t&&e.run("enter"),u&&e.runAfter(function(){e.resize()})},!1,1)},Zy.addEventListener=function(e,t,n){var r=t;return n&&!1===n.trap||((r=td(this,t)).raw=t),this._handler.on(e,r),this},Zy.removeEventListener=function(e,t){for(var n,r,i=this._handler.handlers(e),a=i.length;0<=--a;)if(r=i[a].type,n=i[a].handler,e===r&&(t===n||t===n.raw)){this._handler.off(r,n);break}return this},Zy.addResizeListener=function(e){var t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},Zy.removeResizeListener=function(e){var t=this._resizeListeners,n=t.indexOf(e);return 0<=n&&t.splice(n,1),this},Zy.addSignalListener=function(e,t){var n=eb(this,e),r=tb(n,t);return r||((r=td(this,function(){t(e,n.value)})).handler=t,this.on(n,null,r)),this},Zy.removeSignalListener=function(e,t){var n=eb(this,e),r=tb(n,t);return r&&n._targets.remove(r),this},Zy.preventDefault=function(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},Zy.timer=function(t,e){this._timers.push(d.interval(function(e){t({timestamp:Date.now(),elapsed:e})},e))},Zy.events=function(u,s,e){var t,l=this,c=new Ye(e),n=function(e,t){var n,r,i,a,o;"view"!==u||(r=s,i=(n=l)._eventConfig.defaults,a=i&&i.prevent,o=i&&i.allow,!1===a||!0===o||!0!==a&&!1!==o&&(a?!a[r]:o?o[r]:!n.preventDefault()))||e.preventDefault();try{c.receive(Ff(l,e,t))}catch(e){l.error(e)}finally{l.run()}};if("timer"===u)l.timer(n,s);else if("view"===u)l.addEventListener(s,n,Nf);else if("window"===u?"undefined"!=typeof window&&(t=[window]):"undefined"!=typeof document&&(t=document.querySelectorAll(u)),t){for(var r=0,i=t.length;r<i;++r)t[r].addEventListener(s,n);l._eventListeners.push({type:s,sources:t,handler:n})}else l.warn("Can not resolve event source: "+u);return c},Zy.finalize=function(){var e,t,n,r=this._tooltip,i=this._timers,a=this._eventListeners;for(e=i.length;0<=--e;)i[e].stop();for(e=a.length;0<=--e;)for(t=(n=a[e]).sources.length;0<=--t;)n.sources[t].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},Zy.hover=function(e,t){return t=[t||"update",(e=[e||"hover"])[0]],this.on(this.events("view","mouseover",If),jf,Uf(e)),this.on(this.events("view","mouseout",If),jf,Uf(t)),this},Zy.data=function(e){return Cf(this,e).values.value},Zy.change=Pf,Zy.insert=function(e,t){return Pf.call(this,e,Le().insert(t))},Zy.remove=function(e,t){return Pf.call(this,e,Le().remove(t))},Zy.initialize=function(e,t){var n,r,i,a,o,u,s=this,l=s._renderType,c=du(l);return e=s._el=e?nd(s,e):null,c||s.error("Unrecognized renderer type: "+l),n=c.handler||zo,r=e?c.renderer:c.headless,s._renderer=r?ed(s,s._renderer,e,r):null,s._handler=(a=(i=s)._handler,o=e,u=new n(i.loader(),td(i,i.tooltip())).scene(i.scenegraph().root).initialize(o,Tf(i),i),a&&a.handlers().forEach(function(e){u.on(e.type,e.handler)}),u),s._redraw=!0,e&&(t=t?nd(s,t):e.appendChild(Bf("div",{class:"vega-bindings"})),s._bind.forEach(function(e){e.param.element&&(e.element=nd(s,e.param.element))}),s._bind.forEach(function(e){Hf(s,e.element||t,e)})),s},Zy.toImageURL=function(r,e){return r!==cu.Canvas&&r!==cu.SVG&&r!==cu.PNG?Promise.reject("Unrecognized image type: "+r):rd(this,r,e).then(function(e){return r===cu.SVG?(t=e.svg(),n=new Blob([t],{type:"image/svg+xml"}),window.URL.createObjectURL(n)):e.canvas().toDataURL("image/png");var t,n})},Zy.toCanvas=function(e){return rd(this,cu.Canvas,e).then(function(e){return e.canvas()})},Zy.toSVG=function(e){return rd(this,cu.SVG,e).then(function(e){return e.svg()})},Zy.getState=function(e){return this._runtime.getState(e||{data:Hy,signals:Vy,recurse:!0})},Zy.setState=function(e){var t=this;return t.runAfter(function(){t._trigger=!1,t._runtime.setState(e),t.run().runAfter(function(){t._trigger=!0})}),this},Be(Gt,kr,Hu,fl,Ul,Zl,xc,Mc,tf,cf),y.timeFormatLocale=f.timeFormatDefaultLocale,y.formatLocale=u.formatDefaultLocale,y.version="4.0.0-rc.2",y.Dataflow=It,y.EventStream=Ye,y.Parameters=Fe,y.Pulse=Et,y.MultiPulse=At,y.Operator=je,y.Transform=Bt,y.changeset=Le,y.ingest=De,y.isTuple=Re,y.definition=Wt,y.transform=Yt,y.transforms=Gt,y.tupleid=Se,y.scale=mf,y.scheme=function(e,t){if(1<arguments.length)return Ef[e]=t,this;var n=e.split("-");return e=n[0],(n=+n[1]+1)&&Of.hasOwnProperty(e)?Of[e][n-1]:!n&&Ef.hasOwnProperty(e)?Ef[e]:void 0},y.interpolate=function(e,t){var n,r=l[(n=e,"interpolate"+n.toLowerCase().split("-").map(function(e){return e[0].toUpperCase()+e.slice(1)}).join(""))];return null!=t&&r&&r.gamma?r.gamma(t):r},y.interpolateRange=function(t,e){var n=e[0],r=I(e)-n;return function(e){return t(n+e*r)}},y.timeInterval=function(e){return Sf.hasOwnProperty(e)&&Sf[e]},y.utcInterval=function(e){return zf.hasOwnProperty(e)&&zf[e]},y.projection=Al,y.View=Ky,y.parse=function(e,t){return J(e)||Ue("Input Vega specification must be an object."),my(e,new gy(xy([t,e.config]))).toRuntime()},y.expressionFunction=Gp,y.runtime=Ty,y.runtimeContext=Ny,y.bin=tn,y.bootstrapCI=an,y.quartiles=on,y.setRandom=function(e){y.random=e},y.randomInteger=function(e,t){null==t&&(t=e,e=0);var n,r,i,a={};return a.min=function(e){return arguments.length?(i=r-(n=e||0),a):n},a.max=function(e){return arguments.length?(i=(r=e||0)-n,a):r},a.sample=function(){return n+Math.floor(i*y.random())},a.pdf=function(e){return e===Math.floor(e)&&n<=e&&e<r?1/i:0},a.cdf=function(e){var t=Math.floor(e);return t<n?0:r<=t?1:(t-n+1)/i},a.icdf=function(e){return 0<=e&&e<=1?n-1+Math.floor(e*i):NaN},a.min(e).max(t)},y.randomKDE=sn,y.randomMixture=ln,y.randomNormal=un,y.randomUniform=cn,y.accessor=g,y.accessorName=k,y.accessorFields=_,y.id=E,y.identity=R,y.zero=S,y.one=z,y.truthy=D,y.falsy=A,y.logger=N,y.None=P,y.Error=q,y.Warn=L,y.Info=T,y.Debug=F,y.panLinear=W,y.panLog=Y,y.panPow=H,y.zoomLinear=X,y.zoomLog=K,y.zoomPow=Z,y.array=ee,y.compare=ne,y.constant=re,y.debounce=ie,y.error=Ue,y.extend=Be,y.extentIndex=ae,y.fastmap=ue,y.field=M,y.inherits=se,y.isArray=h,y.isBoolean=le,y.isDate=ce,y.isFunction=te,y.isNumber=fe,y.isObject=J,y.isRegExp=de,y.isString=m,y.key=he,y.merge=pe,y.pad=ge,y.peek=I,y.repeat=me,y.splitAccessPath=w,y.stringValue=Q,y.toBoolean=ve,y.toDate=be,y.toNumber=j,y.toString=xe,y.toSet=_e,y.truncate=we,y.visitArray=ke,y.loader=Qe,y.read=_t,y.inferType=ut,y.inferTypes=st,y.typeParsers=it,y.formats=xt,y.Bounds=Zr,y.Gradient=ri,y.GroupItem=ai,y.ResourceLoader=si,y.Item=ii,y.Scenegraph=fo,y.Handler=_o,y.Renderer=Mo,y.CanvasHandler=zo,y.CanvasRenderer=qo,y.SVGHandler=No,y.SVGRenderer=Ho,y.SVGStringRenderer=iu,y.RenderType=cu,y.renderModule=du,y.Marks=io,y.boundClip=pu,y.boundContext=ta,y.boundStroke=Ji,y.boundItem=ao,y.boundMark=uo,y.pathCurves=hi,y.pathSymbols=Si,y.pathRectangle=Li,y.pathTrail=Fi,y.pathParse=gi,y.pathRender=ki,y.point=xo,y.domCreate=mo,y.domFind=go,y.domChild=vo,y.domClear=yo,y.openTag=Uo,y.closeTag=Bo,y.font=Za,y.textMetrics=Wa,y.resetSVGClipId=function(){Ma=1},y.sceneEqual=gu,y.pathEqual=vu,y.sceneToJSON=lo,y.sceneFromJSON=co,y.sceneZOrder=la,y.sceneVisit=ca,y.scenePickVisit=fa,Object.defineProperty(y,"__esModule",{value:!0})});