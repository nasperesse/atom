!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-util"),require("d3-format"),require("d3-time-format"),require("vega-scale"),require("vega-scenegraph"),require("d3-geo"),require("vega-dataflow"),require("vega-expression"),require("vega-statistics"),require("d3-color"),require("d3-array"),require("vega-event-selector")):"function"==typeof define&&define.amd?define(["exports","vega-util","d3-format","d3-time-format","vega-scale","vega-scenegraph","d3-geo","vega-dataflow","vega-expression","vega-statistics","d3-color","d3-array","vega-event-selector"],t):t(e.vega={},e.vega,e.d3,e.d3,e.vega,e.vega,e.d3,e.vega,e.vega,e.vega,e.d3,e.d3,e.vega)}(this,function(e,Te,n,r,f,g,t,p,o,a,i,l,u){"use strict";function h(e){return+e||0}var s="outer",d=["value","update","react","bind"];function c(e,t){Te.error(e+' for "outer" push: '+Te.stringValue(t))}function m(t,e){var n=t.name;if(t.push===s)e.signals[n]||c("No prior signal definition",n),d.forEach(function(e){void 0!==t[e]&&c("Invalid property ",e)});else{var r=e.addSignal(n,t.value);!1===t.react&&(r.react=!1),t.bind&&e.addBinding(n,t.bind)}}var v={};function y(e,t,n){var r=e+":"+n,a=v[r];return a&&a[0]===t||(v[r]=a=[t,t(n)]),a[1]}function b(e,t){return y("timeFormat",r.timeFormat,t)(e)}var x=new Date(2e3,0,1);function k(e,t,n){return x.setMonth(e),x.setDate(t),b(x,n)}function S(t,e,n){try{t[e].apply(t,["EXPRESSION"].concat([].slice.call(n)))}catch(e){t.warn(e)}return n[n.length-1]}var w="undefined"!=typeof window&&window||null;var R="Literal",O="%",z=":";function P(e,t){var n;return Te.isFunction(e)?e:Te.isString(e)?(n=t.scales[e])&&n.value:void 0}function j(e,t,n){var r=O+n;if(!t.hasOwnProperty(r))try{t[r]=e.scaleRef(n)}catch(e){}}function D(e,t,n,r){if(t[0].type===R)j(n,r,t[0].value);else if("Identifier"===t[0].type)for(e in n.scales)j(n,r,e)}function $(a,i){return function(e,t,n){if(e){var r=P(e,(n||this).context);return r&&r.path[a](t)}return i(t)}}var _=$("area",t.geoArea),E=$("bounds",t.geoBounds),V=$("centroid",t.geoCentroid);function A(e){var t=this.context.data[e];return t?t.values.value:[]}function F(e,t,n,r){t[0].type!==R&&Te.error("First argument to data functions must be a string literal.");var a=t[0].value,i=z+a;r.hasOwnProperty(i)||(r[i]=n.getData(a).tuplesRef())}var W={};function L(e){return e.data}function C(e,t){var n=A.call(t,e);return n.root&&n.root.lookup||W}function M(e,t,n,r){var a,i=t[0],o=t[t.length-1];return o<i&&(a=i,i=o,o=a),r=void 0===r||r,((n=void 0===n||n)?i<=e:i<e)&&(r?e<=o:e<o)}function q(e,t){return e===t||e!=e&&t!=t||!(!Te.isArray(e)||!Te.isArray(t)||e.length!==t.length)&&function(e,t){for(var n=0,r=e.length;n<r;++n)if(!q(e[n],t[n]))return!1;return!0}(e,t)}function B(n){return function(e){for(var t in n)if(!q(e[t],n[t]))return!1;return!0}}var T="bin_",N="intersect",U="union",I="index:unit";function X(e,t){for(var n,r=t.fields,a=t.values,i=t.getter||(t.getter=[]),o=r.length,l=0;l<o;++l)if(i[l]=i[l]||Te.field(r[l]),n=i[l](e),Te.isDate(n)&&(n=Te.toNumber(n)),Te.isDate(a[l])&&(a[l]=Te.toNumber(a[l])),t[T+r[l]]){if(Te.isDate(a[l][0])&&(a[l]=a[l].map(Te.toNumber)),!M(n,a[l],!0,!1))return!1}else if(n!==a[l])return!1;return!0}function Y(e,t){for(var n,r,a=t.intervals,i=a.length,o=0;o<i;++o){if(n=a[o].extent,r=(a[o].getter||(a[o].getter=Te.field(a[o].field)))(e),!n||n[0]===n[1])return!1;if(Te.isDate(r)&&(r=Te.toNumber(r)),Te.isDate(n[0])&&(n=a[o].extent=n.map(Te.toNumber)),Te.isNumber(n[0])&&!M(r,n))return!1;if(Te.isString(n[0])&&n.indexOf(r)<0)return!1}return!0}function G(e,t,n,r){for(var a,i,o,l,s,u=this.context.data[e],d=u?u.values.value:[],c=u?u[I]&&u[I].value:void 0,f=n===N,g=d.length,p=0;p<g;++p)if(a=d[p],c&&f){if(-1===(o=(i=i||{})[l=a.unit]||0))continue;if(s=r(t,a),i[l]=s?-1:++o,s&&1===c.size)return!0;if(!s&&o===c.get(l).count)return!1}else if(f^(s=r(t,a)))return s;return g&&f}function H(e,t,n){return G.call(this,e,t,n,X)}function J(e,t,n,r){t[0].type!==R&&Te.error("First argument to indata must be a string literal.");var a=t[0].value;(2<=t.length&&t[t.length-1].value)!==N||r.hasOwnProperty("@unit")||(r["@unit"]=n.getData(a).indataRef(n,"unit")),F(0,t,n,r)}function K(e,t,n,r){var a,i,o,l,s,u=this.context.data[e],d=u?u.values.value:[],c=u?u[I]&&u[I].value:void 0,f=d[0],g=0;if(f){for(a=t?f.encodings.length:f.fields.length;g<a;++g)if(t&&f.encodings[g]===t||n&&f.fields[g]===n){i=g,l=f[T+f.fields[g]];break}return c&&1===c.size&&(r=U),c&&r===N?(s=d.reduce(function(e,t){return(e[t.unit]||(e[t.unit]=[])).push({unit:t.unit,value:t.values[i]}),e},{}),o=Object.keys(s).map(function(e){return{unit:e,value:l?Z(s[e],U):Q(s[e],U)}})):o=d.map(function(e){return{unit:e.unit,value:e.values[i]}}),l?Z(o,r):Q(o,r)}}function Q(e,t){for(var n,r,a,i,o={},l=0,s={},u=[],d=0,c=e.length;d<c;++d)r=(n=e[d]).unit,i=n.value,o[r]||(o[r]=++l),(a=s[i])||(s[i]=a={value:i,units:{},count:0}),a.units[r]||(a.units[r]=++a.count);for(i in s)a=s[i],t===N&&a.count!==l||u.push(a.value);return u.length?u:void 0}function Z(e,t){for(var n,r,a,i,o=t===N?te:ee,l=0,s=e.length;l<s;++l)n=e[l].value,Te.isDate(n[0])&&(n=n.map(Te.toNumber)),a=n[0],(i=n[1])<a&&(i=n[0],a=n[1]),r=r?o(r,a,i):[a,i];return r&&r.length&&+r[0]!=+r[1]?r:void 0}function ee(e,t,n){return e[0]>t&&(e[0]=t),e[1]<n&&(e[1]=n),e}function te(e,t,n){return n<e[0]||e[1]<t?[]:(e[0]<t&&(e[0]=t),e[1]>n&&(e[1]=n),e)}var ne={random:function(){return a.random()},isArray:Te.isArray,isBoolean:Te.isBoolean,isDate:Te.isDate,isNumber:Te.isNumber,isObject:Te.isObject,isRegExp:Te.isRegExp,isString:Te.isString,isTuple:p.isTuple,toBoolean:Te.toBoolean,toDate:Te.toDate,toNumber:Te.toNumber,toString:Te.toString,pad:Te.pad,peek:Te.peek,truncate:Te.truncate,rgb:i.rgb,lab:i.lab,hcl:i.hcl,hsl:i.hsl,sequence:l.range,format:function(e,t){return y("format",n.format,t)(e)},utcFormat:function(e,t){return y("utcFormat",r.utcFormat,t)(e)},utcParse:function(e,t){return y("utcParse",r.utcParse,t)(e)},timeFormat:b,timeParse:function(e,t){return y("timeParse",r.timeParse,t)(e)},monthFormat:function(e){return k(e,1,"%B")},monthAbbrevFormat:function(e){return k(e,1,"%b")},dayFormat:function(e){return k(0,2+e,"%A")},dayAbbrevFormat:function(e){return k(0,2+e,"%a")},quarter:function(e){return 1+~~(new Date(e).getMonth()/3)},utcquarter:function(e){return 1+~~(new Date(e).getUTCMonth()/3)},warn:function(){return S(this.context.dataflow,"warn",arguments)},info:function(){return S(this.context.dataflow,"info",arguments)},debug:function(){return S(this.context.dataflow,"debug",arguments)},inScope:function(e){var t=this.context.group,n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},clampRange:function(e,t,n){var r,a=e[0],i=e[1];return i<a&&(r=i,i=a,a=r),n-t<=(r=i-a)?[t,n]:[Math.min(Math.max(a,t),n-r),Math.min(Math.max(i,r),n)]},pinchDistance:function(e){var t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){var t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){return w?w.screen:{}},containerSize:function(){var e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){return w?[w.innerWidth,w.innerHeight]:[void 0,void 0]},span:function(e){return e[e.length-1]-e[0]||0},merge:function(){var e=[].slice.call(arguments);return e.unshift({}),Te.extend.apply(null,e)},flush:function(e,t,n,r,a,i){var o,l,s=e[0],u=Te.peek(e);return u<s&&(o=s,s=u,u=o),(o=Math.abs(t-s))<(l=Math.abs(u-t))&&o<=n?r:l<=n?a:i},bandspace:function(e,t,n){return f.bandSpace(e||0,t||0,n||0)},inrange:M,setdata:function(e,t){var n=this.context.dataflow,r=this.context.data[e].input;return n.pulse(r,n.changeset().remove(Te.truthy).insert(t)),1},pathShape:function(t){var n=null;return function(e){return e?g.pathRender(e,n=n||g.pathParse(t)):t}},panLinear:Te.panLinear,panLog:Te.panLog,panPow:Te.panPow,zoomLinear:Te.zoomLinear,zoomLog:Te.zoomLog,zoomPow:Te.zoomPow,encode:function(e,t,n){if(e){var r=this.context.dataflow,a=e.mark.source;r.pulse(a,r.changeset().encode(e,t))}return void 0!==n?n:e},modify:function(e,t,n,r,a,i){var o,l,s=this.context.dataflow,u=this.context.data[e],d=u.input,c=u.changes,f=s.stamp();if(!1===s._trigger||!(d.value.length||t||r))return 0;if((!c||c.stamp<f)&&(u.changes=c=s.changeset(),c.stamp=f,s.runAfter(function(){u.modified=!0,s.pulse(d,c).run()},!0,1)),n&&(o=!0===n?Te.truthy:Te.isArray(n)||p.isTuple(n)?n:B(n),c.remove(o)),t&&c.insert(t),r&&(o=B(r),d.value.some(o)?c.remove(o):c.insert(r)),a)for(l in i)c.modify(a,l,i[l]);return 1}},re=["view","item","group","xy","x","y"],ae={};function ie(e,t,n){return 1===arguments.length?ne[e]:(ne[e]=t,n&&(ae[e]=n),le&&(le.functions[e]="this."+e),this)}ie("bandwidth",function(e,t){var n=P(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0},D),ie("copy",function(e,t){var n=P(e,(t||this).context);return n?n.copy():void 0},D),ie("domain",function(e,t){var n=P(e,(t||this).context);return n?n.domain():[]},D),ie("range",function(e,t){var n=P(e,(t||this).context);return n&&n.range?n.range():[]},D),ie("invert",function(e,t,n){var r=P(e,(n||this).context);return r?Te.isArray(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0},D),ie("scale",function(e,t,n){var r=P(e,(n||this).context);return r?r(t):void 0},D),ie("gradient",function(e,t,n,r,a){e=P(e,(a||this).context);var i=g.Gradient(t,n),o=e.domain(),l=o[0],s=o[o.length-1],u=f.scaleFraction(e,l,s);e.ticks&&(l!==(o=e.ticks(+r||15))[0]&&o.unshift(l),s!==o[o.length-1]&&o.push(s));for(var d=0,c=o.length;d<c;++d)i.stop(u(o[d]),e(o[d]));return i},D),ie("geoArea",_,D),ie("geoBounds",E,D),ie("geoCentroid",V,D),ie("geoShape",function(e,t,n){var r=P(e,(n||this).context);return function(e){return r?r.path.context(e)(t):""}},D),ie("indata",function(e,t,n){var r=this.context.data[e]["index:"+t],a=r?r.value.get(n):void 0;return a?a.count:a},function(e,t,n,r){t[0].type!==R&&Te.error("First argument to indata must be a string literal."),t[1].type!==R&&Te.error("Second argument to indata must be a string literal.");var a=t[0].value,i=t[1].value,o="@"+i;r.hasOwnProperty(o)||(r[o]=n.getData(a).indataRef(n,i))}),ie("data",A,F),ie("vlSingle",H,F),ie("vlSingleDomain",K,F),ie("vlMulti",H,J),ie("vlMultiDomain",K,J),ie("vlInterval",function(e,t,n){return G.call(this,e,t,n,Y)},F),ie("vlIntervalDomain",function(e,t,n,r){var a,i,o,l,s,u=this.context.data[e],d=u?u.values.value:[],c=d[0],f=0;if(c){for(a=c.intervals.length;f<a;++f)if(i=c.intervals[f],t&&i.encoding===t||n&&i.field===n){if(!i.extent)return;o=f,s=2<i.extent.length;break}return l=d.reduce(function(e,t){var n=t.intervals[o].extent,r=s?n.map(function(e){return{unit:t.unit,value:e}}):{unit:t.unit,value:n};return s?e.push.apply(e,r):e.push(r),e},[]),s?Q(l,r):Z(l,r)}},F),ie("treePath",function(e,t,n){var r=C(e,this),a=r[t],i=r[n];return a&&i?a.path(i).map(L):void 0},F),ie("treeAncestors",function(e,t){var n=C(e,this)[t];return n?n.ancestors().map(L):void 0},F);var oe={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:function(e){return"_["+Te.stringValue("$"+e)+"]"},functions:function(e){var t=o.functions(e);for(var n in re.forEach(function(e){t[e]="event.vega."+e}),ne)t[n]="this."+n;return t},constants:o.constants,visitors:ae},le=o.codegen(oe),se="$";function Be(t,r,e){var n,a,i={};try{t=Te.isString(t)?t:Te.stringValue(t)+"",n=o.parse(t)}catch(e){Te.error("Expression parse error: "+t)}return n.visit(function(e){if("CallExpression"===e.type){var t=e.callee.name,n=oe.visitors[t];n&&n(t,e.arguments,r,i)}}),(a=le(n)).globals.forEach(function(e){var t=se+e;!i.hasOwnProperty(t)&&r.getSignal(e)&&(i[t]=r.signalRef(e))}),{$expr:e?e+"return("+a.code+");":a.code,$fields:a.fields,$params:i}}function ue(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function de(e,t,n,r){return new ue(e,t,n,r)}function ce(e,t){return de("operator",e,t)}function Ne(e){var t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}var fe={$tupleid:1,toString:function(){return":_tupleid_:"}};function ge(e,t){return t?{$field:e,$name:t}:{$field:e}}var pe=ge("key");function he(e,t){return{$compare:e,$order:t}}var me="descending";function ve(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}var ye="scope",be="view";function xe(e){return e&&e.signal}function Ue(e,t){return null!=e?e:t}function Ie(e){return e&&e.signal||e}var ke="timer";function Se(e,t){return(e.merge?we:e.stream?Re:e.type?Oe:Te.error("Invalid stream specification: "+Te.stringValue(e)))(e,t)}function we(e,t){var n=ze({merge:e.merge.map(function(e){return Se(e,t)})},e,t);return t.addStream(n).id}function Re(e,t){var n=ze({stream:Se(e.stream,t)},e,t);return t.addStream(n).id}function Oe(e,t){var n,r,a;return e.type===ke?(n=t.event(ke,e.throttle),e={between:e.between,filter:e.filter}):n=t.event((a=e.source)===ye?be:a||be,e.type),r=ze({stream:n},e,t),1===Object.keys(r).length?n:t.addStream(r).id}function ze(e,t,n){var r,a,i,o,l=t.between;return l&&(2!==l.length&&Te.error('Stream "between" parameter must have 2 entries: '+Te.stringValue(t)),e.between=[Se(l[0],n),Se(l[1],n)]),l=t.filter?Te.array(t.filter):[],(t.marktype||t.markname||t.markrole)&&l.push((r=t.marktype,a=t.markname,i=t.markrole,(o="event.item")+(r&&"*"!==r?"&&"+o+".mark.marktype==='"+r+"'":"")+(i?"&&"+o+".mark.role==='"+i+"'":"")+(a?"&&"+o+".mark.name==='"+a+"'":""))),t.source===ye&&l.push("inScope(event.item)"),l.length&&(e.filter=Be("("+l.join(")&&(")+")").$expr),null!=(l=t.throttle)&&(e.throttle=+l),null!=(l=t.debounce)&&(e.debounce=+l),t.consume&&(e.consume=!0),e}var Pe="var datum=event.item&&event.item.datum;";function je(e,r,t){var n,a,i=e.events,o=e.update,l=e.encode,s=[];i||Te.error("Signal update missing events specification."),Te.isString(i)&&(i=u.selector(i,r.isSubscope()?ye:be)),(i=Te.array(i).filter(function(e){return e.signal||e.scale?(s.push(e),0):1})).length&&s.push(1<i.length?{merge:i}:i[0]),null!=l&&(o&&Te.error("Signal encode and update are mutually exclusive."),o="encode(item(),"+Te.stringValue(l)+")"),n=Te.isString(o)?Be(o,r,Pe):null!=o.expr?Be(o.expr,r,Pe):null!=o.value?o.value:null!=o.signal?{$expr:"_.value",$params:{value:r.signalRef(o.signal)}}:Te.error("Invalid signal update specification."),a={target:t,update:n},e.force&&(a.options={force:!0}),s.forEach(function(e){var t,n;r.addUpdate(Te.extend((n=r,{source:(t=e).signal?n.signalRef(t.signal):t.scale?n.scaleRef(t.scale):Se(t,n)}),a))})}function De(e,t){var n=t.getSignal(e.name);if(e.update){var r=Be(e.update,t);n.update=r.$expr,n.params=r.$params}e.on&&e.on.forEach(function(e){je(e,t,n.id)})}function $e(r){return function(e,t,n){return de(r,t,e||void 0,n)}}var _e=$e("aggregate"),Xe=$e("axisticks"),Ee=$e("bound"),Ye=$e("collect"),Ve=$e("compare"),Ae=$e("datajoin"),Fe=$e("encode"),We=$e("facet"),Le=$e("field"),Ce=$e("key"),Ge=$e("legendentries"),Me=$e("mark"),qe=$e("multiextent"),He=$e("multivalues"),Je=$e("overlap"),Ke=$e("params"),Qe=$e("prefacet"),Ze=$e("projection"),et=$e("proxy"),tt=$e("relay"),nt=$e("render"),rt=$e("scale"),at=$e("sieve"),it=$e("sortitems"),ot=$e("viewlayout"),lt=$e("values"),st=0,ut=["identity","ordinal","band","point","bin-linear","bin-ordinal","quantize","quantile","threshold","linear","pow","sqrt","log","sequential","time","utc"],dt=Te.toSet(ut),ct=Te.toSet(ut.slice(4,9)),ft=Te.toSet(ut.slice(9)),gt=Te.toSet(ut.slice(1,6));function pt(e){return gt.hasOwnProperty(e)}function ht(e){return ct.hasOwnProperty(e)}function mt(e){return"quantile"===e}function vt(e,t){var n,r,a,i,o=t.getScale(e.name).params;for(n in o.domain=xt(e.domain,e,t),null!=e.range&&(o.range=function e(t,n,r){var a=t.range,i=n.config.range;{if(a.signal)return n.signalRef(a.signal);if(Te.isString(a)){if(i&&i.hasOwnProperty(a))return t=Te.extend({},t,{range:i[a]}),e(t,n,r);"width"===a?a=[0,{signal:"width"}]:"height"===a?a=pt(t.type)?[0,{signal:"height"}]:[{signal:"height"},0]:Te.error("Unrecognized scale range value: "+Te.stringValue(a))}else{if(a.scheme)return r.scheme=yt(a.scheme,n),a.extent&&(r.schemeExtent=(o=a.extent,l=n,o.signal?l.signalRef(o.signal):o.map(function(e){return yt(e,l)}))),void(a.count&&(r.schemeCount=yt(a.count,n)));if(a.step)return void(r.rangeStep=yt(a.step,n));if(pt(t.type)&&!Te.isArray(a))return xt(a,t,n);Te.isArray(a)||Te.error("Unsupported range type: "+Te.stringValue(a))}}var o,l;return a.map(function(e){return yt(e,n)})}(e,t,o)),null!=e.interpolate&&(r=e.interpolate,(a=o).interpolate=yt(r.type||r),null!=r.gamma&&(a.interpolateGamma=yt(r.gamma))),null!=e.nice&&(i=e.nice,o.nice=Te.isObject(i)?{interval:yt(i.interval),step:yt(i.step)}:yt(i)),e)o.hasOwnProperty(n)||"name"===n||(o[n]=yt(e[n],t))}function yt(e,t){return Te.isObject(e)?e.signal?t.signalRef(e.signal):Te.error("Unsupported object: "+Te.stringValue(e)):e}function bt(e){Te.error("Can not find data set: "+Te.stringValue(e))}function xt(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(Te.isArray(e)?function(e,t,n){return e.map(function(e){return yt(e,n)})}:e.fields?function(e,t,n){var r=e.data,a=e.fields.reduce(function(e,t){return t=Te.isString(t)?{data:r,field:t}:Te.isArray(t)||t.signal?function(e,t){var n="_:vega:_"+st++,r=Ye({});if(Te.isArray(e))r.value={$ingest:e};else if(e.signal){var a="setdata("+Te.stringValue(n)+","+e.signal+")";r.params.input=t.signalRef(a)}return t.addDataPipeline(n,[r,at({})]),{data:n,field:"data"}}(t,n):t,e.push(t),e},[]);return(pt(t.type)?function(e,n,t){var r,a,i;return r=t.map(function(e){var t=n.getData(e.data);return t||bt(e.data),t.countsRef(n,e.field)}),a=n.add(_e({groupby:pe,ops:["sum"],fields:[n.fieldRef("count")],as:["count"],pulse:r})),i=n.add(Ye({pulse:Ne(a)})),Ne(n.add(lt({field:pe,sort:n.sortRef(kt(e.sort,!0)),pulse:Ne(i)})))}:mt(t.type)?function(e,n,t){var r=t.map(function(e){var t=n.getData(e.data);return t||bt(e.data),t.domainRef(n,e.field)});return Ne(n.add(He({values:r})))}:function(e,n,t){var r=t.map(function(e){var t=n.getData(e.data);return t||bt(e.data),t.extentRef(n,e.field)});return Ne(n.add(qe({extents:r})))})(e,n,a)}:function(e,t,n){var r=n.getData(e.data);r||bt(e.data);return pt(t.type)?r.valuesRef(n,e.field,kt(e.sort,!1)):mt(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)})(e,t,n);null==t.domainMin&&null==t.domainMax||Te.error("No scale domain defined for domainMin/domainMax to override.")}function kt(e,t){return e&&(e.field||e.op?e.field||"count"===e.op?t&&e.field?Te.error("Multiple domain scales can not sort by field."):t&&e.op&&"count"!==e.op&&Te.error("Multiple domain scales support op count only."):Te.error("No field provided for sort aggregate op: "+e.op):Te.isObject(e)?e.field="key":e={field:"key"}),e}function St(e,t,n){return Te.isArray(e)?e.map(function(e){return St(e,t,n)}):Te.isObject(e)?e.signal?n.signalRef(e.signal):"fit"===t?e:Te.error("Unsupported parameter object: "+Te.stringValue(e)):e}var wt="top",Rt="left",Ot="right",zt="bottom",Pt="vertical",jt="index",Dt="label",$t="offset",_t="perc",Et="perc2",Vt="size",At="value",Ft="guide-label",Wt="guide-title",Lt="group-title",Ct="symbol",Mt="gradient",qt="discrete",Bt=["size","shape","fill","stroke","strokeDash","opacity"],Tt={name:1,interactive:1},Nt=Te.toSet(["rule"]),Ut=Te.toSet(["group","image","rect"]);function It(e,t,n,r){var a=Be(e,t);return a.$fields.forEach(function(e){r[e]=1}),Te.extend(n,a.$params),a.$expr}function Xt(e,t,n,r){return function e(t,n,r,a){var i,o,l;if(t.signal)i="datum",l=It(t.signal,n,r,a);else if(t.group||t.parent){for(o=Math.max(1,t.level||1),i="item";0<o--;)i+=".mark.group";t.parent?(l=t.parent,i+=".datum"):l=t.group}else t.datum?(i="datum",l=t.datum):Te.error("Invalid field reference: "+Te.stringValue(t));t.signal||(Te.isString(l)?(a[l]=1,l=Te.splitAccessPath(l).map(Te.stringValue).join("][")):l=e(l,n,r,a));return i+"["+l+"]"}(Te.isObject(e)?e:{datum:e},t,n,r)}function Yt(e,t,n,r,a){var i,o,l,s=Gt(e.scale,n,r,a);return null!=e.range?(o=s+".range()",t=0===(i=+e.range)?o+"[0]":"($="+o+","+(1===i?"$[$.length-1]":"$[0]+"+i+"*($[$.length-1]-$[0])")+")"):(void 0!==t&&(t=s+"("+t+")"),e.band&&(l=function(e,t){if(!Te.isString(e))return-1;var n=t.scaleType(e);return"band"===n||"point"===n?1:0}(e.scale,n))&&(i=(o=s+".bandwidth")+"()"+(1===(i=+e.band)?"":"*"+i),l<0&&(i="("+o+"?"+i+":0)"),t=(t?t+"+":"")+i,e.extra&&(t="(datum.extra?"+s+"(datum.extra.value):"+t+")")),null==t&&(t="0")),t}function Gt(e,t,n,r){var a;if(Te.isString(e))a=O+e,n.hasOwnProperty(a)||(n[a]=t.scaleRef(e)),a=Te.stringValue(a);else{for(a in t.scales)n[O+a]=t.scaleRef(a);a=Te.stringValue(O)+"+"+(e.signal?"("+It(e.signal,t,n,r)+")":Xt(e,t,n,r))}return"_["+a+"]"}function Ht(e,t,n,r){return Te.isObject(e)?"("+Jt(null,e,t,n,r)+")":e}function Jt(e,t,n,r,a){if(null!=t.gradient)return o=n,l=r,s=a,"this.gradient("+Gt((i=t).gradient,o,l,s)+","+Te.stringValue(i.start)+","+Te.stringValue(i.stop)+","+Te.stringValue(i.count)+")";var i,o,l,s,u=t.signal?It(t.signal,n,r,a):t.color?function(e,a,i,o){function t(e,t,n,r){return"this."+e+"("+[Jt(null,t,a,i,o),Jt(null,n,a,i,o),Jt(null,r,a,i,o)].join(",")+").toString()"}return e.c?t("hcl",e.h,e.c,e.l):e.h||e.s?t("hsl",e.h,e.s,e.l):e.l||e.a?t("lab",e.l,e.a,e.b):e.r||e.g||e.b?t("rgb",e.r,e.g,e.b):null}(t.color,n,r,a):null!=t.field?Xt(t.field,n,r,a):void 0!==t.value?Te.stringValue(t.value):void 0;return null!=t.scale&&(u=Yt(t,u,n,r,a)),void 0===u&&(u=null),null!=t.exponent&&(u="Math.pow("+u+","+Ht(t.exponent,n,r,a)+")"),null!=t.mult&&(u+="*"+Ht(t.mult,n,r,a)),null!=t.offset&&(u+="+"+Ht(t.offset,n,r,a)),t.round&&(u="Math.round("+u+")"),u}function Kt(e,t,n){return e+"["+Te.stringValue(t)+"]="+n+";"}function Qt(e,t,n,r,a){var i="";return t.forEach(function(e){var t=Jt(0,e,n,r,a);i+=e.test?It(e.test,n,r,a)+"?"+t+":":t}),Kt("o",e,i)}function Zt(e,t,n,r){var a,i,o,l,s,u={},d="var o=item,datum=o.datum,$;";for(a in e)i=e[a],Te.isArray(i)?d+=Qt(a,i,r,n,u):d+=Kt("o",a,Jt(0,i,r,n,u));return d+=(o=e,s="",Nt[l=t]||(o.x2&&(o.x?(Ut[l]&&(s+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),s+="o.width=o.x2-o.x;"):s+="o.x=o.x2-(o.width||0);"),o.xc&&(s+="o.x=o.xc-(o.width||0)/2;"),o.y2&&(o.y?(Ut[l]&&(s+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),s+="o.height=o.y2-o.y;"):s+="o.y=o.y2-(o.height||0);"),o.yc&&(s+="o.y=o.yc-(o.height||0)/2;")),s),{$expr:d+="return 1;",$fields:Object.keys(u),$output:Object.keys(e)}}var en="mark",tn="frame",nn="scope",rn="axis",an="axis-domain",on="axis-grid",ln="axis-label",sn="axis-tick",un="axis-title",dn="legend",cn="legend-band",fn="legend-entry",gn="legend-gradient",pn="legend-label",hn="legend-symbol",mn="legend-title",vn="title";function yn(e){return Te.isObject(e)?Te.extend({},e):{value:e}}function bn(e,t,n){return null!=n?(e[t]=Te.isObject(n)&&!Te.isArray(n)?n:{value:n},1):0}function xn(e,t,n){for(var r in t)n&&n.hasOwnProperty(r)||(e[r]=Te.extend(e[r]||{},t[r]));return e}function kn(e,t,n,r,a,i){var o,l;for(l in(i=i||{}).encoders={$encode:o={}},e=function(r,e,t,n,a){var i,o,l={};"legend"!=t&&0!==String(t).indexOf("axis")||(t=null);for(i in o=t===tn?a.group:t===en?Te.extend({},a.mark,a[e]):null)wn(i,r)||("fill"===i||"stroke"===i)&&(wn("fill",r)||wn("stroke",r))||(l[i]=Sn(o[i]));return Te.array(n).forEach(function(e){var t=a.style&&a.style[e];for(var n in t)wn(n,r)||(l[n]=Sn(t[n]))}),(r=Te.extend({},r)).enter=Te.extend(l,r.enter),r}(e,t,n,r,a.config))o[l]=Zt(e[l],t,i,a);return i}function Sn(e){return e&&e.signal?{signal:e.signal}:{value:e}}function wn(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}function Rn(e,t,n,r,a,i,o){return{type:e,name:o?o.name:void 0,role:t,style:o&&o.style||n,key:r,from:a,interactive:!(!o||!o.interactive),encode:xn(i,o,Tt)}}function On(e,t,n){return Ue(t[e],n[e])}function zn(e,t){return Ue(e.direction,t)===Pt}function Pn(e,t){return Ue(e.gradientLength,t.gradientLength||t.gradientWidth)}function jn(e,t){return Ue(e.gradientThickness,t.gradientThickness||t.gradientHeight)}function Dn(e,t){var n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}var $n="group",_n="rect",En="rule",Vn="symbol",An="text";var Fn="datum."+_t+'<=0?"left":datum.'+_t+'>=1?"right":"center"',Wn="datum."+_t+'<=0?"bottom":datum.'+_t+'>=1?"top":"middle"';function Ln(e,t,n,r){var a,i,o,l,s={value:0},u=zn(e,t.gradientDirection),d=yn(jn(e,t)),c=Pn(e,t),f=On("labelOverlap",e,t),g={},p="";return g.enter=a={opacity:s},bn(a,"fill",On("labelColor",e,t)),bn(a,"font",On("labelFont",e,t)),bn(a,"fontSize",On("labelFontSize",e,t)),bn(a,"fontWeight",On("labelFontWeight",e,t)),bn(a,"limit",Ue(e.labelLimit,t.gradientLabelLimit)),g.exit={opacity:s},g.update=i={opacity:{value:1},text:{field:Dt}},u?(a.align={value:"left"},a.baseline=i.baseline={signal:Wn},o="y",l="x",p="1-"):(a.align=i.align={signal:Fn},a.baseline={value:"top"},o="x",l="y"),a[o]=i[o]={signal:p+"datum."+_t,mult:c},a[l]=i[l]=d,d.offset=Ue(e.labelOffset,t.gradientLabelOffset)||0,e=Rn(An,pn,Ft,At,r,g,n),f&&(e.overlap={method:f,order:"datum."+jt}),e}function Cn(e,t,n,r,a,i,o,l){return{type:$n,name:n,role:e,style:t,from:r,interactive:a||!1,encode:i,marks:o,layout:l}}var Mn={value:0};function qn(e,t){return{align:On("gridAlign",e,t),center:{row:!0,column:!1},columns:(n=e,r=t,Ue(n.columns,Ue(r.columns,+zn(n,r.symbolDirection)))),padding:{row:On("rowPadding",e,t),column:On("columnPadding",e,t)}};var n,r}function Bn(e){return Te.isObject(e)&&e.signal?e.signal:Te.stringValue(e)}function Tn(e){var t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")?e.type===$n?nn:t||en:t}function Nn(e,t){var n=p.definition(e.type);n||Te.error("Unrecognized transform type: "+Te.stringValue(e.type));var r=de(n.type.toLowerCase(),null,Un(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function Un(e,t,n){var r,a,i,o={};for(a=0,i=e.params.length;a<i;++a)o[(r=e.params[a]).name]=In(r,t,n);return o}function In(t,e,n){var r,a,i,o=t.type,l=e[t.name];if("index"===o)return function(e,t,n){Te.isString(t.from)||Te.error('Lookup "from" parameter must be a string literal.');return n.getData(t.from).lookupRef(n,t.key)}(0,e,n);{if(void 0!==l)return"param"===o?(a=n,i=e[(r=t).name],r.array?(Te.isArray(i)||Te.error("Expected an array of sub-parameters. Instead: "+Te.stringValue(i)),i.map(function(e){return Yn(r,e,a)})):Yn(r,i,a)):"projection"===o?n.projectionRef(e[t.name]):t.array&&!xe(l)?l.map(function(e){return Xn(t,e,n)}):Xn(t,l,n);t.required&&Te.error("Missing required "+Te.stringValue(e.type)+" parameter: "+Te.stringValue(t.name))}}function Xn(e,t,n){var r=e.type;if(xe(t))return Gn(r)?Te.error("Expression references can not be signals."):Hn(r)?n.fieldRef(t):Jn(r)?n.compareRef(t):n.signalRef(t.signal);var a,i,o=e.expr||Hn(r);return o&&((i=t)&&i.expr)?Be(t.expr,n):o&&((a=t)&&a.field)?ge(t.field):Gn(r)?Be(t,n):"data"===r?Ne(n.getData(t).values):Hn(r)?ge(t):Jn(r)?n.compareRef(t):t}function Yn(e,t,n){var r,a,i,o,l;for(o=0,l=e.params.length;o<l;++o){for(i in(a=e.params[o]).key)if(a.key[i]!==t[i]){a=null;break}if(a)break}return a||Te.error("Unsupported parameter: "+Te.stringValue(t)),r=Te.extend(Un(a,t,n),a.key),Ne(n.add(Ke(r)))}function Gn(e){return"expr"===e}function Hn(e){return"field"===e}function Jn(e){return"compare"===e}function Kn(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:Ne(t.getData(e.data).output)}function Qn(e,t,n,r,a){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=a,this.index={}}Qn.fromEntries=function(e,t){var n=t.length,r=1,a=t[0],i=t[n-1],o=t[n-2],l=null;for(e.add(t[0]);r<n;++r)t[r].params.pulse=Ne(t[r-1]),e.add(t[r]),"aggregate"===t[r].type&&(l=t[r]);return new Qn(e,a,o,i,l)};var Zn=Qn.prototype;function er(e){return Te.isString(e)?e:null}function tr(e,t,n){var r,a=ve(n.op,n.field);if(t.ops){for(var i=0,o=t.as.length;i<o;++i)if(t.as[i]===a)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(a))}function nr(e,t,n,r,a,i,o){var l,s,u,d=t[n]||(t[n]={}),c=(u=i,Te.isObject(u)?(u.order===me?"-":"+")+ve(u.op,u.field):""),f=er(a);if(null!=f&&(e=t.scope,l=d[f+=c?"|"+c:""]),!l){var g=i?{field:pe,pulse:t.countsRef(e,a,i)}:{field:e.fieldRef(a),pulse:Ne(t.output)};c&&(g.sort=e.sortRef(i)),s=e.add(de(r,void 0,g)),o&&(t.index[a]=s),l=Ne(s),null!=f&&(d[f]=l)}return l}function rr(e,t,n){var r,a=e.remove,i=e.insert,o=e.toggle,l=e.modify,s=e.values,u=t.add(ce());r=Be("if("+e.trigger+',modify("'+n+'",'+[i,a,o,l,s].map(function(e){return null==e?"null":e}).join(",")+"),0)",t),u.update=r.$expr,u.params=r.$params}function ar(e,n){var t,r,a,i,o,l,s,u,d,c,f,g,p,h,m,v,y,b,x,k,S,w,R,O,z,P,j,D,$,_,E,V,A,F,W,L,C,M,q,B,T,N,U=Tn(e),I=e.type===$n,X=e.from&&e.from.facet,Y=e.layout||U===nn||U===tn,G=U===en||Y||X,H=e.overlap;h=e.from,m=I,v=n,h?(y=h.facet)&&(m||Te.error("Only group marks can be faceted."),null!=y.field?k=S=Kn(y,v):(h.data?S=Ne(v.getData(h.data).aggregate):((x=Nn(Te.extend({type:"aggregate",groupby:Te.array(y.groupby)},y.aggregate),v)).params.key=v.keyRef(y.groupby),x.params.pulse=Kn(y,v),k=S=Ne(v.add(x))),b=v.keyRef(y.groupby,!0))):k=Ne(v.add(Ye(null,[{}]))),k||(k=Kn(h,v)),a={key:b,pulse:k,parent:S},d=Ne(r=n.add(Ae({key:a.key||(e.key?ge(e.key):void 0),pulse:a.pulse,clean:!I}))),r=i=n.add(Ye({pulse:d})),c=Ne(r=n.add(Me({markdef:(j=e,{marktype:j.type,name:j.name||void 0,role:j.role||Tn(j),zindex:+j.zindex||void 0}),interactive:(z=e.interactive,P=n,z&&z.signal?P.signalRef(z.signal):!1!==z),clip:(w=e.clip,R=n,Te.isObject(w)&&(w.signal?O=w.signal:w.path?O="pathShape("+Bn(w.path)+")":w.sphere&&(O="geoShape("+Bn(w.sphere)+', {type: "Sphere"})')),O?R.signalRef(O):!!w),context:{$context:!0},groups:n.lookup(),parent:n.signals.parent?n.signalRef("parent"):null,index:n.markpath(),pulse:Ne(r)}))),(r=n.add(Fe(kn(e.encode,e.type,U,e.style,n,{pulse:c})))).params.parent=n.encode(),e.transform&&e.transform.forEach(function(e){var t=Nn(e,n);(t.metadata.generates||t.metadata.changes)&&Te.error("Mark transforms should not generate new data."),t.params.pulse=Ne(r),n.add(r=t)}),e.sort&&(r=n.add(it({sort:n.compareRef(e.sort,!0),pulse:Ne(r)}))),f=Ne(r),(X||Y)&&(g=Ne(Y=n.add(ot({layout:n.objectProperty(e.layout),legendMargin:n.config.legendMargin,mark:c,pulse:f})))),p=Ne(o=n.add(Ee({mark:c,pulse:g||f}))),I&&(G&&((t=n.operators).pop(),Y&&t.pop()),n.pushState(f,g||p,d),X?(F=n,W=a,B=(A=e).from.facet,T=B.name,N=Kn(B,F),B.name||Te.error("Facet must have a name: "+Te.stringValue(B)),B.data||Te.error("Facet must reference a data set: "+Te.stringValue(B)),B.field?q=F.add(Qe({field:F.fieldRef(B.field),pulse:N})):B.groupby?q=F.add(We({key:F.keyRef(B.groupby),group:Ne(F.proxy(W.parent)),pulse:N})):Te.error("Facet must specify groupby or field: "+Te.stringValue(B)),C=(L=F.fork()).add(Ye()),M=L.add(at({pulse:Ne(C)})),L.addData(T,new Qn(L,C,C,M)),L.addSignal("parent",null),q.params.subflow={$subflow:hr(A,L).toRuntime()}):G?(D=e,_=a,E=($=n).add(Qe({pulse:_.pulse})),(V=$.fork()).add(at()),V.addSignal("parent",null),E.params.subflow={$subflow:hr(D,V).toRuntime()}):hr(e,n),n.popState(),G&&(Y&&t.push(Y),t.push(o))),H&&(r={method:!0===H.method?"parity":H.method,pulse:p},H.order&&(r.sort=n.compareRef({field:H.order})),H.bound&&(r.boundScale=n.scaleRef(H.bound.scale),r.boundOrient=H.bound.orient,r.boundTolerance=H.bound.tolerance),p=Ne(n.add(Je(r)))),l=n.add(nt({pulse:p})),s=n.add(at({pulse:Ne(l)},void 0,n.parent())),null!=e.name&&(u=e.name,n.addData(u,new Qn(n,i,l,s)),e.on&&e.on.forEach(function(e){(e.insert||e.remove||e.toggle)&&Te.error("Marks only support modify triggers."),rr(e,n,u)}))}function ir(n,e){var t,r,a,i,o,l,s,u,d,c,f,g,p,h,m,v,y,b,x,k,S,w,R,O,z,P,j,D,$,_,E,V,A,F,W,L,C,M,q,B,T,N,U,I,X,Y,G,H,J,K,Q,Z,ee,te,ne,re,ae,ie,oe,le,se,ue,de,ce,fe,ge,pe,he,me,ve,ye,be,xe,ke,Se,we,Re,Oe,ze,Pe,je,De,$e,_e,Ee,Ve,Ae=e.config.legend,Fe=n.encode||{},We=Fe.legend||{},Le=We.name||void 0,Ce=We.interactive,Me=We.style,qe=Bt.reduce(function(e,t){return e||n[t]},0);return qe||Te.error("Missing valid scale for legend."),o=function(e,t){var n=e.type||Ct;e.type||1!==(a=e,Bt.reduce(function(e,t){return e+(a[t]?1:0)},0))||!e.fill&&!e.stroke||(r=t,n=ft.hasOwnProperty(r)?Mt:ht(t)?qt:Ct);var r;var a;return n!==Mt?n:ht(t)?qt:Mt}(n,e.scaleType(qe)),l={orient:On("orient",n,Ae),title:null!=n.title,type:o},s=Ne(e.add(Ye(null,[l]))),We=xn({enter:(c=n,f=Ae,g={},bn(g,"fill",On("fillColor",c,f))+bn(g,"stroke",On("strokeColor",c,f))+bn(g,"strokeWidth",On("strokeWidth",c,f))+bn(g,"cornerRadius",On("cornerRadius",c,f))+bn(g,"strokeDash",f.strokeDash)?g:void 0),update:{offset:yn(On("offset",n,Ae)),padding:yn(On("padding",n,Ae)),titlePadding:yn(On("titlePadding",n,Ae))}},We,Tt),t={enter:{x:{value:0},y:{value:0}}},u=Ne(e.add(Ge(a={type:o,scale:e.scaleRef(qe),count:e.objectProperty(n.tickCount),values:e.objectProperty(n.values),formatSpecifier:e.property(n.format)}))),o===Mt?(i=[(fe=n,ge=qe,pe=Ae,he=Fe.gradient,Se={value:0},we=zn(fe,pe.gradientDirection),Re=jn(fe,pe),Oe=Pn(fe,pe),ze={},we?(ye=[0,1],be=[0,0],xe=Re,ke=Oe):(ye=[0,0],be=[1,0],xe=Oe,ke=Re),ze.enter=me={opacity:Se,x:Se,y:Se},bn(me,"stroke",On("gradientStrokeColor",fe,pe)),bn(me,"strokeWidth",On("gradientStrokeWidth",fe,pe)),ze.exit={opacity:Se},ze.update=ve={x:Se,y:Se,fill:{gradient:ge,start:ye,stop:be},opacity:{value:1}},me.width=ve.width=yn(xe),me.height=ve.height=yn(ke),Rn(_n,gn,null,void 0,void 0,ze,he)),Ln(n,Ae,Fe.labels,u)],a.count=a.count||e.signalRef("max(2,2*floor(("+Ie(Pn(n,Ae))+")/100))")):o===qt?i=[(H=n,J=qe,K=Ae,Q=Fe.gradient,Z=u,oe={value:0},le=zn(H,K.gradientDirection),se=jn(H,K),ue=Pn(H,K),de={},ce="",le?(ne="y",ae="y2",re="x",ie="width",ce="1-"):(ne="x",ae="x2",re="y",ie="height"),de.enter=ee={opacity:oe},bn(ee,"stroke",On("gradientStrokeColor",H,K)),bn(ee,"strokeWidth",On("gradientStrokeWidth",H,K)),de.exit={opacity:oe},de.update=te={opacity:{value:1}},ee.fill=te.fill={scale:J,field:At},ee[ne]=te[ne]={signal:ce+"datum."+_t,mult:ue},ee[re]=te[re]={value:0},ee[ae]=te[ae]={signal:ce+"datum."+Et,mult:ue},ee[ie]=te[ie]=yn(se),Rn(_n,cn,null,At,Z,de,Q)),Ln(n,Ae,Fe.labels,u)]:(r=qn(n,Ae),i=[(z=n,P=Ae,j=Fe,D=u,$=Ie(r.columns),C=j.entries,M=!(!C||!C.interactive),q=C?C.name:void 0,B=On("clipHeight",z,P),T=On("symbolOffset",z,P),N={data:"value"},U={},I=$+"?datum."+$t+":datum."+Vt,X=B?yn(B):{field:Vt},Y="datum."+jt,G="max(1,"+$+")",U={enter:_={opacity:Mn},exit:{opacity:Mn},update:E={opacity:{value:1}}},z.fill||(bn(_,"fill",P.symbolBaseFillColor),bn(_,"stroke",P.symbolBaseStrokeColor)),bn(_,"shape",On("symbolType",z,P)),bn(_,"size",On("symbolSize",z,P)),bn(_,"strokeWidth",On("symbolStrokeWidth",z,P)),bn(_,"fill",On("symbolFillColor",z,P)),bn(_,"stroke",On("symbolStrokeColor",z,P)),_.x=E.x={signal:I,mult:.5,offset:T},X.mult=.5,_.y=E.y=X,Bt.forEach(function(e){z[e]&&(E[e]=_[e]={scale:z[e],field:At})}),A=Rn(Vn,hn,null,At,N,U,j.symbols),B&&(A.clip=!0),U={enter:_={opacity:Mn},exit:{opacity:Mn},update:E={opacity:{value:1},text:{field:Dt}}},bn(_,"align",On("labelAlign",z,P)),bn(_,"baseline",On("labelBaseline",z,P)),bn(_,"fill",On("labelColor",z,P)),bn(_,"font",On("labelFont",z,P)),bn(_,"fontSize",On("labelFontSize",z,P)),bn(_,"fontWeight",On("labelFontWeight",z,P)),bn(_,"limit",On("labelLimit",z,P)),(V=yn(T)).offset=On("labelOffset",z,P),_.x=E.x={signal:I,offset:V},_.y=E.y=X,F=Rn(An,pn,Ft,At,N,U,j.labels),U={enter:{width:Mn,height:B?yn(B):Mn,opacity:Mn},exit:{opacity:Mn},update:E={opacity:{value:1},row:{signal:null},column:{signal:null}}},zn(z,P.symbolDirection)?(W="ceil(item.mark.items.length/"+G+")",E.row.signal=Y+"%"+W,E.column.signal="floor("+Y+"/"+W+")",L={field:["row",Y]}):(E.row.signal="floor("+Y+"/"+G+")",E.column.signal=Y+"%"+G,L={field:Y}),E.column.signal=$+"?"+E.column.signal+":"+Y,(z=Cn(nn,null,q,D={facet:{data:D,name:"value",groupby:jt}},M,xn(U,C,Tt),[A,F])).sort=L,z)],a.size=(p=n,h=e,m=i[0].marks,b=Dn("strokeWidth",m[0].encode),y=p.size?'scale("'+p.size+'",datum)':Dn("size",m[0].encode),x=m[1].encode,k=h,S=Ft,v=Dn("fontSize",x)||(w="fontSize",R=S,(O=k.config.style[R])&&O[w]),Be("max(ceil(sqrt("+Ie(y)+")+"+Ie(b)+"),"+Ie(v)+")",h))),i=[Cn(fn,null,null,s,Ce,t,i,r)],l.title&&i.push((Pe=n,je=Ae,De=Fe.title,$e=s,(Ve={}).enter=_e={x:{field:{group:"padding"}},y:{field:{group:"padding"}},opacity:Ee={value:0}},bn(_e,"align",On("titleAlign",Pe,je)),bn(_e,"baseline",On("titleBaseline",Pe,je)),bn(_e,"fill",On("titleColor",Pe,je)),bn(_e,"font",On("titleFont",Pe,je)),bn(_e,"fontSize",On("titleFontSize",Pe,je)),bn(_e,"fontWeight",On("titleFontWeight",Pe,je)),bn(_e,"limit",On("titleLimit",Pe,je)),Ve.exit={opacity:Ee},Ve.update={opacity:{value:1},text:yn(Pe.title)},Rn(An,mn,Wt,null,$e,Ve,De))),d=Cn(dn,Me,Le,s,Ce,We,i),n.zindex&&(d.zindex=n.zindex),ar(d,e)}function or(e,t,n){return'item.anchor==="start"?'+e+':item.anchor==="end"?'+t+":"+n}Zn.countsRef=function(e,t,n){var r,a,i,o=this.counts||(this.counts={}),l=er(t);return null!=l&&(e=this.scope,r=o[l]),r?n&&n.field&&tr(e,r.agg.params,n):(i={groupby:e.fieldRef(t,"key"),pulse:Ne(this.output)},n&&n.field&&tr(e,i,n),r={agg:a=e.add(_e(i)),ref:Ne(r=e.add(Ye({pulse:Ne(a)})))},null!=l&&(o[l]=r)),r.ref},Zn.tuplesRef=function(){return Ne(this.values)},Zn.extentRef=function(e,t){return nr(e,this,"extent","extent",t,!1)},Zn.domainRef=function(e,t){return nr(e,this,"domain","values",t,!1)},Zn.valuesRef=function(e,t,n){return nr(e,this,"vals","values",t,n||!0)},Zn.lookupRef=function(e,t){return nr(e,this,"lookup","tupleindex",t,!1)},Zn.indataRef=function(e,t){return nr(e,this,"indata","tupleindex",t,!0,!0)};var lr=or(Te.stringValue(Rt),Te.stringValue(Ot),Te.stringValue("center")),sr=or('+(item.orient==="'+Ot+'")','+(item.orient!=="'+Rt+'")',"0.5");function ur(e,t){e=Te.isString(e)?{text:e}:e;var n,r,a,i=t.config.title,o=Te.extend({},e.encode);return n={orient:On("orient",e,i)},r=Ne(t.add(Ye(null,[n]))),o.name=e.name,o.interactive=e.interactive,a=function(e,t,n,r){var a,i,o,l,s={value:0},u=e.text,d=On("orient",e,t),c=On("anchor",e,t),f=d===Rt||d===wt?-1:1,g=d===wt||d===zt,p={group:g?"width":"height"},h={};o={field:p,mult:{signal:sr}},l=f<0?s:g?{field:{group:"height"}}:{field:{group:"width"}},h.enter=a={opacity:s},bn(a,"fill",On("color",e,t)),bn(a,"font",On("font",e,t)),bn(a,"fontSize",On("fontSize",e,t)),bn(a,"fontWeight",On("fontWeight",e,t)),h.exit={opacity:s},h.update=i={opacity:{value:1},text:yn(u),anchor:yn(c),orient:yn(d),extent:{field:p},align:{signal:lr}},g?(i.x=o,i.y=l,i.angle=s,i.baseline={value:d===wt?zt:wt}):(i.x=l,i.y=o,i.angle={value:90*f},i.baseline={value:zt});return bn(i,"offset",On("offset",e,t)||0),bn(i,"frame",On("frame",e,t)),bn(i,"angle",On("angle",e,t)),bn(i,"baseline",On("baseline",e,t)),bn(i,"limit",On("limit",e,t)),Rn(An,vn,e.style||Lt,null,r,h,n)}(e,i,o,r),e.zindex&&(a.zindex=e.zindex),ar(a,t)}function dr(t,n){var r=[];t.transform&&t.transform.forEach(function(e){r.push(Nn(e,n))}),t.on&&t.on.forEach(function(e){rr(e,n,t.name)}),n.addDataPipeline(t.name,function(e,t,n){var r,a,i,o,l,s=[],u=null,d=!1,c=!1;e.values?s.push(u=cr({$ingest:e.values,$format:e.format})):e.url?s.push(u=cr({$request:e.url,$format:e.format})):e.source&&(u=r=Te.array(e.source).map(function(e){return Ne(t.getData(e).output)}),s.push(null));for(a=0,i=n.length;a<i;++a)o=n[a],l=o.metadata,u||l.source||s.push(u=cr()),s.push(o),l.generates&&(c=!0),l.modifies&&!c&&(d=!0),l.source?u=o:l.changes&&(u=null);r&&(i=r.length-1,s[0]=tt({derive:d,pulse:i?r:r[0]}),(d||i)&&s.splice(1,0,cr()));u||s.push(cr());return s.push(at({})),s}(t,n,r))}function cr(e){var t=Ye({},e);return t.metadata={source:!0},t}function fr(e,t){return{scale:e.scale,range:t}}function gr(e,t,n,r,a){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+a+")"}}function pr(e,t){var n,r,a,i,o,l,s,u,d,c,f,g,p,h,m,v,y,b,x,k,S,w,R,O,z,P,j,D,$,_,E,V,A,F,W,L,C,M,q,B,T,N,U,I,X,Y,G,H,J,K,Q,Z,ee,te,ne,re,ae,ie,oe,le,se,ue,de,ce,fe,ge,pe,he,me,ve,ye,be,xe,ke,Se,we,Re,Oe,ze,Pe,je,De,$e,_e,Ee,Ve,Ae,Fe,We=(s=e,d=(u=t).config,c=s.orient,f=c===wt||c===zt?d.axisX:d.axisY,g=d["axis"+c[0].toUpperCase()+c.slice(1)],p="band"===u.scaleType(s.scale)&&d.axisBand,f||g||p?Te.extend({},d.axis,f,g,p):d.axis),Le=e.encode||{},Ce=Le.axis||{},Me=Ce.name||void 0,qe=Ce.interactive,Be=Ce.style;return n={orient:e.orient,ticks:!!On("ticks",e,We),labels:!!On("labels",e,We),grid:!!On("grid",e,We),domain:!!On("domain",e,We),title:!!Ue(e.title,!1)},r=Ne(t.add(Ye({},[n]))),Ce=xn({update:{range:{signal:'abs(span(range("'+e.scale+'")))'},offset:yn(Ue(e.offset,0)),position:yn(Ue(e.position,0)),titlePadding:yn(On("titlePadding",e,We)),minExtent:yn(On("minExtent",e,We)),maxExtent:yn(On("maxExtent",e,We))}},Le.axis,Tt),a=Ne(t.add(Xe({scale:t.scaleRef(e.scale),extra:t.property(On("tickExtra",e,We)),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),formatSpecifier:t.property(e.format)}))),l=[],n.grid&&l.push((h=e,m=We,v=Le.grid,y=a,P=h.orient,j=h.gridScale,$=(D=P===Rt||P===wt?1:-1)*h.offset||0,(E={}).enter=b={opacity:_={value:0}},bn(b,"stroke",On("gridColor",h,m)),bn(b,"strokeWidth",On("gridWidth",h,m)),bn(b,"strokeDash",On("gridDash",h,m)),E.exit=x={opacity:_},E.update=k={},bn(k,"opacity",On("gridOpacity",h,m)),S={scale:h.scale,field:At,band:On("bandPosition",h,m),round:On("tickRound",h,m),extra:On("tickExtra",h,m),offset:On("tickOffset",h,m)},P===wt||P===zt?(w="x",R="y",z="height"):(w="y",R="x",z="width"),O=R+"2",k[w]=b[w]=x[w]=S,j?(b[R]={scale:j,range:0,mult:D,offset:$},k[O]=b[O]={scale:j,range:1,mult:D,offset:$}):(b[R]={value:$},k[O]=b[O]={signal:z,mult:D,offset:$}),Rn(En,on,null,At,y,E,v))),n.ticks&&(i=On("tickSize",e,We),l.push((V=e,A=We,F=Le.ticks,W=a,L=i,N=V.orient,U=N===Rt||N===wt?-1:1,(X={}).enter=C={opacity:I={value:0}},bn(C,"stroke",On("tickColor",V,A)),bn(C,"strokeWidth",On("tickWidth",V,A)),X.exit=M={opacity:I},X.update=q={opacity:{value:1}},(B=yn(L)).mult=U,T={scale:V.scale,field:At,band:On("bandPosition",V,A),round:On("tickRound",V,A),extra:On("tickExtra",V,A),offset:On("tickOffset",V,A)},N===wt||N===zt?(q.y=C.y=I,q.y2=C.y2=B,q.x=C.x=M.x=T):(q.x=C.x=I,q.x2=C.x2=B,q.y=C.y=M.y=T),Rn(En,sn,null,At,W,X,F)))),n.labels&&(i=n.ticks?i:0,l.push((Y=e,G=We,H=Le.labels,J=a,K=i,re=Y.orient,ae=re===Rt||re===wt?-1:1,ie=Y.scale,oe=On("labelBound",Y,G),le=On("labelFlush",Y,G),se=null!=le&&!1!==le&&(le=+le)===le,ue=+On("labelFlushOffset",Y,G),de=On("labelOverlap",Y,G),(fe={}).enter=Q={opacity:ce={value:0}},bn(Q,"angle",On("labelAngle",Y,G)),bn(Q,"fill",On("labelColor",Y,G)),bn(Q,"font",On("labelFont",Y,G)),bn(Q,"fontSize",On("labelFontSize",Y,G)),bn(Q,"fontWeight",On("labelFontWeight",Y,G)),bn(Q,"limit",On("labelLimit",Y,G)),fe.exit=Z={opacity:ce},fe.update=ee={opacity:{value:1},text:{field:Dt}},(te=yn(K)).mult=ae,te.offset=yn(On("labelPadding",Y,G)||0),te.offset.mult=ae,ne={scale:ie,field:At,band:.5,offset:On("tickOffset",Y,G)},re===wt||re===zt?(ee.y=Q.y=te,ee.x=Q.x=Z.x=ne,bn(ee,"align",se?gr(ie,le,'"left"','"right"','"center"'):"center"),se&&ue&&bn(ee,"dx",gr(ie,le,-ue,ue,0)),bn(ee,"baseline",re===wt?"bottom":"top")):(ee.x=Q.x=te,ee.y=Q.y=Z.y=ne,bn(ee,"align",re===Ot?"left":"right"),bn(ee,"baseline",se?gr(ie,le,'"bottom"','"top"','"middle"'):"middle"),se&&ue&&bn(ee,"dy",gr(ie,le,ue,-ue,0))),Y=Rn(An,ln,Ft,At,J,fe,H),(de||oe)&&(Y.overlap={method:de,order:"datum.index",bound:oe?{scale:ie,orient:re,tolerance:+oe}:null}),Y))),n.domain&&l.push((ge=e,pe=We,he=Le.domain,me=r,Se=ge.orient,(Re={}).enter=ve={opacity:we={value:0}},bn(ve,"stroke",On("domainColor",ge,pe)),bn(ve,"strokeWidth",On("domainWidth",ge,pe)),Re.exit={opacity:we},Re.update=ye={opacity:{value:1}},Se===wt||Se===zt?(be="x",ke="y"):(be="y",ke="x"),xe=be+"2",ve[ke]=we,ye[be]=ve[be]=fr(ge,0),ye[xe]=ve[xe]=fr(ge,1),Rn(En,an,null,null,me,Re,he))),n.title&&l.push((Oe=e,ze=We,Pe=Le.title,je=r,Ee=Oe.orient,Ve=Ee===Rt||Ee===wt?-1:1,Ae=Ee===wt||Ee===zt,(Fe={}).enter=De={opacity:{value:0}},bn(De,"align",On("titleAlign",Oe,ze)),bn(De,"fill",On("titleColor",Oe,ze)),bn(De,"font",On("titleFont",Oe,ze)),bn(De,"fontSize",On("titleFontSize",Oe,ze)),bn(De,"fontWeight",On("titleFontWeight",Oe,ze)),bn(De,"limit",On("titleLimit",Oe,ze)),Fe.exit={opacity:{value:0}},Fe.update=$e={opacity:{value:1},text:yn(Oe.title)},_e={scale:Oe.scale,range:.5},Ae?($e.x=_e,$e.angle={value:0},$e.baseline={value:Ee===wt?"bottom":"top"}):($e.y=_e,$e.angle={value:90*Ve},$e.baseline={value:"bottom"}),bn($e,"angle",On("titleAngle",Oe,ze)),bn($e,"baseline",On("titleBaseline",Oe,ze)),!bn($e,"x",On("titleX",Oe,ze))&&Ae&&!wn("x",Pe)&&(Fe.enter.auto={value:!0}),!bn($e,"y",On("titleY",Oe,ze))&&!Ae&&!wn("y",Pe)&&(Fe.enter.auto={value:!0}),Rn(An,un,Wt,null,je,Fe,Pe))),o=Cn(rn,Be,Me,r,qe,Ce,l),e.zindex&&(o.zindex=e.zindex),ar(o,t)}function hr(e,a,t){var n=Te.array(e.signals),r=Te.array(e.scales);return t||n.forEach(function(e){m(e,a)}),Te.array(e.projections).forEach(function(e){!function(e,t){var n={};for(var r in e)"name"!==r&&(n[r]=St(e[r],r,t));t.addProjection(e.name,n)}(e,a)}),r.forEach(function(e){var t,n,r;n=a,r=(t=e).type||"linear",dt.hasOwnProperty(r)||Te.error("Unrecognized scale type: "+Te.stringValue(r)),n.addScale(t.name,{type:r,domain:void 0})}),Te.array(e.data).forEach(function(e){dr(e,a)}),r.forEach(function(e){vt(e,a)}),n.forEach(function(e){De(e,a)}),Te.array(e.axes).forEach(function(e){pr(e,a)}),Te.array(e.marks).forEach(function(e){ar(e,a)}),Te.array(e.legends).forEach(function(e){ir(e,a)}),e.title&&ur(e.title,a),a.parseLambdas(),a}var mr=Te.toSet(["width","height","padding","autosize"]);function vr(e,t){var n,r,a,i,o,l,s,u,d,c,f=t.config;return t.background=e.background||f.background,t.eventConfig=f.events,o=Ne(t.root=t.add(ce())),t.addSignal("width",e.width||0),t.addSignal("height",e.height||0),t.addSignal("padding",(l=e.padding,s=f,l=l||s.padding,Te.isObject(l)?{top:h(l.top),bottom:h(l.bottom),left:h(l.left),right:h(l.right)}:{top:u=h(l),bottom:u,left:u,right:u})),t.addSignal("autosize",(d=e.autosize,c=f,d=d||c.autosize,Te.isObject(d)?d:{type:d=d||"pad"})),Te.array(e.signals).forEach(function(e){mr[e.name]||m(e,t)}),r=t.add(Ye()),a=xn({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e.encode),a=t.add(Fe(kn(a,$n,tn,e.style,t,{pulse:Ne(r)}))),i=t.add(ot({layout:t.objectProperty(e.layout),legendMargin:f.legendMargin,autosize:t.signalRef("autosize"),mark:o,pulse:Ne(a)})),t.operators.pop(),t.pushState(Ne(a),Ne(i),null),hr(e,t,!0),t.operators.push(i),n=t.add(Ee({mark:o,pulse:Ne(i)})),n=t.add(nt({pulse:Ne(n)})),n=t.add(at({pulse:Ne(n)})),t.addData("root",new Qn(t,r,r,n)),t}function yr(e){this.config=e,this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.background=null,this.eventConfig=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function br(e){this.config=e.config,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}var xr=yr.prototype=br.prototype;function kr(e){return(Te.isArray(e)?function(e){for(var t,n="[",r=0,a=e.length;r<a;++r)t=e[r],n+=(0<r?",":"")+(Te.isObject(t)?t.signal||kr(t):Te.stringValue(t));return n+"]"}:function(e){var t,n,r="{",a=0;for(t in e)n=e[t],r+=(1<++a?",":"")+Te.stringValue(t)+":"+(Te.isObject(n)?n.signal||kr(n):Te.stringValue(n));return r+"}"})(e)}function Sr(e){var a={padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:zr},area:{fill:zr},image:null,line:{stroke:zr,strokeWidth:Or},path:{stroke:zr},rect:{fill:zr},rule:{stroke:Pr},shape:{stroke:zr},symbol:{fill:zr,size:64},text:{fill:Pr,font:wr,fontSize:11},style:{"guide-label":{fill:Pr,font:wr,fontSize:10},"guide-title":{fill:Pr,font:wr,fontSize:11,fontWeight:"bold"},"group-title":{fill:Pr,font:wr,fontSize:13,fontWeight:"bold"},point:{size:Rr,strokeWidth:Or,shape:"circle"},circle:{size:Rr,strokeWidth:Or},square:{size:Rr,strokeWidth:Or,shape:"square"},cell:{fill:"transparent",stroke:Dr}},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:jr,grid:!1,gridWidth:1,gridColor:Dr,gridOpacity:1,labels:!0,labelAngle:0,labelLimit:180,labelPadding:2,ticks:!0,tickColor:jr,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titleAlign:"center",titlePadding:4},axisBand:{tickOffset:-1},legend:{orient:"right",offset:18,padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:Dr,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:jr,titleAlign:"left",titleBaseline:"top",titleLimit:180,titlePadding:5},title:{orient:"top",anchor:"middle",offset:4},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues",extent:[.2,1]},heatmap:{scheme:"viridis"},ramp:{scheme:"blues",extent:[.2,1]},diverging:{scheme:"blueorange"},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}};return(e||[]).forEach(function(e){var t,n,r;if(e)for(t in e)if("style"===t)for(t in r=a.style||(a.style={}),e.style)r[t]=Te.extend(r[t]||{},e.style[t]);else n=e[t],a[t]=Te.isObject(n)&&!Te.isArray(n)?Te.extend(Te.isObject(a[t])?a[t]:{},n):n}),a}xr.fork=function(){return new br(this)},xr.isSubscope=function(){return 0<this._subid},xr.toRuntime=function(){return this.finish(),{background:this.background,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig}},xr.id=function(){return(this._subid?this._subid+":":0)+this._id++},xr.add=function(t){return this.operators.push(t),t.id=this.id(),t.refs&&(t.refs.forEach(function(e){e.$ref=t.id}),t.refs=null),t},xr.proxy=function(e){var t=e instanceof ue?Ne(e):e;return this.add(et({value:t}))},xr.addStream=function(e){return this.streams.push(e),e.id=this.id(),e},xr.addUpdate=function(e){return this.updates.push(e),e},xr.finish=function(){var e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){var r;e&&((r=e.data||(e.data={}))[t]||(r[t]=[])).push(n)}for(e in this.data)for(var r in n((t=this.data[e]).input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values"),t.index)n(t.index[r],e,"index:"+r);return this},xr.pushState=function(e,t,n){this._encode.push(Ne(this.add(at({pulse:e})))),this._parent.push(t),this._lookup.push(n?Ne(this.proxy(n)):null),this._markpath.push(-1)},xr.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},xr.parent=function(){return Te.peek(this._parent)},xr.encode=function(){return Te.peek(this._encode)},xr.lookup=function(){return Te.peek(this._lookup)},xr.markpath=function(){var e=this._markpath;return++e[e.length-1]},xr.fieldRef=function(e,t){if(Te.isString(e))return ge(e,t);e.signal||Te.error("Unsupported field reference: "+Te.stringValue(e));var n,r=e.signal,a=this.field[r];return a||(n={name:this.signalRef(r)},t&&(n.as=t),this.field[r]=a=Ne(this.add(Le(n)))),a},xr.compareRef=function(e,t){function n(e){return xe(e)?(a=!0,Ne(r[e.signal])):e}var r=this.signals,a=!1,i=Te.array(e.field).map(n),o=Te.array(e.order).map(n);return t&&i.push(fe),a?Ne(this.add(Ve({fields:i,orders:o}))):he(i,o)},xr.keyRef=function(e,t){var n,r=this.signals,a=!1;return e=Te.array(e).map(function(e){return xe(e)?(a=!0,Ne(r[e.signal])):e}),a?Ne(this.add(Ce({fields:e,flat:t}))):(n={$key:e},t&&(n.$flat=!0),n)},xr.sortRef=function(e){if(!e)return e;var t=[ve(e.op,e.field),fe],n=e.order||"ascending";return n.signal?Ne(this.add(Ve({fields:t,orders:[n=this.signalRef(n.signal),n]}))):he(t,[n,n])},xr.event=function(e,t){var n=e+":"+t;if(!this.events[n]){var r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},xr.addSignal=function(e,t){this.signals.hasOwnProperty(e)&&Te.error("Duplicate signal name: "+Te.stringValue(e));var n=t instanceof ue?t:this.add(ce(t));return this.signals[e]=n},xr.getSignal=function(e){return this.signals[e]||Te.error("Unrecognized signal name: "+Te.stringValue(e)),this.signals[e]},xr.signalRef=function(e){return this.signals[e]?Ne(this.signals[e]):(this.lambdas.hasOwnProperty(e)||(this.lambdas[e]=this.add(ce(null))),Ne(this.lambdas[e]))},xr.parseLambdas=function(){for(var e=Object.keys(this.lambdas),t=0,n=e.length;t<n;++t){var r=e[t],a=Be(r,this),i=this.lambdas[r];i.params=a.$params,i.update=a.$expr}},xr.property=function(e){return e&&e.signal?this.signalRef(e.signal):e},xr.objectProperty=function(e){return e&&Te.isObject(e)?this.signalRef(e.signal||kr(e)):e},xr.addBinding=function(e,t){this.bindings||Te.error("Nested signals do not support binding: "+Te.stringValue(e)),this.bindings.push(Te.extend({signal:e},t))},xr.addScaleProj=function(e,t){this.scales.hasOwnProperty(e)&&Te.error("Duplicate scale or projection name: "+Te.stringValue(e)),this.scales[e]=this.add(t)},xr.addScale=function(e,t){this.addScaleProj(e,rt(t))},xr.addProjection=function(e,t){this.addScaleProj(e,Ze(t))},xr.getScale=function(e){return this.scales[e]||Te.error("Unrecognized scale name: "+Te.stringValue(e)),this.scales[e]},xr.projectionRef=xr.scaleRef=function(e){return Ne(this.getScale(e))},xr.projectionType=xr.scaleType=function(e){return this.getScale(e).params.type},xr.addData=function(e,t){return this.data.hasOwnProperty(e)&&Te.error("Duplicate data set name: "+Te.stringValue(e)),this.data[e]=t},xr.getData=function(e){return this.data[e]||Te.error("Undefined data set name: "+Te.stringValue(e)),this.data[e]},xr.addDataPipeline=function(e,t){return this.data.hasOwnProperty(e)&&Te.error("Duplicate data set name: "+Te.stringValue(e)),this.addData(e,Qn.fromEntries(this,t))};var wr="sans-serif",Rr=30,Or=2,zr="#4c78a8",Pr="#000",jr="#888",Dr="#ddd";e.formatLocale=n.formatDefaultLocale,e.timeFormatLocale=r.timeFormatDefaultLocale,e.parse=function(e,t){return Te.isObject(e)||Te.error("Input Vega specification must be an object."),vr(e,new yr(Sr([t,e.config]))).toRuntime()},e.config=Sr,e.signal=m,e.signalUpdates=De,e.stream=Se,e.codeGenerator=le,e.functionContext=ne,e.expressionFunction=ie,e.MarkRole=en,e.FrameRole=tn,e.ScopeRole=nn,e.AxisRole=rn,e.AxisDomainRole=an,e.AxisGridRole=on,e.AxisLabelRole=ln,e.AxisTickRole=sn,e.AxisTitleRole=un,e.LegendRole=dn,e.LegendEntryRole=fn,e.LegendLabelRole=pn,e.LegendSymbolRole=hn,e.LegendTitleRole=mn,e.Scope=yr,e.DataScope=Qn,Object.defineProperty(e,"__esModule",{value:!0})});